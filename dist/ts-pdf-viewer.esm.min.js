/**
 * Copyright 2021 yermolim
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * 
 * FlateStream class is based on the corresponding one from PDF.js,
 * so the code of that class is also subject to the next license notice:
 * 
 * Copyright 2012 Mozilla Foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Copyright 1996-2003 Glyph & Cog, LLC
 * 
 * The flate stream implementation contained in this file is a JavaScript port
 * of XPDF's implementation, made available under the Apache 2.0 open source
 * license.
 */

import{renderTextLayer as e,RenderingCancelledException as t,GlobalWorkerOptions as r,getDocument as n}from"pdfjs-dist";import s from"crypto-es";import i from"pako";function a(e,t,r){return Math.max(t,Math.min(e,r))}function o(e,t,r,n){return Math.hypot(r-e,n-t)}class h{constructor(e){this.data=e}}class c{constructor(e){this._length=0,e&&this.push(e)}get head(){return this._head.data}get length(){return this._length}get tail(){return this.get(this._length-1)}push(e){const t=new h(e);let r;if(this._head){for(r=this._head;r.next;)r=r.next;r.next=t}else this._head=t;this._length++}insert(e,t){if(t<0||t>this._length-1)return null;const r=new h(e);let n,s=this._head,i=0;if(t){for(;i++<t;)n=s,s=s.next;n.next=r}else this._head=r;return r.next=s,this._length++,r.data}replace(e,t){if(t<0||t>this._length-1)return null;const r=new h(e);let n,s=this._head,i=0;if(t){for(;i++<t;)n=s,s=s.next;n.next=r}else this._head=r;return r.next=s.next,s.data}remove(e){if(e<0||e>this._length-1)return null;let t,r=this._head,n=0;if(e){for(;n++<e;)t=r,r=r.next;t.next=r.next}else this._head=r.next;return this._length--,r.data}clear(){this._head=null,this._length=0}get(e){if(e<0||e>this._length-1)return null;let t=this._head,r=0;for(;r++<e;)t=t.next;return t.data}pop(){return this.remove(this._length-1)}has(e,t){if(!this._length)return!1;t||(t=(e,t)=>e===t);let r=this._head,n=0;for(;n<this._length;){if(t(e,r.data))return!0;r=r.next,n++}return!1}findIndex(e,t){if(!this._length)return-1;t||(t=(e,t)=>e===t);let r=this._head,n=0;for(;n<this._length;){if(t(e,r.data))return n;r=r.next,n++}return-1}*[Symbol.iterator](){let e=this._head;for(;e;)yield e.data,e=e.next}}var d=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{h(n.next(e))}catch(e){i(e)}}function o(e){try{h(n.throw(e))}catch(e){i(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}h((n=n.apply(e,t||[])).next())}))};class u{constructor(e){if(this.onMouseDown=e=>{var t;this._divModeTimer&&(clearTimeout(this._divModeTimer),this._divModeTimer=null),null===(t=this._renderTask)||void 0===t||t.expandTextDivs(!0)},this.onMouseUp=e=>{this._divModeTimer=setTimeout((()=>{var e;null===(e=this._renderTask)||void 0===e||e.expandTextDivs(!1),this._divModeTimer=null}),300)},!e)throw new Error("Page proxy is not defined");this._pageProxy=e,this._container=document.createElement("div"),this._container.classList.add("page-text"),this._container.addEventListener("mousedown",this.onMouseDown),this._container.addEventListener("mouseup",this.onMouseUp)}static appendPageTextAsync(e,t,r){return d(this,void 0,void 0,(function*(){const n=new u(e);return yield n.renderTextLayerAsync(r),t.append(n._container),n}))}destroy(){this.destroyRenderTask(),this._container&&(this._container.remove(),this._container=null)}renderTextLayerAsync(t){return d(this,void 0,void 0,(function*(){this.clear(),this.destroyRenderTask();const r=this._pageProxy.getViewport({scale:t}),n=this._pageProxy.streamTextContent();this._renderTask=e({container:this._container,textContentStream:n,viewport:r,enhanceTextSelection:!0});try{yield this._renderTask.promise}catch(e){if("TextLayer task cancelled."===e.message)return!1;throw e}return!0}))}clear(){this._container.innerHTML=""}destroyRenderTask(){this._renderTask&&(this._renderTask.cancel(),this._renderTask=null)}}var l=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{h(n.next(e))}catch(e){i(e)}}function o(e){try{h(n.throw(e))}catch(e){i(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}h((n=n.apply(e,t||[])).next())}))};class p{constructor(e,t,r){if(!e)throw new Error("Page proxy is not defined");this._pageProxy=e,this._viewport=e.getViewport({scale:1}),this._maxScale=Math.max(t,1),this.number=e.pageNumber,this.id=e.ref.num,this.generation=e.ref.gen;const{width:n,height:s}=this._viewport,i=(r=Math.max(null!=r?r:0,50))*(s/n);this._dimensions={width:n,height:s,previewWidth:r,previewHeight:i},this._previewContainer=document.createElement("div"),this._previewContainer.classList.add("page-preview"),this._previewContainer.setAttribute("data-page-number",this.number+""),this._previewContainer.setAttribute("data-page-id",this.id+""),this._previewContainer.setAttribute("data-page-gen",this.generation+""),this._previewContainer.style.width=this._dimensions.previewWidth+"px",this._previewContainer.style.height=this._dimensions.previewHeight+"px",this._viewContainer=document.createElement("div"),this._viewContainer.classList.add("page"),this._viewContainer.setAttribute("data-page-number",this.number+""),this._viewContainer.setAttribute("data-page-id",this.id+""),this._viewContainer.setAttribute("data-page-gen",this.generation+""),this.scale=1}get previewContainer(){return this._previewContainer}get viewContainer(){return this._viewContainer}set _viewRendered(e){this.$viewRendered=e,this._viewContainer.setAttribute("data-loaded",e+"")}get _viewRendered(){return this.$viewRendered}set scale(e){if(e<=0||this._scale===e)return;this._scale=e;const t=window.devicePixelRatio;this._dimensions.scaledWidth=this._dimensions.width*this._scale,this._dimensions.scaledHeight=this._dimensions.height*this._scale,this._dimensions.scaledDprWidth=this._dimensions.scaledWidth*t,this._dimensions.scaledDprHeight=this._dimensions.scaledHeight*t,this._viewContainer.style.width=this._dimensions.scaledWidth+"px",this._viewContainer.style.height=this._dimensions.scaledHeight+"px",this._viewCanvas&&(this._viewCanvas.style.width=this._dimensions.scaledWidth+"px",this._viewCanvas.style.height=this._dimensions.scaledHeight+"px"),this._scaleIsValid=!1}get viewValid(){return this._scaleIsValid&&this._viewRendered}destroy(){this._previewContainer.remove(),this._viewContainer.remove(),this._pageProxy.cleanup()}renderPreviewAsync(e=!1){return l(this,void 0,void 0,(function*(){if(this._renderPromise&&(e&&this.cancelRenderTask(),yield this._renderPromise),e||!this._previewRendered)return this._renderPromise=this.runPreviewRenderAsync(),this._renderPromise}))}renderViewAsync(e=!1){return l(this,void 0,void 0,(function*(){if(this._renderPromise&&(e&&this.cancelRenderTask(),yield this._renderPromise),e||!this.viewValid)return this._renderPromise=this.runViewRenderAsync(),this._renderPromise}))}clearPreview(){this._previewContainer.innerHTML=""}clearView(){var e,t;null===(e=this._text)||void 0===e||e.destroy(),null===(t=this._viewCanvas)||void 0===t||t.remove(),this._viewRendered=!1}cancelRenderTask(){this._renderTask&&(this._renderTask.cancel(),this._renderTask=null)}runRenderTaskAsync(e){return l(this,void 0,void 0,(function*(){this.cancelRenderTask(),this._renderTask=this._pageProxy.render(e);try{yield this._renderTask.promise}catch(e){if(e instanceof t)return!1;throw e}finally{this._renderTask=null}return!0}))}createPreviewCanvas(){const e=document.createElement("canvas");e.classList.add("page-canvas");const t=window.devicePixelRatio,{previewWidth:r,previewHeight:n}=this._dimensions;return e.style.width=r+"px",e.style.height=n+"px",e.width=r*t,e.height=n*t,e}createViewCanvas(){const e=document.createElement("canvas");return e.classList.add("page-canvas"),e.style.width=this._dimensions.scaledWidth+"px",e.style.height=this._dimensions.scaledHeight+"px",e.width=this._dimensions.scaledDprWidth,e.height=this._dimensions.scaledDprHeight,e}scaleCanvasImage(e,t){let r,n=this._scale/this._maxScale,s=e;for(;n<.5;)r=document.createElement("canvas"),r.width=.5*s.width,r.height=.5*s.height,r.getContext("2d").drawImage(s,0,0,r.width,r.height),s=r,n*=2;t.getContext("2d").drawImage(s,0,0,t.width,t.height)}runPreviewRenderAsync(){return l(this,void 0,void 0,(function*(){const e=this.createPreviewCanvas(),t={canvasContext:e.getContext("2d"),viewport:this._viewport.clone({scale:e.width/this._dimensions.width})};(yield this.runRenderTaskAsync(t))?(this._previewContainer.innerHTML="",this._previewContainer.append(e),this._previewRendered=!0):this._previewRendered=!1}))}runViewRenderAsync(){var e,t;return l(this,void 0,void 0,(function*(){const r=this._scale;null===(e=this._text)||void 0===e||e.destroy();const n=this.createViewCanvas(),s={canvasContext:n.getContext("2d"),viewport:this._viewport.clone({scale:r*window.devicePixelRatio}),enableWebGL:!0};(yield this.runRenderTaskAsync(s))&&r===this._scale&&(null===(t=this._viewCanvas)||void 0===t||t.remove(),this._viewContainer.append(n),this._viewCanvas=n,this._viewRendered=!0,this._text=yield u.appendPageTextAsync(this._pageProxy,this._viewContainer,r),r===this._scale&&(this._scaleIsValid=!0))}))}}const f=0,A=8,w=9,y=10,g=12,v=13,m=32,b=37,E=40,C=41,x=45,P=46,_=47,S=48,N=49,k=50,I=51,D=52,R=53,B=54,T=55,L=56,M=57,O=60,U=62,F=70,V=80,H=82,W=83,Q=88,j=91,K=92,X=93,q=97,Y=98,z=100,G=101,J=102,Z=106,$=108,ee=109,te=110,re=111,ne=112,se=114,ie=115,ae=116,oe=117,he=120,ce=121,de={NULL:[te,oe,$,$],OBJ:[re,Y,Z],OBJ_END:[G,te,z,re,Y,Z],STREAM_START:[ie,ae,se,G,q,ee],STREAM_END:[G,te,z,ie,ae,se,G,q,ee],DICT_START:[O,O],DICT_END:[U,U],ARRAY_START:[j],ARRAY_END:[X],STR_LITERAL_START:[E],STR_LITERAL_END:[C],STR_HEX_START:[O],STR_HEX_END:[U],VERSION:[b,V,68,F,x],PREV:[_,V,se,G,118],TYPE:[_,84,ce,ne,G],SUBTYPE:[_,W,oe,Y,ae,ce,ne,G],XREF_TABLE:[he,se,G,J],XREF_STREAM:[_,Q,H,G,J],XREF_HYBRID:[Q,H,G,J,W,ae,ee],XREF_START:[ie,ae,q,se,ae,he,se,G,J],TRAILER:[ae,se,q,105,$,G,se],END_OF_FILE:[b,b,69,79,F],END_OF_LINE:[v,y],TRUE:[ae,se,oe,G],FALSE:[J,q,$,ie,G]},ue=new Set([b,E,C,_,O,U,j,X,123,125]),le=new Set([f,w,y,g,v,m]),pe=new Set([S,N,k,I,D,R,B,T,L,M]);function fe(e){return!ue.has(e)&&!le.has(e)}function Ae(e){if(!(null==e?void 0:e.length))return 0;if(1===e.length)return e[0];const t=Array.from(e,(e=>("0"+(255&e).toString(16)).slice(-2))).join("");return parseInt(t,16)}function we(e){const t=new ArrayBuffer(1);return new DataView(t).setInt8(0,e),new Uint8Array(t)}function ye(e,t=!1){const r=new ArrayBuffer(2);return new DataView(r).setInt16(0,e,t),new Uint8Array(r)}function ge(e,t=!1){const r=new ArrayBuffer(4);return new DataView(r).setInt32(0,e,t),new Uint8Array(r)}function ve(e,t){const r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t;return r}function me(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function be(e){const t=new Uint8Array(e.length/2);for(let r=0,n=0;r<e.length;r+=2,n++)t[n]=parseInt(e.substr(r,2),16);return t}const Ee=3,Ce=4,xe=5,Pe=7,_e=8,Se=0,Ne=1,ke=0,Ie=1,De=2,Re="/FlateDecode",Be=1,Te=2,Le=10,Me=11,Oe=12,Ue=13,Fe=14,Ve=15,He={RC4_40:1,RC4_128:2,AES_128:4,AES_256:5},We={RC4_40:2,RC4_128:3,AES_128:4,AES_256:5,AES_256_V2:6},Qe={NONE:"/None",RC4:"/V2",AES_128:"/AESV2",AES_256:"/AESV3"},je={DOC_OPEN:"/DocOpen",EMBEDDED_OPEN:"/EFOpen"},Ke={LEFT:0,CENTER:1,RIGHT:2},Xe="/XRef",qe="/ObjStm",Ye="/XRef",ze="/Catalog",Ge="/Pages",Je="/Page",Ze="/Annot",$e="/Border",et="/Measure",tt="/CryptFilter",rt="",nt=0,st=2,it=3,at=4,ot=5,ht=6,ct=7,dt=8,ut=9,lt=10,pt=11,ft="/Text",At="/FreeText",wt="/Line",yt="/Square",gt="/Circle",vt="/Polygon",mt="/PolyLine",bt="/Stamp",Et="/Ink",Ct={MARKED:"/Marked",REVIEW:"/Review"},xt={MARKED:"/Marked",UNMARKED:"/Unmarked"},Pt={ACCEPTED:"/Accepted",REJECTED:"/Rejected",CANCELLED:"/Cancelled",COMPLETED:"/Completed",NONE:"/None"},_t={COMMENT:"/Comment",KEY:"/Key",NOTE:"/Note",HELP:"/Help",NEW_PARAGRAPH:"/NewParagraph",PARAGRAPH:"/Paragraph",INSERT:"/Insert"},St={SQUARE:"/Square",CIRCLE:"/Circle",DIAMOND:"/Diamond",ARROW_OPEN:"/OpenArrow",ARROW_CLOSED:"/ClosedArrow",NONE:"/None",BUTT:"/Butt",ARROW_OPEN_R:"/ROpenArrow",ARROW_CLOSED_R:"/RClosedArrow",SLASH:"/Slash"},Nt=new Set([Re]),kt=new Uint8Array([40,191,78,94,78,117,138,65,100,0,78,86,255,250,1,8]);function It(e){return s.lib.WordArray.create(e)}function Dt(e){return function(e,t=!1){const r=new ArrayBuffer(4*e.length),n=new DataView(r);for(let r=0;r<e.length;r++)n.setInt32(4*r,e[r],t);return new Uint8Array(r)}(e.words).slice(0,e.sigBytes)}function Rt(e){e instanceof Uint8Array&&(e=It(e));return s.MD5(e)}function Bt(e,t){e instanceof Uint8Array&&(e=It(e)),t instanceof Uint8Array&&(t=It(t));return s.RC4.encrypt(e,t).ciphertext}function Tt(e,t,r){e instanceof Uint8Array&&(e=It(e)),t instanceof Uint8Array&&(t=It(t));const n=s.lib.WordArray.create(function(e,t=!1){if(!(null==e?void 0:e.length))return null;const r=new ArrayBuffer(4*Math.ceil(e.length/4)),n=new DataView(r);for(let t=0;t<e.length;t++)n.setUint8(t,e[t]);const s=new Int32Array(r.byteLength/4);for(let e=0;e<s.length;e++)s[e]=n.getInt32(4*e,t);return s}(r));return s.AES.encrypt(e,t,{mode:s.mode.CBC,iv:n,padding:s.pad.Pkcs7}).ciphertext}const Lt=[115,65,108,84];class Mt{constructor(e){if(!e)throw new Error("Empty key");if(16!==e.length)throw new Error(`Invalid key length: ${e.length} (shall be 16)`);this._n=e.length,this._key=e,this._tempKey=new Uint8Array(e.length+9)}encrypt(e,t){return this.run(e,t.id,t.generation,kt)}decrypt(e,t){return this.run(e,t.id,t.generation)}run(e,t,r,n){const s=ge(t,!0),i=ge(r,!0);this._tempKey.set(this._key,0),this._tempKey.set(s.subarray(0,3),this._n),this._tempKey.set(i.subarray(0,2),this._n+3),this._tempKey.set(Lt,this._n+5);const a=Dt(Rt(this._tempKey)),o=Math.max(this._n+5,16),h=a.slice(0,o);null!=n||(n=e.slice(0,16));return Dt(Tt(e,h,n))}}class Ot{constructor(e){if(!e)throw new Error("Empty key");if(32!==e.length)throw new Error(`Invalid key length: ${e.length} (shall be 16)`);this._n=e.length,this._key=e}encrypt(e,t){return this.run(e,t.id,t.generation,new Uint8Array(kt))}decrypt(e,t){return this.run(e,t.id,t.generation)}run(e,t,r,n){null!=n||(n=e.slice(0,16));return Dt(Tt(e,this._key,n))}}class Ut{constructor(){}encrypt(e,t){return e}decrypt(e,t){return e}}class Ft{constructor(e){if(!e)throw new Error("Empty key");if(e.length<5||e.length>16)throw new Error(`Invalid key length: ${e.length} (shall be a multiple in range from 40 to 128)`);this._n=e.length,this._key=e,this._tempKey=new Uint8Array(e.length+5)}encrypt(e,t){const r=ge(t.id,!0),n=ge(t.generation,!0);this._tempKey.set(this._key,0),this._tempKey.set(r.slice(0,3),this._n),this._tempKey.set(n.slice(0,2),this._n+3);const s=Dt(Rt(this._tempKey)),i=Math.min(this._n+5,16);return Dt(Bt(e,s.slice(0,i)))}decrypt(e,t){return this.encrypt(e,t)}}const Vt=[40,191,78,94,78,117,138,65,100,0,78,86,255,250,1,8,46,46,0,182,208,104,62,128,47,12,169,254,100,83,105,122];class Ht{constructor(e,t){const{filter:r,version:n,revision:s,permissions:i,encryptMetadata:a,keyLength:o,stringKeyLength:h,streamKeyLength:c,stringMethod:d,streamMethod:u,oPasswordHash:l,uPasswordHash:p,oEncPasswordHash:f,uEncPasswordHash:A,perms:w}=e;if("/Standard"!==r)throw new Error(`Unsupported filter name: ${r}`);if(![1,2,4,5].includes(n))throw new Error(`Unsupported algorithm version: ${n}`);if(![2,3,4,5,6].includes(s))throw new Error(`Unsupported algorithm revision: ${s}`);if(isNaN(i))throw new Error("Permissions not provided");if(!l||!p)throw new Error("Password hash not provided");this._filter=r,this._version=n,this._revision=s,this._permissions=i,this._keyLength=o,this._encryptMetadata=a,this._stringKeyLength=h,this._streamKeyLength=c,this._stringMethod=d,this._streamMethod=u,this._oPasswordHash=l,this._uPasswordHash=p,this._oEncPasswordHash=f,this._uEncPasswordHash=A,this._perms=w,this._fileId=t}authenticate(e){const t=this._version,r=this._stringMethod,n=this._streamMethod;let s=!1;if(this.authOwnerPassword(e))s=!0;else{if(!this.authUserPassword(e))return null}const i=this._lastEncryptionKey;switch(t){case 1:const e=new Ft(i);return{owner:s,stringCryptor:e,streamCryptor:e};case 2:const t=new Ft(i);return{owner:s,stringCryptor:t,streamCryptor:t};case 4:let a,o;if(r&&r!==Qe.NONE)if(r===Qe.RC4)a=new Ft(i);else{if(r!==Qe.AES_128)throw new Error(`Invalid crypt method: ${r}`);a=new Mt(i)}else a=new Ut;if(n&&n!==Qe.NONE)if(n===Qe.RC4)o=new Ft(i);else{if(n!==Qe.AES_128)throw new Error(`Invalid crypt method: ${n}`);o=new Mt(i)}else o=new Ut;return{owner:s,stringCryptor:a,streamCryptor:o};case 5:let h,c;if(r&&r!==Qe.NONE){if(r!==Qe.AES_256)throw new Error(`Invalid crypt method: ${r}`);a=new Ot(i)}else a=new Ut;if(n&&n!==Qe.NONE){if(n!==Qe.AES_256)throw new Error(`Invalid crypt method: ${n}`);o=new Ot(i)}else o=new Ut;return{owner:s,stringCryptor:h,streamCryptor:c}}}padPassword32(e){if(!e)return new Uint8Array(Vt);const t=(new TextEncoder).encode(e),r=new Uint8Array(32);return r.set(t.slice(0,32)),t.length<32&&r.set(Vt.slice(0,32-t.length),t.length),r}computeEncryptionKey(e){if([2,3,4].includes(this._revision)){const t=this.padPassword32(e),r=ge(this._permissions,!0),n=this._revision>=4&&!this._encryptMetadata?new Uint8Array([255,255,255,255]):new Uint8Array(0);let s=Dt(Rt(new Uint8Array([...t,...this._oPasswordHash,...r,...this._fileId,...n])));const i=this._keyLength>>3;if(this._revision>=3)for(let e=0;e<50;e++)s=Dt(Rt(s.slice(0,i)));const a=s.slice(0,i);return this._lastEncryptionKey=a,a}if(5===this._revision)throw new Error("Not implemented yet");if(6===this._revision)throw new Error("Not implemented yet")}computeOHashEncryptionKey_R2R3R4(e){let t=Rt(this.padPassword32(e));if(this._revision>=3)for(let e=0;e<50;e++)t=Rt(t);const r=Dt(t),n=this._keyLength>>3;return r.slice(0,n)}computeOHash_R2R3R4(e,t){const r=this.computeOHashEncryptionKey_R2R3R4(e||t);let n=Bt(this.padPassword32(t),r);if(this._revision>=3)for(let e=1;e<20;e++)n=Bt(n,ve(r,e));return Dt(n)}computeUHash_R2(e){const t=this.computeEncryptionKey(e);return Dt(Bt(new Uint8Array(Vt),t))}computeUHash_R3R4(e){const t=this.computeEncryptionKey(e);let r=Rt(new Uint8Array([...Vt,...this._fileId]));r=Bt(r,t);for(let e=1;e<20;e++)r=Bt(r,ve(t,e));return Dt(r)}authOwnerPassword(e){if([2,3,4].includes(this._revision)){const t=this.computeOHashEncryptionKey_R2R3R4(e);let r;if(2===this._revision)r=Dt(Bt(this._oPasswordHash,t));else{let e=It(this._oPasswordHash);for(let r=19;r>=0;r--)e=Bt(e,ve(t,r));r=Dt(e)}const n=function(e,t){if((null==e?void 0:e.length)&&(null==t?void 0:t.length)){let r;e:for(let n=0;n<=e.length;n++){let s=!1;for(r=0;r<t.length;r++){if(!(n+r<e.length)){if(s)return n;break e}if(e[n+r]!==t[r])continue e;s=!0}}}return-1}(r,new Uint8Array(Vt)),s=(new TextDecoder).decode(-1===n?r:r.subarray(0,n));return this.authUserPassword(s)}if(5===this._revision)throw new Error("Not implemented yet");if(6===this._revision)throw new Error("Not implemented yet")}authUserPassword(e){let t;if(2===this._revision)return t=this.computeUHash_R2(e),me(this._uPasswordHash,t);if(3===this._revision||4===this._revision)return t=this.computeUHash_R3R4(e),me(this._uPasswordHash.subarray(0,16),t);if(5===this._revision)throw new Error("Not implemented yet");if(6===this._revision)throw new Error("Not implemented yet")}}class Wt{constructor(e,t){this.literal=e,this.bytes=t}static parse(e,t,r=null,n=!0){const s=e.getLiteralBounds(t,n);if(!s)return;let i=Wt.unescape(e.subCharCodes(s.start+1,s.end-1));(null==r?void 0:r.ref)&&r.stringCryptor&&(i=r.stringCryptor.decrypt(i,r.ref));return{value:Wt.fromBytes(i),start:s.start,end:s.end}}static fromBytes(e){const t=(254===e[0]&&255===e[1]?new TextDecoder("utf-16be"):new TextDecoder).decode(e);return new Wt(t,e)}static fromString(e){const t=[];t.push(254,255);for(let r=0;r<e.length;r++){const n=e.charCodeAt(r);t.push((65280&n)>>>8),t.push(255&n)}return new Wt(e,new Uint8Array(t))}static escape(e){const t=[];for(let r=0;r<e.length;r++)switch(e[r]){case y:t.push(K),t.push(te);break;case v:t.push(K),t.push(se);break;case w:t.push(K),t.push(ae);break;case A:t.push(K),t.push(Y);break;case g:t.push(K),t.push(J);break;case E:t.push(K),t.push(E);break;case C:t.push(K),t.push(C);break;case K:t.push(K),t.push(K);break;default:t.push(e[r])}return new Uint8Array(t)}static unescape(e){const t=[];let r=!1;for(let n=0;n<e.length;n++)if(r){switch(e[n]){case te:t.push(y);break;case se:t.push(v);break;case ae:t.push(w);break;case Y:t.push(A);break;case J:t.push(g);break;case E:t.push(E);break;case C:t.push(C);break;case K:t.push(K);break;default:t.push(e[n])}r=!1}else e[n]!==K?t.push(e[n]):r=!0;return new Uint8Array(t)}toArray(e){const t=(null==e?void 0:e.ref)&&e.stringCryptor?e.stringCryptor.encrypt(this.bytes,e.ref):this.bytes;return new Uint8Array([...de.STR_LITERAL_START,...Wt.escape(t),...de.STR_LITERAL_END])}}class Qt{constructor(e,t){this.source=e,this.date=t}static parse(e,t,r=null,n=!0){if(n&&(t=e.skipEmpty(t)),e.isOutside(t)||e.getCharCode(t)!==E)return null;const s=e.findCharIndex(C,"straight",t);if(-1===s)return null;let i=e.subCharCodes(t+1,s-1);(null==r?void 0:r.ref)&&r.stringCryptor&&(i=r.stringCryptor.decrypt(i,r.ref));try{return{value:Qt.fromArray(i),start:t,end:s}}catch(e){return null}}static fromDate(e){const t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0");return new Qt(`D:${t}${r}${n}${s}${i}${a}`,e)}static fromString(e){const t=/D:(?<Y>\d{4})(?<M>\d{2})(?<D>\d{2})(?<h>\d{2})(?<m>\d{2})(?<s>\d{2})/.exec(e),r=new Date(+t.groups.Y,+t.groups.M-1,+t.groups.D,+t.groups.h,+t.groups.m,+t.groups.s);return new Qt(e,r)}static fromArray(e){const t=(new TextDecoder).decode(e);return Qt.fromString(t)}toArray(e){let t=(new TextEncoder).encode(this.source);return(null==e?void 0:e.ref)&&e.stringCryptor&&(t=e.stringCryptor.encrypt(t,e.ref)),new Uint8Array([...de.STR_LITERAL_START,...t,...de.STR_LITERAL_END])}}class jt{constructor(e,t){this.id=null!=e?e:0,this.generation=null!=t?t:0}static parse(e,t,r=!0){if(r&&(t=e.findRegularIndex("straight",t)),t<0||t>e.maxIndex)return null;const n=e.parseNumberAt(t,!1,!1);if(!n||isNaN(n.value))return null;const s=e.parseNumberAt(n.end+2,!1,!1);return!s||isNaN(s.value)?null:{value:new jt(n.value,s.value),start:t,end:s.end}}static parseRef(e,t,r=!0){const n=jt.parse(e,t,r);if(!n)return null;const s=n.end+2,i=e.findSubarrayIndex([H],{minIndex:s,closedOnly:!0});return i&&i.start===s?{value:n.value,start:n.start,end:i.end}:null}static parseRefArray(e,t,r=!0){const n=e.getArrayBoundsAt(t,r);if(!n)return null;const s=[];let i,a=n.start+1;for(;a<n.end&&(i=jt.parseRef(e,a,!0),i);)s.push(i.value),a=i.end+1;return{value:s,start:n.start,end:n.end}}equals(e){return this.id===e.id&&this.generation===e.generation}toArray(e){return(new TextEncoder).encode(`${this.id} ${this.generation} R`)}toString(){return this.id+"|"+this.generation}}class Kt{constructor(){}get ref(){return this._ref}get id(){return this._ref.id}get generation(){return this._ref.generation}}class Xt extends Kt{constructor(e){super(),this.Type=e}get streamId(){return this._streamId}toArray(e){const t=new TextEncoder,r=[...de.DICT_START];return this.Type&&r.push(...de.TYPE,...t.encode(this.Type)),r.push(...de.DICT_END),new Uint8Array(r)}tryParseProps(e){var t;if(!e)return!1;this._ref=null===(t=e.cryptInfo)||void 0===t?void 0:t.ref,this._streamId=e.streamId;const{parser:r,bounds:n}=e,s=n.contentStart||n.start,i=n.contentEnd||n.end;let a,o,h=r.skipToNextName(s,i-1);if(-1===h)return!1;for(;o=r.parseNameAt(h),o;)switch(h=o.end+1,a=o.value,a){case"/Type":const e=r.parseNameAt(h);if(e)return!this.Type||this.Type===e.value;throw new Error("Can't parse /Type property value");default:h=r.skipToNextName(h,i-1)}return!0}}class qt extends Xt{constructor(){super(rt),this.Predictor=Be,this.Colors=1,this.BitsPerComponent=8,this.Columns=1}static parse(e){const t=new qt;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.Predictor&&n.push(...r.encode("/Predictor"),...r.encode(" "+this.Predictor)),this.Colors&&n.push(...r.encode("/Colors"),...r.encode(" "+this.Colors)),this.BitsPerComponent&&n.push(...r.encode("/BitsPerComponent"),...r.encode(" "+this.BitsPerComponent)),this.Columns&&n.push(...r.encode("/Columns"),...r.encode(" "+this.Columns));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Predictor":const e=t.parseNumberAt(o,!1);if(!e)throw new Error("Can't parse /Colors property value");this.Predictor=e.value,o=e.end+1;break;case"/Colors":const r=t.parseNumberAt(o,!1);if(!r)throw new Error("Can't parse /Colors property value");this.Colors=r.value,o=r.end+1;break;case"/BitsPerComponent":const n=t.parseNumberAt(o,!1);if(!n)throw new Error("Can't parse /BitsPerComponent property value");this.BitsPerComponent=n.value,o=n.end+1;break;case"/Columns":const i=t.parseNumberAt(o,!1);if(!i)throw new Error("Can't parse /Columns property value");this.Columns=i.value,o=i.end+1;break;default:o=t.skipToNextName(o,s-1)}return!0}}class Yt extends class{constructor(e){this._minBufferLength=512,this._bufferLength=0,this._current=0,this._ended=!1,this._sourceStream=e}get length(){return this._buffer.length}ensureBuffer(e){const t=this._buffer;if(t&&e<=t.byteLength)return t;let r=this._minBufferLength;for(;r<e;)r*=2;const n=new Uint8Array(r);return t&&n.set(t),this._buffer=n}takeByte(){const e=this._current;for(;this._bufferLength<=e;){if(this._ended)return-1;this._readBlock()}return this._buffer[this._current++]}takeBytes(e){let t;const r=this._current;if(e){for(this.ensureBuffer(r+e),t=r+e;!this._ended&&this._bufferLength<t;)this._readBlock();t>this._bufferLength&&(t=this._bufferLength)}else{for(;!this._ended;)this._readBlock();t=this._bufferLength}this._current=t;return this._buffer.subarray(r,t)}takeUint16(){const e=this.takeByte(),t=this.takeByte();return-1===e||-1===t?-1:(e<<8)+t}takeInt32(){return(this.takeByte()<<24)+(this.takeByte()<<16)+(this.takeByte()<<8)+this.takeByte()}peekByte(){const e=this.takeByte();return-1!==e&&this._current--,e}peekBytes(e){const t=this.takeBytes(e);return this._current-=t.length,t}skip(e){this._current+=e||1}reset(){this._current=0}}{constructor(e){super(e),this._codeSize=0,this._codeBuf=0;const t=e.takeByte(),r=e.takeByte();if(-1===t||-1===r)throw new Error(`Invalid header in flate stream: ${t}, ${r}`);if(8!=(15&t))throw new Error(`Unknown compression method in flate stream: ${t}, ${r}`);if(((t<<8)+r)%31!=0)throw new Error(`Bad FCHECK in flate stream: ${t}, ${r}`);if(32&r)throw new Error(`FDICT bit set in flate stream: ${t}, ${r}`);this._codeSize=0,this._codeBuf=0}_readBlock(){let e,t;const r=this._sourceStream;let n,s,i=this.getBits(3);if(1&i&&(this._ended=!0),i>>=1,0===i){let t;if(-1===(t=r.takeByte()))throw new Error("Bad block header in flate stream");let n=t;if(-1===(t=r.takeByte()))throw new Error("Bad block header in flate stream");if(n|=t<<8,-1===(t=r.takeByte()))throw new Error("Bad block header in flate stream");let s=t;if(-1===(t=r.takeByte()))throw new Error("Bad block header in flate stream");if(s|=t<<8,s!==(65535&~n)&&(0!==n||0!==s))throw new Error("Bad uncompressed block length in flate stream");this._codeBuf=0,this._codeSize=0;const i=this._bufferLength,a=i+n;if(e=this.ensureBuffer(a),this._bufferLength=a,0===n)-1===r.peekByte()&&(this._ended=!0);else{const t=r.takeBytes(n);e.set(t,i),t.length<n&&(this._ended=!0)}return}if(1===i)n=Yt.fixedLitCodeTab,s=Yt.fixedDistCodeTab;else{if(2!==i)throw new Error("Unknown block type in flate stream");{const e=this.getBits(5)+257,r=this.getBits(5)+1,i=this.getBits(4)+4,a=new Uint8Array(Yt.codeLenCodeMap.length);let o;for(o=0;o<i;o++)a[Yt.codeLenCodeMap[o]]=this.getBits(3);const h=this.generateHuffmanTable(a);t=0,o=0;const c=e+r,d=new Uint8Array(c);let u,l,p;for(;o<c;){const e=this.getCode(h);if(16===e)u=2,l=3,p=t;else if(17===e)u=3,l=3,p=t=0;else{if(18!==e){d[o++]=t=e;continue}u=7,l=11,p=t=0}let r=this.getBits(u)+l;for(;r-- >0;)d[o++]=p}n=this.generateHuffmanTable(d.subarray(0,e)),s=this.generateHuffmanTable(d.subarray(e,c))}}e=this._buffer;let a=e?e.length:0,o=this._bufferLength;for(;;){let r=this.getCode(n);if(r<256){o+1>=a&&(e=this.ensureBuffer(o+1),a=e.length),e[o++]=r;continue}if(256===r)return void(this._bufferLength=o);r-=257,r=Yt.lengthDecode[r];let i=r>>16;i>0&&(i=this.getBits(i)),t=(65535&r)+i,r=this.getCode(s),r=Yt.distDecode[r],i=r>>16,i>0&&(i=this.getBits(i));const h=(65535&r)+i;o+t>=a&&(e=this.ensureBuffer(o+t),a=e.length);for(let r=0;r<t;++r,++o)e[o]=e[o-h]}}getBits(e){const t=this._sourceStream;let r,n=this._codeSize,s=this._codeBuf;for(;n<e;){if(-1===(r=t.takeByte()))throw new Error("Bad encoding in flate stream");s|=r<<n,n+=8}return r=s&(1<<e)-1,this._codeBuf=s>>e,this._codeSize=n-=e,r}getCode(e){const t=this._sourceStream,[r,n]=e;let s,i=this._codeSize,a=this._codeBuf;for(;i<n&&-1!==(s=t.takeByte());)a|=s<<i,i+=8;const o=r[a&(1<<n)-1],h=o>>16,c=65535&o;if(h<1||i<h)throw new Error("Bad encoding in flate stream");return this._codeBuf=a>>h,this._codeSize=i-h,c}generateHuffmanTable(e){const t=e.length;let r,n=0;for(r=0;r<t;r++)e[r]>n&&(n=e[r]);const s=1<<n,i=new Int32Array(s);for(let a=1,o=0,h=2;a<=n;a++,o<<=1,h<<=1)for(let n=0;n<t;n++)if(e[n]===a){let e=0,t=o;for(r=0;r<a;r++)e=e<<1|1&t,t>>=1;for(r=e;r<s;r+=h)i[r]=a<<16|n;o++}return[i,n]}}Yt.codeLenCodeMap=new Int32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Yt.lengthDecode=new Int32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),Yt.distDecode=new Int32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),Yt.fixedLitCodeTab=[new Int32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],Yt.fixedDistCodeTab=[new Int32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];class zt{constructor(e,t=0,r){if(r&&r<0)throw new Error("Stream length can't be negative");this._bytes=e instanceof Uint8Array?e:new Uint8Array(e),this._start=t,this._current=t,this._end=t+r||e.length}get length(){return this._end-this._start}takeByte(){return this._current>=this._end?-1:this._bytes[this._current++]}takeBytes(e){const t=this._bytes,r=this._current,n=this._end;if(e){let s=r+e;s>n&&(s=n),this._current=s;return t.subarray(r,s)}return t.subarray(r,n)}takeUint16(){const e=this.takeByte(),t=this.takeByte();return-1===e||-1===t?-1:(e<<8)+t}takeInt32(){return(this.takeByte()<<24)+(this.takeByte()<<16)+(this.takeByte()<<8)+this.takeByte()}peekByte(){const e=this.takeByte();return-1!==e&&this._current--,e}peekBytes(e){const t=this.takeBytes(e);return this._current-=t.length,t}getByte(e){return this._bytes[e]}getByteRange(e,t){return this._bytes.subarray(Math.max(e,0),Math.min(t,this._end))}skip(e){this._current+=e||1}reset(){this._current=this._start}}class Gt{static Decode(e,t=Be,r=1,n=1,s=8){const i=new zt(e,0,e.length),a=new Yt(i).takeBytes(null);switch(t){case Be:return a;case Le:case Me:case Oe:case Ue:case Fe:case Ve:return Gt.removePngFilter(a,r,n,s);case Te:throw new Error("Unsupported filter predictor")}}static Encode(e,t=Oe,r=5,n=1,s=8){let a;switch(t){case Be:a=e;break;case Le:case Me:case Oe:case Ue:case Fe:case Ve:a=Gt.applyPngFilter(e,t,r,n,s);break;case Te:throw new Error("Unsupported filter predictor")}return i.deflate(a)}static removePngFilter(e,t,r,n){const s=Math.ceil(r*n/8),i=t*s,a=i+1;if(e.length%a)throw new Error("Data length doesn't match filter columns");const o=new Uint8Array(e.length/a*i),h=new Array(i).fill(0),c=new Array(i).fill(0),d=e=>e-s<0?0:c[e-s],u=e=>h[e];let l=0,p=0,f=0,A=0,w=0,y=0;for(let t=0;t<e.length;t++)if(t%a==0){if(w=e[t],l=0,t)for(f=0;f<i;f++)h[f]=o[A+f];A=p}else{switch(c[l]=e[t],w){case 0:y=c[l];break;case 1:y=(c[l]+d(l))%256;break;case 2:y=(c[l]+u(l))%256;break;case 3:y=(c[l]+Math.floor((u(l)+d(l))/2))%256;break;case 4:y=(c[l]+this.paethPredictor(d(l),u(l),(g=l)-s<0?0:h[g-s]))%256}o[p++]=y,l++}var g;return o}static applyPngFilter(e,t=12,r=5,n=1,s=8){let i;switch(t){case Le:i=0;break;case Me:i=1;break;case Oe:i=2;break;case Ue:i=3;break;case Fe:i=4;break;default:throw new Error("Invalid PNG filter type")}const a=Math.ceil(n*s/8),o=r*a,h=o+1,c=Math.ceil(e.length/o)*h,d=new Uint8Array(c),u=new Array(o).fill(0),l=new Array(o).fill(0),p=e=>e-a<0?0:l[e-a],f=e=>u[e];let A=0,w=0,y=0,g=0,v=0;for(let t=0;t<c;t++)if(t%h==0){if(A=0,t)for(y=0;y<o;y++)u[y]=e[g+y];g=w,d[t]=i}else{switch(l[A]=e[w++]||0,i){case 0:v=l[A];break;case 1:v=(l[A]-p(A))%256;break;case 2:v=(l[A]-f(A))%256;break;case 3:v=(l[A]-Math.floor((f(A)+p(A))/2))%256;break;case 4:v=(l[A]-this.paethPredictor(p(A),f(A),(m=A)-a<0?0:u[m-a]))%256}d[t]=v,A++}var m;return d}static paethPredictor(e,t,r){const n=e+t-r,s=Math.abs(n-e),i=Math.abs(n-t),a=Math.abs(n-r);return s<=i&&s<=a?e:i<=a?t:r}}class Jt extends Kt{constructor(e=null){super(),this.Type=e}get streamData(){return this._streamData}set streamData(e){let t;if(this.DecodeParms){const r=this.DecodeParms;t=Gt.Encode(e,r.Predictor,r.Columns,r.Colors,r.BitsPerComponent)}else t=Gt.Encode(e);this._streamData=t,this.Length=t.length,this.DL=e.length}get decodedStreamData(){let e;if(this.DecodeParms){const t=this.DecodeParms;e=Gt.Decode(this._streamData,t.Predictor,t.Columns,t.Colors,t.BitsPerComponent)}else e=Gt.Decode(this._streamData);return e}toArray(e){const t=new TextEncoder,r=[...de.DICT_START];this.Type&&r.push(...de.TYPE,...t.encode(this.Type)),this.Length&&r.push(...t.encode("/Length"),...t.encode(" "+this.Length)),this.Filter&&r.push(...t.encode("/Filter"),...t.encode(this.Filter)),this.DecodeParms&&r.push(...t.encode("/DecodeParms"),...this.DecodeParms.toArray(e));const n=(null==e?void 0:e.ref)&&e.streamCryptor?e.streamCryptor.encrypt(this.streamData,e.ref):this.streamData;return r.push(...de.DICT_END,...de.END_OF_LINE,...de.STREAM_START,...de.END_OF_LINE,...n,...de.END_OF_LINE,...de.STREAM_END,...de.END_OF_LINE),new Uint8Array(r)}tryParseProps(e){var t,r;if(!e)return!1;this._ref=null===(t=e.cryptInfo)||void 0===t?void 0:t.ref;const{parser:n,bounds:s}=e,i=s.contentStart||s.start,a=s.contentEnd||s.end,o=n.findSubarrayIndex(de.STREAM_END,{direction:"reverse",minIndex:i,maxIndex:a,closedOnly:!0});if(!o)return!1;const h=n.findSubarrayIndex(de.STREAM_START,{direction:"reverse",minIndex:i,maxIndex:o.start-1,closedOnly:!0});if(!h)return!1;const c=n.getDictBoundsAt(i);let d,u,l=n.skipToNextName(c.contentStart,c.contentEnd);if(-1===l)return!1;for(;u=n.parseNameAt(l),u;)switch(l=u.end+1,d=u.value,d){case"/Type":const e=n.parseNameAt(l);if(!e)throw new Error("Can't parse /Type property value");if(this.Type&&this.Type!==e.value)return!1;l=e.end+1;break;case"/Length":const t=n.parseNumberAt(l,!1);if(!t)throw new Error("Can't parse /Length property value");this.Length=t.value,l=t.end+1;break;case"/Filter":const r=n.getValueTypeAt(l);if(r===ht){const e=n.parseNameAt(l);if(e&&Nt.has(e.value)){this.Filter=e.value,l=e.end+1;break}throw new Error(`Unsupported /Filter property value: ${e.value}`)}if(r===ct){const e=n.parseNameArrayAt(l);if(e){const t=e.value;if(1===t.length&&Nt.has(t[0])){this.Filter=t[0],l=e.end+1;break}throw new Error(`Unsupported /Filter property value: ${t.toString()}`)}}throw new Error(`Unsupported /Filter property value type: ${r}`);case"/DecodeParms":const s=n.getDictBoundsAt(l);if(!s)throw new Error("Can't parse /DecodeParms property value");{const e=qt.parse({parser:n,bounds:s});e&&(this.DecodeParms=e.value),l=s.end+1}break;case"/DL":const i=n.parseNumberAt(l,!1);if(!i)throw new Error("Can't parse /DL property value");this.DL=i.value,l=i.end+1;break;default:l=n.skipToNextName(l,c.contentEnd)}const p=n.findNewLineIndex("straight",h.end+1),f=n.findNewLineIndex("reverse",o.start-1),A=n.sliceCharCodes(p,f),w=(null===(r=e.cryptInfo)||void 0===r?void 0:r.ref)&&e.cryptInfo.streamCryptor?e.cryptInfo.streamCryptor.decrypt(A,e.cryptInfo.ref):A;if(!this.Length||this.Length!==w.length)throw new Error("Incorrect stream length");return this._streamData=w,!0}}class Zt extends Jt{constructor(e=null){super(e)}static parse(e){const t=new Zt;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}getText(){return null}toArray(e){return super.toArray(e)}tryParseProps(e){return!!super.tryParseProps(e)}}const $t={SOLID:"/S",DASHED:"/D",BEVELED:"/B",INSET:"/I",UNDERLINE:"/U"};class er extends Xt{constructor(){super($e),this.W=1,this.S=$t.SOLID,this.D=[3,0]}static parse(e){const t=new er;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.W&&n.push(...r.encode("/W"),...r.encode(" "+this.W)),this.S&&n.push(...r.encode("/S"),...r.encode(this.S)),this.D&&n.push(...r.encode("/D"),j,...r.encode(this.D[0]+""),m,...r.encode(this.D[1]+""),X);const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){var t,r;if(!super.tryParseProps(e))return!1;const{parser:n,bounds:s}=e,i=s.contentStart||s.start,a=s.contentEnd||s.end;let o,h,c=n.skipToNextName(i,a-1);if(-1===c)return!1;for(;h=n.parseNameAt(c),h;)switch(c=h.end+1,o=h.value,o){case"/W":const e=n.parseNumberAt(c,!0);if(!e)throw new Error("Can't parse /W property value");this.W=e.value,c=e.end+1;break;case"/S":const s=n.parseNameAt(c,!0);if(!s||!Object.values($t).includes(s.value))throw new Error("Can't parse /S property value");this.S=s.value,c=s.end+1;break;case"/D":const i=n.parseNumberArrayAt(c,!0);if(!i)throw new Error("Can't parse /D property value");this.D=[null!==(t=i.value[0])&&void 0!==t?t:3,null!==(r=i.value[1])&&void 0!==r?r:0],c=i.end+1;break;default:c=n.skipToNextName(c,a-1)}return!0}}class tr extends Xt{constructor(){super(null),this._objectIdMap=new Map}static parse(e){const t=new tr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}getProp(e){return this._objectIdMap.get(e)}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this._objectIdMap.forEach(((t,s)=>{n.push(...r.encode(s),...t.toArray(e))}));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){default:if(t.getValueTypeAt(o)===lt){const e=jt.parseRef(t,o);if(e){this._objectIdMap.set(i,e.value),o=e.end+1;break}}o=t.skipToNextName(o,s-1)}return!0}}class rr extends Xt{constructor(){super(null)}static parse(e){const t=new rr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.N&&(n.push(...r.encode("/N")),this.N,n.push(...this.N.toArray(e))),this.R&&(n.push(...r.encode("/R")),this.R,n.push(...this.R.toArray(e))),this.D&&(n.push(...r.encode("/D")),this.D,n.push(...this.D.toArray(e)));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/N":const e=t.getValueTypeAt(o);if(e===lt){const e=jt.parseRef(t,o);if(e){this.N=e.value,o=e.end+1;break}}else{if(e!==dt)throw new Error(`Unsupported /N property value type: ${e}`);{const e=t.getDictBoundsAt(o);if(e){const r=tr.parse({parser:t,bounds:e});if(r){this.N=r.value,o=r.end+1;break}}}}throw new Error("Can't parse /N property value");case"/R":const r=t.getValueTypeAt(o);if(r===lt){const e=jt.parseRef(t,o);if(e){this.R=e.value,o=e.end+1;break}}else{if(r!==dt)throw new Error(`Unsupported /R property value type: ${r}`);{const e=t.getDictBoundsAt(o);if(e){const r=tr.parse({parser:t,bounds:e});if(r){this.R=r.value,o=r.end+1;break}}}}throw new Error("Can't parse /R property value");case"/D":const n=t.getValueTypeAt(o);if(n===lt){const e=jt.parseRef(t,o);if(e){this.D=e.value,o=e.end+1;break}}else{if(n!==dt)throw new Error(`Unsupported /D property value type: ${n}`);{const e=t.getDictBoundsAt(o);if(e){const r=tr.parse({parser:t,bounds:e});if(r){this.D=r.value,o=r.end+1;break}}}}throw new Error("Can't parse /D property value");default:o=t.skipToNextName(o,s-1)}return!!this.N}}const nr={NONE:"/S",CLOUDY:"/C"};class sr extends Xt{constructor(){super(null),this.S=nr.NONE,this.L=0}static parse(e){const t=new sr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.S&&n.push(...r.encode("/S"),...r.encode(this.S)),this.L&&n.push(...r.encode("/L"),...r.encode(" "+this.L));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/S":const e=t.parseNameAt(o,!0);if(!e||!Object.values(nr).includes(e.value))throw new Error("Can't parse /S property value");this.S=e.value,o=e.end+1;break;case"/L":const r=t.parseNumberAt(o,!0);if(!r)throw new Error("Can't parse /L property value");this.L=Math.min(Math.max(0,r.value),2),o=r.end+1;break;default:o=t.skipToNextName(o,s-1)}return!0}}class ir{constructor(e,t,r,n,s){this.hCornerR=null!=e?e:0,this.vCornerR=null!=t?t:0,this.width=null!=r?r:1,this.dash=null!=n?n:3,this.gap=null!=s?s:0}static parse(e,t,r=!0){if(r&&(t=e.findRegularIndex("straight",t)),t<0||t>e.maxIndex||e.getCharCode(t)!==j)return null;const n=e.parseNumberAt(t+1);if(!n||isNaN(n.value))return null;const s=e.parseNumberAt(n.end+2);if(!s||isNaN(s.value))return null;const i=e.parseNumberAt(s.end+2);if(!i||isNaN(i.value))return null;const a=e.findNonSpaceIndex("straight",i.end+1);if(!a)return null;if(e.getCharCode(a)===X)return{value:new ir(n.value,s.value,i.value),start:t,end:a};if(e.getCharCode(a)===j){const r=e.parseNumberAt(a+1);if(!r||isNaN(r.value))return null;const o=e.parseNumberAt(r.end+2);if(!o||isNaN(o.value))return null;const h=e.findNonSpaceIndex("straight",o.end+1);if(!h||e.getCharCode(h)!==X)return null;const c=e.findNonSpaceIndex("straight",h+1);return c&&e.getCharCode(c)===X?{value:new ir(n.value,s.value,i.value,r.value,o.value),start:t,end:c}:null}return null}toArray(e){const t=this.dash&&this.gap?`[${this.hCornerR} ${this.vCornerR} ${this.width}]`:`[${this.hCornerR} ${this.vCornerR} ${this.width} [${this.dash} ${this.gap}]]`;return(new TextEncoder).encode(t)}}class ar extends Xt{constructor(e){super(Ze),this.F=0,this.Border=new ir(0,0,1),this.Subtype=e}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.Subtype&&n.push(...r.encode("/Subtype"),...r.encode(this.Subtype)),this.Rect&&n.push(...r.encode("/Rect"),j,...r.encode(this.Rect[0]+""),m,...r.encode(this.Rect[1]+""),m,...r.encode(this.Rect[2]+""),m,...r.encode(this.Rect[3]+""),X),this.Contents&&n.push(...r.encode("/Contents"),...this.Contents.toArray(e)),this.P&&n.push(...r.encode("/P"),m,...this.P.toArray(e)),this.NM&&n.push(...r.encode("/NM"),...this.NM.toArray(e)),this.M&&n.push(...r.encode("/M"),...this.M.toArray(e)),this.F&&n.push(...r.encode("/F"),...r.encode(" "+this.F)),this.AP&&n.push(...r.encode("/AP"),...this.AP.toArray(e)),this.AS&&n.push(...r.encode("/AS"),...r.encode(this.AS)),this.Border&&n.push(...r.encode("/Border"),...this.Border.toArray(e)),this.BS&&n.push(...r.encode("/BS"),...this.BS.toArray(e)),this.BE&&n.push(...r.encode("/BE"),...this.BE.toArray(e)),this.C&&(n.push(...r.encode("/C"),j),this.C.forEach((e=>n.push(...r.encode(" "+e)))),n.push(X)),this.StructParent&&n.push(...r.encode("/StructParent"),...r.encode(" "+this.StructParent));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Subtype":const r=t.parseNameAt(o);if(!r)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==r.value)return!1;o=r.end+1;break;case"/Contents":const n=Wt.parse(t,o,e.cryptInfo);if(!n)throw new Error("Can't parse /Contents property value");this.Contents=n.value,o=n.end+1;break;case"/Rect":const i=t.parseNumberArrayAt(o,!0);if(!i)throw new Error("Can't parse /Rect property value");this.Rect=[i.value[0],i.value[1],i.value[2],i.value[3]],o=i.end+1;break;case"/P":const a=jt.parseRef(t,o);if(!a)throw new Error("Can't parse /P property value");this.P=a.value,o=a.end+1;break;case"/NM":const h=Wt.parse(t,o,e.cryptInfo);if(!h)throw new Error("Can't parse /NM property value");this.NM=h.value,o=h.end+1;break;case"/M":const c=Qt.parse(t,o,e.cryptInfo);if(c){this.M=c.value,o=c.end+1;break}{const r=Wt.parse(t,o,e.cryptInfo);if(r){this.M=r.value,o=r.end+1;break}}throw new Error("Can't parse /M property value");case"/F":const d=t.parseNumberAt(o,!1);if(!d)throw new Error("Can't parse /F property value");this.F=d.value,o=d.end+1;break;case"/C":const u=t.parseNumberArrayAt(o,!0);if(!u)throw new Error("Can't parse /C property value");this.C=u.value,o=u.end+1;break;case"/StructParent":const l=t.parseNumberAt(o,!1);if(!l)throw new Error("Can't parse /StructParent property value");this.StructParent=l.value,o=l.end+1;break;case"/Border":const p=ir.parse(t,o);if(!p)throw new Error("Can't parse /Border property value");this.Border=p.value,o=p.end+1;break;case"/BS":const f=t.getValueTypeAt(o);if(f===lt){const r=jt.parseRef(t,o);if(r&&e.parseInfoGetter){const t=e.parseInfoGetter(r.value.id);if(t){const e=er.parse(t);if(e){this.BS=e.value,o=e.end+1;break}}}throw new Error("Can't parse /BS value reference")}if(f===dt){const e=t.getDictBoundsAt(o);if(e){const r=er.parse({parser:t,bounds:e});if(r){this.BS=r.value,o=r.end+1;break}}throw new Error("Can't parse /BS value dictionary")}throw new Error(`Unsupported /BS property value type: ${f}`);case"/BE":const A=t.getValueTypeAt(o);if(A===lt){const r=jt.parseRef(t,o);if(r&&e.parseInfoGetter){const t=e.parseInfoGetter(r.value.id);if(t){const e=sr.parse(t);if(e){this.BE=e.value,o=e.end+1;break}}}throw new Error("Can't parse /BE value reference")}if(A===dt){const e=t.getDictBoundsAt(o);if(e){const r=sr.parse({parser:t,bounds:e});if(r){this.BE=r.value,o=r.end+1;break}}throw new Error("Can't parse /BE value dictionary")}throw new Error(`Unsupported /BE property value type: ${A}`);case"/AP":const w=t.getValueTypeAt(o);if(w===lt){const r=jt.parseRef(t,o);if(r&&e.parseInfoGetter){const t=e.parseInfoGetter(r.value.id);if(t){const e=rr.parse(t);if(e){this.AP=e.value,o=e.end+1;break}}}throw new Error("Can't parse /AP value reference")}if(w===dt){const e=t.getDictBoundsAt(o);if(e){const r=rr.parse({parser:t,bounds:e});if(r){this.AP=r.value,o=r.end+1;break}}throw new Error("Can't parse /AP value dictionary")}throw new Error(`Unsupported /AP property value type: ${w}`);case"/AS":const y=t.parseNameAt(o,!0);if(!y)throw new Error("Can't parse /AS property value");this.AS=y.value,o=y.end+1;break;case"/OC":default:o=t.skipToNextName(o,s-1)}return!(!this.Subtype||!this.Rect)}}const or={REPLY:"/R",GROUP:"/Group"};class hr extends ar{constructor(e){super(e),this.RT=or.REPLY}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.T&&n.push(...r.encode("/T"),...this.T.toArray(e)),this.Popup&&n.push(...r.encode("/Popup"),m,...this.Popup.toArray(e)),this.RC&&n.push(...r.encode("/RC"),...this.RC.toArray(e)),this.CA&&n.push(...r.encode("/CA"),...r.encode(" "+this.CA)),this.CreationDate&&n.push(...r.encode("/CreationDate"),...this.CreationDate.toArray(e)),this.Subj&&n.push(...r.encode("/Subj"),...this.Subj.toArray(e)),this.IRT&&n.push(...r.encode("/IRT"),m,...this.IRT.toArray(e)),this.RT&&n.push(...r.encode("/RT"),...r.encode(this.RT));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/T":const r=Wt.parse(t,o,e.cryptInfo);if(!r)throw new Error("Can't parse /T property value");this.T=r.value,o=r.end+1;break;case"/Popup":const n=jt.parseRef(t,o);if(!n)throw new Error("Can't parse /Popup property value");this.Popup=n.value,o=n.end+1;break;case"/RC":const i=t.getValueTypeAt(o);if(i===lt){const r=jt.parseRef(t,o);if(r&&e.parseInfoGetter){const t=e.parseInfoGetter(r.value.id);if(t){const e=t.type||t.parser.getValueTypeAt(t.bounds.contentStart);if(e===at){const e=Wt.parse(t.parser,t.bounds.contentStart);if(e){this.RC=e.value,o=r.end+1;break}}else{if(e!==dt)throw new Error(`Unsupported /RC property value type: ${e}`);{const e=Zt.parse(t);if(e){const t=e.value.getText();this.RC=Wt.fromString(t),o=r.end+1;break}}}}}throw new Error("Can't parse /RC value reference")}if(i===at){const r=Wt.parse(t,o,e.cryptInfo);if(r){this.RC=r.value,o=r.end+1;break}throw new Error("Can't parse /RC property value")}throw new Error(`Unsupported /RC property value type: ${i}`);case"/CA":const a=t.parseNumberAt(o,!0);if(!a)throw new Error("Can't parse /CA property value");this.CA=a.value,o=a.end+1;break;case"/CreationDate":const h=Qt.parse(t,o,e.cryptInfo);if(!h)throw new Error("Can't parse /CreationDate property value");this.CreationDate=h.value,o=h.end+1;break;case"/Subj":const c=Wt.parse(t,o,e.cryptInfo);if(!c)throw new Error("Can't parse /Subj property value");this.Subj=c.value,o=c.end+1;break;case"/IRT":const d=jt.parseRef(t,o);if(!d)throw new Error("Can't parse /IRT property value");this.IRT=d.value,o=d.end+1;break;case"/RT":const u=t.parseNameAt(o,!0);if(!u||!Object.values(or).includes(u.value))throw new Error("Can't parse /RT property value");this.RT=u.value,o=u.end+1;break;case"/ExData":break;default:o=t.skipToNextName(o,s-1)}return!(!this.Subtype||!this.Rect)}}const cr={PLAIN_TEXT:"/FreeText",WITH_CALLOUT:"/FreeTextCallout",CLICK_TO_TYPE:"/FreeTextTypeWriter"};class dr extends hr{constructor(){super(At),this.IT=cr.PLAIN_TEXT,this.LE=St.NONE}static parse(e){const t=new dr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.DA&&n.push(...r.encode("/DA"),...this.DA.toArray(e)),this.Q&&n.push(...r.encode("/Q"),...r.encode(" "+this.Q)),this.DS&&n.push(...r.encode("/DS"),...this.DS.toArray(e)),this.CL&&(n.push(...r.encode("/CL"),j),this.CL.forEach((e=>n.push(...r.encode(" "+e)))),n.push(X)),this.IT&&n.push(...r.encode("/IT"),...r.encode(this.IT)),this.RD&&n.push(...r.encode("/RD"),j,...r.encode(this.RD[0]+""),m,...r.encode(this.RD[1]+""),m,...r.encode(this.RD[2]+""),m,...r.encode(this.RD[3]+""),X),this.LE&&n.push(...r.encode("/LE"),...r.encode(this.LE));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/DA":const r=Wt.parse(t,o,e.cryptInfo);if(!r)throw new Error("Can't parse /DA property value");this.DA=r.value,o=r.end+1;break;case"/Q":const n=t.parseNumberAt(o,!0);if(!n||!Object.values(Ke).includes(n.value))throw new Error("Can't parse /Q property value");this.Q=n.value,o=n.end+1;break;case"/DS":const i=Wt.parse(t,o,e.cryptInfo);if(!i)throw new Error("Can't parse /DS property value");this.DS=i.value,o=i.end+1;break;case"/CL":const a=t.parseNumberArrayAt(o,!0);if(!a)throw new Error("Can't parse /CL property value");this.CL=a.value,o=a.end+1;break;case"/IT":const h=t.parseNameAt(o,!0);if(h){if("/FreeTextTypewriter"===h.value){this.IT=cr.CLICK_TO_TYPE,o=h.end+1;break}if(Object.values(cr).includes(h.value)){this.IT=h.value,o=h.end+1;break}}throw new Error("Can't parse /IT property value");case"/RD":const c=t.parseNumberArrayAt(o,!0);if(!c)throw new Error("Can't parse /RD property value");this.RD=[c.value[0],c.value[1],c.value[2],c.value[3]],o=c.end+1;break;case"/LE":const d=t.parseNameAt(o,!0);if(!d||!Object.values(St).includes(d.value))throw new Error("Can't parse /LE property value");this.LE=d.value,o=d.end+1;break;default:o=t.skipToNextName(o,s-1)}return!!this.DA}}class ur extends hr{constructor(e){super(e)}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.IC&&(n.push(...r.encode("/IC"),j),this.IC.forEach((e=>n.push(...r.encode(" "+e)))),n.push(X));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/IC":const e=t.parseNumberArrayAt(o,!0);if(!e)throw new Error("Can't parse /IC property value");this.IC=e.value,o=e.end+1;break;default:o=t.skipToNextName(o,s-1)}return!0}}class lr extends ur{constructor(){super(gt)}static parse(e){const t=new lr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.RD&&n.push(...r.encode("/RD"),j,...r.encode(this.RD[0]+""),m,...r.encode(this.RD[1]+""),m,...r.encode(this.RD[2]+""),m,...r.encode(this.RD[3]+""),X);const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/RD":const e=t.parseNumberArrayAt(o,!0);if(!e)throw new Error("Can't parse /RD property value");this.RD=[e.value[0],e.value[1],e.value[2],e.value[3]],o=e.end+1;break;default:o=t.skipToNextName(o,s-1)}return!0}}class pr extends Xt{constructor(){super(et),this.Subtype="/RL"}static parse(e){const t=new pr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.Subtype&&n.push(...r.encode("/Subtype"),...r.encode(this.Subtype));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Subtype":const e=t.parseNameAt(o);if(!e)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==e.value)return!1;o=e.end+1;break;default:o=t.skipToNextName(o,s-1)}return!0}}const fr={ARROW:"/LineArrow",DIMESION:"/LineDimension"},Ar={INLINE:"/Inline",TOP:"/Top"};class wr extends ur{constructor(){super(wt),this.LE=[St.NONE,St.NONE],this.LL=0,this.LLE=0,this.Cap=!1,this.LLO=0,this.CP=Ar.INLINE,this.CO=[0,0]}static parse(e){const t=new wr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.L&&n.push(...r.encode("/L"),j,...r.encode(this.L[0]+""),m,...r.encode(this.L[1]+""),m,...r.encode(this.L[2]+""),m,...r.encode(this.L[3]+""),X),this.LE&&(n.push(...r.encode("/LE"),j),this.LE.forEach((e=>n.push(m,...r.encode(e)))),n.push(X)),this.LL&&n.push(...r.encode("/LL"),...r.encode(" "+this.LL)),this.LLE&&n.push(...r.encode("/LLE"),...r.encode(" "+this.LLE)),this.Cap&&n.push(...r.encode("/Cap"),...r.encode(" "+this.Cap)),this.IT&&n.push(...r.encode("/IT"),...r.encode(this.IT)),this.LLO&&n.push(...r.encode("/LLO"),...r.encode(" "+this.LLO)),this.CP&&n.push(...r.encode("/CP"),...r.encode(this.CP)),this.Measure&&n.push(...r.encode("/Measure"),...this.Measure.toArray(e)),this.CO&&n.push(...r.encode("/CO"),j,...r.encode(this.CO[0]+""),m,...r.encode(this.CO[1]+""),X);const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/L":const r=t.parseNumberArrayAt(o,!0);if(!r)throw new Error("Can't parse /L property value");this.L=[r.value[0],r.value[1],r.value[2],r.value[3]],o=r.end+1;break;case"/LE":const n=t.parseNameArrayAt(o,!0);if(!(n&&Object.values(St).includes(n.value[0])&&Object.values(St).includes(n.value[1])))throw new Error("Can't parse /LE property value");this.LE=[n.value[0],n.value[1]],o=n.end+1;break;case"/LL":const i=t.parseNumberAt(o,!1);if(!i)throw new Error("Can't parse /LL property value");this.LL=i.value,o=i.end+1;break;case"/LLE":const a=t.parseNumberAt(o,!1);if(!a)throw new Error("Can't parse /LLE property value");this.LLE=a.value,o=a.end+1;break;case"/Cap":const h=t.parseBoolAt(o,!1);if(!h)throw new Error("Can't parse /Cap property value");this.Cap=h.value,o=h.end+1;break;case"/IT":const c=t.parseNameAt(o,!0);if(c&&Object.values(fr).includes(c.value)){this.IT=c.value,o=c.end+1;break}throw new Error("Can't parse /IT property value");case"/LLO":const d=t.parseNumberAt(o,!1);if(!d)throw new Error("Can't parse /LLO property value");this.LLO=d.value,o=d.end+1;break;case"/CP":const u=t.parseNameAt(o,!0);if(!u||!Object.values(Ar).includes(u.value[0]))throw new Error("Can't parse /CP property value");this.CP=u.value,o=u.end+1;break;case"/Measure":const l=t.getValueTypeAt(o);if(l===lt){const r=jt.parseRef(t,o);if(r&&e.parseInfoGetter){const t=e.parseInfoGetter(r.value.id);if(t){const e=pr.parse(t);if(e){this.Measure=e.value,o=e.end+1;break}}}throw new Error("Can't parse /BS value reference")}if(l===dt){const e=t.getDictBoundsAt(o);if(e){const r=pr.parse({parser:t,bounds:e});if(r){this.Measure=r.value,o=r.end+1;break}}throw new Error("Can't parse /Measure value dictionary")}throw new Error(`Unsupported /Measure property value type: ${l}`);case"/CO":const p=t.parseNumberArrayAt(o,!0);if(!p)throw new Error("Can't parse /CO property value");this.CO=[p.value[0],p.value[1]],o=p.end+1;break;default:o=t.skipToNextName(o,s-1)}return!0}}class yr extends ur{constructor(){super(yt)}static parse(e){const t=new yr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.RD&&n.push(...r.encode("/RD"),j,...r.encode(this.RD[0]+""),m,...r.encode(this.RD[1]+""),m,...r.encode(this.RD[2]+""),m,...r.encode(this.RD[3]+""),X);const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/RD":const e=t.parseNumberArrayAt(o,!0);if(!e)throw new Error("Can't parse /RD property value");this.RD=[e.value[0],e.value[1],e.value[2],e.value[3]],o=e.end+1;break;default:o=t.skipToNextName(o,s-1)}return!0}}class gr extends hr{constructor(){super(Et)}static parse(e){const t=new gr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.InkList&&(n.push(...r.encode("/InkList"),j),this.InkList.forEach((e=>{n.push(j),e.forEach((e=>n.push(...r.encode(" "+e)))),n.push(X)})),n.push(X));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){var t;if(!super.tryParseProps(e))return!1;const{parser:r,bounds:n}=e,s=n.contentStart||n.start,i=n.contentEnd||n.end;let a,o,h=r.skipToNextName(s,i-1);if(-1===h)return!1;for(;o=r.parseNameAt(h),o;)switch(h=o.end+1,a=o.value,a){case"/InkList":if(r.getValueTypeAt(h)===ct){const e=[];let t,n=++h;for(;t=r.parseNumberArrayAt(n),t;)e.push(t.value),n=t.end+1;this.InkList=e;break}throw new Error("Can't parse /InkList property value");default:h=r.skipToNextName(h,i-1)}return!!(null===(t=this.InkList)||void 0===t?void 0:t.length)}}const vr={DRAFT:"/Draft",NOT_APPROVED:"/NotApproved",APPROVED:"/Approved",AS_IS:"/AsIs",FOR_COMMENT:"/ForComment",EXPERIMENTAL:"/Experimental",FINAL:"/Final",SOLD:"/Sold",EXPIRED:"/Expired",PUBLIC:"/ForPublicRelease",NOT_PUBLIC:"/NotForPublicRelease",DEPARTMENTAL:"/Departmental",CONFIDENTIAL:"/Confidential",SECRET:"/TopSecret"};class mr extends hr{constructor(){super(bt),this.Name=vr.DRAFT}static parse(e){const t=new mr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.Name&&n.push(...r.encode("/Name"),...r.encode(this.Name));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Name":const e=t.parseNameAt(o,!0);if(!e||!Object.values(vr).includes(e.value))throw new Error("Can't parse /Name property value");this.Name=e.value,o=e.end+1;break;default:o=t.skipToNextName(o,s-1)}return!!this.Name}}class br extends hr{constructor(){super(ft),this.Open=!1}static parse(e){const t=new br;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.Open&&n.push(...r.encode("/Open"),...r.encode(" "+this.Open)),this.Name&&n.push(...r.encode("/Name"),...r.encode(this.Name)),this.State&&n.push(...r.encode("/State"),...r.encode(this.State)),this.StateModel&&n.push(...r.encode("/StateModel"),...r.encode(this.StateModel));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Open":const e=t.parseBoolAt(o,!0);if(!e)throw new Error("Can't parse /Open property value");this.Open=e.value,o=e.end+1;break;case"/Name":const r=t.parseNameAt(o,!0);if(!r||!Object.values(_t).includes(r.value))throw new Error("Can't parse /Name property value");this.Name=r.value,o=r.end+1;break;case"/State":const n=t.parseNameAt(o,!0);if(!n||!Object.values(xt).concat(Object.values(Pt)).includes(n.value))throw new Error("Can't parse /State property value");this.State=n.value,o=n.end+1;break;case"/StateModel":const i=t.parseNameAt(o,!0);if(!i||!Object.values(Ct).includes(i.value))throw new Error("Can't parse /StateModel property value");this.StateModel=i.value,o=i.end+1;break;default:o=t.skipToNextName(o,s-1)}return!0}}class Er{constructor(e,t,r){this.literal=e,this.hex=t,this.bytes=r}static parse(e,t,r=null,n=!0){const s=e.getHexBounds(t,n);if(!s)return null;let i=e.sliceCharCodes(s.start+1,s.end-1);(null==r?void 0:r.ref)&&r.stringCryptor&&(i=r.stringCryptor.decrypt(i,r.ref));return{value:Er.fromBytes(i),start:s.start,end:s.end}}static parseArray(e,t,r=null,n=!0){const s=e.getArrayBoundsAt(t,n);if(!s)return null;const i=[];let a,o=s.start+1;for(;o<s.end&&(a=Er.parse(e,o,r,n),a);)i.push(a.value),o=a.end+1;return{value:i,start:s.start,end:s.end}}static fromBytes(e){const t=(new TextDecoder).decode(e),r=be(t);return new Er(t,r,e)}static fromHexBytes(e){let t="";e.forEach((e=>t+=e.toString(16).padStart(2,"0")));const r=(new TextEncoder).encode(t);return new Er(t,e,r)}static fromLiteralString(e){const t=be(e),r=(new TextEncoder).encode(e);return new Er(e,t,r)}toArray(e){return new Uint8Array([...de.STR_HEX_START,...this.bytes,...de.STR_HEX_END])}}class Cr extends Xt{constructor(){super(tt),this.CFM=Qe.NONE,this.AuthEvent=je.DOC_OPEN,this.Length=40,this.EncryptMetadata=!0}static parse(e){const t=new Cr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.CFM&&n.push(...r.encode("/CFM"),...r.encode(this.CFM)),this.AuthEvent&&n.push(...r.encode("/AuthEvent"),...r.encode(this.AuthEvent)),this.Length&&n.push(...r.encode("/Length"),...r.encode(" "+this.Length)),this.EncryptMetadata&&n.push(...r.encode("/EncryptMetadata"),...r.encode(" "+this.EncryptMetadata)),this.Recipients&&(this.Recipients instanceof Er?n.push(...r.encode("/Recipients"),...this.Recipients.toArray(e)):(n.push(j),this.Recipients.forEach((t=>n.push(...t.toArray(e)))),n.push(X)));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/CFM":const r=t.parseNameAt(o,!0);if(!r||!Object.values(Qe).includes(r.value))throw new Error("Can't parse /CFM property value");this.CFM=r.value,o=r.end+1;break;case"/AuthEvent":const n=t.parseNameAt(o,!0);if(!n||!Object.values(je).includes(n.value))throw new Error("Can't parse /AuthEvent property value");this.AuthEvent=n.value,o=n.end+1;break;case"/Length":const i=t.parseNumberAt(o,!1);if(!i)throw new Error("Can't parse /Length property value");this.Length=i.value,o=i.end+1;break;case"/EncryptMetadata":const a=t.parseBoolAt(o,!1);if(!a)throw new Error("Can't parse /EncryptMetadata property value");this.EncryptMetadata=a.value,o=a.end+1;break;case"/Recipients":const h=t.getValueTypeAt(o);if(h===ot){const r=Er.parse(t,o,e.cryptInfo);if(r){this.Recipients=r.value,o=r.end+1;break}throw new Error("Can't parse /Recipients property value")}if(h===ct){const e=Er.parseArray(t,o);if(e){this.Recipients=e.value,o=e.end+1;break}throw new Error("Can't parse /Recipients property value")}throw new Error(`Unsupported /Filter property value type: ${h}`);default:o=t.skipToNextName(o,s-1)}return!0}}class xr extends Xt{constructor(){super(null),this._filtersMap=new Map}static parse(e){const t=new xr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}getProp(e){return this._filtersMap.get(e)}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this._filtersMap.size&&this._filtersMap.forEach(((t,s)=>n.push(...r.encode(s),...t.toArray(e))));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){default:if(t.getValueTypeAt(o)===dt){const e=t.getDictBoundsAt(o);if(e){const r=Cr.parse({parser:t,bounds:e});if(r){this._filtersMap.set(i,r.value),o=r.end+1;break}}}o=t.skipToNextName(o,s-1)}return!0}}class Pr extends Xt{constructor(){super(rt),this.Filter="/Standard",this.Length=40,this.StmF="/Identity",this.StrF="/Identity",this.EncryptMetadata=!0}static parse(e){const t=new Pr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.Filter&&n.push(...r.encode("/Filter"),...r.encode(this.Filter)),this.SubFilter&&n.push(...r.encode("/SubFilter"),...r.encode(this.SubFilter)),this.V&&n.push(...r.encode("/V"),...r.encode(" "+this.V)),this.Length&&n.push(...r.encode("/Length"),...r.encode(" "+this.Length)),this.CF&&n.push(...r.encode("/CF"),...this.CF.toArray(e)),this.StmF&&n.push(...r.encode("/StmF"),...r.encode(this.StmF)),this.StrF&&n.push(...r.encode("/StrF"),...r.encode(this.StrF)),this.EFF&&n.push(...r.encode("/EFF"),...r.encode(this.EFF)),this.R&&n.push(...r.encode("/R"),...r.encode(" "+this.R)),this.O&&n.push(...r.encode("/O"),...this.O.toArray(e)),this.U&&n.push(...r.encode("/U"),...this.U.toArray(e)),this.OE&&n.push(...r.encode("/OE"),...this.OE.toArray(e)),this.UE&&n.push(...r.encode("/UE"),...this.UE.toArray(e)),this.P&&n.push(...r.encode("/P"),...r.encode(" "+this.P)),this.Perms&&n.push(...r.encode("/Perms"),...this.Perms.toArray(e)),this.U&&n.push(...r.encode("/U"),...this.U.toArray(e)),this.EncryptMetadata&&n.push(...r.encode("/EncryptMetadata"),...r.encode(" "+this.EncryptMetadata)),this.Recipients&&(this.Recipients instanceof Er?n.push(...r.encode("/Recipients"),...this.Recipients.toArray(e)):(n.push(j),this.Recipients.forEach((t=>n.push(...t.toArray(e)))),n.push(X)));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}toCryptOptions(){var e,t,r,n,s,i,a,o,h;return this.V?{filter:this.Filter,version:this.V,revision:this.R,permissions:this.P,keyLength:this.Length,encryptMetadata:this.EncryptMetadata,stringKeyLength:null===(e=this.stringFilter)||void 0===e?void 0:e.Length,streamKeyLength:null===(t=this.streamFilter)||void 0===t?void 0:t.Length,stringMethod:null===(r=this.stringFilter)||void 0===r?void 0:r.CFM,streamMethod:null===(n=this.streamFilter)||void 0===n?void 0:n.CFM,oPasswordHash:null===(s=this.O)||void 0===s?void 0:s.bytes,uPasswordHash:null===(i=this.U)||void 0===i?void 0:i.bytes,oEncPasswordHash:null===(a=this.OE)||void 0===a?void 0:a.bytes,uEncPasswordHash:null===(o=this.UE)||void 0===o?void 0:o.bytes,perms:null===(h=this.Perms)||void 0===h?void 0:h.bytes}:null}tryParseProps(e){var t,r;if(!super.tryParseProps(e))return!1;const{parser:n,bounds:s}=e,i=s.contentStart||s.start,a=s.contentEnd||s.end;let o,h,c=n.skipToNextName(i,a-1);if(-1===c)return!1;for(;h=n.parseNameAt(c),h;)switch(c=h.end+1,o=h.value,o){case"/Filter":const t=n.parseNameAt(c,!0);if(!t)throw new Error("Can't parse /Filter property value");this.Filter=t.value,c=t.end+1;break;case"/SubFilter":const r=n.parseNameAt(c,!0);if(!r)throw new Error("Can't parse /SubFilter property value");this.SubFilter=r.value,c=r.end+1;break;case"/V":const i=n.parseNumberAt(c,!1);if(!i||!Object.values(He).includes(i.value))throw new Error("Can't parse /V property value");this.V=i.value,c=i.end+1;break;case"/Length":const o=n.parseNumberAt(c,!1);if(!o)throw new Error("Can't parse /Length property value");this.Length=o.value,c=o.end+1;break;case"/CF":const h=n.getDictBoundsAt(c);if(!s)throw new Error("Can't parse /CF property value");{const e=xr.parse({parser:n,bounds:h});e&&(this.CF=e.value,c=e.end+1)}break;case"/StmF":const d=n.parseNameAt(c,!0);if(!d)throw new Error("Can't parse /StmF property value");this.StmF=d.value,c=d.end+1;break;case"/StrF":const u=n.parseNameAt(c,!0);if(!u)throw new Error("Can't parse /StrF property value");this.StrF=u.value,c=u.end+1;break;case"/EFF":const l=n.parseNameAt(c,!0);if(!l)throw new Error("Can't parse /EFF property value");this.EFF=l.value,c=l.end+1;break;case"/R":const p=n.parseNumberAt(c,!1);if(!p||!Object.values(We).includes(p.value))throw new Error("Can't parse /R property value");this.R=p.value,c=p.end+1;break;case"/O":const f=Wt.parse(n,c,e.cryptInfo);if(!f)throw new Error("Can't parse /O property value");this.O=f.value,c=f.end+1;break;case"/U":const A=Wt.parse(n,c,e.cryptInfo);if(!A)throw new Error("Can't parse /U property value");this.U=A.value,c=A.end+1;break;case"/OE":const w=Wt.parse(n,c,e.cryptInfo);if(!w)throw new Error("Can't parse /OE property value");this.OE=w.value,c=w.end+1;break;case"/UE":const y=Wt.parse(n,c,e.cryptInfo);if(!y)throw new Error("Can't parse /UE property value");this.UE=y.value,c=y.end+1;break;case"/P":const g=n.parseNumberAt(c,!1);if(!g)throw new Error("Can't parse /P property value");this.P=g.value,c=g.end+1;break;case"/Perms":const v=Wt.parse(n,c,e.cryptInfo);if(!v)throw new Error("Can't parse /Perms property value");this.Perms=v.value,c=v.end+1;break;case"/EncryptMetadata":const m=n.parseBoolAt(c);if(!m)throw new Error("Can't parse /EncryptMetadata property value");this.EncryptMetadata=m.value,c=m.end+1;break;case"/Recipients":const b=n.getValueTypeAt(c);if(b===ot){const t=Er.parse(n,c,e.cryptInfo);if(t){this.Recipients=t.value,c=t.end+1;break}throw new Error("Can't parse /Recipients property value")}if(b===ct){const e=Er.parseArray(n,c);if(e){this.Recipients=e.value,c=e.end+1;break}throw new Error("Can't parse /Recipients property value")}throw new Error(`Unsupported /Filter property value type: ${b}`);default:c=n.skipToNextName(c,a-1)}return!!this.Filter&&(!!("/Standard"!==this.Filter||this.R&&this.O&&this.U&&!isNaN(this.P)&&(5!==this.V||!(this.R<5)&&this.OE&&this.UE&&this.Perms))&&(!!("adbe.pkcs7.s3"!==this.SubFilter&&"adbe.pkcs7.s4"!==this.SubFilter||this.Recipients)&&("/Identity"!==this.StrF&&(this.stringFilter=null===(t=this.CF)||void 0===t?void 0:t.getProp(this.StrF)),"/Identity"!==this.StmF&&(this.streamFilter=null===(r=this.CF)||void 0===r?void 0:r.getProp(this.StmF)),!0)))}}class _r{constructor(e){if(!(null==e?void 0:e.length))throw new Error("Data is empty");this._data=e,this._maxIndex=e.length-1}get maxIndex(){return this._maxIndex}getPdfVersion(){var e;const t=this.findSubarrayIndex(de.VERSION);if(!t)throw new Error("PDF not valid. Version not found");const r=null===(e=this.parseNumberAt(t.end+1,!0))||void 0===e?void 0:e.value;if(!r)throw new Error("Error parsing version number");return r.toFixed(1)}getLastXrefIndex(){const e=this.findSubarrayIndex(de.XREF_START,{maxIndex:this.maxIndex,direction:"reverse"});if(!e)return null;const t=this.parseNumberAt(e.end+1);return t||null}findSubarrayIndex(e,t){var r,n;const s=this._data;if(!(null==e?void 0:e.length))return null;const i=(null==t?void 0:t.direction)||"straight",a=Math.max(Math.min(null!==(r=null==t?void 0:t.minIndex)&&void 0!==r?r:0,this._maxIndex),0),o=Math.max(Math.min(null!==(n=null==t?void 0:t.maxIndex)&&void 0!==n?n:this._maxIndex,this._maxIndex),0),h=!(null==t?void 0:t.closedOnly);let c,d="straight"===i?a:o;if("straight"===i)e:for(;d<=o;d++){for(c=0;c<e.length;c++)if(s[d+c]!==e[c])continue e;if(h||!fe(s[d+c]))return{start:d,end:d+c-1}}else{const t=e.length-1;e:for(;d>=a;d--){for(c=0;c<e.length;c++)if(s[d-c]!==e[t-c])continue e;if(h||!fe(s[d-c]))return{start:d-c+1,end:d}}}return null}findCharIndex(e,t="straight",r){return this.findSingleCharIndex((t=>e===t),t,r)}findNewLineIndex(e="straight",t){let r=this.findSingleCharIndex((e=>e===v||e===y),e,t);return-1===r?-1:"straight"===e?(this._data[r]===v&&this._data[r+1]===y&&r++,Math.min(r+1,this._maxIndex)):(this._data[r]===y&&this._data[r-1]===v&&r--,Math.max(r-1,0))}findSpaceIndex(e="straight",t){return this.findSingleCharIndex((e=>le.has(e)),e,t)}findNonSpaceIndex(e="straight",t){return this.findSingleCharIndex((e=>!le.has(e)),e,t)}findDelimiterIndex(e="straight",t){return this.findSingleCharIndex((e=>ue.has(e)),e,t)}findNonDelimiterIndex(e="straight",t){return this.findSingleCharIndex((e=>!ue.has(e)),e,t)}findIrregularIndex(e="straight",t){return this.findSingleCharIndex((e=>!fe(e)),e,t)}findRegularIndex(e="straight",t){return this.findSingleCharIndex((e=>fe(e)),e,t)}getValueTypeAt(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e))return null;const r=this._data,n=e;switch(r[n]){case _:return fe(r[n+1])?ht:nt;case j:return ct;case E:return at;case O:return O===r[n+1]?dt:ot;case b:return pt;case S:case N:case k:case I:case D:case R:case B:case T:case L:case M:const e=this.findDelimiterIndex("straight",n+1);if(-1!==e){const t=this.findCharIndex(H,"reverse",e-1);if(-1!==t&&t>n)return lt}return it;case ie:return r[n+1]===ae&&r[n+2]===se&&r[n+3]===G&&r[n+4]===q&&r[n+5]===ee?ut:nt;case ae:return r[n+1]===se&&r[n+2]===oe&&r[n+3]===G?st:nt;case J:return r[n+1]===q&&r[n+2]===$&&r[n+3]===ie&&r[n+4]===G?st:nt;default:return nt}}getIndirectObjectBoundsAt(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e))return null;const r=this.findSubarrayIndex(de.OBJ,{minIndex:e,closedOnly:!0});if(!r)return null;let n=this.findNonSpaceIndex("straight",r.end+1);if(-1===n)return null;const s=this.findSubarrayIndex(de.OBJ_END,{minIndex:n,closedOnly:!0});if(!s)return null;let i=this.findNonSpaceIndex("reverse",s.start-1);return this.getCharCode(n)===O&&this.getCharCode(n+1)===O&&this.getCharCode(i-1)===U&&this.getCharCode(i)===U&&(n+=2,i-=2),{start:r.start,end:s.end,contentStart:n,contentEnd:i}}getXrefTableBoundsAt(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e)||this._data[e]!==he)return null;const r=this.findSubarrayIndex(de.XREF_TABLE,{minIndex:e});if(!r)return null;const n=this.findNonSpaceIndex("straight",r.end+1);if(-1===n)return null;const s=this.findSubarrayIndex(de.TRAILER,{minIndex:r.end+1});if(!s)return null;const i=this.findNonSpaceIndex("reverse",s.start-1);return i<n?null:{start:r.start,end:s.end,contentStart:n,contentEnd:i}}getDictBoundsAt(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e)||this._data[e]!==O||this._data[e+1]!==O)return null;const r=this.findNonSpaceIndex("straight",e+2);if(-1===r)return null;let n,s,i=1,a=!0,o=0,h=r;for(;i;)s=n,n=this._data[h++],n!==E||o&&s===K||o++,n===C&&o&&s!==K&&o--,o||(a?a=!1:n===O&&n===s?(i++,a=!0):n===U&&n===s&&(i--,a=!0));const c=h-1,d=this.findNonSpaceIndex("reverse",c-2);return d<r?null:{start:e,end:c,contentStart:r,contentEnd:d}}getArrayBoundsAt(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e)||this._data[e]!==j)return null;let r,n=0,s=e+1;for(;n||r!==X;)r=this._data[s++],r===j?n++:n&&r===X&&n--;const i=s-1;return i-e<2?null:{start:e,end:i}}getHexBounds(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e)||this.getCharCode(e)!==O)return null;const r=this.findCharIndex(U,"straight",e+1);return-1===r?null:{start:e,end:r}}getLiteralBounds(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e)||this.getCharCode(e)!==E)return null;let r,n,s=e+1,i=0;for(;i||n!==C||r===K;){if(s>this._maxIndex)return null;isNaN(n)||(r=n),n=this.getCharCode(s++),r!==K&&(n===E?i+=1:i&&n===C&&(i-=1))}return{start:e,end:s-1}}parseNumberAt(e,t=!1,r=!0){if(r&&(e=this.skipEmpty(e)),this.isOutside(e)||!fe(this._data[e]))return null;let n=e,s="",i=this._data[n];for(i===x&&(s+="-",i=this._data[++n]);pe.has(i)||t&&i===P;)s+=String.fromCharCode(i),i=this._data[++n];return s?{value:+s,start:e,end:n-1}:null}parseNameAt(e,t=!0,r=!0){if(r&&(e=this.skipEmpty(e)),this.isOutside(e)||this._data[e]!==_)return null;let n=e+1,s=t?"/":"",i=this._data[n];for(;fe(i);)s+=String.fromCharCode(i),i=this._data[++n];return s.length>1?{value:s,start:e,end:n-1}:null}parseBoolAt(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e))return null;const r=this.findSubarrayIndex(de.TRUE,{minIndex:e});if(r)return{value:!0,start:e,end:r.end};const n=this.findSubarrayIndex(de.FALSE,{minIndex:e});return n?{value:!0,start:e,end:n.end}:null}parseNumberArrayAt(e,t=!0,r=!0){const n=this.getArrayBoundsAt(e,r);if(!n)return null;const s=[];let i,a=n.start+1;for(;a<n.end&&(i=this.parseNumberAt(a,t,!0),i);)s.push(i.value),a=i.end+1;return{value:s,start:n.start,end:n.end}}parseNameArrayAt(e,t=!0,r=!0){const n=this.getArrayBoundsAt(e,r);if(!n)return null;const s=[];let i,a=n.start+1;for(;a<n.end&&(i=this.parseNameAt(a,t,!0),i);)s.push(i.value),a=i.end+1;return{value:s,start:n.start,end:n.end}}parseDictType(e){return this.parseDictNameProperty(de.TYPE,e)}parseDictSubtype(e){return this.parseDictNameProperty(de.SUBTYPE,e)}parseDictNameProperty(e,t){const r=this.findSubarrayIndex(e,{minIndex:t.start,maxIndex:t.end});if(!r)return null;const n=this.parseNameAt(r.end+1);return n?n.value:null}skipEmpty(e){let t=this.findNonSpaceIndex("straight",e);if(-1===t)return-1;if(this._data[t]===b){const e=this.findNewLineIndex("straight",t+1);if(-1===e)return-1;t=this.findNonSpaceIndex("straight",e)}return t}skipToNextName(e,t){if(e||(e=0),(t=t?Math.min(t,this._maxIndex):0)<e)return-1;let r=e;for(;r<=t;){const e=this.getValueTypeAt(r,!0);if(e){let t;switch(e){case dt:t=this.getDictBoundsAt(r,!1);break;case ct:t=this.getArrayBoundsAt(r,!1);break;case at:t=this.getLiteralBounds(r,!1);break;case ot:t=this.getHexBounds(r,!1);break;case it:const e=this.parseNumberAt(r,!0,!1);e&&(t=e);break;case st:const n=this.parseBoolAt(r,!1);n&&(t=n);break;case pt:break;case ht:return r;default:r++;continue}if(t){r=t.end+1,t=null;continue}}r++}return-1}getCharCode(e){return this._data[e]}getChar(e){const t=this._data[e];return isNaN(t)?null:String.fromCharCode(t)}sliceCharCodes(e,t){return this._data.slice(e,(t||e)+1)}sliceChars(e,t){return String.fromCharCode(...this._data.slice(e,(t||e)+1))}subCharCodes(e,t){return this._data.subarray(e,(t||e)+1)}isOutside(e){return e<0||e>this._maxIndex}getValidStartIndex(e,t){return isNaN(t)?"straight"===e?0:this._maxIndex:Math.max(Math.min(t,this._maxIndex),0)}findSingleCharIndex(e,t="straight",r){const n=this._data;let s=this.getValidStartIndex(t,r);if("straight"===t){for(;s<=this._maxIndex;s++)if(e(n[s]))return s}else for(;s>=0;s--)if(e(n[s]))return s;return-1}}class Sr extends Jt{constructor(){super(qe)}static parse(e){const t=new Sr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}getObjectData(e){if(!this._streamData||!this.N||!this.First)return null;const t=new _r(this.decodedStreamData),r=new Map;let n,s,i,a=0;for(let e=0;e<this.N;e++)n=t.parseNumberAt(a,!1,!1),s=n.value,a=n.end+2,n=t.parseNumberAt(a,!1,!1),i=n.value,a=n.end+2,r.set(s,i);if(!r.has(e))return null;const o=this.First+r.get(e),h=t.getValueTypeAt(o);if(null===h)return;let c,d;switch(h){case _e:c=t.getDictBoundsAt(o,!1);break;case Pe:c=t.getArrayBoundsAt(o,!1);break;case Ce:const e=Wt.parse(t,o);e&&(c={start:e.start,end:e.end},d=e);break;case xe:const r=Er.parse(t,o);r&&(c={start:r.start,end:r.end},d=r);break;case Ee:const n=t.parseNumberAt(o);n&&(c={start:n.start,end:n.end},d=n)}if(!c)return null;const u=t.sliceCharCodes(c.start,c.end);if(!u.length)throw new Error("Object byte array is empty");return{parser:new _r(u),bounds:{start:0,end:u.length-1,contentStart:c.contentStart?c.contentStart-c.start:void 0,contentEnd:c.contentEnd?u.length-1-(c.end-c.contentEnd):void 0},type:h,value:d,cryptInfo:{ref:{id:e,generation:0}},streamId:this.id}}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.N&&n.push(...r.encode("/N"),...r.encode(" "+this.N)),this.First&&n.push(...r.encode("/First"),...r.encode(" "+this.First)),this.Extends&&n.push(...r.encode("/Extends"),m,...this.Extends.toArray(e));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;if(this.Type!==qe)return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=t.getDictBoundsAt(n);let i,a,o=t.skipToNextName(s.contentStart,s.contentEnd);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/N":const e=t.parseNumberAt(o,!1);if(!e)throw new Error("Can't parse /N property value");this.N=e.value,o=e.end+1;break;case"/First":const r=t.parseNumberAt(o,!1);if(!r)throw new Error("Can't parse /First property value");this.First=r.value,o=r.end+1;break;case"/Extends":const n=jt.parseRef(t,o);if(!n)throw new Error("Can't parse /Extends property value");this.Extends=n.value,o=n.end+1;break;default:o=t.skipToNextName(o,s.contentEnd)}return!0}}class Nr extends Xt{constructor(){super(ze)}static parse(e){const t=new Nr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.Version&&n.push(...r.encode("/Version"),...r.encode(this.Version)),this.Pages&&n.push(...r.encode("/Pages"),m,...this.Pages.toArray(e)),this.Lang&&n.push(...r.encode("/Lang"),...this.Lang.toArray(e));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Version":const r=t.parseNameAt(o,!1,!1);if(!r)throw new Error("Can't parse /Version property value");this.Version=r.value,o=r.end+1;break;case"/Pages":const n=jt.parseRef(t,o);if(!n)throw new Error("Can't parse /Pages property value");this.Pages=n.value,o=n.end+1;break;case"/Lang":const i=Wt.parse(t,o,e.cryptInfo);if(!i)throw new Error("Can't parse /Lang property value");this.Lang=i.value,o=i.end+1;break;default:o=t.skipToNextName(o,s-1)}return!!this.Pages}}class kr extends Xt{constructor(){super(Je),this.Rotate=0}static parse(e){const t=new kr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.Parent&&n.push(...r.encode("/Parent"),m,...this.Parent.toArray(e)),this.LastModified&&n.push(...r.encode("/LastModified"),...this.LastModified.toArray(e)),this.MediaBox&&n.push(...r.encode("/MediaBox"),j,...r.encode(this.MediaBox[0]+""),m,...r.encode(this.MediaBox[1]+""),m,...r.encode(this.MediaBox[2]+""),m,...r.encode(this.MediaBox[3]+""),X),this.Rotate&&n.push(...r.encode("/Rotate"),...r.encode(" "+this.Rotate)),this.Annots&&(this.Annots instanceof jt?n.push(...r.encode("/Annots"),m,...this.Annots.toArray(e)):(n.push(...r.encode("/Annots"),j),this.Annots.forEach((t=>n.push(m,...t.toArray(e)))),n.push(X)));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Parent":const r=jt.parseRef(t,o);if(!r)throw new Error("Can't parse /Parent property value");this.Parent=r.value,o=r.end+1;break;case"/LastModified":const n=Qt.parse(t,o,e.cryptInfo);if(!n)throw new Error("Can't parse /LastModified property value");this.LastModified=n.value,o=n.end+1;break;case"/MediaBox":const i=t.parseNumberArrayAt(o,!0);if(!i)throw new Error("Can't parse /MediaBox property value");this.MediaBox=[i.value[0],i.value[1],i.value[2],i.value[3]],o=i.end+1;break;case"/Rotate":const a=t.parseNumberAt(o,!1);if(!a)throw new Error("Can't parse /Rotate property value");this.Rotate=a.value,o=a.end+1;break;case"/Annots":const h=t.getValueTypeAt(o);if(h===lt){const e=jt.parseRef(t,o);if(e){this.Annots=e.value,o=e.end+1;break}}else if(h===ct){const e=jt.parseRefArray(t,o);if(e){this.Annots=e.value,o=e.end+1;break}}throw new Error(`Unsupported /Annots property value type: ${h}`);default:o=t.skipToNextName(o,s-1)}return!!this.Parent}}class Ir extends Xt{constructor(){super(Ge),this.Rotate=0}static parse(e){const t=new Ir;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.Parent&&n.push(...r.encode("/Parent"),m,...this.Parent.toArray(e)),this.Kids&&(n.push(...r.encode("/Kids"),j),this.Kids.forEach((t=>n.push(m,...t.toArray(e)))),n.push(X)),this.Count&&n.push(...r.encode("/Count"),...r.encode(" "+this.Count)),this.MediaBox&&n.push(...r.encode("/MediaBox"),j,...r.encode(this.MediaBox[0]+""),m,...r.encode(this.MediaBox[1]+""),m,...r.encode(this.MediaBox[2]+""),m,...r.encode(this.MediaBox[3]+""),X),this.Rotate&&n.push(...r.encode("/Rotate"),...r.encode(" "+this.Rotate));const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Parent":const e=jt.parseRef(t,o);if(!e)throw new Error("Can't parse /Parent property value");this.Parent=e.value,o=e.end+1;break;case"/Kids":const r=jt.parseRefArray(t,o);if(!r)throw new Error("Can't parse /Kids property value");this.Kids=r.value,o=r.end+1;break;case"/Count":const n=t.parseNumberAt(o,!1);if(!n)throw new Error("Can't parse /Count property value");this.Count=n.value,o=n.end+1;break;case"/MediaBox":const i=t.parseNumberArrayAt(o,!0);if(!i)throw new Error("Can't parse /MediaBox property value");this.MediaBox=[i.value[0],i.value[1],i.value[2],i.value[3]],o=i.end+1;break;case"/Rotate":const a=t.parseNumberAt(o,!1);if(!a)throw new Error("Can't parse /Rotate property value");this.Rotate=a.value,o=a.end+1;break;default:o=t.skipToNextName(o,s-1)}return!(!this.Kids||isNaN(this.Count))}}class Dr extends Jt{constructor(){super(Xe)}static parse(e){const t=new Dr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.Size&&n.push(...r.encode("/Size"),...r.encode(" "+this.Size)),this.Prev&&n.push(...r.encode("/Prev"),...r.encode(" "+this.Prev)),this.Root&&n.push(...r.encode("/Root"),m,...this.Root.toArray(e)),this.Encrypt&&n.push(...r.encode("/Encrypt"),m,...this.Encrypt.toArray(e)),this.Info&&n.push(...r.encode("/Info"),m,...this.Info.toArray(e)),this.ID&&n.push(...r.encode("/ID"),j,...this.ID[0].toArray(e),...this.ID[1].toArray(e),X),this.Index&&(n.push(...r.encode("/Index"),j),this.Index.forEach((e=>n.push(...r.encode(" "+e)))),n.push(X)),this.W&&n.push(...r.encode("/W"),j,...r.encode(this.W[0]+""),m,...r.encode(this.W[1]+""),m,...r.encode(this.W[2]+""),X);const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){var t;if(!super.tryParseProps(e))return!1;if(this.Type!==Ye)return!1;const{parser:r,bounds:n}=e,s=n.contentStart||n.start,i=r.getDictBoundsAt(s);let a,o,h=r.skipToNextName(i.contentStart,i.contentEnd);if(-1===h)return!1;for(;o=r.parseNameAt(h),o;)switch(h=o.end+1,a=o.value,a){case"/Size":const e=r.parseNumberAt(h,!1);if(!e)throw new Error("Can't parse /Size property value");this.Size=e.value,h=e.end+1;break;case"/Prev":const t=r.parseNumberAt(h,!1);if(!t)throw new Error("Can't parse /Size property value");this.Prev=t.value,h=t.end+1;break;case"/Root":const n=jt.parseRef(r,h);if(!n)throw new Error("Can't parse /Root property value");this.Root=n.value,h=n.end+1;break;case"/Encrypt":const s=r.getValueTypeAt(h);if(s===lt){const e=jt.parseRef(r,h);if(e){this.Encrypt=e.value,h=e.end+1;break}throw new Error("Can't parse /Encrypt property value")}throw new Error(`Unsupported /Encrypt property value type: ${s}`);case"/Info":const a=jt.parseRef(r,h);if(!a)throw new Error("Can't parse /Info property value");this.Info=a.value,h=a.end+1;break;case"/ID":const o=Er.parseArray(r,h);if(!o)throw new Error("Can't parse /ID property value");this.ID=[o.value[0],o.value[1]],h=o.end+1;break;case"/Index":const c=r.parseNumberArrayAt(h);if(!c)throw new Error("Can't parse /Index property value");this.Index=c.value,h=c.end+1;break;case"/W":const d=r.parseNumberArrayAt(h);if(!d)throw new Error("Can't parse /W property value");this.W=[d.value[0],d.value[1],d.value[2]],h=d.end+1;break;default:h=r.skipToNextName(h,i.contentEnd)}return!(!(this.W&&this.Size&&this.Root)||this.Encrypt&&!this.ID)&&((null===(t=this.Index)||void 0===t?void 0:t.length)||(this.Index=[0,this.Size]),!0)}}class Rr{constructor(e){this._type=e}get type(){return this._type}get offset(){return this._offset}}class Br{constructor(e,t,r,n,s,i,a){this.type=e,this.id=t,this.generation=r,this.byteOffset=n,this.nextFreeId=s,this.streamId=i,this.streamIndex=a}static*fromTableBytes(e){let t=0,r=0;for(;t<e.length;){const n=[];let s=e[t++];for(;pe.has(s);)n.push(s),s=e[t++];let i=parseInt(n.map((e=>String.fromCharCode(e))).join(""),10);const a=[];let o=e[t++];for(;pe.has(o);)a.push(o),o=e[t++];const h=parseInt(a.map((e=>String.fromCharCode(e))).join(""),10);for(;!pe.has(e[t]);)t++;for(r=0;r<h;r++){const r=parseInt(Array.from(e.subarray(t,t+10)).map((e=>String.fromCharCode(e))).join(""),10);t+=11;const n=parseInt(Array.from(e.subarray(t,t+5)).map((e=>String.fromCharCode(e))).join(""),10);t+=6;const s=e[t];s===J?yield new Br(ke,i++,n,null,r):s===te&&(yield new Br(Ie,i++,n,r)),t+=3}}}static*fromStreamBytes(e,t,r){const[n,s,i]=t,a=n+s+i;if(e.length%a)throw new Error("Incorrect stream length");const o=e.length/a,h=new Array(o);if(null==r?void 0:r.length){let e,t,n=0;for(let s=0;s<r.length;s++)if(s%2)for(t=0;t<r[s];t++)h[n++]=e+t;else e=r[s]}else{let e=0;for(;e<o;)h[e++]=e}let c,d,u,l=0,p=0;for(;l<e.length;)switch(c=n?Ae(e.slice(l,l+n)):1,l+=n,d=Ae(e.slice(l,l+s)),l+=s,u=i?Ae(e.slice(l,l+i)):null,l+=i,c){case ke:yield new Br(ke,h[p++],null!=u?u:65535,null,d);break;case Ie:yield new Br(Ie,h[p++],null!=u?u:0,d);break;case De:yield new Br(De,h[p++],0,null,null,d,u)}}static toTableBytes(e){if(!(null==e?void 0:e.length))return null;const t=new TextEncoder,r=this.groupEntries(e);let n,s,i=new Uint8Array;for(const e of r){s=`${e[0]} ${e[1].length}\r\n`,n=new Uint8Array(i.length+s.length),n.set(i),n.set(t.encode(s),i.length),i=n;for(const r of e[1]){switch(r.type){case ke:s=`${r.nextFreeId.toString().padStart(10,"0")} ${r.generation.toString().padStart(5,"0")} f\r\n`;break;case Ie:s=`${r.byteOffset.toString().padStart(10,"0")} ${r.generation.toString().padStart(5,"0")} n\r\n`;break;default:continue}n=new Uint8Array(i.length+s.length),n.set(i),n.set(t.encode(s),i.length),i=n}}return i}static toStreamBytes(e,t=[1,4,2]){if(!(null==e?void 0:e.length))return null;if(Math.min(...t)<0)throw new Error("Negative length values are not permitted");let[r,n,s]=t;null!=r||(r=0),null!=n||(n=4),null!=s||(s=0);const i=r+n+s;let a,o,h;switch(r){case 0:a=()=>new Uint8Array;break;case 1:a=we;break;case 2:a=ye;break;default:o=e=>new Uint8Array([...new Array(r-2).fill(0),...ye(e)])}switch(n){case 1:o=we;break;case 2:o=ye;break;case 3:o=e=>new Uint8Array([0,...ye(e)]);break;case 4:o=ge;break;default:o=e=>new Uint8Array([...new Array(r-4).fill(0),...ge(e)])}switch(s){case 0:h=()=>new Uint8Array;break;case 1:h=we;break;case 2:h=ye;break;default:o=e=>new Uint8Array([...new Array(r-2).fill(0),...ye(e)])}new TextEncoder;const c=this.groupEntries(e),d=[];let u,l,p,f,A=new Uint8Array;for(const e of c){d.push(e[0],e[1].length);for(const t of e[1]){switch(t.type){case ke:l=a(0),p=o(t.nextFreeId),f=h(t.generation);break;case Ie:l=a(1),p=o(t.byteOffset),f=h(t.generation);break;case De:l=a(2),p=o(t.streamId),f=h(t.streamIndex);break;default:continue}u=new Uint8Array(A.length+i),u.set(A),u.set(l,A.length),u.set(p,A.length+r),u.set(f,A.length+r+n),A=u}}return{bytes:A,index:d}}static groupEntries(e){e.sort(((e,t)=>e.id-t.id));const t=[];let r,n,s;for(const i of e)i.id!==s+1?((null==n?void 0:n.length)&&t.push([r,n]),r=i.id,n=[i]):n.push(i),s=i.id;return(null==n?void 0:n.length)&&t.push([r,n]),t}}class Tr extends Rr{constructor(e,t){super(Ne),this._trailerStream=e,this._offset=t}get prev(){var e;return null===(e=this._trailerStream)||void 0===e?void 0:e.Prev}get size(){var e;return null===(e=this._trailerStream)||void 0===e?void 0:e.Size}get root(){var e;return null===(e=this._trailerStream)||void 0===e?void 0:e.Root}get info(){var e;return null===(e=this._trailerStream)||void 0===e?void 0:e.Root}get encrypt(){var e;return null===(e=this._trailerStream)||void 0===e?void 0:e.Encrypt}get id(){var e;return null===(e=this._trailerStream)||void 0===e?void 0:e.ID}static createFrom(e,t,r){if(!(null==t?void 0:t.length)||!e)return null;const n=Math.max(...t.map((e=>e.id)))+1,s=Math.max(n,e.size);return Tr.create(t,s,r,e.root,e.offset,e.info,e.encrypt,e.id)}static create(e,t,r,n,s,i,a,o){if(!((null==e?void 0:e.length)&&t&&r&&n))return null;const h=new Dr;h.Size=t,h.Root=n,h.Prev=s,h.Info=i,h.Encrypt=a,h.ID=o;const c=[1,4,2],d=Br.toStreamBytes(e,c),u=new qt;u.Predictor=Oe,u.Columns=5,u.Colors=1,u.BitsPerComponent=8;const l=new Tr(h,r);return l._trailerStream.Filter=Re,l._trailerStream.DecodeParms=u,l._trailerStream.W=c,l._trailerStream.Index=d.index,l._trailerStream.streamData=d.bytes,l}static parse(e,t){if(!e)return null;const r=Dr.parse(e);if(!r)return null;return{value:new Tr(r.value,t),start:null,end:null}}createUpdate(e,t){return Tr.createFrom(this,e,t)}getEntries(){if(!this._trailerStream)return[];return Br.fromStreamBytes(this._trailerStream.decodedStreamData,this._trailerStream.W,this._trailerStream.Index)}toArray(e){return this._trailerStream.toArray(e)}}class Lr extends Xt{constructor(){super(rt)}static parse(e){const t=new Lr;return t.tryParseProps(e)?{value:t,start:e.bounds.start,end:e.bounds.end}:null}toArray(e){const t=super.toArray(e),r=new TextEncoder,n=[];this.Size&&n.push(...r.encode("/Size"),...r.encode(" "+this.Size)),this.Prev&&n.push(...r.encode("/Prev"),...r.encode(" "+this.Prev)),this.Root&&n.push(...r.encode("/Root"),m,...this.Root.toArray(e)),this.Encrypt&&n.push(...r.encode("/Encrypt"),m,...this.Encrypt.toArray(e)),this.Info&&n.push(...r.encode("/Info"),m,...this.Info.toArray(e)),this.ID&&n.push(...r.encode("/ID"),j,...this.ID[0].toArray(e),...this.ID[1].toArray(e),X);const s=[...t.subarray(0,2),...n,...t.subarray(2,t.length)];return new Uint8Array(s)}tryParseProps(e){if(!super.tryParseProps(e))return!1;const{parser:t,bounds:r}=e,n=r.contentStart||r.start,s=r.contentEnd||r.end;let i,a,o=t.skipToNextName(n,s-1);if(-1===o)return!1;for(;a=t.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Size":const e=t.parseNumberAt(o,!1);if(!e)throw new Error("Can't parse /Size property value");this.Size=e.value,o=e.end+1;break;case"/Prev":const r=t.parseNumberAt(o,!1);if(!r)throw new Error("Can't parse /Size property value");this.Prev=r.value,o=r.end+1;break;case"/Root":const n=jt.parseRef(t,o);if(!n)throw new Error("Can't parse /Root property value");this.Root=n.value,o=n.end+1;break;case"/Encrypt":const i=t.getValueTypeAt(o);if(i===lt){const e=jt.parseRef(t,o);if(e){this.Encrypt=e.value,o=e.end+1;break}throw new Error("Can't parse /Encrypt property value")}throw new Error(`Unsupported /Encrypt property value type: ${i}`);case"/Info":const a=jt.parseRef(t,o);if(!a)throw new Error("Can't parse /Info property value");this.Info=a.value,o=a.end+1;break;case"/ID":const h=Er.parseArray(t,o);if(!h)throw new Error("Can't parse /ID property value");this.ID=[h.value[0],h.value[1]],o=h.end+1;break;default:o=t.skipToNextName(o,s-1)}return!(!this.Size||!this.Root||this.Encrypt&&!this.ID)}}class Mr extends Rr{constructor(e,t,r){super(Se),this._table=e,this._trailerDict=t,this._offset=r}get prev(){var e;return null===(e=this._trailerDict)||void 0===e?void 0:e.Prev}get size(){var e;return null===(e=this._trailerDict)||void 0===e?void 0:e.Size}get root(){var e;return null===(e=this._trailerDict)||void 0===e?void 0:e.Root}get info(){var e;return null===(e=this._trailerDict)||void 0===e?void 0:e.Root}get encrypt(){var e;return null===(e=this._trailerDict)||void 0===e?void 0:e.Encrypt}get id(){var e;return null===(e=this._trailerDict)||void 0===e?void 0:e.ID}static createFrom(e,t,r){if(!(null==t?void 0:t.length)||!e)return null;const n=Math.max(...t.map((e=>e.id)))+1,s=Math.max(n,e.size);return Mr.create(t,s,r,e.root,e.offset,e.info,e.encrypt,e.id)}static create(e,t,r,n,s,i,a,o){if(!((null==e?void 0:e.length)&&t&&r&&n))return null;const h=new Lr;h.Size=t,h.Prev=s,h.Root=n,h.Info=i,h.Encrypt=a,h.ID=o;const c=Br.toTableBytes(e);return new Mr(c,h,r)}static parse(e,t,r){if(!e||isNaN(t))return null;const n=e.getXrefTableBoundsAt(t);if(!n)return null;const s=e.getDictBoundsAt(n.end+1);if(!s)return null;const i=e.sliceCharCodes(n.contentStart,n.contentEnd),a=Lr.parse({parser:e,bounds:s});if(!a)return null;return{value:new Mr(i,a.value,r),start:null,end:null}}createUpdate(e,t){return Mr.createFrom(this,e,t)}getEntries(){if(!this._table.length)return[];return Br.fromTableBytes(this._table)}toArray(e){const t=this._trailerDict.toArray(e),r=[...de.XREF_TABLE,...de.END_OF_LINE,...this._table,...de.TRAILER,...de.END_OF_LINE,...t,...de.END_OF_LINE];return new Uint8Array(r)}}class Or{constructor(e,t){if(!(null==e?void 0:e.length))throw new Error("Data is empty");this._data=[...e],this._pointer=e.length-1,this._encoder=new TextEncoder,t&&(this._stringCryptor=t.stringCryptor,this._streamCryptor=t.streamCryptor),this.fixEof()}get offset(){return this._pointer}getCurrentData(){return new Uint8Array(this._data)}writeBytes(e){(null==e?void 0:e.length)&&(this._data.push(...e),this._pointer+=e.length)}writeIndirectObject(e,t){if(!(null==e?void 0:e.ref)||!t)return;const r=[...this._encoder.encode(`${e.ref.id} ${e.ref.generation} `),...de.OBJ,...de.END_OF_LINE,...t.toArray(e),...de.OBJ_END,...de.END_OF_LINE];this.writeBytes(r)}writeEof(e){const t=[...de.XREF_START,...de.END_OF_LINE,...this._encoder.encode(e+""),...de.END_OF_LINE,...de.END_OF_FILE,...de.END_OF_LINE];this.writeBytes(t)}fixEof(){this._data[this._pointer]!==y&&(this._data[this._pointer-1]!==v?(this._data.push(v,y),this._pointer+=2):(this._data.push(y),this._pointer+=1))}}class Ur{constructor(e){var t;const r=[],n=[],s=[];let i=0;e.forEach((e=>{for(const t of e.getEntries()){switch(t.type){case ke:r.push(t);break;case Ie:n.push(t);break;case De:s.push(t);break;default:continue}t.id>i&&(i=t.id)}})),this.size=i+1;const a={id:0,generation:65535,nextFreeId:0},o=new c(a),h=new Map,d=new Map;let u=!1;for(const e of r){if(!u&&0===e.id){u=!0,a.nextFreeId=e.nextFreeId;continue}const t=d.get(e.id);(!t||t.generation<e.generation)&&d.set(e.id,{id:e.id,generation:e.generation,nextFreeId:e.nextFreeId})}let l,p=a.nextFreeId;for(;p;)l=d.get(p),d.delete(p),o.push(l),p=l.nextFreeId;[...d].forEach((e=>{const t=e[1];65535===t.generation&&0===t.nextFreeId&&h.set(t.id,t)})),this.freeLinkedList=o,this.freeOutsideListMap=h;const f=new Map;for(const e of n){if(this.isFreed(e))continue;const t=f.get(e.id);t&&t.generation>=e.generation||f.set(e.id,{id:e.id,generation:e.generation,byteOffset:e.byteOffset})}for(const e of s){if(this.isFreed(e))continue;if(f.get(e.id))continue;const r=null===(t=f.get(e.streamId))||void 0===t?void 0:t.byteOffset;r&&f.set(e.id,{id:e.id,generation:e.generation,byteOffset:r,compressed:!0,streamId:e.streamId,streamIndex:e.streamIndex})}this.usedMap=f}getOffset(e){var t;return null===(t=this.usedMap.get(e))||void 0===t?void 0:t.byteOffset}getGeneration(e){var t;return null===(t=this.usedMap.get(e))||void 0===t?void 0:t.generation}isFreed(e){return this.freeOutsideListMap.has(e.id)||this.freeLinkedList.has(e,((e,t)=>e.id===t.id&&e.generation<t.generation))}isUsed(e){return this.usedMap.has(e)}}class Fr{constructor(e){this._refData=e,this._size=e.size;const t=new c;for(const r of e.freeLinkedList)t.push(r);this._freeLinkedList=t,this._usedMap=new Map}get size(){return this._size}takeFreeRef(e,t=!1){let r;if(!t&&this._freeLinkedList.length>1){const t=this._freeLinkedList.pop();this._freeLinkedList.tail.nextFreeId=0,r={id:t.id,generation:t.generation,byteOffset:e}}else r={id:this._size++,generation:0,byteOffset:e};return this._usedMap.set(r.id,r),r}setRefFree(e){if(this._usedMap.has(e)&&(this._usedMap.delete(e),this._size>this._refData.size&&this._size===e+1&&this._size--),this._refData.isUsed(e)){const t={id:e,generation:this._refData.getGeneration(e)+1,nextFreeId:0};if(-1!==this._freeLinkedList.findIndex(t,((e,t)=>e.id===t.id&&e.generation<=t.generation)))return;this._freeLinkedList.tail.nextFreeId=e,this._freeLinkedList.push(t)}}updateUsedRef(e){if(e.compressed&&e.generation)return!1;if(this.isFreed(e))return!1;const t=this._usedMap.get(e.id);if(t&&e.generation>=t.generation)return this._usedMap.set(e.id,e),!0;if(this._refData.isUsed(e.id)){const t=this._refData.getGeneration(e.generation);if(e.generation>=t)return this._usedMap.set(e.id,e),!0}return!1}exportEntries(){const e=[];for(const t of this._freeLinkedList)e.push(new Br(ke,t.id,t.generation,null,t.nextFreeId));return this._usedMap.forEach((t=>{t.compressed?e.push(new Br(De,t.id,0,null,null,t.streamId,t.streamIndex)):e.push(new Br(Ie,t.id,t.generation,t.byteOffset))})),e}isFreed(e){return this._freeLinkedList.has(e,((e,t)=>e.id===t.id&&e.generation<t.generation))}isUsed(e){return this._usedMap.has(e)||this._refData.isUsed(e)}}class Vr{constructor(e){this.getObjectParseInfo=e=>{var t,r,n;if(!e)return null;const s=null===(t=this._referenceData)||void 0===t?void 0:t.getOffset(e);if(isNaN(s))return null;const i=jt.parse(this._docParser,s);if(!i)return null;const a=this._docParser.getIndirectObjectBoundsAt(i.end+1,!0);if(!a)return null;const o=this.getObjectParseInfo,h={parser:this._docParser,bounds:a,parseInfoGetter:o,cryptInfo:{ref:{id:i.value.id,generation:i.value.generation},stringCryptor:null===(r=this._authResult)||void 0===r?void 0:r.stringCryptor,streamCryptor:null===(n=this._authResult)||void 0===n?void 0:n.streamCryptor}};if(i.value.id===e)return h;const c=Sr.parse(h);if(!c)return;const d=c.value.getObjectData(e);return d?(d.parseInfoGetter=o,d):null},this._data=e,this._docParser=new _r(e),this._version=this._docParser.getPdfVersion();const t=this._docParser.getLastXrefIndex();if(!t)throw new Error("File doesn't contain update section");const r=Vr.parseAllXrefs(this._docParser,t.value);if(!r.length)throw new Error("Failed to parse cross-reference sections");this._lastXrefOffset=t.value,this._xrefs=r,this._referenceData=new Ur(r),console.log(this._xrefs),console.log(this._referenceData),this.parseEncryption(),console.log(this._encryption)}get size(){var e;return(null===(e=this._xrefs)||void 0===e?void 0:e.length)?this._xrefs[0].size:0}get encrypted(){return!!this._encryption}get authenticated(){return!this._encryption||!!this._authResult}static parseXref(e,t,r){if(!e||!t)return null;const n=t,s=e.findSubarrayIndex(de.XREF_TABLE,{minIndex:t,closedOnly:!0});if(s&&s.start===t){const s=e.findSubarrayIndex(de.XREF_HYBRID,{minIndex:t,maxIndex:r,closedOnly:!0});if(!s){const r=Mr.parse(e,t,n);return null==r?void 0:r.value}{const r=e.parseNumberAt(s.end+1);if(!r)return null;t=r.value}}const i=jt.parse(e,t,!1);if(!i)return null;const a=e.getIndirectObjectBoundsAt(i.end+1);if(!a)return null;const o=Tr.parse({parser:e,bounds:a},n);return null==o?void 0:o.value}static parseAllXrefs(e,t){const r=[];let n,s=e.maxIndex;for(;t&&(n=Vr.parseXref(e,t,s),n);)r.push(n),s=t,t=n.prev;return r}authenticate(e){if(this.authenticated)return!0;const t=this._encryption.toCryptOptions(),r=this._xrefs[0].id[0].hex,n=new Ht(t,r);return this._authResult=n.authenticate(e),this.authenticated}getRefinedData(e){this.checkAuthentication();const t=new Fr(this._referenceData);e.forEach((e=>t.setRefFree(e)));const r=new Or(this._data,this._authResult),n=r.offset,s=t.takeFreeRef(n,!0),i=t.exportEntries(),a=this._xrefs[0].createUpdate(i,n);r.writeIndirectObject({ref:s},a),r.writeEof(n);return r.getCurrentData()}getSupportedAnnotations(){var e;this.checkAuthentication(),this._catalog||(this.parsePageTree(),console.log(this._catalog),console.log(this._pageRoot),console.log(this._pages));const t=new Map;for(const r of this._pages){if(!r.Annots)break;const n=[];if(Array.isArray(r.Annots))n.push(...r.Annots);else{const t=this.getObjectParseInfo(r.Annots.id);if(t){const r=jt.parseRefArray(t.parser,t.bounds.contentStart);(null===(e=null==r?void 0:r.value)||void 0===e?void 0:e.length)&&n.push(...r.value)}}const s=[];for(const e of n){const t=this.getObjectParseInfo(e.id);let r;switch(t.parser.parseDictSubtype(t.bounds)){case ft:r=br.parse(t);break;case At:r=dr.parse(t);break;case bt:r=mr.parse(t);break;case gt:r=lr.parse(t);break;case yt:case vt:case mt:r=yr.parse(t);break;case wt:r=wr.parse(t);break;case Et:r=gr.parse(t)}r&&s.push(r.value)}t.set(r.id,s)}return t}checkAuthentication(){if(!this.authenticated)throw new Error("Unauthorized access to file data")}parseEncryption(){const e=this._xrefs[0].encrypt;if(!e)return;const t=this.getObjectParseInfo(e.id),r=Pr.parse(t);if(!r)throw new Error("Encryption dict can't be parsed");this._encryption=r.value}parsePageTree(){const e=this._xrefs[0].root,t=this.getObjectParseInfo(e.id),r=Nr.parse(t);if(!r)throw new Error("Document root catalog not found");this._catalog=r.value;const n=r.value.Pages,s=this.getObjectParseInfo(n.id),i=Ir.parse(s);if(!i)throw new Error("Document root page tree not found");this._pageRoot=i.value;const a=[];this.parsePages(a,i.value),this._pages=a}parsePages(e,t){if(t.Kids.length)for(const r of t.Kids){const t=this.getObjectParseInfo(r.id);if(!t)continue;const n=t.parser.parseDictType(t.bounds);if(n===Ge){const r=Ir.parse(t);r&&this.parsePages(e,r.value)}else if(n===Je){const r=kr.parse(t);r&&e.push(r.value)}}}}class Hr{constructor(e){if(this.onAnnotationDictChange={set:(e,t,r)=>!0},!(null==e?void 0:e.length))throw new Error("Data is empty");this._sourceData=e,this._documentData=new Vr(e)}tryAuthenticate(e=""){return!!this._documentData.authenticated||this._documentData.authenticate(e)}getRefinedData(){const e=this.getAnnotationMap(),t=[];return(null==e?void 0:e.size)&&this.getAnnotationMap().forEach((e=>{e.forEach((e=>{e.id&&t.push(e.id)}))})),this._documentData.getRefinedData(t)}getExportedData(){return null}getPageAnnotations(e){const t=this.getAnnotationMap().get(e);return t?t.map((e=>new Proxy(e,this.onAnnotationDictChange))):[]}addAnnotation(e,t){const r=this.getAnnotationMap().get(e);r?r.push(t):this.getAnnotationMap().set(e,[t])}getAnnotationMap(){if(this._annotationsByPageId)return this._annotationsByPageId;if(!this._documentData.authenticated)throw new Error("Unauthorized access to file data");this._annotationsByPageId=this._documentData.getSupportedAnnotations()}}var Wr=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{h(n.next(e))}catch(e){i(e)}}function o(e){try{h(n.throw(e))}catch(e){i(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}h((n=n.apply(e,t||[])).next())}))};class Qr{constructor(e,t){this._visibleAdjPages=0,this._previewWidth=100,this._minScale=.25,this._maxScale=4,this._scale=1,this._previewerHidden=!0,this._pages=[],this._currentPage=0,this._mode="normal",this._pointerInfo={lastPos:null,downPos:null,downScroll:null},this._timers={hidePanels:0},this._pinchInfo={active:!1,lastDist:0,minDist:10,sensitivity:.025,target:null},this.onPdfLoadingProgress=e=>{},this.onPdfLoadedAsync=e=>Wr(this,void 0,void 0,(function*(){this._pdfDocument=e,yield this.refreshPagesAsync(),this.renderVisiblePreviews(),this.renderVisiblePages(),this._shadowRoot.querySelector("#panel-bottom").classList.remove("disabled")})),this.onPdfClosedAsync=()=>Wr(this,void 0,void 0,(function*(){this._shadowRoot.querySelector("#panel-bottom").classList.add("disabled"),this._pdfDocument&&(this._pdfDocument=null),yield this.refreshPagesAsync()})),this.onMainContainerResize=(e,t)=>{const{width:r}=this._mainContainer.getBoundingClientRect();r<721?this._mainContainer.classList.add("mobile"):this._mainContainer.classList.remove("mobile")},this.onHandToggleClick=()=>{"hand"===this._mode?(this._mode="normal",this._viewer.classList.remove("hand"),this._shadowRoot.querySelector("div#toggle-hand").classList.remove("on")):(this._mode="hand",this._viewer.classList.add("hand"),this._shadowRoot.querySelector("div#toggle-hand").classList.add("on"))},this.onPreviewerToggleClick=()=>{this._previewerHidden?(this._mainContainer.classList.remove("hide-previewer"),this._shadowRoot.querySelector("div#toggle-previewer").classList.add("on"),this._previewerHidden=!1,setTimeout((()=>this.renderVisiblePreviews()),1e3)):(this._mainContainer.classList.add("hide-previewer"),this._shadowRoot.querySelector("div#toggle-previewer").classList.remove("on"),this._previewerHidden=!0)},this.onPreviewerPageClick=e=>{let t,r=e.target;for(;r&&!t;){const e=r.dataset.pageNumber;e?t=+e:r=r.parentElement}t&&this.scrollToPage(t-1)},this.onPreviewerScroll=e=>{this.renderVisiblePreviews()},this.onPaginatorInput=e=>{e.target instanceof HTMLInputElement&&(e.target.value=e.target.value.replace(/[^\d]+/g,""))},this.onPaginatorChange=e=>{if(e.target instanceof HTMLInputElement){const t=Math.max(Math.min(+e.target.value,this._pdfDocument.numPages),1);t+""!==e.target.value&&(e.target.value=t+""),this.scrollToPage(t-1)}},this.onPaginatorPrevClick=()=>{const e=a(this._currentPage-1,0,this._pages.length-1);this.scrollToPage(e)},this.onPaginatorNextClick=()=>{const e=a(this._currentPage+1,0,this._pages.length-1);this.scrollToPage(e)},this.onZoomOutClick=()=>{this.zoomOut()},this.onZoomInClick=()=>{this.zoomIn()},this.onZoomFitViewerClick=()=>{const e=a((this._viewer.getBoundingClientRect().width-20)/this._pages[this._currentPage].viewContainer.getBoundingClientRect().width*this._scale,this._minScale,this._maxScale);this.setScale(e),this.scrollToPage(this._currentPage)},this.onZoomFitPageClick=()=>{const{width:e,height:t}=this._viewer.getBoundingClientRect(),{width:r,height:n}=this._pages[this._currentPage].viewContainer.getBoundingClientRect(),s=a((e-20)/r*this._scale,this._minScale,this._maxScale),i=a((t-20)/n*this._scale,this._minScale,this._maxScale);this.setScale(Math.min(s,i)),this.scrollToPage(this._currentPage)},this.onViewerScroll=e=>{this.renderVisiblePages()},this.onViewerPointerMove=e=>{const{clientX:t,clientY:r}=e,{x:n,y:s,width:i,height:a}=this._viewer.getBoundingClientRect(),o=t-n,h=r-s,c=i-o,d=a-h;Math.min(o,c,h,d)>100?this._panelsHidden||this._timers.hidePanels||(this._timers.hidePanels=setTimeout((()=>{this._mainContainer.classList.add("hide-panels"),this._panelsHidden=!0,this._timers.hidePanels=null}),5e3)):(this._timers.hidePanels&&(clearTimeout(this._timers.hidePanels),this._timers.hidePanels=null),this._panelsHidden&&(this._mainContainer.classList.remove("hide-panels"),this._panelsHidden=!1)),this._pointerInfo.lastPos={x:t,y:r}},this.onViewerPointerDown=e=>{if("hand"!==this._mode)return;const{clientX:t,clientY:r}=e;this._pointerInfo.downPos={x:t,y:r},this._pointerInfo.downScroll={x:this._viewer.scrollLeft,y:this._viewer.scrollTop};const n=e=>{const{x:t,y:r}=this._pointerInfo.downPos,{x:n,y:s}=this._pointerInfo.downScroll,i=e.clientX-t,a=e.clientY-r;this._viewer.scrollTo(n-i,s-a)},s=e=>{this._pointerInfo.downPos=null,this._pointerInfo.downScroll=null,window.removeEventListener("pointermove",n),window.removeEventListener("pointerup",s),window.removeEventListener("pointerout",s)};window.addEventListener("pointermove",n),window.addEventListener("pointerup",s),window.addEventListener("pointerout",s)},this.onViewerTouchStart=e=>{if(2!==e.touches.length)return;const t=e.touches[0],r=e.touches[1];this._pinchInfo.active=!0,this._pinchInfo.lastDist=o(t.clientX,t.clientY,r.clientX,r.clientY);const n=e=>{if(2!==e.touches.length)return;const t=e.touches[0],r=e.touches[1],n=o(t.clientX,t.clientY,r.clientX,r.clientY),s=n-this._pinchInfo.lastDist,i=Math.floor(s/this._pinchInfo.minDist);if(i){const e=(a=t.clientX,h=t.clientY,c=r.clientX,d=r.clientY,{x:(c+a)/2,y:(d+h)/2});this._pinchInfo.lastDist=n,this.zoom(i*this._pinchInfo.sensitivity,e)}var a,h,c,d},s=t=>{this._pinchInfo.active=!1,this._pinchInfo.lastDist=0,e.target.removeEventListener("touchmove",n),e.target.removeEventListener("touchend",s),e.target.removeEventListener("touchcancel",s)};e.target.addEventListener("touchmove",n),e.target.addEventListener("touchend",s),e.target.addEventListener("touchcancel",s)},this.onViewerWheel=e=>{e.ctrlKey&&(e.preventDefault(),e.deltaY>0?this.zoomOut(this._pointerInfo.lastPos):this.zoomIn(this._pointerInfo.lastPos))};const n=document.querySelector(e);if(!n)throw new Error("Container not found");if(!(n instanceof HTMLDivElement))throw new Error("Container is not a DIV element");if(this._outerContainer=n,!t)throw new Error("Worker source path not defined");r.workerSrc=t,this.initViewerGUI()}destroy(){var e,t;null===(e=this._pdfLoadingTask)||void 0===e||e.destroy(),this._pages.forEach((e=>e.destroy())),this._pdfDocument&&(this._pdfDocument.cleanup(),this._pdfDocument.destroy()),null===(t=this._mainContainerResizeObserver)||void 0===t||t.disconnect(),this._shadowRoot.innerHTML=""}openPdfAsync(e){return Wr(this,void 0,void 0,(function*(){let t,r;try{if(e instanceof Uint8Array)t=e;else{let r;if("string"==typeof e){const t=yield fetch(e);r=yield t.blob()}else r=e;const n=yield r.arrayBuffer();t=new Uint8Array(n)}}catch(e){throw new Error("Cannot load file data!")}const s=new Hr(t);let i;for(;;){if(s.tryAuthenticate(i))break;i="ownerpassword"}t=s.getRefinedData();try{if(this._pdfLoadingTask)return yield this.closePdfAsync(),this.openPdfAsync(t);this._pdfLoadingTask=n({data:t,password:i}),this._pdfLoadingTask.onProgress=this.onPdfLoadingProgress,r=yield this._pdfLoadingTask.promise,this._pdfLoadingTask=null}catch(e){throw new Error(`Cannot open PDF: ${e.message}`)}yield this.onPdfLoadedAsync(r)}))}closePdfAsync(){return Wr(this,void 0,void 0,(function*(){this._pdfLoadingTask&&(this._pdfLoadingTask.destroyed||(yield this._pdfLoadingTask.destroy()),this._pdfLoadingTask=null),yield this.onPdfClosedAsync()}))}initViewerGUI(){this._shadowRoot=this._outerContainer.attachShadow({mode:"open"}),this._shadowRoot.innerHTML='\n  <style>\n    :host {\n      --color-primary-final: var(--color-primary, rgba(40,40,40,1));\n      --color-primary-tr-final: var(--color-primary-tr, rgba(40,40,40,0.9));\n      --color-secondary-final: var(--color-secondary, rgba(60,60,60,1));\n      --color-secondary-tr-final: var(--color-secondary-tr, rgba(60,60,60,0.9));\n      --color-accent-final: var(--color-accent, rgba(96,96,96,1));\n      --color-shadow-final: var(--color-shadow, rgba(0,0,0,0.75));\n      --color-bg-final: var(--color-bg, rgba(128,128,128,1));\n      --color-fg-primary-final: var(--color-fg-primary, rgba(255,255,255,1));\n      --color-fg-secondary-final: var(--color-fg-secondary, rgba(187,187,187,1));\n      --color-fg-accent-final: var(--color-fg-accent, rgba(255,255,255,1));\n      --color-text-selection-final: var(--color-text-selection, rgba(104,104,128,0.3));\n    }\n\n    .disabled {\n      pointer-events: none;\n    }\n\n    .absolute {\n      position: absolute;\n    }\n    .abs-stretch {\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n    }\n    .abs-topleft {\n      position: absolute;\n      left: 0;\n      top: 0;\n    }\n\n    #main-container {\n      box-sizing: border-box;\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      justify-content: stretch;\n      align-items: stretch;\n      width: 100%;\n      height: 100%;\n      background: var(--color-bg-final);\n    }\n  \n    #panel-top {\n      position: relative;\n      display: flex;\n      flex-direction: row;\n      justify-content: space-between;\n      align-items: center;\n      flex-shrink: 0;\n      width: 100%;\n      height: 50px;\n      background: var(--color-primary-final);\n      box-shadow: 0 0 10px var(--color-shadow-final);\n      z-index: 1;\n      transition: height 0.25s ease-out 0.1s;\n    }\n    .hide-panels #panel-top {\n      height: 0;\n      transition: height 0.25s ease-in 0.2s;\n    }\n  \n    #panel-bottom {\n      position: absolute;\n      display: flex;\n      flex-direction: row;\n      justify-content: center;\n      align-items: center;\n      flex-grow: 0;\n      flex-shrink: 0;\n      left: calc(50% - 160px);\n      bottom: 20px;\n      width: 320px;\n      height: 50px;  \n      background: var(--color-primary-tr-final);\n      box-shadow: 0 0 10px var(--color-shadow-final);\n      z-index: 1;\n      transition: height 0.25s ease-out, bottom 0.1s linear 0.25s;\n    }\n    .hide-panels #panel-bottom {\n      bottom: 0;\n      height: 0;\n      transition: bottom 0.1s linear 0.1s, height 0.25s ease-in 0.2s;\n    }\n\n    .panel-v-separator {\n      width: 1px;\n      height: 30px;\n      background-color: var(--color-fg-secondary-final);\n    }\n  \n    .panel-button {\n      cursor: pointer;\n      user-select: none;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      width: 36px;\n      height: 36px;\n      border-radius: 50%;\n    }\n    .panel-button:hover,\n    .panel-button.on {\n      background-color: var(--color-accent-final);\n    }\n    .panel-button img {\n      width: 20px;\n      height: 20px;\n      filter: invert() opacity(0.5) drop-shadow(0 0 0 var(--color-fg-primary-final)) saturate(1000%);\n    }  \n    .panel-button:hover img,\n    .panel-button.on img {\n      filter: invert() opacity(0.5) drop-shadow(0 0 0 var(--color-fg-accent-final)) saturate(1000%);\n    }  \n  \n    .subpanel {\n      display: flex;\n      flex-direction: row;\n      justify-content: center;\n      align-items: center;\n      margin: 0 4px;\n    }    \n    \n    .panel-item {\n      transform: scale(1);\n      transition: opacity 0.1s ease-out 0.35s, transform 0s linear 0.35s;\n    }\n    .hide-panels .panel-item {\n      cursor: default;      \n      opacity: 0;\n      transform: scale(0);\n      transition: opacity 0.1s ease-in, transform 0s linear 0.1s;\n    }\n  \n    #paginator {  \n      user-select: none;\n      font-family: sans-serif;\n      font-size: 16px;\n      color: var(--color-fg-primary-final);\n    }\n    #paginator-input {\n      text-align: center; \n      font-size: 16px;\n      width: 30px;\n      height: 30px;\n      margin: 2px;\n      padding: 0;\n      outline: none;\n      border: none;\n      color: var(--color-fg-primary-final);\n      background-color: var(--color-primary-final);\n    }\n    #paginator-total {\n      margin: 4px;\n    }\n\n    #toggle-previewer {\n      margin: 4px;\n    }\n      \n    #previewer {\n      box-sizing: border-box;\n      position: absolute;\n      display: flex;\n      flex-direction: column;\n      justify-content: flex-start;\n      overflow-y: auto;\n      left: 0;\n      top: 50px;\n      bottom: 0;\n      width: 160px; \n      padding-top: 0px;\n      background: var(--color-secondary-final);\n      box-shadow: 0 0 10px var(--color-shadow-final);\n      z-index: 1;\n      transition: padding-top 0.25s ease-out 0.1s, top 0.25s ease-out 0.1s, width 0.25s ease-out;\n    } \n    .hide-panels #previewer {\n      top: 0;\n      padding-top: 50px;\n      transition: padding-top 0.25s ease-in 0.2s, top 0.25s ease-in 0.2s;\n    }   \n    .mobile #previewer {\n      background: var(--color-secondary-tr-final);\n    } \n    .hide-previewer #previewer {\n      width: 0;\n      transition: width 0.25s ease-in 0.1s;\n    }\n    #previewer .page-preview {      \n      transform: scaleX(1);\n      transition: opacity 0.1s ease-out 0.35s, transform 0s linear 0.35s;\n    }\n    .hide-previewer #previewer .page-preview {\n      opacity: 0;\n      transform: scaleX(0);\n      transition: opacity 0.1s ease-in, transform 0s linear 0.1s;\n    }\n  \n    #viewer {\n      box-sizing: border-box;\n      position: absolute;\n      display: flex;\n      flex-direction: column;\n      justify-content: flex-start;\n      overflow: auto;\n      left: 160px;\n      right: 0;\n      top: 50px;\n      bottom: 0;\n      padding-top: 0px;\n      transition: padding-top 0.25s ease-out 0.1s, top 0.25s ease-out 0.1s, left 0.25s ease-out;\n    }\n    #viewer.hand {\n      cursor: grab !important;\n      user-select: none !important;\n    }\n    .hide-panels #viewer {\n      top: 0;\n      padding-top: 50px;\n      transition: padding-top 0.25s ease-in 0.2s, top 0.25s ease-in 0.2s;\n    }      \n    .hide-panels.mobile #viewer,\n    .hide-panels.hide-previewer #viewer {\n      top: 0;\n      padding-top: 50px;\n      left: 0;\n      transition: padding-top 0.25s ease-in 0.2s, top 0.25s ease-in 0.2s, left 0.25s ease-in;\n    }   \n    .mobile #viewer,\n    .hide-previewer #viewer {\n      top: 50px;\n      padding-top: 0px;\n      left: 0;\n      transition: padding-top 0.25s ease-out 0.1s, top 0.25s ease-out 0.1s, left 0.25s ease-in;\n    } \n  \n    .page {    \n      position: relative;\n      display: flex;\n      flex-grow: 0;\n      flex-shrink: 0;\n      margin: 10px auto;\n      background-color: white;\n      box-shadow: 0 0 10px var(--color-shadow-final);\n    }\n    .page-preview {   \n      cursor: pointer; \n      position: relative;\n      display: flex;\n      flex-grow: 0;\n      flex-shrink: 0;\n      margin: 0 auto;\n      background-color: white;\n      background-clip: content-box;\n      border-style: solid;\n      border-width: 10px 10px 20px 10px;\n      border-color: transparent;\n    }\n    .page-preview:hover,\n    .page-preview.current {\n      border-color: var(--color-accent-final);\n    }\n    .page-preview::after {\n      display: inline-block;\n      position: absolute;\n      top: calc(100% + 3px);\n      width: 100%;\n      text-align: center;\n      font-family: sans-serif;\n      font-size: 14px;\n      line-height: 1;\n      color: var(--color-fg-primary-final);\n      content: attr(data-page-number) " ";\n    }\n\n    .page-canvas {\n      background-color: white;\n    } \n    \n    .page-text {\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      margin: 0;\n      padding: 0;\n      overflow: hidden;\n      line-height: 1;\n    }\n    .page-text span {\n      cursor: text;\n      position: absolute;\n      white-space: pre;\n      color: transparent;\n      transform-origin: 0% 0%;\n    }\n    .page-text ::selection {\n      background: var(--color-text-selection-final);\n    }\n    .hand .page-text span {\n      cursor: grab;\n    }\n  </style>\n\n  <div id="main-container" class="hide-previewer">\n    <div id="viewer"></div>\n    <div id="previewer"></div>\n    <div id="panel-top"> \n      <div class="subpanel panel-item">\n        <div id="toggle-previewer" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcmlDQ1BpY2MAACiRdZE9S8NQFIbftkpFWwrqIOKQoYpCC0VBHKWCXapDW8GqS3KbtEKShpsUKa6Ci0PBQXTxa/Af6Cq4KgiCIoi4+Af8WqTEc5tCi7Qn3JyH9573cO+5gD+tM8PuSQCG6fBMKimt5tek4Dt8GEQYQ5iSmW0tZRdz6Bo/j1RN8RAXvbrXdYyBgmozwNdHPMss7hDPE6e3HEvwHvEwK8kF4hPiGKcDEt8KXfH4TXDR4y/BPJdZAPyip1RsY6WNWYkbxJPEUUOvsOZ5xE1CqrmSpTxKaww2MkghCQkKKtiEDgdxyibNrLMv0fAto0weRn8LVXByFFEib4zUCnVVKWukq/TpqIq5/5+nrc1Me91DSaD31XU/x4HgPlCvue7vqevWz4DAC3BttvxlmtPcN+m1lhY9BiI7wOVNS1MOgKtdYOTZkrnckAK0/JoGfFwA4TwwdA/0r3uzau7j/AnIbdMT3QGHR8AE1Uc2/gDt82gCvNGYhAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAcpJREFUeNrtWwFuwyAMjBEPWNf8/4XpugesoWMKUppBYidQ5cAnVZWaRtGdDxscoC6Bvu9d7PfRue6sMETJa8MwRC8Slzi6ACkhiEu8FgGWQpiucdBW9FNj5wiWzyvxjOk5/muVm30n8Xfjl8NfkNeEMLHo10Cem/CbyAHeCZMb/sGePfqTfXfh5/Hovu/3F25Lx9ujiURad6WIld1xHDtjTLLshXv8f7Zgka2dY04ClQNCxDmR5eL0Dvi63Vavf16vh1xjzzy13YKUPPQQWFaDHOShBJjX8VzkIRdDa+RDvvBlskoBOOSlVcLURr7KIVCKPIQAJclDJsGc5FkzwdBUqJE8pANykocTIDd59mKI2zIv0Q8oSR7GAaXIQwhQkjx0GVQBGI5xjEWRrTGqkmGjQ0AFUAFUABVABVAB2sXmRMi3pEbnSDLJyNm3h3MAEvnsAqCRZw0Bb/l5Q2THjg1qaghoFVABVAAVQAVQAVQAFUCCI9thxYSJXj5WcspCHaACNNgP+LhcTr+gySqAX/nNX2nP99ujI/aaX3NAbAPDkQ0RSNFfPTUWbkA/QLUVTNoT9RpOj+rJ0aUDJE5AdkDy8LRECEQBUrnsCeUexwK5uUFRAAAAAElFTkSuQmCC"/>\n        </div> \n        <div id="toggle-hand" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcWlDQ1BpY2MAACiRdZE9S8NQFIbfpkpFqx3qIMUhQxWHFoqCOEoFu1SHtoJVl+Q2aYQkDUmKFFfBxaHgILr4NfgPdBVcFQRBEURc/AN+LVLiuU2hRdoTbs7De897uPdcQMjqzHD6UoBhunYukxZXi2ti6B0BxDACAVGJOdZSfrGAnvHzSNUUD0neq3dd1xgqKQ4DAgPEs8yyXeJ54uyWa3HeIx5lmlQiPiFO2HRA4luuyz6/cS77/MXZLuQWAIH3FMsdLHcw02yDeIo4buhV1joPv0lYMVfylGO0xuEghwzSECGjik3ocJGkbNLMuvtSTd8yKuRh9LdQg02OMjTyJkitUleFskq6Qp+OGp/7/3k66sy03z2cBvpfPe9zAgjtA4265/2eel7jDAi+ANdm21+hOc19k15va/FjILIDXN60NfkAuNoFxp4tyZaaUpCWoKrAxwUwXASi98Dguj+r1j7On4DCNj3RHXB4BExSfWTjD603Z+Sp2ztrAAAACXBIWXMAAAsTAAALEwEAmpwYAAADGklEQVR42uVbC47jIAytESeY6f1P2NkjLCOqInmoP5g4BChSpLZJAT8/G9sQuDHtfr+Tv/9P6WZp/35+tP6lDsEyXgBg7z0eD3qAVsE9AWgU/s8cOQG+vr+bAOCAiK2Cn9CS4TnwGrTIWYAItw9voGmfo56DJlI1DnD38jx75qGxOvcZRwuuCV++V888zaCmLyUkvlc+S0BE6uZBtBMDKHjYbvnMzVG6Rz0bvbSaByWo+0frR0GQWCSZicSE0Kv93Fm5mAl10V/4PSkrSGpRkgrAUXoatWbq8yVA8ujfFQBOg56UbxXQCoIXACytvUHwBjkepffL+Q0PYGqQseaxw5WWyScDcmyPr6uEYOzdnT3YcTcxwMsBtsTlXv1aVoJwpv0bNH16tDl8FThTmwygXeYSBtn61YAmLn6YlgFW0Bg/UgueatMYWQ+AWRiFQZjSBOql6kwneWlF6MyaA8E+6EqHtUleEQUeMD2ofcJH1QRPS4cno7tp/NjoMGbSIljpL4EfPo3ybwzAOzd5aRC0DSOTllEgBEPykBSAlmzBkjkhILyWJLb2Vy7qP54heW89oGu/rgiEKskiRdGETyurBUr7L08L0sA9FdhpTYBaZopmpMKjBwjO+5KiuVD9xVYPSuzXTRdAtdQRc90TnyMIBxBetuHib+jQxjYgPNnQ68m3igOsjm0nEALl4Q2BzvIgRC3Qwaewciu5A9pzr4sM65nAQRYszYioxPzqQUXsDzJbOMZMDwAX6GQB6vM522WDStKzdYt1HlCzQNrBXZEROAxuDYS2YUGtrAwGmw1+SmsNhdMm2n87Wxha1/PdvH/xa8GQg69eEL3ufMBszg+zPBjD2jRwgmfavv7CxC7rvqbcgA89E4cKYQNfkCTlDt0XmGDZezNt1QmuGBgJwvNvjeE/t5Siy3ncq/f9LcJTrA1Wp7GAQ2SFJ0+ItGx5C0XQNJPmhYIuiG+Otm5P9QzQypwjpmSlPR4TNDoTr6iRA40+ak/l95QD1+RaemdIE96UDqMDCUuBYBW+lhM0O1VC4nQl/SkW1MJrcvwCJhH28gf87HUAAAAASUVORK5CYII="/>\n        </div> \n      </div>\n      <div id="annotator" class="subpanel panel-item">\n      </div>\n    </div>\n    <div id="panel-bottom" class="disabled">\n      <div id="paginator" class="subpanel panel-item">\n        <div id="paginator-prev" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="paginator-next" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <input id="paginator-input" type="text">\n        <span>&nbsp/&nbsp</span>\n        <span id="paginator-total">0</span>\n      </div>\n      <div class="panel-v-separator panel-item"></div>\n      <div id="zoomer" class="subpanel panel-item">\n        <div id="zoom-out" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="zoom-in" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="zoom-fit-viewer" class="panel-button">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcWlDQ1BpY2MAACiRdZG9S8NQFMVPW8Wi1Q46SHHIUMWhhaIgjlLBLtWhrWDVJXlN2kKShpcUKa6Ci0PBQXTxa/A/0FVwVRAERRBx8R/wa5ES72sKLdLe8PJ+nHfP5eUE8Kd1Zth9CcAwHZ5JJaW1/Lo08A4fRhBEHBGZ2dZydimHnvXzSN1UD3Exq3df1xoqqDYDfEHiOWZxh3iBOL3lWIL3iMdYSS4QnxDHOF2Q+Fboisdvgosefwnmucwi4BczpWIHKx3MStwgniaOGnqVte4jviSkmqtZ2iO0JmAjgxSSkKCgijJ0OJRLGSZl1t2XaPpWUCEPo7eFGjg5iiiRN0ZqlaaqtGukq/ToqInc/+dpa7Mz3vRQEuh/dd3PSWBgH2jUXff31HUbZ0DgBbg22/4K5TT/TXq9rUWPgfAOcHnT1pQD4GoXGH+2ZC43pQAtv6YBHxfAcB4YvQcGN7ysWuc4fwJy2/SL7oDDI2CK+sObf/JNaAQfxWcoAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+0lEQVR42u2bMW/EIAyFA7qla5Ol///HdUm6dguFKlQuBwnh7ADKs5TlTsrxPp6NAZ16H0czCMTXsijO90mNUw83DwC4OwAV5hZ37rYWoV6kAAAAAAAAAAAAAAAAAAAAAADcMh6CO63F7iwnkR2cUmqe57YcEIq3zyg4cWaapnYARM7rRjtLYupXY9ggaAHxzqKDtSgbAXdIkwBqqgK4QryP8J3OBe6xLjBVAFwpnjoh9rmDUJoOuhfxqXTwTiitCbon8WE6ROrCaQi6N/GxdFjX9XtzwWkIukS8/cHPmuKfnKD1W6kTdMnM2x/8qC0+VhNIPciGoEts7+nb75ro53cm4nCJ3L0ZkrqRvWSXRwokBZR9M9SzeJoOR82SziHYe5C6kA/A2cZB8E/PsXfh+zgqLt4+DgIl2cotsivEdizJlD0aZ84ymOy/G5nd5FhyJukQwHby8td60jW3hULpxP8Wu605O+vQrEaIQqDtZ20nePG+OStJz+xW+MkJpP2s4QQqvmTmizZDUSdsg7jSCVzii7bDHkK4PF5VEzjFFx+IOAip/lsSArf4YgCxZkl6iZQQ/zKAVJ/AnQ5S4lkA0Jog3Msv3OK5HBBdHZjj300TZxvOdjcoCYHrjlHMAT0HAAAAAAAAAAAAAAAAAAAAANwzFP47jBQAgFvHDyRnPtj60cBDAAAAAElFTkSuQmCC"/>\n        </div>\n        <div id="zoom-fit-page" class="panel-button">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcWlDQ1BpY2MAACiRdZG9S8NQFMVPW8Wi1Q46SHHIUMWhhaIgjlLBLtWhrWDVJXlN2kKShpcUKa6Ci0PBQXTxa/A/0FVwVRAERRBx8R/wa5ES72sKLdLe8PJ+nHfP5eUE8Kd1Zth9CcAwHZ5JJaW1/Lo08A4fRhBEHBGZ2dZydimHnvXzSN1UD3Exq3df1xoqqDYDfEHiOWZxh3iBOL3lWIL3iMdYSS4QnxDHOF2Q+Fboisdvgosefwnmucwi4BczpWIHKx3MStwgniaOGnqVte4jviSkmqtZ2iO0JmAjgxSSkKCgijJ0OJRLGSZl1t2XaPpWUCEPo7eFGjg5iiiRN0ZqlaaqtGukq/ToqInc/+dpa7Mz3vRQEuh/dd3PSWBgH2jUXff31HUbZ0DgBbg22/4K5TT/TXq9rUWPgfAOcHnT1pQD4GoXGH+2ZC43pQAtv6YBHxfAcB4YvQcGN7ysWuc4fwJy2/SL7oDDI2CK+sObf/JNaAQfxWcoAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB30lEQVR42u2bzXKDIBCAw+ql6cnqpQ/Q93+f9gF60aan9GKwmkqHsXZA5Wd3YWcyySFO+D4WCLKKU+R4qush5u/DKfHIAlIXIFIDXs45eQhkAYlHiaUhTdMMcvgZniDcTE397Xb9vFweKQgoFfwU+ue1kFJ+AcDDf6J+RQKcqWRAv+cikyhqc4Ax71WPT73Pbg746Lpd/0uO7iVIrwIuNlJkBIyrhJddJBkBbdt62UIDp7Qf5xExL5PvLAXYwM+rxDM7AbbwLIeAL3gSAnzCoxfgGx61gBDwaAWEgkcpICQ8OgGh4VEJiAGPRkAseBQCPMF3JAQo+LV7e3vh9esGKd9M3xeppT2Kk6GYY/5PBiwb47sBmOCDZwA2eCsBVVW9Tg0fX63TsadNfLHgrQQIgBebHtza8+pQIyb81iFQc0n7YHMAdnivAijAexNABd6LAErwzgVQg3cqgCK8MwFU4Z0IoAx/WAB1+EMCOMBvEqAfOXOB3yRAHTlzgne6DOrwy3IW9gKWPa+Xs7AXQDHt9ThcJ7h2p8eiglPMdYF85oCpfvf+ble+OpDMAFNx8o7f7tELGHv2WhbF2SQGisJYv7soh+9JZICp3p565EdmsoDEQ8R+dpfSwUgeAlkAw/gGgdL3j4c6UpkAAAAASUVORK5CYII="/>\n        </div>\n      </div>\n    </div>\n  </div>\n';const e=this._shadowRoot.getElementById("paginator-input");e.addEventListener("input",this.onPaginatorInput),e.addEventListener("change",this.onPaginatorChange),this._shadowRoot.querySelector("#paginator-prev").addEventListener("click",this.onPaginatorPrevClick),this._shadowRoot.querySelector("#paginator-next").addEventListener("click",this.onPaginatorNextClick),this._shadowRoot.querySelector("#zoom-out").addEventListener("click",this.onZoomOutClick),this._shadowRoot.querySelector("#zoom-in").addEventListener("click",this.onZoomInClick),this._shadowRoot.querySelector("#zoom-fit-viewer").addEventListener("click",this.onZoomFitViewerClick),this._shadowRoot.querySelector("#zoom-fit-page").addEventListener("click",this.onZoomFitPageClick),this._shadowRoot.querySelector("div#toggle-previewer").addEventListener("click",this.onPreviewerToggleClick),this._shadowRoot.querySelector("div#toggle-hand").addEventListener("click",this.onHandToggleClick),this._previewer=this._shadowRoot.querySelector("div#previewer"),this._previewer.addEventListener("scroll",this.onPreviewerScroll),this._viewer=this._shadowRoot.querySelector("div#viewer"),this._viewer.addEventListener("scroll",this.onViewerScroll),this._viewer.addEventListener("wheel",this.onViewerWheel),this._viewer.addEventListener("pointermove",this.onViewerPointerMove),this._viewer.addEventListener("pointerdown",this.onViewerPointerDown),this._viewer.addEventListener("touchstart",this.onViewerTouchStart),this._mainContainer=this._shadowRoot.querySelector("div#main-container");const t=new ResizeObserver(this.onMainContainerResize);t.observe(this._mainContainer),this._mainContainerResizeObserver=t}refreshPagesAsync(){var e;return Wr(this,void 0,void 0,(function*(){this._pages.forEach((e=>{e.previewContainer.removeEventListener("click",this.onPreviewerPageClick),e.destroy()})),this._pages.length=0;const t=(null===(e=this._pdfDocument)||void 0===e?void 0:e.numPages)||0;if(this._shadowRoot.getElementById("paginator-total").innerHTML=t+"",t)for(let e=0;e<t;e++){const t=yield this._pdfDocument.getPage(e+1),r=new p(t,this._maxScale,this._previewWidth);r.scale=this._scale,r.previewContainer.addEventListener("click",this.onPreviewerPageClick),this._previewer.append(r.previewContainer),this._viewer.append(r.viewContainer),this._pages.push(r)}}))}renderVisiblePreviews(){if(this._previewerHidden)return;const e=this._pages,t=this.getVisiblePages(this._previewer,e,!0),r=Math.max(Math.min(...t)-this._visibleAdjPages,0),n=Math.min(Math.max(...t)+this._visibleAdjPages,e.length-1);for(let t=0;t<e.length;t++){const s=e[t];t>=r&&t<=n&&s.renderPreviewAsync()}}renderVisiblePages(){var e,t;const r=this._pages,n=this.getVisiblePages(this._viewer,r),s=this._currentPage,i=this.getCurrentPage(this._viewer,r,n);if(s&&s===i||(null===(e=r[s])||void 0===e||e.previewContainer.classList.remove("current"),null===(t=r[i])||void 0===t||t.previewContainer.classList.add("current"),this._shadowRoot.getElementById("paginator-input").value=i+1+"",this.scrollToPreview(i),this._currentPage=i),-1===i)return;const a=Math.max(Math.min(...n)-this._visibleAdjPages,0),o=Math.min(Math.max(...n)+this._visibleAdjPages,r.length-1);for(let e=0;e<r.length;e++){const t=r[e];e>=a&&e<=o?t.renderViewAsync():t.clearView()}}scrollToPreview(e){const{top:t,height:r}=this._previewer.getBoundingClientRect(),{top:n,height:s}=this._pages[e].previewContainer.getBoundingClientRect(),i=n+s/2-(t+r/2)+this._previewer.scrollTop;this._previewer.scrollTo(0,i)}scrollToPage(e){const{top:t}=this._viewer.getBoundingClientRect(),{top:r}=this._pages[e].viewContainer.getBoundingClientRect(),n=r-(t-this._viewer.scrollTop);this._viewer.scrollTo(this._viewer.scrollLeft,n)}setScale(e,t=null){if(!e||e===this._scale)return;let r,n,s;if(t)for(const e of this._pages){const{x:i,y:a}=t,{x:o,y:h,width:c,height:d}=e.viewContainer.getBoundingClientRect();if(o<=i&&o+c>=i&&h<=a&&h+d>=a){r=e.viewContainer,n=(i-o)/c,s=(a-h)/d;break}}if(this._scale=e,this._pages.forEach((e=>e.scale=this._scale)),r&&(this._viewer.scrollHeight>this._viewer.clientHeight||this._viewer.scrollWidth>this._viewer.clientWidth)){const{x:e,y:i}=t,{x:a,y:o,width:h,height:c}=r.getBoundingClientRect(),d=a+h*n,u=o+c*s;let l=this._viewer.scrollLeft+(d-e),p=this._viewer.scrollTop+(u-i);if(l=l<0?0:l,p=p<0?0:p,p!==this._viewer.scrollTop||l!==this._viewer.scrollLeft)return void this._viewer.scrollTo(l,p)}setTimeout((()=>this.renderVisiblePages()),0)}zoom(e,t=null){const r=a(this._scale+e,this._minScale,this._maxScale);this.setScale(r,t||this.getViewerCenterPosition())}zoomOut(e=null){this.zoom(-.25,e)}zoomIn(e=null){this.zoom(.25,e)}getViewerCenterPosition(){const{x:e,y:t,width:r,height:n}=this._viewer.getBoundingClientRect();return{x:e+r/2,y:t+n/2}}getVisiblePages(e,t,r=!1){const n=new Set;if(!t.length)return n;const s=e.getBoundingClientRect(),i=s.top,a=s.top+s.height;for(let e=0;e<t.length;e++){const s=t[e],o=r?s.previewContainer.getBoundingClientRect():s.viewContainer.getBoundingClientRect(),h=o.top,c=o.top+o.height;if(h<a&&c>i)n.add(e);else if(n.size)break}return n}getCurrentPage(e,t,r){const n=[...r];if(!n.length)return-1;if(1===n.length)return n[0];const s=e.getBoundingClientRect(),i=s.top,a=s.top+s.height/2;for(const e of n){const r=t[e].viewContainer.getBoundingClientRect().top;if(r>i)return r>a?e-1:e}throw new Error("Incorrect argument")}}export{Qr as TsPdfViewer};
