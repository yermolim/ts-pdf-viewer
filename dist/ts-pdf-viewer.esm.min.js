/**
 * Copyright 2021 yermolim
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * 
 * FlateStream class is based on the corresponding one from PDF.js,
 * so the code of that class is also subject to the next license notice:
 * 
 * Copyright 2012 Mozilla Foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Copyright 1996-2003 Glyph & Cog, LLC
 * 
 * The flate stream implementation contained in this file is a JavaScript port
 * of XPDF's implementation, made available under the Apache 2.0 open source
 * license.
 */

import{renderTextLayer as t,RenderingCancelledException as e,GlobalWorkerOptions as r,getDocument as s}from"pdfjs-dist";import{v4 as n}from"uuid";import a from"crypto-es";import i from"pako";function o(){return n()}function h(t,e,r,s){return Math.hypot(r-t,s-e)}class c{constructor(t){this.data=t}}class d{constructor(t){this._length=0,t&&this.push(t)}get head(){return this._head.data}get length(){return this._length}get tail(){return this.get(this._length-1)}push(t){const e=new c(t);let r;if(this._head){for(r=this._head;r.next;)r=r.next;r.next=e}else this._head=e;this._length++}insert(t,e){if(e<0||e>this._length-1)return null;const r=new c(t);let s,n=this._head,a=0;if(e){for(;a++<e;)s=n,n=n.next;s.next=r}else this._head=r;return r.next=n,this._length++,r.data}replace(t,e){if(e<0||e>this._length-1)return null;const r=new c(t);let s,n=this._head,a=0;if(e){for(;a++<e;)s=n,n=n.next;s.next=r}else this._head=r;return r.next=n.next,n.data}remove(t){if(t<0||t>this._length-1)return null;let e,r=this._head,s=0;if(t){for(;s++<t;)e=r,r=r.next;e.next=r.next}else this._head=r.next;return this._length--,r.data}clear(){this._head=null,this._length=0}get(t){if(t<0||t>this._length-1)return null;let e=this._head,r=0;for(;r++<t;)e=e.next;return e.data}pop(){return this.remove(this._length-1)}has(t,e){if(!this._length)return!1;e||(e=(t,e)=>t===e);let r=this._head,s=0;for(;s<this._length;){if(e(t,r.data))return!0;r=r.next,s++}return!1}findIndex(t,e){if(!this._length)return-1;e||(e=(t,e)=>t===e);let r=this._head,s=0;for(;s<this._length;){if(e(t,r.data))return s;r=r.next,s++}return-1}*[Symbol.iterator](){let t=this._head;for(;t;)yield t.data,t=t.next}}function u(t,e,r){return Math.max(e,Math.min(t,r))}class l{constructor(t=0,e=0){this.length=2,this.x=t,this.y=e}static multiplyByScalar(t,e){return new l(t.x*e,t.y*e)}static addScalar(t,e){return new l(t.x+e,t.y+e)}static normalize(t){return(new l).setFromVec2(t).normalize()}static add(t,e){return new l(t.x+e.x,t.y+e.y)}static substract(t,e){return new l(t.x-e.x,t.y-e.y)}static dotProduct(t,e){return t.x*e.x+t.y*e.y}static applyMat3(t,e){return t.clone().applyMat3(e)}static lerp(t,e,r){return t.clone().lerp(e,r)}static rotate(t,e,r){return t.clone().rotate(e,r)}static equals(t,e,r=6){return t.equals(e)}static getDistance(t,e){const r=e.x-t.x,s=e.y-t.y;return Math.sqrt(r*r+s*s)}clone(){return new l(this.x,this.y)}set(t,e){return this.x=t,this.y=e,this}setFromVec2(t){return this.x=t.x,this.y=t.y,this}multiplyByScalar(t){return this.x*=t,this.y*=t,this}addScalar(t){return this.x+=t,this.y+=t,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t),this}add(t){return this.x+=t.x,this.y+=t.y,this}substract(t){return this.x-=t.x,this.y-=t.y,this}dotProduct(t){return l.dotProduct(this,t)}applyMat3(t){if(9!==t.length)throw new Error("Matrix must contain 9 elements");const{x:e,y:r}=this,[s,n,,a,i,,o,h]=t;return this.x=e*s+r*a+o,this.y=e*n+r*i+h,this}lerp(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this}rotate(t,e){const r=Math.sin(e),s=Math.cos(e),n=this.x-t.x,a=this.y-t.y;return this.x=n*s-a*r+t.x,this.y=n*r+a*s+t.y,this}equals(t,e=6){return+this.x.toFixed(e)==+t.x.toFixed(e)&&+this.y.toFixed(e)==+t.y.toFixed(e)}toArray(){return[this.x,this.y]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y}}class p{constructor(t=0,e=0,r=0){this.length=3,this.x=t,this.y=e,this.z=r}static multiplyByScalar(t,e){return new p(t.x*e,t.y*e,t.z*e)}static addScalar(t,e){return new p(t.x+e,t.y+e,t.z+e)}static normalize(t){return(new p).setFromVec3(t).normalize()}static add(t,e){return new p(t.x+e.x,t.y+e.y,t.z+e.z)}static substract(t,e){return new p(t.x-e.x,t.y-e.y,t.z-e.z)}static dotProduct(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static crossProduct(t,e){return new p(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}static onVector(t,e){return t.clone().onVector(e)}static onPlane(t,e){return t.clone().onPlane(e)}static applyMat3(t,e){return t.clone().applyMat3(e)}static lerp(t,e,r){return t.clone().lerp(e,r)}static equals(t,e,r=6){return!!t&&t.equals(e,r)}static getDistance(t,e){const r=e.x-t.x,s=e.y-t.y,n=e.z-t.z;return Math.sqrt(r*r+s*s+n*n)}static getAngle(t,e){return t.getAngle(e)}clone(){return new p(this.x,this.y,this.z)}set(t,e,r){return this.x=t,this.y=e,this.z=r,this}setFromVec3(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}multiplyByScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getAngle(t){const e=this.getMagnitude()*t.getMagnitude();if(!e)return Math.PI/2;const r=this.dotProduct(t)/e;return Math.acos(u(r,-1,1))}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t,this.z/=t),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}substract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}dotProduct(t){return p.dotProduct(this,t)}crossProduct(t){return this.x=this.y*t.z-this.z*t.y,this.y=this.z*t.x-this.x*t.z,this.z=this.x*t.y-this.y*t.x,this}onVector(t){const e=this.getMagnitude();return e?t.clone().multiplyByScalar(t.clone().dotProduct(this)/(e*e)):this.set(0,0,0)}onPlane(t){return this.substract(this.clone().onVector(t))}applyMat3(t){if(9!==t.length)throw new Error("Matrix must contain 9 elements");const{x:e,y:r,z:s}=this,[n,a,i,o,h,c,d,u,l]=t;return this.x=e*n+r*o+s*d,this.y=e*a+r*h+s*u,this.z=e*i+r*c+s*l,this}lerp(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this}equals(t,e=6){return!!t&&(+this.x.toFixed(e)==+t.x.toFixed(e)&&+this.y.toFixed(e)==+t.y.toFixed(e)&&+this.z.toFixed(e)==+t.z.toFixed(e))}toArray(){return[this.x,this.y,this.z]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}class f{constructor(){this.length=9,this._matrix=new Array(this.length),this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=1,this._matrix[5]=0,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=1}get x_x(){return this._matrix[0]}get x_y(){return this._matrix[1]}get x_z(){return this._matrix[2]}get y_x(){return this._matrix[3]}get y_y(){return this._matrix[4]}get y_z(){return this._matrix[5]}get z_x(){return this._matrix[6]}get z_y(){return this._matrix[7]}get z_z(){return this._matrix[8]}static fromMat3(t){return(new f).setFromMat3(t)}static multiply(t,e){const[r,s,n,a,i,o,h,c,d]=t._matrix,[u,l,p,y,g,A,w,m,v]=e._matrix,b=new f;return b.set(r*u+s*y+n*w,r*l+s*g+n*m,r*p+s*A+n*v,a*u+i*y+o*w,a*l+i*g+o*m,a*p+i*A+o*v,h*u+c*y+d*w,h*l+c*g+d*m,h*p+c*A+d*v),b}static multiplyScalar(t,e){const r=new f;for(let s=0;s<this.length;s++)r._matrix[s]=t._matrix[s]*e;return r}static transpose(t){const e=new f;return e.set(t.x_x,t.y_x,t.z_x,t.x_y,t.y_y,t.z_y,t.x_z,t.y_z,t.z_z),e}static invert(t){const e=new f;e.set(t.y_y*t.z_z-t.z_y*t.y_z,t.y_x*t.z_z-t.z_x*t.y_z,t.y_x*t.z_y-t.z_x*t.y_y,t.x_y*t.z_z-t.z_y*t.x_z,t.x_x*t.z_z-t.z_x*t.x_z,t.x_x*t.z_y-t.z_x*t.x_y,t.x_y*t.y_z-t.y_y*t.x_z,t.x_x*t.y_z-t.y_x*t.x_z,t.x_x*t.y_y-t.y_x*t.x_y),e.set(e.x_x,-e.x_y,e.x_z,-e.y_x,e.y_y,-e.y_z,e.z_x,-e.z_y,e.z_z);const r=t.x_x*e.x_x+t.x_y*e.x_y+t.x_z*e.x_z,s=new f;if(r){const t=.1;s.set(t*e.x_x,t*e.y_x,t*e.z_x,t*e.x_y,t*e.y_y,t*e.z_y,t*e.x_z,t*e.y_z,t*e.z_z)}else s.set(0,0,0,0,0,0,0,0,0);return s}static buildScale(t,e){return null!=e||(e=t),(new f).set(t,0,0,0,e,0,0,0,1)}static buildRotation(t){const e=Math.cos(t),r=Math.sin(t);return(new f).set(e,-r,0,r,e,0,0,0,1)}static buildTranslate(t,e){return(new f).set(1,0,0,0,1,0,t,e,1)}static equals(t,e,r=6){return t.equals(e,r)}clone(){return(new f).set(this.x_x,this.x_y,this.x_z,this.y_x,this.y_y,this.y_z,this.z_x,this.z_y,this.z_z)}set(t,e,r,s,n,a,i,o,h){return this._matrix[0]=t,this._matrix[1]=e,this._matrix[2]=r,this._matrix[3]=s,this._matrix[4]=n,this._matrix[5]=a,this._matrix[6]=i,this._matrix[7]=o,this._matrix[8]=h,this}reset(){return this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=1,this._matrix[5]=0,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=1,this}setFromMat3(t){for(let e=0;e<this.length;e++)this._matrix[e]=t._matrix[e];return this}multiply(t){const[e,r,s,n,a,i,o,h,c]=this._matrix,[d,u,l,p,f,y,g,A,w]=t._matrix;return this._matrix[0]=e*d+r*p+s*g,this._matrix[1]=e*u+r*f+s*A,this._matrix[2]=e*l+r*y+s*w,this._matrix[3]=n*d+a*p+i*g,this._matrix[4]=n*u+a*f+i*A,this._matrix[5]=n*l+a*y+i*w,this._matrix[6]=o*d+h*p+c*g,this._matrix[7]=o*u+h*f+c*A,this._matrix[8]=o*l+h*y+c*w,this}multiplyScalar(t){for(let e=0;e<this.length;e++)this._matrix[e]*=t;return this}transpose(){const t=(new f).setFromMat3(this);return this.set(t.x_x,t.y_x,t.z_x,t.x_y,t.y_y,t.z_y,t.x_z,t.y_z,t.z_z),this}invert(){const t=new f;t.set(this.y_y*this.z_z-this.z_y*this.y_z,this.y_x*this.z_z-this.z_x*this.y_z,this.y_x*this.z_y-this.z_x*this.y_y,this.x_y*this.z_z-this.z_y*this.x_z,this.x_x*this.z_z-this.z_x*this.x_z,this.x_x*this.z_y-this.z_x*this.x_y,this.x_y*this.y_z-this.y_y*this.x_z,this.x_x*this.y_z-this.y_x*this.x_z,this.x_x*this.y_y-this.y_x*this.x_y),t.set(t.x_x,-t.x_y,t.x_z,-t.y_x,t.y_y,-t.y_z,t.z_x,-t.z_y,t.z_z);if(this.x_x*t.x_x+this.x_y*t.x_y+this.x_z*t.x_z){const e=.1;this.set(e*t.x_x,e*t.y_x,e*t.z_x,e*t.x_y,e*t.y_y,e*t.z_y,e*t.x_z,e*t.y_z,e*t.z_z)}else this.set(0,0,0,0,0,0,0,0,0);return this}getDeterminant(){const[t,e,r,s,n,a,i,o,h]=this._matrix;return t*n*h-t*a*o+e*a*i-e*s*h+r*s*o-r*n*i}getTRS(){const t=new l(this.z_x,this.z_y),e=Math.sqrt(this.x_x*this.x_x+this.x_y*this.x_y),r=Math.sqrt(this.y_x*this.y_x+this.y_y*this.y_y),s=new l(e,r),n=Math.atan(-this.x_y/this.x_x),a=Math.acos(this.x_x/e);let i;return i=a>Math.PI/2&&n>0||a<Math.PI/2&&n<0?2*Math.PI-a:a,{t:t,r:i,s:s}}equals(t,e=6){for(let r=0;r<this.length;r++)if(+this._matrix[r].toFixed(e)!=+t._matrix[r].toFixed(e))return!1;return!0}applyScaling(t,e){const r=f.buildScale(t,e);return this.multiply(r)}applyTranslation(t,e){const r=f.buildTranslate(t,e);return this.multiply(r)}applyRotation(t){const e=f.buildRotation(t);return this.multiply(e)}toArray(){return this._matrix.slice()}toIntArray(){return new Int32Array(this)}toIntShortArray(){return new Int32Array([this._matrix[0],this._matrix[1],this._matrix[3],this._matrix[4],this._matrix[6],this._matrix[7]])}toFloatArray(){return new Float32Array(this)}toFloatShortArray(){return new Float32Array([this._matrix[0],this._matrix[1],this._matrix[3],this._matrix[4],this._matrix[6],this._matrix[7]])}*[Symbol.iterator](){for(let t=0;t<9;t++)yield this._matrix[t]}}function y(t,e,r,s,n=!1){const a=new f;a.applyTranslation(-t.x,-t.y);const i=l.substract(e,t).getMagnitude(),o=l.substract(s,r).getMagnitude()/i;if(a.applyScaling(o),!n){const n=Math.atan2(e.y-t.y,e.x-t.x),i=Math.atan2(s.y-r.y,s.x-r.x)-n;a.applyRotation(i)}return a.applyTranslation(r.x,r.y),a}function g(...t){return{min:new l(Math.min(...t.map((t=>t.x))),Math.min(...t.map((t=>t.y)))),max:new l(Math.max(...t.map((t=>t.x))),Math.max(...t.map((t=>t.y))))}}var A=function(t,e,r,s){return new(r||(r=Promise))((function(n,a){function i(t){try{h(s.next(t))}catch(t){a(t)}}function o(t){try{h(s.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,o)}h((s=s.apply(t,e||[])).next())}))};class w{constructor(t,e,r){if(this._svgByAnnotation=new Map,!t||isNaN(e)||!r)throw new Error("Required argument not found");this._pageId=e,this._pageDimensions=r,this._container=document.createElement("div"),this._container.classList.add("page-annotations"),this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.classList.add("stretch"),this._svg.setAttribute("data-page-id",e+""),this._svg.setAttribute("viewBox",`0 0 ${r.x} ${r.y}`),this._svg.setAttribute("transform","scale(1, -1)"),this._svg.addEventListener("pointerdown",(t=>{t.target===this._svg&&this.switchSelectedAnnotation(null)})),this._defs=document.createElementNS("http://www.w3.org/2000/svg","defs"),this._container.append(this._svg),this._annotations=t.getPageAnnotations(e)}destroy(){this.remove(),this._container=null}remove(){var t;null===(t=this._container)||void 0===t||t.remove()}appendAsync(t){return A(this,void 0,void 0,(function*(){this._rendered||(yield this.renderAnnotationsAsync(),this._rendered=!0),t.append(this._container)}))}switchSelectedAnnotation(t){if(t===this._selectedAnnotation)return;if(this._selectedAnnotation){const t=this._svgByAnnotation.get(this._selectedAnnotation);null==t||t.classList.remove("selected")}const e=this._svgByAnnotation.get(t);e&&(e.classList.add("selected"),this._svg.append(e),this._selectedAnnotation=t)}renderAnnotation(t){const e=t.render();if(!e)return;const{svg:r,clipPaths:s}=e;this._svgByAnnotation.set(t,r),r.addEventListener("pointerdown",(()=>this.switchSelectedAnnotation(t))),this._svg.append(r),null==s||s.forEach((t=>this._defs.append(t)))}renderAnnotationsAsync(){var t;return A(this,void 0,void 0,(function*(){this.clear();const e=[];for(let r=0;r<(null===(t=this._annotations)||void 0===t?void 0:t.length);r++)e.push(new Promise((t=>{setTimeout((()=>{this.renderAnnotation(this._annotations[r]),t()}),0)})));return yield Promise.all(e),this._svg.append(this._defs),!0}))}clear(){this._svg.innerHTML="",this._svgByAnnotation.clear()}}var m=function(t,e,r,s){return new(r||(r=Promise))((function(n,a){function i(t){try{h(s.next(t))}catch(t){a(t)}}function o(t){try{h(s.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,o)}h((s=s.apply(t,e||[])).next())}))};class v{constructor(t){if(this.onMouseDown=t=>{var e;this._divModeTimer&&(clearTimeout(this._divModeTimer),this._divModeTimer=null),null===(e=this._renderTask)||void 0===e||e.expandTextDivs(!0)},this.onMouseUp=t=>{this._divModeTimer=setTimeout((()=>{var t;null===(t=this._renderTask)||void 0===t||t.expandTextDivs(!1),this._divModeTimer=null}),300)},!t)throw new Error("Page proxy is not defined");this._pageProxy=t,this._container=document.createElement("div"),this._container.classList.add("page-text"),this._container.addEventListener("mousedown",this.onMouseDown),this._container.addEventListener("mouseup",this.onMouseUp)}static appendPageTextAsync(t,e,r){return m(this,void 0,void 0,(function*(){const s=new v(t);return yield s.renderTextLayerAsync(r),e.append(s._container),s}))}destroy(){this.destroyRenderTask(),this._container&&(this._container.remove(),this._container=null)}renderTextLayerAsync(e){return m(this,void 0,void 0,(function*(){this.clear(),this.destroyRenderTask();const r=this._pageProxy.getViewport({scale:e}),s=this._pageProxy.streamTextContent();this._renderTask=t({container:this._container,textContentStream:s,viewport:r,enhanceTextSelection:!0});try{yield this._renderTask.promise}catch(t){if("TextLayer task cancelled."===t.message)return!1;throw t}return!0}))}clear(){this._container.innerHTML=""}destroyRenderTask(){this._renderTask&&(this._renderTask.cancel(),this._renderTask=null)}}var b=function(t,e,r,s){return new(r||(r=Promise))((function(n,a){function i(t){try{h(s.next(t))}catch(t){a(t)}}function o(t){try{h(s.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,o)}h((s=s.apply(t,e||[])).next())}))};class x{constructor(t,e,r,s){if(!t)throw new Error("Page proxy is not defined");if(!e)throw new Error("Annotation data is not defined");this._pageProxy=t,this._viewport=t.getViewport({scale:1}),this._maxScale=Math.max(r,1),this._annotationData=e,this.number=t.pageNumber,this.id=t.ref.num,this.generation=t.ref.gen;const{width:n,height:a}=this._viewport,i=(s=Math.max(null!=s?s:0,50))*(a/n);this._dimensions={width:n,height:a,previewWidth:s,previewHeight:i},this._previewContainer=document.createElement("div"),this._previewContainer.classList.add("page-preview"),this._previewContainer.setAttribute("data-page-number",this.number+""),this._previewContainer.setAttribute("data-page-id",this.id+""),this._previewContainer.setAttribute("data-page-gen",this.generation+""),this._previewContainer.style.width=this._dimensions.previewWidth+"px",this._previewContainer.style.height=this._dimensions.previewHeight+"px",this._viewContainer=document.createElement("div"),this._viewContainer.classList.add("page"),this._viewContainer.setAttribute("data-page-number",this.number+""),this._viewContainer.setAttribute("data-page-id",this.id+""),this._viewContainer.setAttribute("data-page-gen",this.generation+""),this.scale=1}get previewContainer(){return this._previewContainer}get viewContainer(){return this._viewContainer}set _viewRendered(t){this.$viewRendered=t,this._viewContainer.setAttribute("data-loaded",t+"")}get _viewRendered(){return this.$viewRendered}set scale(t){if(t<=0||this._scale===t)return;this._scale=t;const e=window.devicePixelRatio;this._dimensions.scaledWidth=this._dimensions.width*this._scale,this._dimensions.scaledHeight=this._dimensions.height*this._scale,this._dimensions.scaledDprWidth=this._dimensions.scaledWidth*e,this._dimensions.scaledDprHeight=this._dimensions.scaledHeight*e,this._viewContainer.style.width=this._dimensions.scaledWidth+"px",this._viewContainer.style.height=this._dimensions.scaledHeight+"px",this._viewCanvas&&(this._viewCanvas.style.width=this._dimensions.scaledWidth+"px",this._viewCanvas.style.height=this._dimensions.scaledHeight+"px"),this._scaleIsValid=!1}get viewValid(){return this._scaleIsValid&&this._viewRendered}destroy(){this._previewContainer.remove(),this._viewContainer.remove(),this._pageProxy.cleanup()}renderPreviewAsync(t=!1){return b(this,void 0,void 0,(function*(){if(this._renderPromise&&(t&&this.cancelRenderTask(),yield this._renderPromise),t||!this._previewRendered)return this._renderPromise=this.runPreviewRenderAsync(),this._renderPromise}))}renderViewAsync(t=!1){return b(this,void 0,void 0,(function*(){if(this._renderPromise&&(t&&this.cancelRenderTask(),yield this._renderPromise),t||!this.viewValid)return this._renderPromise=this.runViewRenderAsync(),this._renderPromise}))}clearPreview(){this._previewContainer.innerHTML=""}clearView(){var t,e,r;null===(t=this._annotations)||void 0===t||t.destroy(),this._annotations=null,null===(e=this._text)||void 0===e||e.destroy(),this._text=null,null===(r=this._viewCanvas)||void 0===r||r.remove(),this._viewRendered=!1}cancelRenderTask(){this._renderTask&&(this._renderTask.cancel(),this._renderTask=null)}runRenderTaskAsync(t){return b(this,void 0,void 0,(function*(){this.cancelRenderTask(),this._renderTask=this._pageProxy.render(t);try{yield this._renderTask.promise}catch(t){if(t instanceof e)return!1;throw t}finally{this._renderTask=null}return!0}))}createPreviewCanvas(){const t=document.createElement("canvas");t.classList.add("page-canvas");const e=window.devicePixelRatio,{previewWidth:r,previewHeight:s}=this._dimensions;return t.style.width=r+"px",t.style.height=s+"px",t.width=r*e,t.height=s*e,t}createViewCanvas(){const t=document.createElement("canvas");return t.classList.add("page-canvas"),t.style.width=this._dimensions.scaledWidth+"px",t.style.height=this._dimensions.scaledHeight+"px",t.width=this._dimensions.scaledDprWidth,t.height=this._dimensions.scaledDprHeight,t}scaleCanvasImage(t,e){let r,s=this._scale/this._maxScale,n=t;for(;s<.5;)r=document.createElement("canvas"),r.width=.5*n.width,r.height=.5*n.height,r.getContext("2d").drawImage(n,0,0,r.width,r.height),n=r,s*=2;e.getContext("2d").drawImage(n,0,0,e.width,e.height)}runPreviewRenderAsync(){return b(this,void 0,void 0,(function*(){const t=this.createPreviewCanvas(),e={canvasContext:t.getContext("2d"),viewport:this._viewport.clone({scale:t.width/this._dimensions.width})};(yield this.runRenderTaskAsync(e))?(this._previewContainer.innerHTML="",this._previewContainer.append(t),this._previewRendered=!0):this._previewRendered=!1}))}runViewRenderAsync(){var t,e;return b(this,void 0,void 0,(function*(){const r=this._scale;null===(t=this._text)||void 0===t||t.destroy(),this._text=null;const s=this.createViewCanvas(),n={canvasContext:s.getContext("2d"),viewport:this._viewport.clone({scale:r*window.devicePixelRatio}),enableWebGL:!0};if((yield this.runRenderTaskAsync(n))&&r===this._scale){if(null===(e=this._viewCanvas)||void 0===e||e.remove(),this._viewContainer.append(s),this._viewCanvas=s,this._viewRendered=!0,this._text=yield v.appendPageTextAsync(this._pageProxy,this._viewContainer,r),!this._annotations){const{width:t,height:e}=this._dimensions;this._annotations=new w(this._annotationData,this.id,new l(t,e))}yield this._annotations.appendAsync(this.viewContainer),r===this._scale&&(this._scaleIsValid=!0)}}))}}const E=0,P=8,_=9,C=10,S=12,k=13,N=32,I=37,B=40,M=41,R=45,D=46,T=47,L=48,O=49,U=50,F=51,V=52,z=53,H=54,W=55,G=56,Q=57,j=60,K=62,X=69,q=70,Y=80,J=82,Z=83,$=84,tt=88,et=91,rt=92,st=93,nt=97,at=98,it=100,ot=101,ht=102,ct=106,dt=108,ut=109,lt=110,pt=111,ft=112,yt=114,gt=115,At=116,wt=117,mt=120,vt=121,bt={NULL:[lt,wt,dt,dt],OBJ:[pt,at,ct],OBJ_END:[ot,lt,it,pt,at,ct],STREAM_START:[gt,At,yt,ot,nt,ut],STREAM_END:[ot,lt,it,gt,At,yt,ot,nt,ut],DICT_START:[j,j],DICT_END:[K,K],ARRAY_START:[et],ARRAY_END:[st],STR_LITERAL_START:[B],STR_LITERAL_END:[M],STR_HEX_START:[j],STR_HEX_END:[K],VERSION:[I,Y,68,q,R],PREV:[T,Y,yt,ot,118],TYPE:[T,$,vt,ft,ot],SUBTYPE:[T,Z,wt,at,At,vt,ft,ot],XREF_TABLE:[mt,yt,ot,ht],XREF_STREAM:[T,tt,J,ot,ht],XREF_HYBRID:[tt,J,ot,ht,Z,At,ut],XREF_START:[gt,At,nt,yt,At,mt,yt,ot,ht],TRAILER:[At,yt,nt,105,dt,ot,yt],END_OF_FILE:[I,I,X,79,q],END_OF_LINE:[k,C],TRUE:[At,yt,wt,ot],FALSE:[ht,nt,dt,gt,ot]},xt=new Set([I,B,M,T,j,K,et,st,123,125]),Et=new Set([E,_,C,S,k,N]),Pt=new Set([L,O,U,F,V,z,H,W,G,Q]);function _t(t){return!xt.has(t)&&!Et.has(t)}function Ct(t){if(!(null==t?void 0:t.length))return 0;if(1===t.length)return t[0];const e=Array.from(t,(t=>("0"+(255&t).toString(16)).slice(-2))).join("");return parseInt(e,16)}function St(t){const e=new ArrayBuffer(1);return new DataView(e).setInt8(0,t),new Uint8Array(e)}function kt(t,e=!1){const r=new ArrayBuffer(2);return new DataView(r).setInt16(0,t,e),new Uint8Array(r)}function Nt(t,e=!1){const r=new ArrayBuffer(4);return new DataView(r).setInt32(0,t,e),new Uint8Array(r)}function It(t,e){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t[s]^e;return r}function Bt(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Mt(t){const e=new Uint8Array(t.length/2);for(let r=0,s=0;r<t.length;r+=2,s++)e[s]=parseInt(t.substr(r,2),16);return e}const Rt=3,Dt=4,Tt=5,Lt=7,Ot=8,Ut=0,Ft=1,Vt=0,zt=1,Ht=2,Wt="/DCTDecode",Gt="/FlateDecode",Qt="/JBIG2Decode",jt="/JPXDecode",Kt=1,Xt=2,qt=10,Yt=11,Jt=12,Zt=13,$t=14,te=15,ee={RC4_40:1,RC4_128:2,AES_128:4,AES_256:5},re={RC4_40:2,RC4_128:3,AES_128:4,AES_256:5,AES_256_V2:6},se={NONE:"/None",RC4:"/V2",AES_128:"/AESV2",AES_256:"/AESV3"},ne={DOC_OPEN:"/DocOpen",EMBEDDED_OPEN:"/EFOpen"},ae={LEFT:0,CENTER:1,RIGHT:2},ie="/XRef",oe="/ObjStm",he="/XObject",ce="/XRef",de="/Catalog",ue="/Pages",le="/Page",pe="/Annot",fe="/Border",ye="/Measure",ge="/ExtGState",Ae="/CryptFilter",we="/Mask",me="/Group",ve="/Font",be="",xe={TRANSPARENCY:"/Transparency"},Ee=0,Pe=2,_e=3,Ce=4,Se=5,ke=6,Ne=7,Ie=8,Be=9,Me=10,Re=11,De="/Text",Te="/FreeText",Le="/Line",Oe="/Square",Ue="/Circle",Fe="/Polygon",Ve="/PolyLine",ze="/Stamp",He="/Ink",We={MARKED:"/Marked",REVIEW:"/Review"},Ge={MARKED:"/Marked",UNMARKED:"/Unmarked"},Qe={ACCEPTED:"/Accepted",REJECTED:"/Rejected",CANCELLED:"/Cancelled",COMPLETED:"/Completed",NONE:"/None"},je={COMMENT:"/Comment",KEY:"/Key",NOTE:"/Note",HELP:"/Help",NEW_PARAGRAPH:"/NewParagraph",PARAGRAPH:"/Paragraph",INSERT:"/Insert"},Ke={SQUARE:"/Square",CIRCLE:"/Circle",DIAMOND:"/Diamond",ARROW_OPEN:"/OpenArrow",ARROW_CLOSED:"/ClosedArrow",NONE:"/None",BUTT:"/Butt",ARROW_OPEN_R:"/ROpenArrow",ARROW_CLOSED_R:"/RClosedArrow",SLASH:"/Slash"},Xe={BUTT:0,ROUND:1,SQUARE:2},qe={MITER:0,ROUND:1,BEVEL:2},Ye={ABSOLUTE:"/AbsoluteColorimetric",RELATIVE:"/RelativeColorimetric",SATURATION:"/Saturation",PERCEPTUAL:"/Perceptual"},Je={NORMAL:"/Normal",COMPATIBLE:"/Compatible",MULTIPLY:"/Multiply",SCREEN:"/Screen",OVERLAY:"/Overlay",DARKEN:"/Darken",LIGHTEN:"/Lighten",COLOR_DODGE:"/ColorDodge",COLOR_BURN:"/ColorBurn",HARD_LIGHT:"/HardLight",SOFT_LIGHT:"/SoftLight",DIFFERENCE:"/Difference",EXCLUSION:"/Exclusion"},Ze="/DeviceGray",$e="/DeviceRGB",tr="/DeviceCMYK",er="/Indexed",rr={ALPHA:"/Alpha",LUMINOSITY:"/Luminosity"},sr=new Set([Gt,Wt,Qt,jt]);function nr(t){return a.lib.WordArray.create(t)}function ar(t){return function(t,e=!1){const r=new ArrayBuffer(4*t.length),s=new DataView(r);for(let r=0;r<t.length;r++)s.setInt32(4*r,t[r],e);return new Uint8Array(r)}(t.words).slice(0,t.sigBytes)}function ir(t){t instanceof Uint8Array&&(t=nr(t));return a.MD5(t)}function or(t,e){t instanceof Uint8Array&&(t=nr(t)),e instanceof Uint8Array&&(e=nr(e));return a.RC4.encrypt(t,e).ciphertext}function hr(t,e,r=!1){if(t instanceof Uint8Array&&(t=nr(t)),e instanceof Uint8Array&&(e=nr(e)),r){const r=a.lib.WordArray.create(t.words.slice(0,4));return a.algo.AES.createDecryptor(e,{mode:a.mode.CBC,iv:r,padding:a.pad.Pkcs7}).finalize(t)}{const r=a.lib.WordArray.random(16);return a.algo.AES.createEncryptor(e,{mode:a.mode.CBC,iv:r,padding:a.pad.Pkcs7}).finalize(t)}}const cr=[115,65,108,84];class dr{constructor(t){if(!t)throw new Error("Empty key");if(16!==t.length)throw new Error(`Invalid key length: ${t.length} (shall be 16)`);this._n=t.length,this._key=t,this._tempKey=new Uint8Array(t.length+9)}encrypt(t,e){return this.run(t,e.id,e.generation)}decrypt(t,e){return this.run(t,e.id,e.generation,!0)}run(t,e,r,s=!1){const n=Nt(e,!0),a=Nt(r,!0);this._tempKey.set(this._key,0),this._tempKey.set(n.subarray(0,3),this._n),this._tempKey.set(a.subarray(0,2),this._n+3),this._tempKey.set(cr,this._n+5);const i=ar(ir(this._tempKey)),o=Math.min(this._n+5,16),h=ar(hr(t,i.slice(0,o),s));return s?h.slice(16):h}}class ur{constructor(t){if(!t)throw new Error("Empty key");if(32!==t.length)throw new Error(`Invalid key length: ${t.length} (shall be 16)`);this._n=t.length,this._key=t}encrypt(t,e){return this.run(t,e.id,e.generation)}decrypt(t,e){return this.run(t,e.id,e.generation,!0)}run(t,e,r,s=!1){const n=ar(hr(t,this._key,s));return s?n.slice(16):n}}class lr{constructor(){}encrypt(t,e){return t}decrypt(t,e){return t}}class pr{constructor(t){if(!t)throw new Error("Empty key");if(t.length<5||t.length>16)throw new Error(`Invalid key length: ${t.length} (shall be a multiple in range from 40 to 128)`);this._n=t.length,this._key=t,this._tempKey=new Uint8Array(t.length+5)}encrypt(t,e){const r=Nt(e.id,!0),s=Nt(e.generation,!0);this._tempKey.set(this._key,0),this._tempKey.set(r.slice(0,3),this._n),this._tempKey.set(s.slice(0,2),this._n+3);const n=ar(ir(this._tempKey)),a=Math.min(this._n+5,16);return ar(or(t,n.slice(0,a)))}decrypt(t,e){return this.encrypt(t,e)}}const fr=[40,191,78,94,78,117,138,65,100,0,78,86,255,250,1,8,46,46,0,182,208,104,62,128,47,12,169,254,100,83,105,122];class yr{constructor(t,e){const{filter:r,version:s,revision:n,permissions:a,encryptMetadata:i,keyLength:o,stringKeyLength:h,streamKeyLength:c,stringMethod:d,streamMethod:u,oPasswordHash:l,uPasswordHash:p,oEncPasswordHash:f,uEncPasswordHash:y,perms:g}=t;if("/Standard"!==r)throw new Error(`Unsupported filter name: ${r}`);if(![1,2,4,5].includes(s))throw new Error(`Unsupported algorithm version: ${s}`);if(![2,3,4,5,6].includes(n))throw new Error(`Unsupported algorithm revision: ${n}`);if(isNaN(a))throw new Error("Permissions not provided");if(!l||!p)throw new Error("Password hash not provided");this._filter=r,this._version=s,this._revision=n,this._permissions=a,this._keyLength=o,this._encryptMetadata=i,this._stringKeyLength=h,this._streamKeyLength=c,this._stringMethod=d,this._streamMethod=u,this._oPasswordHash=l,this._uPasswordHash=p,this._oEncPasswordHash=f,this._uEncPasswordHash=y,this._perms=g,this._fileId=e}authenticate(t){const e=this._version,r=this._stringMethod,s=this._streamMethod;let n=!1;if(this.authOwnerPassword(t))n=!0;else{if(!this.authUserPassword(t))return null}const a=this._lastEncryptionKey;switch(e){case 1:const t=new pr(a);return{owner:n,stringCryptor:t,streamCryptor:t};case 2:const e=new pr(a);return{owner:n,stringCryptor:e,streamCryptor:e};case 4:let i,o;if(r&&r!==se.NONE)if(r===se.RC4)i=new pr(a);else{if(r!==se.AES_128)throw new Error(`Invalid crypt method: ${r}`);i=new dr(a)}else i=new lr;if(s&&s!==se.NONE)if(s===se.RC4)o=new pr(a);else{if(s!==se.AES_128)throw new Error(`Invalid crypt method: ${s}`);o=new dr(a)}else o=new lr;return{owner:n,stringCryptor:i,streamCryptor:o};case 5:let h,c;if(r&&r!==se.NONE){if(r!==se.AES_256)throw new Error(`Invalid crypt method: ${r}`);i=new ur(a)}else i=new lr;if(s&&s!==se.NONE){if(s!==se.AES_256)throw new Error(`Invalid crypt method: ${s}`);o=new ur(a)}else o=new lr;return{owner:n,stringCryptor:h,streamCryptor:c}}}padPassword32(t){if(!t)return new Uint8Array(fr);const e=(new TextEncoder).encode(t),r=new Uint8Array(32);return r.set(e.slice(0,32)),e.length<32&&r.set(fr.slice(0,32-e.length),e.length),r}computeEncryptionKey(t){if([2,3,4].includes(this._revision)){const e=this.padPassword32(t),r=Nt(this._permissions,!0),s=this._revision>=4&&!this._encryptMetadata?new Uint8Array([255,255,255,255]):new Uint8Array(0);let n=ar(ir(new Uint8Array([...e,...this._oPasswordHash,...r,...this._fileId,...s])));const a=this._keyLength>>3;if(this._revision>=3)for(let t=0;t<50;t++)n=ar(ir(n.slice(0,a)));const i=n.slice(0,a);return this._lastEncryptionKey=i,i}if(5===this._revision)throw new Error("Not implemented yet");if(6===this._revision)throw new Error("Not implemented yet")}computeOHashEncryptionKey_R2R3R4(t){let e=ir(this.padPassword32(t));if(this._revision>=3)for(let t=0;t<50;t++)e=ir(e);const r=ar(e),s=this._keyLength>>3;return r.slice(0,s)}computeOHash_R2R3R4(t,e){const r=this.computeOHashEncryptionKey_R2R3R4(t||e);let s=or(this.padPassword32(e),r);if(this._revision>=3)for(let t=1;t<20;t++)s=or(s,It(r,t));return ar(s)}computeUHash_R2(t){const e=this.computeEncryptionKey(t);return ar(or(new Uint8Array(fr),e))}computeUHash_R3R4(t){const e=this.computeEncryptionKey(t);let r=ir(new Uint8Array([...fr,...this._fileId]));r=or(r,e);for(let t=1;t<20;t++)r=or(r,It(e,t));return ar(r)}authOwnerPassword(t){if([2,3,4].includes(this._revision)){const e=this.computeOHashEncryptionKey_R2R3R4(t);let r;if(2===this._revision)r=ar(or(this._oPasswordHash,e));else{let t=nr(this._oPasswordHash);for(let r=19;r>=0;r--)t=or(t,It(e,r));r=ar(t)}const s=function(t,e){if((null==t?void 0:t.length)&&(null==e?void 0:e.length)){let r;t:for(let s=0;s<=t.length;s++){let n=!1;for(r=0;r<e.length;r++){if(!(s+r<t.length)){if(n)return s;break t}if(t[s+r]!==e[r])continue t;n=!0}}}return-1}(r,new Uint8Array(fr)),n=(new TextDecoder).decode(-1===s?r:r.subarray(0,s));return this.authUserPassword(n)}if(5===this._revision)throw new Error("Not implemented yet");if(6===this._revision)throw new Error("Not implemented yet")}authUserPassword(t){let e;if(2===this._revision)return e=this.computeUHash_R2(t),Bt(this._uPasswordHash,e);if(3===this._revision||4===this._revision)return e=this.computeUHash_R3R4(t),Bt(this._uPasswordHash.subarray(0,16),e);if(5===this._revision)throw new Error("Not implemented yet");if(6===this._revision)throw new Error("Not implemented yet")}}class gr{constructor(t,e){this.literal=t,this.bytes=e}static parse(t,e,r=null,s=!0){const n=t.getLiteralBounds(e,s);if(!n)return;let a=gr.unescape(t.subCharCodes(n.start+1,n.end-1));(null==r?void 0:r.ref)&&r.stringCryptor&&(a=r.stringCryptor.decrypt(a,r.ref));return{value:gr.fromBytes(a),start:n.start,end:n.end}}static fromBytes(t){const e=(254===t[0]&&255===t[1]?new TextDecoder("utf-16be"):new TextDecoder).decode(t);return new gr(e,t)}static fromString(t){const e=[];e.push(254,255);for(let r=0;r<t.length;r++){const s=t.charCodeAt(r);e.push((65280&s)>>>8),e.push(255&s)}return new gr(t,new Uint8Array(e))}static escape(t){const e=[];for(let r=0;r<t.length;r++)switch(t[r]){case C:e.push(rt),e.push(lt);break;case k:e.push(rt),e.push(yt);break;case _:e.push(rt),e.push(At);break;case P:e.push(rt),e.push(at);break;case S:e.push(rt),e.push(ht);break;case B:e.push(rt),e.push(B);break;case M:e.push(rt),e.push(M);break;case rt:e.push(rt),e.push(rt);break;default:e.push(t[r])}return new Uint8Array(e)}static unescape(t){const e=[];let r=!1;for(let s=0;s<t.length;s++)if(r){switch(t[s]){case lt:e.push(C);break;case yt:e.push(k);break;case At:e.push(_);break;case at:e.push(P);break;case ht:e.push(S);break;case B:e.push(B);break;case M:e.push(M);break;case rt:e.push(rt);break;default:e.push(t[s])}r=!1}else t[s]!==rt?e.push(t[s]):r=!0;return new Uint8Array(e)}toArray(t){const e=(null==t?void 0:t.ref)&&t.stringCryptor?t.stringCryptor.encrypt(this.bytes,t.ref):this.bytes;return new Uint8Array([...bt.STR_LITERAL_START,...gr.escape(e),...bt.STR_LITERAL_END])}}class Ar{constructor(t,e){this.id=null!=t?t:0,this.generation=null!=e?e:0}static parse(t,e,r=!0){if(r&&(e=t.findRegularIndex("straight",e)),e<0||e>t.maxIndex)return null;const s=t.parseNumberAt(e,!1,!1);if(!s||isNaN(s.value))return null;const n=t.parseNumberAt(s.end+2,!1,!1);return!n||isNaN(n.value)?null:{value:new Ar(s.value,n.value),start:e,end:n.end}}static parseRef(t,e,r=!0){const s=Ar.parse(t,e,r);if(!s)return null;const n=s.end+2,a=t.findSubarrayIndex([J],{minIndex:n,closedOnly:!0});return a&&a.start===n?{value:s.value,start:s.start,end:a.end}:null}static parseRefArray(t,e,r=!0){const s=t.getArrayBoundsAt(e,r);if(!s)return null;const n=[];let a,i=s.start+1;for(;i<s.end&&(a=Ar.parseRef(t,i,!0),a);)n.push(a.value),i=a.end+1;return{value:n,start:s.start,end:s.end}}equals(t){return this.id===t.id&&this.generation===t.generation}toArray(t){return(new TextEncoder).encode(`${this.id} ${this.generation} R`)}toString(){return this.id+"|"+this.generation}}class wr{constructor(t,e){this.source=t,this.date=e}static parse(t,e,r=null,s=!0){if(s&&(e=t.skipEmpty(e)),t.isOutside(e)||t.getCharCode(e)!==B)return null;const n=t.findCharIndex(M,"straight",e);if(-1===n)return null;let a=t.subCharCodes(e+1,n-1);(null==r?void 0:r.ref)&&r.stringCryptor&&(a=r.stringCryptor.decrypt(a,r.ref));try{return{value:wr.fromArray(a),start:e,end:n}}catch(t){return null}}static fromDate(t){const e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0");return new wr(`D:${e}${r}${s}${n}${a}${i}`,t)}static fromString(t){const e=/D:(?<Y>\d{4})(?<M>\d{2})(?<D>\d{2})(?<h>\d{2})(?<m>\d{2})(?<s>\d{2})/.exec(t),r=new Date(+e.groups.Y,+e.groups.M-1,+e.groups.D,+e.groups.h,+e.groups.m,+e.groups.s);return new wr(t,r)}static fromArray(t){const e=(new TextDecoder).decode(t);return wr.fromString(e)}toArray(t){let e=(new TextEncoder).encode(this.source);return(null==t?void 0:t.ref)&&t.stringCryptor&&(e=t.stringCryptor.encrypt(e,t.ref)),new Uint8Array([...bt.STR_LITERAL_START,...e,...bt.STR_LITERAL_END])}}class mr{constructor(){}get ref(){return this._ref}set ref(t){this._ref=t}get id(){var t;return null===(t=this._ref)||void 0===t?void 0:t.id}get generation(){var t;return null===(t=this._ref)||void 0===t?void 0:t.generation}parseRefProp(t,e,r){const s=Ar.parseRef(e,r);return this.setParsedProp(t,s)}parseRefArrayProp(t,e,r){const s=Ar.parseRefArray(e,r);return this.setParsedProp(t,s)}parseBoolProp(t,e,r){const s=e.parseBoolAt(r);return this.setParsedProp(t,s)}parseNameProp(t,e,r,s=!0){const n=e.parseNameAt(r,s);return this.setParsedProp(t,n)}parseNameArrayProp(t,e,r,s=!0){const n=e.parseNameArrayAt(r,s);return this.setParsedProp(t,n)}parseNumberProp(t,e,r,s=!0){const n=e.parseNumberAt(r,s);return this.setParsedProp(t,n)}parseNumberArrayProp(t,e,r,s=!0){const n=e.parseNumberArrayAt(r,s);return this.setParsedProp(t,n)}parseDateProp(t,e,r,s){const n=wr.parse(e,r,s);return this.setParsedProp(t,n)}parseLiteralProp(t,e,r,s){const n=gr.parse(e,r,s);return this.setParsedProp(t,n)}setParsedProp(t,e){if(!e)throw new Error(`Can't parse ${t} property value`);return this[t.slice(1)]=e.value,e.end+1}}class vr extends mr{constructor(t){super(),this.Type=t}get streamId(){return this._streamId}toArray(t){const e=new TextEncoder,r=[...bt.DICT_START];return this.Type&&r.push(...bt.TYPE,...e.encode(this.Type)),r.push(...bt.DICT_END),new Uint8Array(r)}tryParseProps(t){var e;if(!t)return!1;this._ref=null===(e=t.cryptInfo)||void 0===e?void 0:e.ref,this._streamId=t.streamId;const{parser:r,bounds:s}=t,n=s.contentStart||s.start,a=s.contentEnd||s.end;let i,o,h=r.skipToNextName(n,a-1);if(-1===h)return!1;for(;o=r.parseNameAt(h),o;)switch(h=o.end+1,i=o.value,i){case"/Type":const t=r.parseNameAt(h);if(t)return!this.Type||this.Type===t.value;throw new Error("Can't parse /Type property value");default:h=r.skipToNextName(h,a-1)}return!0}}class br extends vr{constructor(){super(be),this._intPropMap=new Map,this._boolPropMap=new Map,this._namePropMap=new Map,this._refPropMap=new Map}static parse(t){const e=new br;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}static parseArray(t,e,r=null,s=!0){const n=t.getArrayBoundsAt(e,s);if(!n)return null;const a=[];let i,o=n.start+1;for(;o<n.end;){const e=t.getDictBoundsAt(o);if(i=br.parse({parser:t,bounds:e,cryptInfo:r}),!i)break;a.push(i.value),o=i.end+1}return{value:a,start:n.start,end:n.end}}getIntProp(t){return this._intPropMap.get(t)}getBoolProp(t){return this._boolPropMap.get(t)}getNameProp(t){return this._namePropMap.get(t)}getRefProp(t){return this._refPropMap.get(t)}setIntProp(t,e){return this._intPropMap.set(t,e)}setBoolProp(t,e){return this._boolPropMap.set(t,e)}setNameProp(t,e){return this._namePropMap.set(t,e)}setRefProp(t,e){return this._refPropMap.set(t,e)}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this._intPropMap.forEach(((t,e)=>s.push(...r.encode(e),...r.encode(" "+t)))),this._boolPropMap.forEach(((t,e)=>s.push(...r.encode(e),...r.encode(" "+t)))),this._namePropMap.forEach(((t,e)=>s.push(...r.encode(e),...r.encode(t)))),this._refPropMap.forEach(((e,n)=>s.push(...r.encode(n),...e.toArray(t))));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;){o=i.end+1,a=i.value;switch(e.getValueTypeAt(o)){case _e:const t=e.parseNumberAt(o,!1);if(t){this._intPropMap.set(a,t.value),o=t.end+1;continue}break;case Pe:const r=e.parseBoolAt(o);if(r){this._boolPropMap.set(a,r.value),o=r.end+1;continue}break;case ke:const s=e.parseNameAt(o);if(s){this._namePropMap.set(a,s.value),o=s.end+1;continue}break;case Me:const n=Ar.parseRef(e,o);if(n){this._refPropMap.set(a,n.value),o=n.end+1;continue}}o=e.skipToNextName(o,n-1)}return!0}}class xr extends class{constructor(t){this._minBufferLength=512,this._bufferLength=0,this._current=0,this._ended=!1,this._sourceStream=t}get length(){return this._buffer.length}ensureBuffer(t){const e=this._buffer;if(e&&t<=e.byteLength)return e;let r=this._minBufferLength;for(;r<t;)r*=2;const s=new Uint8Array(r);return e&&s.set(e),this._buffer=s}takeByte(){const t=this._current;for(;this._bufferLength<=t;){if(this._ended)return-1;this._readBlock()}return this._buffer[this._current++]}takeBytes(t){let e;const r=this._current;if(t){for(this.ensureBuffer(r+t),e=r+t;!this._ended&&this._bufferLength<e;)this._readBlock();e>this._bufferLength&&(e=this._bufferLength)}else{for(;!this._ended;)this._readBlock();e=this._bufferLength}this._current=e;return this._buffer.subarray(r,e)}takeUint16(){const t=this.takeByte(),e=this.takeByte();return-1===t||-1===e?-1:(t<<8)+e}takeInt32(){return(this.takeByte()<<24)+(this.takeByte()<<16)+(this.takeByte()<<8)+this.takeByte()}peekByte(){const t=this.takeByte();return-1!==t&&this._current--,t}peekBytes(t){const e=this.takeBytes(t);return this._current-=e.length,e}skip(t){this._current+=t||1}reset(){this._current=0}}{constructor(t){super(t),this._codeSize=0,this._codeBuf=0;const e=t.takeByte(),r=t.takeByte();if(-1===e||-1===r)throw new Error(`Invalid header in flate stream: ${e}, ${r}`);if(8!=(15&e))throw new Error(`Unknown compression method in flate stream: ${e}, ${r}`);if(((e<<8)+r)%31!=0)throw new Error(`Bad FCHECK in flate stream: ${e}, ${r}`);if(32&r)throw new Error(`FDICT bit set in flate stream: ${e}, ${r}`);this._codeSize=0,this._codeBuf=0}_readBlock(){let t,e;const r=this._sourceStream;let s,n,a=this.getBits(3);if(1&a&&(this._ended=!0),a>>=1,0===a){let e;if(-1===(e=r.takeByte()))throw new Error("Bad block header in flate stream");let s=e;if(-1===(e=r.takeByte()))throw new Error("Bad block header in flate stream");if(s|=e<<8,-1===(e=r.takeByte()))throw new Error("Bad block header in flate stream");let n=e;if(-1===(e=r.takeByte()))throw new Error("Bad block header in flate stream");if(n|=e<<8,n!==(65535&~s)&&(0!==s||0!==n))throw new Error("Bad uncompressed block length in flate stream");this._codeBuf=0,this._codeSize=0;const a=this._bufferLength,i=a+s;if(t=this.ensureBuffer(i),this._bufferLength=i,0===s)-1===r.peekByte()&&(this._ended=!0);else{const e=r.takeBytes(s);t.set(e,a),e.length<s&&(this._ended=!0)}return}if(1===a)s=xr.fixedLitCodeTab,n=xr.fixedDistCodeTab;else{if(2!==a)throw new Error("Unknown block type in flate stream");{const t=this.getBits(5)+257,r=this.getBits(5)+1,a=this.getBits(4)+4,i=new Uint8Array(xr.codeLenCodeMap.length);let o;for(o=0;o<a;o++)i[xr.codeLenCodeMap[o]]=this.getBits(3);const h=this.generateHuffmanTable(i);e=0,o=0;const c=t+r,d=new Uint8Array(c);let u,l,p;for(;o<c;){const t=this.getCode(h);if(16===t)u=2,l=3,p=e;else if(17===t)u=3,l=3,p=e=0;else{if(18!==t){d[o++]=e=t;continue}u=7,l=11,p=e=0}let r=this.getBits(u)+l;for(;r-- >0;)d[o++]=p}s=this.generateHuffmanTable(d.subarray(0,t)),n=this.generateHuffmanTable(d.subarray(t,c))}}t=this._buffer;let i=t?t.length:0,o=this._bufferLength;for(;;){let r=this.getCode(s);if(r<256){o+1>=i&&(t=this.ensureBuffer(o+1),i=t.length),t[o++]=r;continue}if(256===r)return void(this._bufferLength=o);r-=257,r=xr.lengthDecode[r];let a=r>>16;a>0&&(a=this.getBits(a)),e=(65535&r)+a,r=this.getCode(n),r=xr.distDecode[r],a=r>>16,a>0&&(a=this.getBits(a));const h=(65535&r)+a;o+e>=i&&(t=this.ensureBuffer(o+e),i=t.length);for(let r=0;r<e;++r,++o)t[o]=t[o-h]}}getBits(t){const e=this._sourceStream;let r,s=this._codeSize,n=this._codeBuf;for(;s<t;){if(-1===(r=e.takeByte()))throw new Error("Bad encoding in flate stream");n|=r<<s,s+=8}return r=n&(1<<t)-1,this._codeBuf=n>>t,this._codeSize=s-=t,r}getCode(t){const e=this._sourceStream,[r,s]=t;let n,a=this._codeSize,i=this._codeBuf;for(;a<s&&-1!==(n=e.takeByte());)i|=n<<a,a+=8;const o=r[i&(1<<s)-1],h=o>>16,c=65535&o;if(h<1||a<h)throw new Error("Bad encoding in flate stream");return this._codeBuf=i>>h,this._codeSize=a-h,c}generateHuffmanTable(t){const e=t.length;let r,s=0;for(r=0;r<e;r++)t[r]>s&&(s=t[r]);const n=1<<s,a=new Int32Array(n);for(let i=1,o=0,h=2;i<=s;i++,o<<=1,h<<=1)for(let s=0;s<e;s++)if(t[s]===i){let t=0,e=o;for(r=0;r<i;r++)t=t<<1|1&e,e>>=1;for(r=t;r<n;r+=h)a[r]=i<<16|s;o++}return[a,s]}}xr.codeLenCodeMap=new Int32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),xr.lengthDecode=new Int32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),xr.distDecode=new Int32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),xr.fixedLitCodeTab=[new Int32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],xr.fixedDistCodeTab=[new Int32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];class Er{constructor(t,e=0,r){if(r&&r<0)throw new Error("Stream length can't be negative");this._bytes=t instanceof Uint8Array?t:new Uint8Array(t),this._start=e,this._current=e,this._end=e+r||t.length}get length(){return this._end-this._start}takeByte(){return this._current>=this._end?-1:this._bytes[this._current++]}takeBytes(t){const e=this._bytes,r=this._current,s=this._end;if(t){let n=r+t;n>s&&(n=s),this._current=n;return e.subarray(r,n)}return e.subarray(r,s)}takeUint16(){const t=this.takeByte(),e=this.takeByte();return-1===t||-1===e?-1:(t<<8)+e}takeInt32(){return(this.takeByte()<<24)+(this.takeByte()<<16)+(this.takeByte()<<8)+this.takeByte()}peekByte(){const t=this.takeByte();return-1!==t&&this._current--,t}peekBytes(t){const e=this.takeBytes(t);return this._current-=e.length,e}getByte(t){return this._bytes[t]}getByteRange(t,e){return this._bytes.subarray(Math.max(t,0),Math.min(e,this._end))}skip(t){this._current+=t||1}reset(){this._current=this._start}}class Pr{static Decode(t,e=Kt,r=1,s=1,n=8){const a=new Er(t,0,t.length),i=new xr(a).takeBytes(null);switch(e){case Kt:return i;case qt:case Yt:case Jt:case Zt:case $t:case te:return Pr.removePngFilter(i,r,s,n);case Xt:throw new Error("Unsupported filter predictor")}}static Encode(t,e=Jt,r=5,s=1,n=8){let a;switch(e){case Kt:a=t;break;case qt:case Yt:case Jt:case Zt:case $t:case te:a=Pr.applyPngFilter(t,e,r,s,n);break;case Xt:throw new Error("Unsupported filter predictor")}return i.deflate(a)}static removePngFilter(t,e,r,s){const n=Math.ceil(r*s/8),a=e*n,i=a+1;if(t.length%i)throw new Error("Data length doesn't match filter columns");const o=new Uint8Array(t.length/i*a),h=new Array(a).fill(0),c=new Array(a).fill(0),d=t=>t-n<0?0:c[t-n],u=t=>h[t];let l=0,p=0,f=0,y=0,g=0,A=0;for(let e=0;e<t.length;e++)if(e%i==0){if(g=t[e],l=0,e)for(f=0;f<a;f++)h[f]=o[y+f];y=p}else{switch(c[l]=t[e],g){case 0:A=c[l];break;case 1:A=(c[l]+d(l))%256;break;case 2:A=(c[l]+u(l))%256;break;case 3:A=(c[l]+Math.floor((u(l)+d(l))/2))%256;break;case 4:A=(c[l]+this.paethPredictor(d(l),u(l),(w=l)-n<0?0:h[w-n]))%256}o[p++]=A,l++}var w;return o}static applyPngFilter(t,e=12,r=5,s=1,n=8){let a;switch(e){case qt:a=0;break;case Yt:a=1;break;case Jt:a=2;break;case Zt:a=3;break;case $t:a=4;break;default:throw new Error("Invalid PNG filter type")}const i=Math.ceil(s*n/8),o=r*i,h=o+1,c=Math.ceil(t.length/o)*h,d=new Uint8Array(c),u=new Array(o).fill(0),l=new Array(o).fill(0),p=t=>t-i<0?0:l[t-i],f=t=>u[t];let y=0,g=0,A=0,w=0,m=0;for(let e=0;e<c;e++)if(e%h==0){if(y=0,e)for(A=0;A<o;A++)u[A]=t[w+A];w=g,d[e]=a}else{switch(l[y]=t[g++]||0,a){case 0:m=l[y];break;case 1:m=(l[y]-p(y))%256;break;case 2:m=(l[y]-f(y))%256;break;case 3:m=(l[y]-Math.floor((f(y)+p(y))/2))%256;break;case 4:m=(l[y]-this.paethPredictor(p(y),f(y),(v=y)-i<0?0:u[v-i]))%256}d[e]=m,y++}var v;return d}static paethPredictor(t,e,r){const s=t+e-r,n=Math.abs(s-t),a=Math.abs(s-e),i=Math.abs(s-r);return n<=a&&n<=i?t:a<=i?e:r}}class _r extends mr{constructor(t=null){super(),this.Type=t}get streamData(){return this._streamData}set streamData(t){this.setStreamData(t)}get decodedStreamData(){return this._decodedStreamData||this.decodeStreamData(),this._decodedStreamData}toArray(t){const e=(null==t?void 0:t.ref)&&t.streamCryptor?t.streamCryptor.encrypt(this.streamData,t.ref):this.streamData,r=new TextEncoder,s=[...bt.DICT_START];return s.push(...r.encode("/Length "),...r.encode(" "+e.length)),this.Type&&s.push(...bt.TYPE,...r.encode(this.Type)),this.Filter&&s.push(...r.encode("/Filter "),...r.encode(this.Filter)),this.DecodeParms&&s.push(...r.encode("/DecodeParms "),...this.DecodeParms.toArray(t)),s.push(...bt.DICT_END,...bt.END_OF_LINE,...bt.STREAM_START,...bt.END_OF_LINE,...e,...bt.END_OF_LINE,...bt.STREAM_END,...bt.END_OF_LINE),new Uint8Array(s)}tryParseProps(t){var e,r;if(!t)return!1;this._ref=null===(e=t.cryptInfo)||void 0===e?void 0:e.ref;const{parser:s,bounds:n}=t,a=n.contentStart||n.start,i=n.contentEnd||n.end,o=s.findSubarrayIndex(bt.STREAM_END,{direction:"reverse",minIndex:a,maxIndex:i,closedOnly:!0});if(!o)return!1;const h=s.findSubarrayIndex(bt.STREAM_START,{direction:"reverse",minIndex:a,maxIndex:o.start-1,closedOnly:!0});if(!h)return!1;const c=s.getDictBoundsAt(a);let d,u,l=s.skipToNextName(c.contentStart,c.contentEnd);if(-1===l)return!1;for(;u=s.parseNameAt(l),u;)switch(l=u.end+1,d=u.value,d){case"/Type":const e=s.parseNameAt(l);if(!e)throw new Error("Can't parse /Type property value");if(this.Type&&this.Type!==e.value)return!1;l=e.end+1;break;case"/Length":case"/DL":l=this.parseNumberProp(d,s,l,!1);break;case"/Filter":const r=s.getValueTypeAt(l);if(r===ke){const t=s.parseNameAt(l);if(t&&sr.has(t.value)){this.Filter=t.value,l=t.end+1;break}return console.log(`Unsupported /Filter property value: ${t.value}`),!1}if(r===Ne){const t=s.parseNameArrayAt(l);if(t){const e=t.value;if(1===e.length&&sr.has(e[0])){this.Filter=e[0],l=t.end+1;break}return console.log(`Unsupported /Filter property value: ${e.toString()}`),!1}}throw new Error(`Unsupported /Filter property value type: ${r}`);case"/DecodeParms":const n=s.getValueTypeAt(l);if(n===Ie){const e=s.getDictBoundsAt(l);if(e){const r=br.parse({parser:s,bounds:e,cryptInfo:t.cryptInfo});if(r){this.DecodeParms=r.value,l=e.end+1;break}}throw new Error("Can't parse /DecodeParms property value")}if(n===Ne){const e=br.parseArray(s,l,t.cryptInfo);if(e){const t=e.value;if(1===t.length){this.DecodeParms=t[0],l=e.end+1;break}}throw new Error("Can't parse /DecodeParms property value")}throw new Error(`Unsupported /DecodeParms property value type: ${n}`);default:l=s.skipToNextName(l,c.contentEnd)}const p=s.findNewLineIndex("straight",h.end+1),f=s.findNewLineIndex("reverse",o.start-1),y=s.sliceCharCodes(p,f),g=(null===(r=t.cryptInfo)||void 0===r?void 0:r.ref)&&t.cryptInfo.streamCryptor?t.cryptInfo.streamCryptor.decrypt(y,t.cryptInfo.ref):y;return this._streamData=g,!0}setStreamData(t){let e;if(this.DecodeParms){const r=this.DecodeParms;e=Pr.Encode(t,r.getIntProp("/Predictor")||Kt,r.getIntProp("/Columns")||1,r.getIntProp("/Colors")||1,r.getIntProp("/BitsPerComponent")||8)}else e=Pr.Encode(t);this._streamData=e,this.Length=e.length,this.DL=t.length,this._decodedStreamData=t}decodeStreamData(){let t;switch(this.Filter){case Gt:if(this.DecodeParms){const e=this.DecodeParms;t=Pr.Decode(this._streamData,e.getIntProp("/Predictor")||Kt,e.getIntProp("/Columns")||1,e.getIntProp("/Colors")||1,e.getIntProp("/BitsPerComponent")||8)}else t=Pr.Decode(this._streamData);break;default:t=new Uint8Array(this._streamData)}this._decodedStreamData=t}}class Cr extends _r{constructor(t=null){super(t)}static parse(t){const e=new Cr;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}getText(){return null}toArray(t){return super.toArray(t)}tryParseProps(t){return!!super.tryParseProps(t)}}const Sr={SOLID:"/S",DASHED:"/D",BEVELED:"/B",INSET:"/I",UNDERLINE:"/U"};class kr extends vr{constructor(){super(fe),this.W=1,this.S=Sr.SOLID,this.D=[3,0]}static parse(t){const e=new kr;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.W&&s.push(...r.encode("/W "),...r.encode(" "+this.W)),this.S&&s.push(...r.encode("/S "),...r.encode(this.S)),this.D&&s.push(...r.encode("/D "),et,...r.encode(this.D[0]+""),N,...r.encode(this.D[1]+""),st);const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){var e,r;if(!super.tryParseProps(t))return!1;const{parser:s,bounds:n}=t,a=n.contentStart||n.start,i=n.contentEnd||n.end;let o,h,c=s.skipToNextName(a,i-1);if(-1===c)return!1;for(;h=s.parseNameAt(c),h;)switch(c=h.end+1,o=h.value,o){case"/W":c=this.parseNumberProp(o,s,c,!0);break;case"/S":const t=s.parseNameAt(c,!0);if(!t||!Object.values(Sr).includes(t.value))throw new Error("Can't parse /S property value");this.S=t.value,c=t.end+1;break;case"/D":const n=s.parseNumberArrayAt(c,!0);if(!n)throw new Error("Can't parse /D property value");this.D=[null!==(e=n.value[0])&&void 0!==e?e:3,null!==(r=n.value[1])&&void 0!==r?r:0],c=n.end+1;break;default:c=s.skipToNextName(c,i-1)}return!0}}class Nr{constructor(t){if(!(null==t?void 0:t.length))throw new Error("Data is empty");this._data=t,this._maxIndex=t.length-1}get maxIndex(){return this._maxIndex}getPdfVersion(){var t;const e=this.findSubarrayIndex(bt.VERSION);if(!e)throw new Error("PDF not valid. Version not found");const r=null===(t=this.parseNumberAt(e.end+1,!0))||void 0===t?void 0:t.value;if(!r)throw new Error("Error parsing version number");return r.toFixed(1)}getLastXrefIndex(){const t=this.findSubarrayIndex(bt.XREF_START,{maxIndex:this.maxIndex,direction:"reverse"});if(!t)return null;const e=this.parseNumberAt(t.end+1);return e||null}findSubarrayIndex(t,e){var r,s;const n=this._data;if(!(null==t?void 0:t.length))return null;const a=(null==e?void 0:e.direction)||"straight",i=Math.max(Math.min(null!==(r=null==e?void 0:e.minIndex)&&void 0!==r?r:0,this._maxIndex),0),o=Math.max(Math.min(null!==(s=null==e?void 0:e.maxIndex)&&void 0!==s?s:this._maxIndex,this._maxIndex),0),h=!(null==e?void 0:e.closedOnly);let c,d="straight"===a?i:o;if("straight"===a)t:for(;d<=o;d++){for(c=0;c<t.length;c++)if(n[d+c]!==t[c])continue t;if(h||!_t(n[d+c]))return{start:d,end:d+c-1}}else{const e=t.length-1;t:for(;d>=i;d--){for(c=0;c<t.length;c++)if(n[d-c]!==t[e-c])continue t;if(h||!_t(n[d-c]))return{start:d-c+1,end:d}}}return null}findCharIndex(t,e="straight",r){return this.findSingleCharIndex((e=>t===e),e,r)}findNewLineIndex(t="straight",e){let r=this.findSingleCharIndex((t=>t===k||t===C),t,e);return-1===r?-1:"straight"===t?(this._data[r]===k&&this._data[r+1]===C&&r++,Math.min(r+1,this._maxIndex)):(this._data[r]===C&&this._data[r-1]===k&&r--,Math.max(r-1,0))}findSpaceIndex(t="straight",e){return this.findSingleCharIndex((t=>Et.has(t)),t,e)}findNonSpaceIndex(t="straight",e){return this.findSingleCharIndex((t=>!Et.has(t)),t,e)}findDelimiterIndex(t="straight",e){return this.findSingleCharIndex((t=>xt.has(t)),t,e)}findNonDelimiterIndex(t="straight",e){return this.findSingleCharIndex((t=>!xt.has(t)),t,e)}findIrregularIndex(t="straight",e){return this.findSingleCharIndex((t=>!_t(t)),t,e)}findRegularIndex(t="straight",e){return this.findSingleCharIndex((t=>_t(t)),t,e)}getValueTypeAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t))return null;const r=this._data,s=t;switch(r[s]){case T:return _t(r[s+1])?ke:Ee;case et:return Ne;case B:return Ce;case j:return j===r[s+1]?Ie:Se;case I:return Re;case L:case O:case U:case F:case V:case z:case H:case W:case G:case Q:const t=this.findDelimiterIndex("straight",s+1);if(-1!==t){const e=this.findCharIndex(J,"reverse",t-1);if(-1!==e&&e>s&&!_t(r[e+1]))return Me}return _e;case D:case R:return n=r[s+1],Pt.has(n)?_e:Ee;case gt:return r[s+1]===At&&r[s+2]===yt&&r[s+3]===ot&&r[s+4]===nt&&r[s+5]===ut?Be:Ee;case At:return r[s+1]===yt&&r[s+2]===wt&&r[s+3]===ot?Pe:Ee;case ht:return r[s+1]===nt&&r[s+2]===dt&&r[s+3]===gt&&r[s+4]===ot?Pe:Ee;default:return Ee}var n}getIndirectObjectBoundsAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t))return null;const r=this.findSubarrayIndex(bt.OBJ,{minIndex:t,closedOnly:!0});if(!r)return null;let s=this.findNonSpaceIndex("straight",r.end+1);if(-1===s)return null;const n=this.findSubarrayIndex(bt.OBJ_END,{minIndex:s,closedOnly:!0});if(!n)return null;let a=this.findNonSpaceIndex("reverse",n.start-1);return this.getCharCode(s)===j&&this.getCharCode(s+1)===j&&this.getCharCode(a-1)===K&&this.getCharCode(a)===K&&(s+=2,a-=2),{start:r.start,end:n.end,contentStart:s,contentEnd:a}}getXrefTableBoundsAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t)||this._data[t]!==mt)return null;const r=this.findSubarrayIndex(bt.XREF_TABLE,{minIndex:t});if(!r)return null;const s=this.findNonSpaceIndex("straight",r.end+1);if(-1===s)return null;const n=this.findSubarrayIndex(bt.TRAILER,{minIndex:r.end+1});if(!n)return null;const a=this.findNonSpaceIndex("reverse",n.start-1);return a<s?null:{start:r.start,end:n.end,contentStart:s,contentEnd:a}}getDictBoundsAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t)||this._data[t]!==j||this._data[t+1]!==j)return null;const r=this.findNonSpaceIndex("straight",t+2);if(-1===r)return null;let s,n,a=1,i=!0,o=0,h=r;for(;a;)n=s,s=this._data[h++],s!==B||o&&n===rt||o++,s===M&&o&&n!==rt&&o--,o||(i?i=!1:s===j&&s===n?(a++,i=!0):s===K&&s===n&&(a--,i=!0));const c=h-1,d=this.findNonSpaceIndex("reverse",c-2);return d<r?{start:t,end:c}:{start:t,end:c,contentStart:r,contentEnd:d}}getArrayBoundsAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t)||this._data[t]!==et)return null;let r,s=0,n=t+1;for(;s||r!==st;)r=this._data[n++],r===et?s++:s&&r===st&&s--;const a=n-1;return a-t<1?null:{start:t,end:a}}getHexBounds(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t)||this.getCharCode(t)!==j)return null;const r=this.findCharIndex(K,"straight",t+1);return-1===r?null:{start:t,end:r}}getLiteralBounds(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t)||this.getCharCode(t)!==B)return null;let r,s,n=t+1,a=0;for(;a||s!==M||r===rt;){if(n>this._maxIndex)return null;isNaN(s)||(r=s),s=this.getCharCode(n++),r!==rt&&(s===B?a+=1:a&&s===M&&(a-=1))}return{start:t,end:n-1}}parseNumberAt(t,e=!1,r=!0){if(r&&(t=this.skipEmpty(t)),this.isOutside(t)||!_t(this._data[t]))return null;let s=t,n="",a=this._data[s];for(a===R?(n+="-",a=this._data[++s]):a===D&&(n+="0.",a=this._data[++s]);Pt.has(a)||e&&a===D;)n+=String.fromCharCode(a),a=this._data[++s];return n?{value:+n,start:t,end:s-1}:null}parseNameAt(t,e=!0,r=!0){if(r&&(t=this.skipEmpty(t)),this.isOutside(t)||this._data[t]!==T)return null;let s=t+1,n=e?"/":"",a=this._data[s];for(;_t(a);)n+=String.fromCharCode(a),a=this._data[++s];return n.length>1?{value:n,start:t,end:s-1}:null}parseStringAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t))return null;let r=t,s="",n=this._data[r];for(;_t(n);)s+=String.fromCharCode(n),n=this._data[++r];return 0!==s.length?{value:s,start:t,end:r-1}:null}parseBoolAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t))return null;const r=this.findSubarrayIndex(bt.TRUE,{minIndex:t});if(r)return{value:!0,start:t,end:r.end};const s=this.findSubarrayIndex(bt.FALSE,{minIndex:t});return s?{value:!0,start:t,end:s.end}:null}parseNumberArrayAt(t,e=!0,r=!0){const s=this.getArrayBoundsAt(t,r);if(!s)return null;const n=[];let a,i=s.start+1;for(;i<s.end&&(a=this.parseNumberAt(i,e,!0),a);)n.push(a.value),i=a.end+1;return{value:n,start:s.start,end:s.end}}parseNameArrayAt(t,e=!0,r=!0){const s=this.getArrayBoundsAt(t,r);if(!s)return null;const n=[];let a,i=s.start+1;for(;i<s.end&&(a=this.parseNameAt(i,e,!0),a);)n.push(a.value),i=a.end+1;return{value:n,start:s.start,end:s.end}}parseDictType(t){return this.parseDictNameProperty(bt.TYPE,t)}parseDictSubtype(t){return this.parseDictNameProperty(bt.SUBTYPE,t)}parseDictNameProperty(t,e){const r=this.findSubarrayIndex(t,{minIndex:e.start,maxIndex:e.end});if(!r)return null;const s=this.parseNameAt(r.end+1);return s?s.value:null}skipEmpty(t){let e=this.findNonSpaceIndex("straight",t);if(-1===e)return-1;if(this._data[e]===I){const t=this.findNewLineIndex("straight",e+1);if(-1===t)return-1;e=this.findNonSpaceIndex("straight",t)}return e}skipToNextName(t,e){if(t||(t=0),(e=e?Math.min(e,this._maxIndex):0)<t)return-1;let r=t;for(;r<=e;){const t=this.getValueTypeAt(r,!0);if(t){let e;switch(t){case Ie:e=this.getDictBoundsAt(r,!1);break;case Ne:e=this.getArrayBoundsAt(r,!1);break;case Ce:e=this.getLiteralBounds(r,!1);break;case Se:e=this.getHexBounds(r,!1);break;case _e:const t=this.parseNumberAt(r,!0,!1);t&&(e=t);break;case Pe:const s=this.parseBoolAt(r,!1);s&&(e=s);break;case Re:break;case ke:return r;default:r++;continue}if(e){r=e.end+1,e=null;continue}}r++}return-1}getCharCode(t){return this._data[t]}getChar(t){const e=this._data[t];return isNaN(e)?null:String.fromCharCode(e)}sliceCharCodes(t,e){return this._data.slice(t,(e||t)+1)}sliceChars(t,e){return String.fromCharCode(...this._data.slice(t,(e||t)+1))}subCharCodes(t,e){return this._data.subarray(t,(e||t)+1)}isOutside(t){return t<0||t>this._maxIndex}getValidStartIndex(t,e){return isNaN(e)?"straight"===t?0:this._maxIndex:Math.max(Math.min(e,this._maxIndex),0)}findSingleCharIndex(t,e="straight",r){const s=this._data;let n=this.getValidStartIndex(e,r);if("straight"===e){for(;n<=this._maxIndex;n++)if(t(s[n]))return n}else for(;n>=0;n--)if(t(s[n]))return n;return-1}}class Ir extends vr{constructor(){super(null),this._objectIdMap=new Map,this._dictParserMap=new Map}static parse(t){const e=new Ir;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}getObjectId(t){return this._objectIdMap.get(t)}*getObjectIds(){for(const t of this._objectIdMap)yield t}getDictParser(t){return this._dictParserMap.get(t)}*getDictParsers(){for(const t of this._dictParserMap)yield t}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this._objectIdMap.forEach(((e,n)=>{s.push(...r.encode(n),N,...e.toArray(t))}));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){default:const r=e.getValueTypeAt(o);if(r===Me){const t=Ar.parseRef(e,o);if(t){this._objectIdMap.set(a,t.value),o=t.end+1;break}}else if(r===Ie){const r=e.getDictBoundsAt(o);if(r){const s={parser:new Nr(e.sliceCharCodes(r.start,r.end)),bounds:{start:0,end:r.end-r.start,contentStart:r.contentStart-r.start,contentEnd:r.contentEnd-r.start},cryptInfo:t.cryptInfo};this._dictParserMap.set(a,s),o=r.end+1;break}}o=e.skipToNextName(o,n-1)}return!0}}class Br{constructor(t,e,r){this.literal=t,this.hex=e,this.bytes=r}static parse(t,e,r=null,s=!0){const n=t.getHexBounds(e,s);if(!n)return null;let a=t.sliceCharCodes(n.start+1,n.end-1);(null==r?void 0:r.ref)&&r.stringCryptor&&(a=r.stringCryptor.decrypt(a,r.ref));return{value:Br.fromBytes(a),start:n.start,end:n.end}}static parseArray(t,e,r=null,s=!0){const n=t.getArrayBoundsAt(e,s);if(!n)return null;const a=[];let i,o=n.start+1;for(;o<n.end&&(i=Br.parse(t,o,r,s),i);)a.push(i.value),o=i.end+1;return{value:a,start:n.start,end:n.end}}static fromBytes(t){const e=(new TextDecoder).decode(t),r=Mt(e);return new Br(e,r,t)}static fromHexBytes(t){let e="";t.forEach((t=>e+=t.toString(16).padStart(2,"0")));const r=(new TextEncoder).encode(e);return new Br(e,t,r)}static fromLiteralString(t){const e=Mt(t),r=(new TextEncoder).encode(t);return new Br(t,e,r)}toArray(t){return new Uint8Array([...bt.STR_HEX_START,...this.bytes,...bt.STR_HEX_END])}}class Mr{constructor(t,e,r){switch(t){case Ze:this.componentsNumber=1;break;case $e:this.componentsNumber=3;break;case tr:this.componentsNumber=4;break;default:throw new Error(`Unsupported base color space for indexed color space: ${t}`)}if(this.baseColorSpace=t,r.length!==this.componentsNumber*(e+1))throw new Error(`Invalid lookup array length: ${r.length}`);this.highestValue=e,this.lookupArray=r,console.log(this)}static parse(t,e=!0){const{parser:r,bounds:s,cryptInfo:n}=t;let a;e&&(a=r.findNonSpaceIndex("straight",s.start));const i=a;if(a<0||a>r.maxIndex||r.getCharCode(a)!==et)return console.log("Color space array start not found"),null;a++;const o=r.parseNameAt(a);if(!o||"/Indexed"!==o.value)return console.log("Array is not representing an indexed color space"),null;a=o.end+1;const h=r.parseNameAt(a);if(!h)return console.log("Can't parse base color space name of the indexed color space"),null;a=h.end+2;const c=r.parseNumberAt(a);if(!c||isNaN(c.value))return console.log("Can't parse the highest value of the indexed color space"),null;let d;a=c.end+1;const u=r.getValueTypeAt(a);if(u===Me)try{const e=Ar.parseRef(r,a),s=t.parseInfoGetter(e.value.id);d=Cr.parse(s).value.decodedStreamData,a=e.end+1}catch(t){throw new Error(`Can't parse indexed color array lookup ref: ${t.message}`)}else if(u===Se){const t=Br.parse(r,a,n);if(!t)throw new Error("Can't parse indexed color array lookup hex string");d=t.value.hex,a=t.end+1}try{return{value:new Mr(h.value,c.value,d),start:i,end:a-1}}catch(t){return console.log(t.message),null}}toArray(t){const e=new TextEncoder,r=[];return r.push(et,...e.encode("/Indexed "),...e.encode(this.baseColorSpace+" "),...e.encode(this.highestValue+" "),...Br.fromHexBytes(this.lookupArray).toArray(t),st),new Uint8Array(r)}getColor(t){switch(this.baseColorSpace){case Ze:const e=this.lookupArray[t];return[e,e,e];case $e:return[this.lookupArray[3*t],this.lookupArray[3*t+1],this.lookupArray[3*t+2]];case tr:const r=this.lookupArray[4*t]/255,s=this.lookupArray[4*t+1]/255,n=this.lookupArray[4*t+2]/255,a=this.lookupArray[4*t+3]/255;return[255*(1-r)*(1-a),255*(1-s)*(1-a),255*(1-n)*(1-a)]}}}var Rr=function(t,e,r,s){return new(r||(r=Promise))((function(n,a){function i(t){try{h(s.next(t))}catch(t){a(t)}}function o(t){try{h(s.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,o)}h((s=s.apply(t,e||[])).next())}))};class Dr extends _r{constructor(){super(he),this.Subtype="/Image",this.ImageMask=!1,this.Interpolate=!1,this.SMaskInData=0}get sMask(){return this._sMask}set streamData(t){this.setStreamData(t)}get decodedStreamData(){return this._decodedStreamData||this.decodeStreamData(),this._decodedStreamData}static parse(t){const e=new Dr;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.Subtype&&s.push(...r.encode("/Subtype "),...r.encode(this.Subtype)),this.Width&&s.push(...r.encode("/Width "),...r.encode(" "+this.Width)),this.Height&&s.push(...r.encode("/Width "),...r.encode(" "+this.Height)),this.ColorSpace&&(this._indexedColorSpace?s.push(...r.encode("/ColorSpace "),...this._indexedColorSpace.toArray(t)):s.push(...r.encode("/ColorSpace "),...r.encode(this.ColorSpace))),this.BitsPerComponent&&s.push(...r.encode("/BitsPerComponent "),...r.encode(" "+this.BitsPerComponent)),s.push(...r.encode("/ImageMask "),...r.encode(" "+!!this.ImageMask)),this.Mask&&(s.push(...r.encode("/Mask "),et),this.Mask.forEach((t=>s.push(N,...r.encode(" "+t)))),s.push(st)),this.Decode&&(s.push(...r.encode("/Decode "),et),this.Decode.forEach((t=>s.push(N,...r.encode(" "+t)))),s.push(st)),s.push(...r.encode("/Interpolate "),...r.encode(" "+!!this.Interpolate)),this.SMask&&s.push(...r.encode("/SMask "),...this.SMask.toArray(t)),this.SMaskInData&&s.push(...r.encode("/SMaskInData "),...r.encode(" "+this.SMaskInData)),this.Matte&&(s.push(...r.encode("/Matte "),et),this.Matte.forEach((t=>s.push(N,...r.encode(" "+t)))),s.push(st)),this.StructParent&&s.push(...r.encode("/StructParent "),...r.encode(" "+this.StructParent)),this.Metadata&&s.push(...r.encode("/Metadata "),N,...this.Metadata.toArray(t));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}getImageUrlAsync(){return Rr(this,void 0,void 0,(function*(){if(this._imageUrl&&URL.revokeObjectURL(this._imageUrl),this.Filter===Wt||this.Filter===Qt||this.Filter===jt){const t=new Blob([this.decodedStreamData],{type:"application/octet-binary"}),e=URL.createObjectURL(t);return this._imageUrl=e,e}if(this.Filter===Gt){const t=this.Width*this.Height;let e;if(this.sMask){if(e=this.sMask.decodedStreamData,e.length!==t)throw new Error(`Invalid alpha mask data length: ${e.length} (must be ${t})`)}else e=new Uint8Array(t).fill(255);const r=new Uint8ClampedArray(4*t);for(let s=0;s<t;s++){const[t,n,a]=this.getColor(s);r[4*s]=t,r[4*s+1]=n,r[4*s+2]=a,r[4*s+3]=e[s]}const s=new ImageData(r,this.Width,this.Height),n=new Promise(((t,e)=>{const r=document.createElement("canvas");r.width=this.Width,r.height=this.Height,r.getContext("2d").putImageData(s,0,0),r.toBlob((e=>{const r=URL.createObjectURL(e);t(r)}))})),a=yield n;return this._imageUrl=a,a}throw new Error(`Unsupported image filter type: ${this.Filter}`)}))}tryParseProps(t){if(!super.tryParseProps(t))return!1;if(this.Type!==he)return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=e.getDictBoundsAt(s);let a,i,o=e.skipToNextName(n.contentStart,n.contentEnd);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Subtype":const r=e.parseNameAt(o);if(!r)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==r.value)return!1;o=r.end+1;break;case"/Width":case"/Height":case"/BitsPerComponent":case"/SMaskInData":case"/StructParent":o=this.parseNumberProp(a,e,o,!1);break;case"/Decode":o=this.parseNumberArrayProp(a,e,o,!1);break;case"/Matte":o=this.parseNumberArrayProp(a,e,o,!0);break;case"/Interpolate":o=this.parseBoolProp(a,e,o);break;case"/SMask":case"/Metadata":o=this.parseRefProp(a,e,o);break;case"/ColorSpace":const s=e.getValueTypeAt(o);if(s===ke){const t=e.parseNameAt(o);if(t){this.ColorSpace=t.value,o=t.end+1;break}throw new Error("Can't parse /ColorSpace name")}if(s===Ne){const r=e.getArrayBoundsAt(o);if(r){const s=Mr.parse({parser:e,bounds:r,cryptInfo:t.cryptInfo,parseInfoGetter:t.parseInfoGetter});if(s){this.ColorSpace=er,this._indexedColorSpace=s.value,o=r.end+1;break}throw new Error("Can't parse /ColorSpace object:"+e.sliceChars(r.start,r.end))}throw new Error("Can't parse /ColorSpace value array")}if(s===Me){const r=Ar.parseRef(e,o);if(r){const e=t.parseInfoGetter(r.value.id);if(e){const t=Mr.parse(e);if(t){this.ColorSpace=er,this._indexedColorSpace=t.value,o=r.end+1;break}throw new Error("Can't parse /ColorSpace object:"+e.parser.sliceChars(e.bounds.start,e.bounds.end))}}throw new Error("Can't parse /ColorSpace ref")}throw new Error(`Unsupported /ColorSpace property value type: ${s}`);case"/ImageMask":const i=e.parseBoolAt(o,!1);if(!i)throw new Error("Can't parse /ImageMask property value");this.ImageMask=i.value,o=i.end+1,this.ImageMask&&(this.BitsPerComponent=1);break;case"/Mask":const h=e.getValueTypeAt(o);if(h===Me){const r=Ar.parseRef(e,o);if(!r)throw new Error("Can't parse /Mask value reference: failed to parse ref");const s=t.parseInfoGetter(r.value.id);if(!s)throw new Error("Can't parse /Mask value reference: failed to get image parse info");const n=Dr.parse(s);if(!n)throw new Error("Can't parse /Mask value reference: failed to parse image stream");const a=new Nr(new Uint8Array([et,...n.value.decodedStreamData,st]));if(!a)throw new Error("Can't parse /Mask value reference: failed to get decoded image data");const i=a.parseNumberArrayAt(0,!1);if(!i)throw new Error("Can't parse /Mask value reference: failed to parse decoded image data");this.Mask=i.value,o=r.end+1;break}if(h===Ne){const t=e.parseNumberArrayAt(o,!1);if(t){this.Mask=t.value,o=t.end+1;break}throw new Error("Can't parse /Mask property value")}throw new Error(`Unsupported /Mask property value type: ${h}`);case"/OC":case"/Intent":case"/Alternates":case"/ID":case"/OPI":default:o=e.skipToNextName(o,n.contentEnd)}if(!this.Width&&!this.Height)return!1;if(this.ImageMask&&(1!==this.BitsPerComponent||this.ColorSpace))return!1;if(!this.Decode&&(this.Filter!==jt||this.ImageMask))switch(this.ColorSpace){case Ze:this.Decode=[0,1];break;case $e:this.Decode=[0,1,0,1,0,1];break;case tr:this.Decode=[0,1,0,1,0,1,0,1];break;case er:this.Decode=[0,Math.pow(2,this.BitsPerComponent||1)-1];break;default:this.Decode=[0,1]}if(this.DecodeParms||(this.DecodeParms=new br),this.DecodeParms.getIntProp("/BitsPerComponent")||this.DecodeParms.setIntProp("/BitsPerComponent",this.BitsPerComponent),this.DecodeParms.getIntProp("/Columns")||this.DecodeParms.setIntProp("/Columns",this.Width),!this.DecodeParms.getIntProp("/Colors"))switch(this.ColorSpace){case Ze:case er:this.DecodeParms.setIntProp("/Colors",1);break;case $e:this.DecodeParms.setIntProp("/Colors",3);break;case tr:this.DecodeParms.setIntProp("/Colors",4);break;default:this.DecodeParms.setIntProp("/Colors",1)}if(this.SMask){const e=t.parseInfoGetter(this.SMask.id);if(!e)throw new Error(`Can't get parse info for ref: ${this.SMask.id} ${this.sMask.generation} R`);const r=Dr.parse(e);if(!r)throw new Error(`Can't parse SMask: ${this.SMask.id} ${this.sMask.generation} R`);this._sMask=r.value}return!0}getColor(t){var e;const r=this.decodedStreamData;switch(this.ColorSpace){case Ze:const s=r[t];return[s,s,s];case $e:return[r[3*t],r[3*t+1],r[3*t+2]];case tr:const n=r[4*t]/255,a=r[4*t+1]/255,i=r[4*t+2]/255,o=r[4*t+3]/255;return[255*(1-n)*(1-o),255*(1-a)*(1-o),255*(1-i)*(1-o)];case er:return(null===(e=this._indexedColorSpace)||void 0===e?void 0:e.getColor(t))||[0,0,0]}}}class Tr extends vr{constructor(){super(ve)}static parse(t){const e=new Tr;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.Subtype&&s.push(...r.encode("/Subtype "),...r.encode(" "+this.Subtype)),this.BaseFont&&s.push(...r.encode("/BaseFont "),...r.encode(" "+this.BaseFont)),this.Encoding&&s.push(...r.encode("/Encoding "),...r.encode(" "+this.Encoding)),this.ToUnicode&&s.push(...r.encode("/G "),N,...this.ToUnicode.toArray(t));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Subtype":const t=e.parseNameAt(o,!0);if(t){if("/Type1"===t.value||"/TrueType"===t.value){this.Subtype=t.value,o=t.end+1;break}return!1}throw new Error("Can't parse /Subtype property value");case"/BaseFont":case"/Encoding":o=this.parseNameProp(a,e,o);break;case"/ToUnicode":o=this.parseRefProp(a,e,o);break;default:o=e.skipToNextName(o,n-1)}return!0}}class Lr extends vr{constructor(){super(we),this.TR="/Identity"}static parse(t){const e=new Lr;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.S&&s.push(...r.encode("/S "),...r.encode(this.S)),this.G&&s.push(...r.encode("/G "),N,...this.G.toArray(t)),this.BC&&(s.push(...r.encode("/BC "),et),this.BC.forEach((t=>s.push(N,...r.encode(" "+t)))),s.push(st)),this.TR&&s.push(...r.encode("/TR "),...r.encode(" "+this.TR));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/S":const t=e.parseNameAt(o,!0);if(!t||!Object.values(rr).includes(t.value))throw new Error("Can't parse /S property value");this.S=t.value,o=t.end+1;break;case"/G":o=this.parseRefProp(a,e,o);break;case"/BC":o=this.parseNumberArrayProp(a,e,o);break;case"/TR":default:o=e.skipToNextName(o,n-1)}return!0}}class Or extends vr{constructor(){super(ge)}static parse(t){const e=new Or;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.LW&&s.push(...r.encode("/LW "),...r.encode(" "+this.LW)),this.LC&&s.push(...r.encode("/LC "),...r.encode(" "+this.LC)),this.LJ&&s.push(...r.encode("/LJ "),...r.encode(" "+this.LJ)),this.ML&&s.push(...r.encode("/ML "),...r.encode(" "+this.ML)),this.D&&s.push(...r.encode("/D "),et,et,...r.encode(""+this.D[0][0]),...r.encode(" "+this.D[0][1]),st,...r.encode(" "+this.D[1]),st),this.RI&&s.push(...r.encode("/RI "),...r.encode(this.RI)),this.OP&&s.push(...r.encode("/OP "),...r.encode(" "+this.OP)),this.op&&s.push(...r.encode("/op "),...r.encode(" "+this.op)),this.OPM&&s.push(...r.encode("/OPM "),...r.encode(" "+this.OPM)),this.Font&&s.push(...r.encode("/Font "),et,...this.Font[0].toArray(t),...r.encode(" "+this.Font[1]),st),this.FL&&s.push(...r.encode("/FL "),...r.encode(" "+this.FL)),this.SM&&s.push(...r.encode("/SM "),...r.encode(" "+this.SM)),this.SA&&s.push(...r.encode("/SA "),...r.encode(" "+this.SA)),this.BM&&s.push(...r.encode("/BM "),...r.encode(this.BM)),this.SMask&&(this.SMask instanceof Lr?s.push(...r.encode("/SMask "),...this.SMask.toArray(t)):s.push(...r.encode("/SMask "),...r.encode(this.SMask))),this.CA&&s.push(...r.encode("/CA "),...r.encode(" "+this.CA)),this.ca&&s.push(...r.encode("/ca "),...r.encode(" "+this.ca)),this.AIS&&s.push(...r.encode("/AIS "),...r.encode(" "+this.AIS)),this.TK&&s.push(...r.encode("/AIS "),...r.encode(" "+this.TK));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}toParams(){const t={};if(isNaN(this.LW)||(t.strokeWidth=this.LW),!isNaN(this.LC))switch(this.LC){case Xe.BUTT:t.strokeLineCap="butt";break;case Xe.ROUND:t.strokeLineCap="round";break;case Xe.SQUARE:t.strokeLineCap="square"}if(!isNaN(this.LJ))switch(this.LJ){case qe.BEVEL:t.strokeLineJoin="bevel";break;case qe.ROUND:t.strokeLineJoin="round";break;case qe.MITER:t.strokeLineJoin="miter"}return this.ML&&(t.strokeMiterLimit=this.ML),this.D&&(t.strokeDashArray=`${this.D[0][0]} ${this.D[0][1]}`,t.strokeDashOffset=this.D[1]),this.Font,this.BM&&(t.strokeMiterLimit=this.ML),this.SMask,this.CA&&(t.strokeAlpha=this.CA),this.ca&&(t.fillAlpha=this.ca),this.AIS,t}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/LC":const t=e.parseNumberAt(o,!0);if(!t||!Object.values(Xe).includes(t.value))throw new Error("Can't parse /LC property value");this.LC=t.value,o=t.end+1;break;case"/OPM":const r=e.parseNumberAt(o,!0);if(!r||![0,1].includes(r.value))throw new Error("Can't parse /OPM property value");this.OPM=r.value,o=r.end+1;break;case"/LJ":const s=e.parseNumberAt(o,!0);if(!s||!Object.values(qe).includes(s.value))throw new Error("Can't parse /LJ property value");this.LJ=s.value,o=s.end+1;break;case"/RI":const i=e.parseNameAt(o,!0);if(!i||!Object.values(Ye).includes(i.value))throw new Error("Can't parse /RI property value");this.RI=i.value,o=i.end+1;break;case"/BM":const h=e.parseNameAt(o,!0);if(!h||!Object.values(Je).includes(h.value))throw new Error("Can't parse /BM property value");this.BM=h.value,o=h.end+1;break;case"/SMask":const c=e.getValueTypeAt(o);if(c===ke){const t=e.parseNameAt(o);if(t){this.SMask=t.value,o=t.end+1;break}throw new Error("Can't parse /SMask property name")}if(c===Ie){const t=e.getDictBoundsAt(o);if(t){const r=Lr.parse({parser:e,bounds:t});if(r){this.SMask=r.value,o=r.end+1;break}}throw new Error("Can't parse /SMask value dictionary")}throw new Error(`Unsupported /SMask property value type: ${c}`);case"/Font":const d=e.getValueTypeAt(o);if(d!==Ne)throw new Error(`Unsupported /Font property value type: ${d}`);{const t=e.getArrayBoundsAt(o);if(t){const r=Ar.parse(e,t.start+1);if(r){const s=e.parseNumberAt(r.end+1);if(s){this.Font=[r.value,s.value],o=t.end+1;break}}}}throw new Error("Can't parse /Font property value");case"/D":const u=e.getValueTypeAt(o);if(u!==Ne)throw new Error(`Unsupported /D property value type: ${u}`);{const t=e.getArrayBoundsAt(o);if(t){const r=e.parseNumberArrayAt(t.start+1);if(r){const s=e.parseNumberAt(r.end+1);if(s){this.D=[[r.value[0],r.value[1]],s.value],o=t.end+1;break}}}}throw new Error("Can't parse /D property value");case"/OP":case"/op":case"/SA":case"/AIS":case"/TK":o=this.parseBoolProp(a,e,o);break;case"/LW":case"/ML":case"/FL":case"/SM":case"/CA":case"/ca":o=this.parseNumberProp(a,e,o);break;default:o=e.skipToNextName(o,n-1)}return!0}}class Ur extends vr{constructor(){super(null),this._gsMap=new Map,this._fontsMap=new Map,this._xObjectsMap=new Map}static parse(t){const e=new Ur;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];if(this._gsMap.size){s.push(...r.encode("/ExtGState ")),s.push(...bt.DICT_START);for(const[e,n]of this._gsMap)s.push(...r.encode(e.slice(10)),N),n.ref?s.push(...new Ar(n.ref.id,n.ref.generation).toArray(t)):s.push(...n.toArray(t));s.push(...bt.DICT_END)}if(this._xObjectsMap.size){s.push(...r.encode("/XObject "),...bt.DICT_START);for(const[e,n]of this._xObjectsMap){const a=n.ref;if(!a)throw new Error("XObject has no reference");s.push(...r.encode(e.slice(8)),N),s.push(...new Ar(a.id,a.generation).toArray(t))}s.push(...bt.DICT_END)}this.ColorSpace&&s.push(...r.encode("/ColorSpace "),...this.ColorSpace.toArray(t)),this.Pattern&&s.push(...r.encode("/Pattern "),...this.Pattern.toArray(t)),this.Shading&&s.push(...r.encode("/Shading "),...this.Shading.toArray(t)),this.Font&&s.push(...r.encode("/Font "),...this.Font.toArray(t)),this.Properties&&s.push(...r.encode("/Properties "),...this.Properties.toArray(t)),this.ProcSet&&(s.push(...r.encode("/ProcSet "),et),this.ProcSet.forEach((t=>s.push(N,...r.encode(t)))),s.push(st));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}getGraphicsState(t){return this._gsMap.get(t)}*getGraphicsStates(){for(const t of this._gsMap)yield t}setGraphicsState(t,e){this._gsMap.set(`/ExtGState${t}`,e)}getFont(t){return this._fontsMap.get(t)}*getFonts(){for(const t of this._fontsMap)yield t}getXObject(t){return this._xObjectsMap.get(t)}*getXObjects(){for(const t of this._xObjectsMap)yield t}setXObject(t,e){this._xObjectsMap.set(`/XObject${t}`,e)}fillMaps(t,e){var r;if(this._gsMap.clear(),this._fontsMap.clear(),this._xObjectsMap.clear(),this.ExtGState){for(const[e,r]of this.ExtGState.getObjectIds()){const s=t(r.id);if(!s)continue;const n=Or.parse(s);n&&this._gsMap.set(`/ExtGState${e}`,n.value)}for(const[t,e]of this.ExtGState.getDictParsers()){const r=Or.parse(e);r&&this._gsMap.set(`/ExtGState${t}`,r.value)}}if(this.XObject)for(const[e,s]of this.XObject.getObjectIds()){const n=t(s.id);if(!n)continue;const a=null!==(r=Hr.parse(n))&&void 0!==r?r:Dr.parse(n);a&&this._xObjectsMap.set(`/XObject${e}`,a.value)}if(this.Font)for(const[e,r]of this.Font.getObjectIds()){const s=t(r.id);if(!s)continue;const n=Tr.parse(s);n&&this._fontsMap.set(`/Font${e}`,n.value)}}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/ExtGState":case"/ColorSpace":case"/Pattern":case"/Shading":case"/XObject":case"/Font":case"/Properties":const t=e.getDictBoundsAt(o);if(t){const r=Ir.parse({parser:e,bounds:t});if(r){this[a.slice(1)]=r.value,o=t.end+1;break}}throw new Error(`Can't parse ${a} property value`);case"/ProcSet":o=this.parseNameArrayProp(a,e,o);break;default:o=e.skipToNextName(o,n-1)}return t.parseInfoGetter&&this.fillMaps(t.parseInfoGetter,t.cryptInfo),!0}}class Fr extends vr{constructor(){super(ye),this.Subtype="/RL"}static parse(t){const e=new Fr;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.Subtype&&s.push(...r.encode("/Subtype "),...r.encode(this.Subtype));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Subtype":const t=e.parseNameAt(o);if(!t)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==t.value)return!1;o=t.end+1;break;default:o=e.skipToNextName(o,n-1)}return!0}}class Vr extends vr{constructor(){super(me),this.S="/Transparency"}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.S&&s.push(...r.encode("/S "),...r.encode(this.S));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/S":const t=e.parseNameAt(o,!0);if(!t)throw new Error("Can't parse /S property value");if(!Object.values(xe).includes(t.value))return!1;this.S=t.value,o=t.end+1;break;default:o=e.skipToNextName(o,n-1)}return!0}}class zr extends Vr{constructor(){super(),this.I=!1,this.K=!1}static parse(t){const e=new zr;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.CS&&s.push(...r.encode("/CS "),...r.encode(this.CS)),this.I&&s.push(...r.encode("/I "),...r.encode(" "+this.I)),this.K&&s.push(...r.encode("/K "),...r.encode(" "+this.K));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;if("/Transparency"!==this.S)return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/CS":const t=e.getValueTypeAt(o);if(t===ke){const t=e.parseNameAt(o);if(t){this.CS=t.value,o=t.end+1;break}throw new Error("Can't parse /CS property name")}if(t===Ne){const t=e.getArrayBoundsAt(o);if(t){o=t.end+1;break}throw new Error("Can't parse /CS value dictionary")}throw new Error(`Unsupported /CS property value type: ${t}`);case"/I":case"/K":o=this.parseBoolProp(a,e,o);break;default:o=e.skipToNextName(o,n-1)}return!0}}class Hr extends _r{constructor(){super(he),this.Subtype="/Form",this.FormType=1,this.Matrix=[1,0,0,1,0,0]}get matrix(){const t=new f;if(this.Matrix){const[e,r,s,n,a,i]=this.Matrix;t.set(e,r,0,s,n,0,a,i,1)}return t}set matrix(t){t&&(this.Matrix=[...t.toFloatShortArray()])}get bBox(){return{ll:new l(this.BBox[0],this.BBox[1]),lr:new l(this.BBox[2],this.BBox[1]),ur:new l(this.BBox[2],this.BBox[3]),ul:new l(this.BBox[0],this.BBox[3])}}get transformedBBox(){const t=new f;if(this.Matrix){const[e,r,s,n,a,i]=this.Matrix;t.set(e,r,0,s,n,0,a,i,1)}const e=new l(this.BBox[0],this.BBox[1]),r=new l(this.BBox[2],this.BBox[1]),s=new l(this.BBox[2],this.BBox[3]),n=new l(this.BBox[0],this.BBox[3]);return{ll:l.applyMat3(e,t),lr:l.applyMat3(r,t),ur:l.applyMat3(s,t),ul:l.applyMat3(n,t)}}static parse(t){const e=new Hr;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.Subtype&&s.push(...r.encode("/Subtype "),...r.encode(this.Subtype)),this.FormType&&s.push(...r.encode("/FormType "),...r.encode(" "+this.FormType)),this.BBox&&s.push(...r.encode("/BBox "),et,...r.encode(this.BBox[0]+""),N,...r.encode(this.BBox[1]+""),N,...r.encode(this.BBox[2]+""),N,...r.encode(this.BBox[3]+""),st),this.Matrix&&s.push(...r.encode("/BBox "),et,...r.encode(this.Matrix[0]+""),N,...r.encode(this.Matrix[1]+""),N,...r.encode(this.Matrix[2]+""),N,...r.encode(this.Matrix[3]+""),N,...r.encode(this.Matrix[4]+""),N,...r.encode(this.Matrix[5]+""),st),this.Resources&&s.push(...r.encode("/Resources "),...this.Resources.toArray(t)),this.Metadata&&s.push(...r.encode("/Metadata "),N,...this.Metadata.toArray(t)),this.LastModified&&s.push(...r.encode("/LastModified "),...this.LastModified.toArray(t)),this.StructParent&&s.push(...r.encode("/StructParent "),...r.encode(" "+this.StructParent)),this.StructParents&&s.push(...r.encode("/StructParents "),...r.encode(" "+this.StructParents)),this.Measure&&s.push(...r.encode("/Measure "),...this.Measure.toArray(t)),this.Group&&s.push(...r.encode("/Group "),...this.Group.toArray(t));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;if(this.Type!==he)return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=e.getDictBoundsAt(s);let a,i,o=e.skipToNextName(n.contentStart,n.contentEnd);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Subtype":const r=e.parseNameAt(o);if(!r)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==r.value)return!1;o=r.end+1;break;case"/FormType":const s=e.parseNumberAt(o,!1);if(!s)throw new Error("Can't parse /Subtype property value");if(1!==s.value)return!1;o=s.end+1;break;case"/BBox":case"/Matrix":o=this.parseNumberArrayProp(a,e,o,!0);break;case"/LastModified":o=this.parseDateProp(a,e,o,t.cryptInfo);break;case"/Metadata":o=this.parseRefProp(a,e,o);break;case"/StructParent":case"/StructParents":o=this.parseNumberProp(a,e,o,!1);break;case"/Resources":const i=e.getValueTypeAt(o);if(i===Me){const r=Ar.parseRef(e,o);if(r&&t.parseInfoGetter){const e=t.parseInfoGetter(r.value.id);if(e){const t=Ur.parse(e);if(t){this.Resources=t.value,o=t.end+1;break}}}throw new Error("Can't parse /Resources value reference")}if(i===Ie){const r=e.getDictBoundsAt(o);if(r){if(r.contentStart){const s=Ur.parse({parser:e,bounds:r,parseInfoGetter:t.parseInfoGetter});if(!s)throw new Error("Can't parse /Resources value dictionary");this.Resources=s.value}o=r.end+1;break}throw new Error("Can't parse /Resources dictionary bounds")}throw new Error(`Unsupported /Resources property value type: ${i}`);case"/Measure":const h=e.getValueTypeAt(o);if(h===Me){const r=Ar.parseRef(e,o);if(r&&t.parseInfoGetter){const e=t.parseInfoGetter(r.value.id);if(e){const t=Fr.parse(e);if(t){this.Measure=t.value,o=t.end+1;break}}}throw new Error("Can't parse /Measure value reference")}if(h===Ie){const r=e.getDictBoundsAt(o);if(r){const s=Fr.parse({parser:e,bounds:r,cryptInfo:t.cryptInfo});if(s){this.Measure=s.value,o=s.end+1;break}}throw new Error("Can't parse /Measure value dictionary")}throw new Error(`Unsupported /Measure property value type: ${h}`);case"/Group":const c=e.getValueTypeAt(o);if(c===Me){const r=Ar.parseRef(e,o);if(r&&t.parseInfoGetter){const e=t.parseInfoGetter(r.value.id);if(e){const t=zr.parse(e);if(t){this.Group=t.value,o=t.end+1;break}}}throw new Error("Can't parse /Group value reference")}if(c===Ie){const r=e.getDictBoundsAt(o);if(r){const s=zr.parse({parser:e,bounds:r,cryptInfo:t.cryptInfo});if(s){this.Group=s.value,o=s.end+1;break}}throw new Error("Can't parse /Group value dictionary")}throw new Error(`Unsupported /Group property value type: ${c}`);case"/OC":case"/OPI":default:o=e.skipToNextName(o,n.contentEnd)}return!!this.BBox}}class Wr extends vr{constructor(){super(null),this._streamsMap=new Map}static parse(t){const e=new Wr;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}getStream(t){return this._streamsMap.get(t)}*getStreams(){for(const t of this._streamsMap)yield t[1]}setStream(t,e){return this._streamsMap.set(t,e)}clearStreams(){this._streamsMap.clear()}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.N&&(s.push(...r.encode("/N ")),this.N,s.push(...this.N.toArray(t))),this.R&&(s.push(...r.encode("/R ")),this.R,s.push(...this.R.toArray(t))),this.D&&(s.push(...r.encode("/D ")),this.D,s.push(...this.D.toArray(t)));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}fillStreamsMap(t){this._streamsMap.clear();for(const e of["N","R","D"])if(this[e])if(this[e]instanceof Ar){const r=t(this[e].id);if(!r)continue;const s=Hr.parse(r);if(!s)continue;s&&this._streamsMap.set(`/${e}`,s.value)}else for(const[r,s]of this[e].getProps()){const n=t(s.id);if(!n)continue;const a=Hr.parse(n);a&&this._streamsMap.set(`/${e}${r}`,a.value)}}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/N":const t=e.getValueTypeAt(o);if(t===Me){const t=Ar.parseRef(e,o);if(t){this.N=t.value,o=t.end+1;break}}else{if(t!==Ie)throw new Error(`Unsupported /N property value type: ${t}`);{const t=e.getDictBoundsAt(o);if(t){const r=Ir.parse({parser:e,bounds:t});if(r){this.N=r.value,o=r.end+1;break}}}}throw new Error("Can't parse /N property value");case"/R":const r=e.getValueTypeAt(o);if(r===Me){const t=Ar.parseRef(e,o);if(t){this.R=t.value,o=t.end+1;break}}else{if(r!==Ie)throw new Error(`Unsupported /R property value type: ${r}`);{const t=e.getDictBoundsAt(o);if(t){const r=Ir.parse({parser:e,bounds:t});if(r){this.R=r.value,o=r.end+1;break}}}}throw new Error("Can't parse /R property value");case"/D":const s=e.getValueTypeAt(o);if(s===Me){const t=Ar.parseRef(e,o);if(t){this.D=t.value,o=t.end+1;break}}else{if(s!==Ie)throw new Error(`Unsupported /D property value type: ${s}`);{const t=e.getDictBoundsAt(o);if(t){const r=Ir.parse({parser:e,bounds:t});if(r){this.D=r.value,o=r.end+1;break}}}}throw new Error("Can't parse /D property value");default:o=e.skipToNextName(o,n-1)}return!!this.N&&(t.parseInfoGetter&&this.fillStreamsMap(t.parseInfoGetter),!0)}}const Gr={NONE:"/S",CLOUDY:"/C"};class Qr extends vr{constructor(){super(null),this.S=Gr.NONE,this.L=0}static parse(t){const e=new Qr;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.S&&s.push(...r.encode("/S "),...r.encode(this.S)),this.L&&s.push(...r.encode("/L "),...r.encode(" "+this.L));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/S":const t=e.parseNameAt(o,!0);if(!t||!Object.values(Gr).includes(t.value))throw new Error("Can't parse /S property value");this.S=t.value,o=t.end+1;break;case"/L":o=this.parseNumberProp(a,e,o,!0);break;default:o=e.skipToNextName(o,n-1)}return!0}}class jr{constructor(t,e,r,s,n){this.hCornerR=null!=t?t:0,this.vCornerR=null!=e?e:0,this.width=null!=r?r:1,this.dash=null!=s?s:3,this.gap=null!=n?n:0}static parse(t,e,r=!0){if(r&&(e=t.findRegularIndex("straight",e)),e<0||e>t.maxIndex||t.getCharCode(e)!==et)return null;const s=t.parseNumberAt(e+1);if(!s||isNaN(s.value))return null;const n=t.parseNumberAt(s.end+2);if(!n||isNaN(n.value))return null;const a=t.parseNumberAt(n.end+2);if(!a||isNaN(a.value))return null;const i=t.findNonSpaceIndex("straight",a.end+1);if(!i)return null;if(t.getCharCode(i)===st)return{value:new jr(s.value,n.value,a.value),start:e,end:i};if(t.getCharCode(i)===et){const r=t.parseNumberAt(i+1);if(!r||isNaN(r.value))return null;const o=t.parseNumberAt(r.end+2);if(!o||isNaN(o.value))return null;const h=t.findNonSpaceIndex("straight",o.end+1);if(!h||t.getCharCode(h)!==st)return null;const c=t.findNonSpaceIndex("straight",h+1);return c&&t.getCharCode(c)===st?{value:new jr(s.value,n.value,a.value,r.value,o.value),start:e,end:c}:null}return null}toArray(t){const e=this.dash&&this.gap?`[${this.hCornerR} ${this.vCornerR} ${this.width}]`:`[${this.hCornerR} ${this.vCornerR} ${this.width} [${this.dash} ${this.gap}]]`;return(new TextEncoder).encode(e)}}class Kr{constructor(t){Object.assign(this,Kr.defaultParams,t)}clone(t){const e=new Kr(this);return t?Object.assign(e,t):e}}Kr.defaultParams={fontFamily:"helvetica, sans-serif",fontSize:"12px",lineHeight:"1",letterSpacing:"normal",wordSpacing:"normal",textHorScale:1,textRenderMode:0,textVertAlign:"0",textKnockOut:!0};class Xr{constructor(t){var e,r,s,n;Object.assign(this,Xr.defaultParams,t),this.matrix=null===(e=this.matrix)||void 0===e?void 0:e.clone(),this.textState=null===(r=this.textState)||void 0===r?void 0:r.clone(),this.strokeColor=null===(s=this.strokeColor)||void 0===s?void 0:s.clone(),this.fillColor=null===(n=this.fillColor)||void 0===n?void 0:n.clone()}get stroke(){const{x:t,y:e,z:r}=this.strokeColor;return`rgba(${t},${e},${r},${this.strokeAlpha})`}get fill(){const{x:t,y:e,z:r}=this.fillColor;return`rgba(${t},${e},${r},${this.fillAlpha})`}clone(t){const e=new Xr(this);return t?Object.assign(e,t):e}setColor(t,...e){let r,s,n;switch(e.length){case 1:r=s=n=255*e[0];break;case 3:r=255*e[0],s=255*e[1],n=255*e[2];break;case 4:const[t,a,i,o]=e;r=255*(1-t)*(1-o),s=255*(1-a)*(1-o),n=255*(1-i)*(1-o)}"stroke"===t?this.strokeColor.set(r,s,n):this.fillColor.set(r,s,n)}}Xr.defaultParams={matrix:new f,textState:new Kr,strokeColorSpace:"rgb",strokeAlpha:1,strokeColor:new p,fillColorSpace:"rgb",fillAlpha:1,fillColor:new p,strokeWidth:1,strokeMiterLimit:10,strokeLineCap:"square",strokeLineJoin:"miter"};var qr=function(t,e,r,s){return new(r||(r=Promise))((function(n,a){function i(t){try{h(s.next(t))}catch(t){a(t)}}function o(t){try{h(s.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,o)}h((s=s.apply(t,e||[])).next())}))};class Yr{constructor(t,e,r){if(this._clipPaths=[],this._graphicsStates=[],!t)throw new Error("Stream is not defined");this._stream=t,this._parser=new Nr(t.decodedStreamData),this._rect=e,this._objectName=r;const s=Yr.calcBBoxToRectMatrix(t,e),n=document.createElementNS("http://www.w3.org/2000/svg","clipPath");n.id=`clip0_${r}`,n.innerHTML=`<rect x="${e[0]}" y="${e[1]}" width="${e[2]-e[0]}" height="${e[3]-e[1]}" />`,this._clipPaths.push(n),this._graphicsStates.push(new Xr({matrix:s}))}get state(){return this._graphicsStates[this._graphicsStates.length-1]}static calcBBoxToRectMatrix(t,e){const r=t.matrix,{ll:s,lr:n,ur:a,ul:i}=t.bBox,{min:o,max:h}=g(l.applyMat3(s,r),l.applyMat3(n,r),l.applyMat3(a,r),l.applyMat3(i,r)),c=y(o,h,new l(e[0],e[1]),new l(e[2],e[3]));return f.fromMat3(r).multiply(c)}static parseNextCommand(t,e){const r=[];let s;t:for(;!s;){const n=t.getValueTypeAt(e,!0);switch(n){case _e:const a=t.parseNumberAt(e,!0);r.push(a.value),e=a.end+1;break;case ke:const i=t.parseNameAt(e,!0);r.push(i.value),e=i.end+1;break;case Ne:const o=t.getArrayBoundsAt(e),h=t.parseNumberArrayAt(e,!0);if(!h)throw new Error(`Invalid appearance stream array: \n            ${t.sliceChars(o.start,o.end)}`);{const t=h.value;2===t.length?r.push(...t):1===t.length?r.push(t[0],0):r.push(3,0)}e=o.end+1;break;case Ce:const c=gr.parse(t,e);r.push(c.value.literal),e=c.end+1;break;case Se:const d=Br.parse(t,e);r.push(d.value.hex),e=d.end+1;break;case Ee:const u=t.parseStringAt(e);s=u.value,e=u.end+1;break t;default:throw new Error(`Invalid appearance stream value type: ${n}`)}}return{endIndex:e,parameters:r,operator:s}}renderAsync(){return qr(this,void 0,void 0,(function*(){return{svg:yield this.drawGroupAsync(this._parser),clipPaths:this._clipPaths}}))}pushState(t){const e=this._graphicsStates[this._graphicsStates.length-1].clone(t);this._graphicsStates.push(e)}popState(){return 1===this._graphicsStates.length?null:this._graphicsStates.pop()}drawPath(t,e,r,s=!1,n=!1){s&&"Z"!==t[t.length-1]&&(t+=" Z");const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("transform",`matrix(${this.state.matrix.toFloatShortArray().join(" ")})`),a.setAttribute("clipPath",`url(#${this._clipPaths[this._clipPaths.length-1].id})`),a.setAttribute("d",t),this.state.mixBlendMode&&a.setAttribute("mix-blend-mode",this.state.mixBlendMode),r?(a.setAttribute("fill",this.state.fill),a.setAttribute("fill-rule",n?"evenodd":"nonzero")):a.setAttribute("fill","none"),e?(a.setAttribute("stroke",this.state.stroke),a.setAttribute("stroke-width",this.state.strokeWidth+""),a.setAttribute("stroke-miterlimit",this.state.strokeMiterLimit+""),a.setAttribute("stroke-linecap",this.state.strokeLineCap),a.setAttribute("stroke-linejoin",this.state.strokeLineJoin),this.state.strokeDashArray&&a.setAttribute("stroke-dasharray",this.state.strokeDashArray),this.state.strokeDashOffset&&a.setAttribute("stroke-dashoffset",this.state.strokeDashOffset+"")):a.setAttribute("stroke","none"),a}drawText(t){throw new Error("Method is not implemented")}drawTextGroup(t){const e=document.createElementNS("http://www.w3.org/2000/svg","g");let r=0;for(;-1!==r;){const{endIndex:e,parameters:s,operator:n}=Yr.parseNextCommand(t,r);r=t.skipEmpty(e+1)}return e}drawGroupAsync(t){return qr(this,void 0,void 0,(function*(){const e=document.createElementNS("http://www.w3.org/2000/svg","g"),r=new l;let s,n="";const a=t=>{e.append(t),n=""};let i=0;for(;-1!==i;){const{endIndex:o,parameters:h,operator:c}=Yr.parseNextCommand(t,i);switch(i=t.skipEmpty(o+1),c){case"q":this.pushState();break;case"Q":this.popState();break;case"gs":const o=this._stream.Resources.getGraphicsState(`/ExtGState${h[0]}`);if(!o)throw new Error("External state specified in appearance stream not found");const d=o.toParams();Object.assign(this.state,d);break;case"cm":const[u,p,y,g,A,w]=h,m=(new f).set(u,p,0,y,g,0,A,w,1);this.state.matrix=m.multiply(this.state.matrix);break;case"w":this.state.strokeWidth=+h[0]||1;break;case"J":switch(h[0]){case Xe.ROUND:this.state.strokeLineCap="round";break;case Xe.SQUARE:this.state.strokeLineCap="square";break;case Xe.BUTT:default:this.state.strokeLineCap="butt"}break;case"j":switch(h[0]){case qe.BEVEL:this.state.strokeLineJoin="bevel";break;case qe.ROUND:this.state.strokeLineJoin="round";break;case qe.MITER:default:this.state.strokeLineJoin="miter"}break;case"M":this.state.strokeMiterLimit=+h[0]||10;break;case"d":this.state.strokeDashArray=`${h[0]} ${h[1]}`,this.state.strokeDashOffset=+h[2];break;case"CS":switch(h[0]){case Ze:this.state.strokeColorSpace="grayscale";break;case $e:this.state.strokeColorSpace="rgb";break;case tr:this.state.strokeColorSpace="cmyk";break;default:throw new Error("Unsupported color space in appearance stream")}break;case"cs":switch(h[0]){case Ze:this.state.fillColorSpace="grayscale";break;case $e:this.state.fillColorSpace="rgb";break;case tr:this.state.fillColorSpace="cmyk";break;default:throw new Error("Unsupported color space in appearance stream")}break;case"G":this.state.strokeColorSpace="grayscale",this.state.setColor("stroke",...h);break;case"g":this.state.fillColorSpace="grayscale",this.state.setColor("fill",...h);break;case"RG":this.state.strokeColorSpace="rgb",this.state.setColor("stroke",...h);break;case"rg":this.state.fillColorSpace="rgb",this.state.setColor("fill",...h);break;case"K":this.state.strokeColorSpace="cmyk",this.state.setColor("stroke",...h);break;case"k":this.state.fillColorSpace="cmyk",this.state.setColor("fill",...h);break;case"SC":this.state.setColor("stroke",...h);break;case"cs":this.state.setColor("fill",...h);break;case"ri":case"i":break;case"m":const v=new l(+h[0],+h[1]);n+=` M ${v.x} ${v.y}`,r.setFromVec2(v);break;case"l":const b=new l(+h[0],+h[1]);n+=` L ${b.x} ${b.y}`,r.setFromVec2(b);break;case"re":const x=new l(+h[0],+h[1]),E=new l(+h[2],+h[3]).add(x);n+=` M ${x.x} ${x.y} L ${E.x} ${x.y} L ${E.x} ${E.y} L ${x.x} ${E.y} L ${x.x} ${x.y}`,r.setFromVec2(x);break;case"c":const P=new l(+h[0],+h[1]),_=new l(+h[2],+h[3]),C=new l(+h[4],+h[5]);n+=` C ${P.x} ${P.y}, ${_.x} ${_.y}, ${C.x} ${C.y}`,r.setFromVec2(C);break;case"v":const S=new l(+h[0],+h[1]),k=new l(+h[2],+h[3]);n+=` C ${r.x} ${r.y}, ${S.x} ${S.y}, ${k.x} ${k.y}`,r.setFromVec2(k);break;case"y":const N=new l(+h[0],+h[1]),I=new l(+h[2],+h[3]);n+=` C ${N.x} ${N.y}, ${I.x} ${I.y}, ${I.x} ${I.y}`,r.setFromVec2(I);break;case"h":n+=" Z";break;case"S":a(this.drawPath(n,!0,!1));break;case"s":a(this.drawPath(n,!0,!1,!0));break;case"F":case"f":a(this.drawPath(n,!1,!0,!0));break;case"F*":case"f*":a(this.drawPath(n,!1,!0,!0,!0));break;case"B":a(this.drawPath(n,!0,!0,!1,!1));break;case"B*":a(this.drawPath(n,!0,!0,!1,!0));break;case"b":a(this.drawPath(n,!0,!0,!0,!1));break;case"b*":a(this.drawPath(n,!0,!0,!0,!0));break;case"n":if("W"===s||"W*"===s){"Z"!==n[n.length-1]&&(n+=" Z");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",n);const e=this._clipPaths.length-1,r=document.createElementNS("http://www.w3.org/2000/svg","clipPath");r.setAttribute("clip-rule","W"===s?"nonzero":"evenodd"),r.setAttribute("clip-path",`url(#${this._clipPaths[e]})`),r.id=`clip${e+1}_${this._objectName}`,r.append(t),this._clipPaths.push(r),this.state.clipPath=r}n="";break;case"W":case"W*":break;case"BT":const B=t.findSubarrayIndex([X,$],{closedOnly:!0,minIndex:i});if(B){const r=this.drawTextGroup(new Nr(t.sliceCharCodes(i,B.start-1)));e.append(r),i=t.skipEmpty(B.end+1);break}throw new Error("Can't find the appearance stream text object end");case"Do":const M=this._stream.Resources.getXObject(`/XObject${h[0]}`);if(!M)throw new Error(`External object not found in the appearance stream resources: ${h[0]}`);if(M instanceof Hr){const t=yield this.drawGroupAsync(new Nr(M.decodedStreamData));e.append(t)}else{if(!(M instanceof Dr))throw new Error(`Unsupported appearance stream external object: ${h[0]}`);{const t=yield M.getImageUrlAsync();if(!t)throw new Error("Can't get image url from external image stream");const r=document.createElementNS("http://www.w3.org/2000/svg","image");r.onerror=t=>{console.log(`Loading external image stream failed: ${t}`)},r.setAttribute("href",t),r.setAttribute("width",M.Width+""),r.setAttribute("height",M.Height+"");const s=(new f).applyTranslation(-M.Width/2,-M.Height/2).applyScaling(1,-1).applyTranslation(M.Width/2,M.Height/2).applyScaling(1/M.Width,1/M.Height).multiply(this.state.matrix);r.setAttribute("transform",`matrix(${s.toFloatShortArray().join(" ")})`),r.setAttribute("clipPath",`url(#${this._clipPaths[this._clipPaths.length-1].id})`),e.append(r)}}break;default:throw new Error(`Unsupported appearance stream operator: ${c}`)}s=c}return e}))}}var Jr=function(t,e,r,s){return new(r||(r=Promise))((function(n,a){function i(t){try{h(s.next(t))}catch(t){a(t)}}function o(t){try{h(s.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,o)}h((s=s.apply(t,e||[])).next())}))};class Zr extends vr{constructor(t){super(pe),this.F=0,this.Border=new jr(0,0,1),this._transformationMatrix=new f,this._transformationPoint=new l,this._currentAngle=0,this._boxX=new l,this._boxY=new l,this._svgId=o(),this.onRectPointerDown=t=>{document.addEventListener("pointerup",this.onRectPointerUp),document.addEventListener("pointerout",this.onRectPointerUp),this._transformationTimer=setTimeout((()=>{this._transformationTimer=null,this._svg.after(this._svgContentCopy),this._transformationPoint.setFromVec2(this.convertClientCoordsToPage(t.clientX,t.clientY)),document.addEventListener("pointermove",this.onRectPointerMove)}),200)},this.onRectPointerMove=t=>{const e=this.convertClientCoordsToPage(t.clientX,t.clientY);this._transformationMatrix.reset().applyTranslation(e.x-this._transformationPoint.x,e.y-this._transformationPoint.y),this._svgContentCopyUse.setAttribute("transform",`matrix(${this._transformationMatrix.toFloatShortArray().join(" ")})`)},this.onRectPointerUp=()=>{if(document.removeEventListener("pointermove",this.onRectPointerMove),document.removeEventListener("pointerup",this.onRectPointerUp),document.removeEventListener("pointerout",this.onRectPointerUp),this._transformationTimer)return clearTimeout(this._transformationTimer),void(this._transformationTimer=null);this._svgContentCopy.remove(),this._svgContentCopyUse.setAttribute("transform","matrix(1 0 0 1 0 0)"),this.applyRectTransform(this._transformationMatrix),this._transformationMatrix.reset(),this.updateRenderAsync()},this.onRotationHandlePointerDown=t=>{document.addEventListener("pointerup",this.onRotationHandlePointerUp),document.addEventListener("pointerout",this.onRotationHandlePointerUp),this._transformationTimer=setTimeout((()=>{this._transformationTimer=null,this._svg.after(this._svgContentCopy),document.addEventListener("pointermove",this.onRotationHandlePointerMove)}),200),t.stopPropagation()},this.onRotationHandlePointerMove=t=>{const e=(this.Rect[0]+this.Rect[2])/2,r=(this.Rect[1]+this.Rect[3])/2,s=this.convertPageCoordsToClient(e,r),n=this.getCurrentRotation(),a=Math.atan2(t.clientY-s.y,t.clientX-s.x)+Math.PI/2-n;this._currentAngle=a,this._transformationMatrix.reset().applyTranslation(-e,-r).applyRotation(a).applyTranslation(e,r),this._svgContentCopyUse.setAttribute("transform",`matrix(${this._transformationMatrix.toFloatShortArray().join(" ")})`)},this.onRotationHandlePointerUp=t=>{if(document.removeEventListener("pointermove",this.onRotationHandlePointerMove),document.removeEventListener("pointerup",this.onRotationHandlePointerUp),document.removeEventListener("pointerout",this.onRotationHandlePointerUp),this._transformationTimer)return clearTimeout(this._transformationTimer),void(this._transformationTimer=null);this._svgContentCopy.remove(),this._svgContentCopyUse.setAttribute("transform","matrix(1 0 0 1 0 0)"),this.applyRectTransform(this._transformationMatrix),this._transformationMatrix.reset(),this.updateRenderAsync()},this.onScaleHandlePointerDown=t=>{document.addEventListener("pointerup",this.onScaleHandlePointerUp),document.addEventListener("pointerout",this.onScaleHandlePointerUp);const e=t.target,{ll:r,lr:s,ur:n,ul:a}=this.getLocalBB(),i=e.dataset.handleName;switch(i){case"ll":this._transformationPoint.setFromVec2(n),this._boxX.setFromVec2(a).substract(n),this._boxY.setFromVec2(s).substract(n);break;case"lr":this._transformationPoint.setFromVec2(a),this._boxX.setFromVec2(n).substract(a),this._boxY.setFromVec2(r).substract(a);break;case"ur":this._transformationPoint.setFromVec2(r),this._boxX.setFromVec2(s).substract(r),this._boxY.setFromVec2(a).substract(r);break;case"ul":this._transformationPoint.setFromVec2(s),this._boxX.setFromVec2(r).substract(s),this._boxY.setFromVec2(n).substract(s);break;default:throw new Error(`Invalid handle name: ${i}`)}this._boxXLength=this._boxX.getMagnitude(),this._boxYLength=this._boxY.getMagnitude(),this._transformationTimer=setTimeout((()=>{this._transformationTimer=null,this._svg.after(this._svgContentCopy),document.addEventListener("pointermove",this.onScaleHandlePointerMove)}),200),t.stopPropagation()},this.onScaleHandlePointerMove=t=>{const e=this.convertClientCoordsToPage(t.clientX,t.clientY).substract(this._transformationPoint),r=e.getMagnitude(),s=Math.abs(e.dotProduct(this._boxX))/r/this._boxXLength*r,n=Math.sqrt(r*r-s*s),a=s/this._boxXLength,i=n/this._boxYLength,o=(this.Rect[0]+this.Rect[2])/2,h=(this.Rect[1]+this.Rect[3])/2,c=this.getCurrentRotation();this._transformationMatrix.reset().applyTranslation(-o,-h).applyRotation(-c).applyScaling(a,i).applyRotation(c).applyTranslation(o,h);const d=this._transformationPoint.clone().substract(this._transformationPoint.clone().applyMat3(this._transformationMatrix));this._transformationMatrix.applyTranslation(d.x,d.y),this._svgContentCopyUse.setAttribute("transform",`matrix(${this._transformationMatrix.toFloatShortArray().join(" ")})`)},this.onScaleHandlePointerUp=t=>{if(document.removeEventListener("pointermove",this.onScaleHandlePointerMove),document.removeEventListener("pointerup",this.onScaleHandlePointerUp),document.removeEventListener("pointerout",this.onScaleHandlePointerUp),this._transformationTimer)return clearTimeout(this._transformationTimer),void(this._transformationTimer=null);this._svgContentCopy.remove(),this._svgContentCopyUse.setAttribute("transform","matrix(1 0 0 1 0 0)"),this.applyRectTransform(this._transformationMatrix),this._transformationMatrix.reset(),this.updateRenderAsync()},this.Subtype=t}get apStream(){var t;return this._apStream||(this._apStream=[...null===(t=this.AP)||void 0===t?void 0:t.getStreams()][0]),this._apStream}set apStream(t){this._apStream=t}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];if(this.Subtype&&s.push(...r.encode("/Subtype "),...r.encode(this.Subtype)),this.Rect&&s.push(...r.encode("/Rect "),et,...r.encode(this.Rect[0]+""),N,...r.encode(this.Rect[1]+""),N,...r.encode(this.Rect[2]+""),N,...r.encode(this.Rect[3]+""),st),this.Contents&&s.push(...r.encode("/Contents "),...this.Contents.toArray(t)),this.P&&s.push(...r.encode("/P "),N,...this.P.toArray(t)),this.NM&&s.push(...r.encode("/NM "),...this.NM.toArray(t)),this.M&&s.push(...r.encode("/M "),...this.M.toArray(t)),this.F&&s.push(...r.encode("/F "),...r.encode(" "+this.F)),this.AS&&s.push(...r.encode("/AS "),...r.encode(this.AS)),this.Border&&s.push(...r.encode("/Border "),...this.Border.toArray(t)),this.BS&&s.push(...r.encode("/BS "),...this.BS.toArray(t)),this.BE&&s.push(...r.encode("/BE "),...this.BE.toArray(t)),this.C&&(s.push(...r.encode("/C "),et),this.C.forEach((t=>s.push(...r.encode(" "+t)))),s.push(st)),this.StructParent&&s.push(...r.encode("/StructParent "),...r.encode(" "+this.StructParent)),this.apStream){this.AP||(this.AP=new Wr);const e=this.apStream.ref;if(!e)throw new Error("Appearance stream has no reference");this.AP.N=new Ar(e.id,e.generation),this.AP.R=null,this.AP.D=null,this.AP.clearStreams(),this.AP.setStream("/N",this.apStream),s.push(...r.encode("/AP "),...this.AP.toArray(t))}const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}render(){return this._svg||(this._svg=this.renderMainElement()),this.updateRenderAsync(),{svg:this._svg,clipPaths:this._svgClipPaths}}tryParseProps(t){var e;if(!super.tryParseProps(t))return!1;const{parser:r,bounds:s}=t,n=s.contentStart||s.start,a=s.contentEnd||s.end;let i,h,c=r.skipToNextName(n,a-1);if(-1===c)return!1;for(;h=r.parseNameAt(c),h;)switch(c=h.end+1,i=h.value,i){case"/Subtype":const e=r.parseNameAt(c);if(!e)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==e.value)return!1;c=e.end+1;break;case"/Rect":c=this.parseNumberArrayProp(i,r,c,!0);break;case"/P":c=this.parseRefProp(i,r,c);break;case"/Contents":case"/NM":c=this.parseLiteralProp(i,r,c,t.cryptInfo);break;case"/M":const s=wr.parse(r,c,t.cryptInfo);if(s){this.M=s.value,c=s.end+1;break}{const e=gr.parse(r,c,t.cryptInfo);if(e){this.M=e.value,c=e.end+1;break}}throw new Error("Can't parse /M property value");case"/C":c=this.parseNumberArrayProp(i,r,c,!0);break;case"/F":case"/StructParent":c=this.parseNumberProp(i,r,c,!1);break;case"/Border":const n=jr.parse(r,c);if(!n)throw new Error("Can't parse /Border property value");this.Border=n.value,c=n.end+1;break;case"/BS":const o=r.getValueTypeAt(c);if(o===Me){const e=Ar.parseRef(r,c);if(e&&t.parseInfoGetter){const r=t.parseInfoGetter(e.value.id);if(r){const t=kr.parse(r);if(t){this.BS=t.value,c=t.end+1;break}}}throw new Error("Can't parse /BS value reference")}if(o===Ie){const t=r.getDictBoundsAt(c);if(t){const e=kr.parse({parser:r,bounds:t});if(e){this.BS=e.value,c=e.end+1;break}}throw new Error("Can't parse /BS value dictionary")}throw new Error(`Unsupported /BS property value type: ${o}`);case"/BE":const h=r.getValueTypeAt(c);if(h===Me){const e=Ar.parseRef(r,c);if(e&&t.parseInfoGetter){const r=t.parseInfoGetter(e.value.id);if(r){const t=Qr.parse(r);if(t){this.BE=t.value,c=t.end+1;break}}}throw new Error("Can't parse /BE value reference")}if(h===Ie){const t=r.getDictBoundsAt(c);if(t){const e=Qr.parse({parser:r,bounds:t});if(e){this.BE=e.value,c=e.end+1;break}}throw new Error("Can't parse /BE value dictionary")}throw new Error(`Unsupported /BE property value type: ${h}`);case"/AP":const d=r.getValueTypeAt(c);if(d===Me){const e=Ar.parseRef(r,c);if(e&&t.parseInfoGetter){const r=t.parseInfoGetter(e.value.id);if(r){const t=Wr.parse(r);if(t){this.AP=t.value,c=t.end+1;break}}}throw new Error("Can't parse /AP value reference")}if(d===Ie){const e=r.getDictBoundsAt(c);if(e){const s=Wr.parse({parser:r,bounds:e,parseInfoGetter:t.parseInfoGetter});if(s){this.AP=s.value,c=s.end+1;break}}throw new Error("Can't parse /AP value dictionary")}throw new Error(`Unsupported /AP property value type: ${d}`);case"/AS":c=this.parseNameProp(i,r,c);break;case"/OC":default:c=r.skipToNextName(c,a-1)}return!(!this.Subtype||!this.Rect)&&(this.name=(null===(e=this.NM)||void 0===e?void 0:e.literal)||o(),this.pageRect=t.rect,!0)}applyRectTransform(t){const e=this.getLocalBB();e.ll.applyMat3(t),e.lr.applyMat3(t),e.ur.applyMat3(t),e.ul.applyMat3(t);const{min:r,max:s}=g(e.ll,e.lr,e.ur,e.ul);this.Rect=[r.x,r.y,s.x,s.y];const n=this.apStream;if(n){const e=n.matrix.multiply(t);this.apStream.matrix=e}}getCurrentRotation(){var t;const e=null===(t=this.apStream)||void 0===t?void 0:t.matrix;if(!e)return 0;const{r:r}=e.getTRS();return r}getLocalBB(){let t,e,r,s;if(this._bBox)t=this._bBox.ll,e=this._bBox.lr,r=this._bBox.ur,s=this._bBox.ul;else if(this.apStream){const{ll:n,lr:a,ur:i,ul:o}=this.apStream.transformedBBox,{min:h,max:c}=g(n,a,i,o),d=y(h,c,new l(this.Rect[0],this.Rect[1]),new l(this.Rect[2],this.Rect[3]),!0);t=n.applyMat3(d),e=a.applyMat3(d),r=i.applyMat3(d),s=o.applyMat3(d)}else t=new l(this.Rect[0],this.Rect[1]),e=new l(this.Rect[2],this.Rect[1]),r=new l(this.Rect[2],this.Rect[3]),s=new l(this.Rect[0],this.Rect[3]);return this._bBox={ll:t,lr:e,ur:r,ul:s},this._bBox}convertClientCoordsToPage(t,e){const{x:r,y:s,width:n,height:a}=this._svgBox.getBoundingClientRect(),i=new l(r,s),o=(new l(r+n,s+a).x-i.x)/(this.Rect[2]-this.Rect[0]),h=new l(r-this.Rect[0]*o,s+a+this.Rect[1]*o);return new l((t-h.x)/o,(h.y-e)/o)}convertPageCoordsToClient(t,e){const{x:r,y:s,width:n,height:a}=this._svgBox.getBoundingClientRect(),i=new l(r,s),o=(new l(r+n,s+a).x-i.x)/(this.Rect[2]-this.Rect[0]),h=new l(r-this.Rect[0]*o,s+a+this.Rect[1]*o);return new l(h.x+t*o,h.y-e*o)}renderRect(){const t=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.classList.add("svg-annot-rect"),t.setAttribute("data-annotation-name",this.name),t.setAttribute("x",this.Rect[0]+""),t.setAttribute("y",this.Rect[1]+""),t.setAttribute("width",this.Rect[2]-this.Rect[0]+""),t.setAttribute("height",this.Rect[3]-this.Rect[1]+""),t}renderBox(){const{ll:t,lr:e,ur:r,ul:s}=this.getLocalBB(),n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.classList.add("svg-annot-box"),n.setAttribute("data-annotation-name",this.name),n.setAttribute("d",`M ${t.x} ${t.y} L ${e.x} ${e.y} L ${r.x} ${r.y} L ${s.x} ${s.y} Z`),n}renderMainElement(){const t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.classList.add("svg-annotation"),t.setAttribute("data-annotation-name",this.name),t.addEventListener("pointerdown",this.onRectPointerDown),t}renderApAsync(){return Jr(this,void 0,void 0,(function*(){const t=this.apStream;if(t)try{const e=new Yr(t,this.Rect,this.name);return yield e.renderAsync()}catch(t){console.log(`Annotation stream render error: ${t.message}`)}return null}))}renderContent(){return null}renderContentCopy(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","defs"),r=document.createElementNS("http://www.w3.org/2000/svg","symbol");r.id=this._svgId+"_symbol";const s=document.createElementNS("http://www.w3.org/2000/svg","use");s.setAttribute("href",`#${this._svgId}`),s.setAttribute("viewBox",`${this.pageRect[0]} ${this.pageRect[1]} ${this.pageRect[2]} ${this.pageRect[3]}`),r.append(s),e.append(r);const n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttribute("href",`#${this._svgId}_symbol`),n.setAttribute("opacity","0.2"),t.append(e,n),{copy:t,use:n}}renderScaleHandles(){const t=this.getLocalBB(),e=[];return["ll","lr","ur","ul"].forEach((r=>{const s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.classList.add("svg-annot-handle-scale"),s.setAttribute("data-handle-name",r),s.setAttribute("cx",t[r].x+""),s.setAttribute("cy",t[r].y+""),s.addEventListener("pointerdown",this.onScaleHandlePointerDown),e.push(s)})),e}renderRotationHandle(){const t=(this.Rect[0]+this.Rect[2])/2,e=(this.Rect[1]+this.Rect[3])/2,r=this.getCurrentRotation(),s=document.createElementNS("http://www.w3.org/2000/svg","g");s.classList.add("svg-annot-rotation"),s.setAttribute("data-handle-name","center");const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.classList.add("circle","dashed"),n.setAttribute("cx",t+""),n.setAttribute("cy",e+"");const a=(new f).applyTranslation(-t,35-e).applyRotation(r).applyTranslation(t,e),i=new l(t,e).applyMat3(a),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.classList.add("dashed"),o.setAttribute("x1",t+""),o.setAttribute("y1",e+""),o.setAttribute("x2",i.x+""),o.setAttribute("y2",i.y+"");const h=document.createElementNS("http://www.w3.org/2000/svg","circle");return h.classList.add("svg-annot-handle-rotation"),h.setAttribute("data-handle-name","center"),h.setAttribute("cx",i.x+""),h.setAttribute("cy",i.y+""),h.addEventListener("pointerdown",this.onRotationHandlePointerDown),s.append(n,o,h),s}renderHandles(){return[...this.renderScaleHandles(),this.renderRotationHandle()]}updateRenderAsync(){return Jr(this,void 0,void 0,(function*(){this._svg.innerHTML="";const t=this.renderContent()||(yield this.renderApAsync());if(!t)return this._svgBox=null,this._svgContent=null,this._svgContentCopy=null,this._svgContentCopyUse=null,void(this._svgClipPaths=null);const e=t.svg;e.id=this._svgId,e.classList.add("svg-annotation-content"),e.setAttribute("data-annotation-name",this.name);const{copy:r,use:s}=this.renderContentCopy(),n=this.renderRect(),a=this.renderBox(),i=this.renderHandles();this._svg.append(n,a,t.svg,...i),this._svgBox=a,this._svgContent=e,this._svgContentCopy=r,this._svgContentCopyUse=s,this._svgClipPaths=t.clipPaths}))}}const $r={REPLY:"/R",GROUP:"/Group"};class ts extends Zr{constructor(t){super(t),this.RT=$r.REPLY}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.T&&s.push(...r.encode("/T "),...this.T.toArray(t)),this.Popup&&s.push(...r.encode("/Popup "),N,...this.Popup.toArray(t)),this.RC&&s.push(...r.encode("/RC "),...this.RC.toArray(t)),this.CA&&s.push(...r.encode("/CA "),...r.encode(" "+this.CA)),this.CreationDate&&s.push(...r.encode("/CreationDate "),...this.CreationDate.toArray(t)),this.Subj&&s.push(...r.encode("/Subj "),...this.Subj.toArray(t)),this.IRT&&s.push(...r.encode("/IRT "),N,...this.IRT.toArray(t)),this.RT&&s.push(...r.encode("/RT "),...r.encode(this.RT));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/T":case"/Subj":o=this.parseLiteralProp(a,e,o,t.cryptInfo);break;case"/Popup":case"/IRT":o=this.parseRefProp(a,e,o);break;case"/RC":const r=e.getValueTypeAt(o);if(r===Me){const r=Ar.parseRef(e,o);if(r&&t.parseInfoGetter){const e=t.parseInfoGetter(r.value.id);if(e){const t=e.type||e.parser.getValueTypeAt(e.bounds.contentStart);if(t===Ce){const t=gr.parse(e.parser,e.bounds.contentStart);if(t){this.RC=t.value,o=r.end+1;break}}else{if(t!==Ie)throw new Error(`Unsupported /RC property value type: ${t}`);{const t=Cr.parse(e);if(t){const e=t.value.getText();this.RC=gr.fromString(e),o=r.end+1;break}}}}}throw new Error("Can't parse /RC value reference")}if(r===Ce){const r=gr.parse(e,o,t.cryptInfo);if(r){this.RC=r.value,o=r.end+1;break}throw new Error("Can't parse /RC property value")}throw new Error(`Unsupported /RC property value type: ${r}`);case"/CA":o=this.parseNumberProp(a,e,o,!0);break;case"/CreationDate":o=this.parseDateProp(a,e,o,t.cryptInfo);break;case"/RT":const s=e.parseNameAt(o,!0);if(!s||!Object.values($r).includes(s.value))throw new Error("Can't parse /RT property value");this.RT=s.value,o=s.end+1;break;case"/ExData":break;default:o=e.skipToNextName(o,n-1)}return!(!this.Subtype||!this.Rect)}}const es={PLAIN_TEXT:"/FreeText",WITH_CALLOUT:"/FreeTextCallout",CLICK_TO_TYPE:"/FreeTextTypeWriter"};class rs extends ts{constructor(){super(Te),this.IT=es.PLAIN_TEXT,this.LE=Ke.NONE}static parse(t){const e=new rs;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.DA&&s.push(...r.encode("/DA "),...this.DA.toArray(t)),this.Q&&s.push(...r.encode("/Q "),...r.encode(" "+this.Q)),this.DS&&s.push(...r.encode("/DS "),...this.DS.toArray(t)),this.CL&&(s.push(...r.encode("/CL "),et),this.CL.forEach((t=>s.push(...r.encode(" "+t)))),s.push(st)),this.IT&&s.push(...r.encode("/IT "),...r.encode(this.IT)),this.RD&&s.push(...r.encode("/RD "),et,...r.encode(this.RD[0]+""),N,...r.encode(this.RD[1]+""),N,...r.encode(this.RD[2]+""),N,...r.encode(this.RD[3]+""),st),this.LE&&s.push(...r.encode("/LE "),...r.encode(this.LE));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/DA":case"/DS":o=this.parseLiteralProp(a,e,o,t.cryptInfo);break;case"/Q":const r=e.parseNumberAt(o,!0);if(!r||!Object.values(ae).includes(r.value))throw new Error("Can't parse /Q property value");this.Q=r.value,o=r.end+1;break;case"/LE":const s=e.parseNameAt(o,!0);if(!s||!Object.values(Ke).includes(s.value))throw new Error("Can't parse /LE property value");this.LE=s.value,o=s.end+1;break;case"/CL":case"/RD":o=this.parseNumberArrayProp(a,e,o,!0);break;case"/IT":const i=e.parseNameAt(o,!0);if(i){if("/FreeTextTypewriter"===i.value){this.IT=es.CLICK_TO_TYPE,o=i.end+1;break}if(Object.values(es).includes(i.value)){this.IT=i.value,o=i.end+1;break}}throw new Error("Can't parse /IT property value");default:o=e.skipToNextName(o,n-1)}return!!this.DA}}class ss extends ts{constructor(t){super(t)}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.IC&&(s.push(...r.encode("/IC "),et),this.IC.forEach((t=>s.push(...r.encode(" "+t)))),s.push(st));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/IC":o=this.parseNumberArrayProp(a,e,o,!0);break;default:o=e.skipToNextName(o,n-1)}return!0}}class ns extends ss{constructor(){super(Ue)}static parse(t){const e=new ns;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.RD&&s.push(...r.encode("/RD "),et,...r.encode(this.RD[0]+""),N,...r.encode(this.RD[1]+""),N,...r.encode(this.RD[2]+""),N,...r.encode(this.RD[3]+""),st);const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/RD":o=this.parseNumberArrayProp(a,e,o,!0);break;default:o=e.skipToNextName(o,n-1)}return!0}}const as={ARROW:"/LineArrow",DIMESION:"/LineDimension"},is={INLINE:"/Inline",TOP:"/Top"};class os extends ss{constructor(){super(Le),this.LE=[Ke.NONE,Ke.NONE],this.LL=0,this.LLE=0,this.Cap=!1,this.LLO=0,this.CP=is.INLINE,this.CO=[0,0]}static parse(t){const e=new os;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.L&&s.push(...r.encode("/L "),et,...r.encode(this.L[0]+""),N,...r.encode(this.L[1]+""),N,...r.encode(this.L[2]+""),N,...r.encode(this.L[3]+""),st),this.LE&&(s.push(...r.encode("/LE "),et),this.LE.forEach((t=>s.push(N,...r.encode(t)))),s.push(st)),this.LL&&s.push(...r.encode("/LL "),...r.encode(" "+this.LL)),this.LLE&&s.push(...r.encode("/LLE "),...r.encode(" "+this.LLE)),this.Cap&&s.push(...r.encode("/Cap "),...r.encode(" "+this.Cap)),this.IT&&s.push(...r.encode("/IT "),...r.encode(this.IT)),this.LLO&&s.push(...r.encode("/LLO "),...r.encode(" "+this.LLO)),this.CP&&s.push(...r.encode("/CP "),...r.encode(this.CP)),this.Measure&&s.push(...r.encode("/Measure "),...this.Measure.toArray(t)),this.CO&&s.push(...r.encode("/CO "),et,...r.encode(this.CO[0]+""),N,...r.encode(this.CO[1]+""),st);const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/L":case"/CO":o=this.parseNumberArrayProp(a,e,o,!0);break;case"/LE":const r=e.parseNameArrayAt(o,!0);if(!(r&&Object.values(Ke).includes(r.value[0])&&Object.values(Ke).includes(r.value[1])))throw new Error("Can't parse /LE property value");this.LE=[r.value[0],r.value[1]],o=r.end+1;break;case"/IT":const s=e.parseNameAt(o,!0);if(s&&Object.values(as).includes(s.value)){this.IT=s.value,o=s.end+1;break}throw new Error("Can't parse /IT property value");case"/CP":const i=e.parseNameAt(o,!0);if(!i||!Object.values(is).includes(i.value[0]))throw new Error("Can't parse /CP property value");this.CP=i.value,o=i.end+1;break;case"/LL":case"/LLE":case"/LLO":o=this.parseNumberProp(a,e,o,!1);break;case"/Cap":o=this.parseBoolProp(a,e,o);break;case"/Measure":const h=e.getValueTypeAt(o);if(h===Me){const r=Ar.parseRef(e,o);if(r&&t.parseInfoGetter){const e=t.parseInfoGetter(r.value.id);if(e){const t=Fr.parse(e);if(t){this.Measure=t.value,o=t.end+1;break}}}throw new Error("Can't parse /BS value reference")}if(h===Ie){const t=e.getDictBoundsAt(o);if(t){const r=Fr.parse({parser:e,bounds:t});if(r){this.Measure=r.value,o=r.end+1;break}}throw new Error("Can't parse /Measure value dictionary")}throw new Error(`Unsupported /Measure property value type: ${h}`);default:o=e.skipToNextName(o,n-1)}return!0}}class hs extends ss{constructor(){super(Oe)}static parse(t){const e=new hs;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.RD&&s.push(...r.encode("/RD "),et,...r.encode(this.RD[0]+""),N,...r.encode(this.RD[1]+""),N,...r.encode(this.RD[2]+""),N,...r.encode(this.RD[3]+""),st);const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/RD":o=this.parseNumberArrayProp(a,e,o,!0);break;default:o=e.skipToNextName(o,n-1)}return!0}}class cs extends ts{constructor(){super(He)}static parse(t){const e=new cs;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.InkList&&(s.push(...r.encode("/InkList "),et),this.InkList.forEach((t=>{s.push(et),t.forEach((t=>s.push(...r.encode(" "+t)))),s.push(st)})),s.push(st));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){var e;if(!super.tryParseProps(t))return!1;const{parser:r,bounds:s}=t,n=s.contentStart||s.start,a=s.contentEnd||s.end;let i,o,h=r.skipToNextName(n,a-1);if(-1===h)return!1;for(;o=r.parseNameAt(h),o;)switch(h=o.end+1,i=o.value,i){case"/InkList":if(r.getValueTypeAt(h)===Ne){const t=[];let e,s=++h;for(;e=r.parseNumberArrayAt(s),e;)t.push(e.value),s=e.end+1;this.InkList=t;break}throw new Error("Can't parse /InkList property value");default:h=r.skipToNextName(h,a-1)}return!!(null===(e=this.InkList)||void 0===e?void 0:e.length)}}const ds="/Draft";class us extends ts{constructor(){super(ze),this.Name=ds}static parse(t){const e=new us;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.Name&&s.push(...r.encode("/Name "),...r.encode(this.Name));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;e.sliceChars(s,n);let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Name":o=this.parseNameProp(a,e,o);break;default:o=e.skipToNextName(o,n-1)}return!!this.Name}}class ls extends ts{constructor(){super(De),this.Open=!1}static parse(t){const e=new ls;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.Open&&s.push(...r.encode("/Open "),...r.encode(" "+this.Open)),this.Name&&s.push(...r.encode("/Name "),...r.encode(this.Name)),this.State&&s.push(...r.encode("/State "),...r.encode(this.State)),this.StateModel&&s.push(...r.encode("/StateModel "),...r.encode(this.StateModel));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Open":o=this.parseBoolProp(a,e,o);break;case"/Name":const t=e.parseNameAt(o,!0);if(!t||!Object.values(je).includes(t.value))throw new Error("Can't parse /Name property value");this.Name=t.value,o=t.end+1;break;case"/State":const r=e.parseNameAt(o,!0);if(!r||!Object.values(Ge).concat(Object.values(Qe)).includes(r.value))throw new Error("Can't parse /State property value");this.State=r.value,o=r.end+1;break;case"/StateModel":const s=e.parseNameAt(o,!0);if(!s||!Object.values(We).includes(s.value))throw new Error("Can't parse /StateModel property value");this.StateModel=s.value,o=s.end+1;break;default:o=e.skipToNextName(o,n-1)}return!0}}class ps extends vr{constructor(){super(Ae),this.CFM=se.NONE,this.AuthEvent=ne.DOC_OPEN,this.Length=40,this.EncryptMetadata=!0}static parse(t){const e=new ps;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.CFM&&s.push(...r.encode("/CFM "),...r.encode(this.CFM)),this.AuthEvent&&s.push(...r.encode("/AuthEvent "),...r.encode(this.AuthEvent)),this.Length&&s.push(...r.encode("/Length "),...r.encode(" "+this.Length)),this.EncryptMetadata&&s.push(...r.encode("/EncryptMetadata "),...r.encode(" "+this.EncryptMetadata)),this.Recipients&&(this.Recipients instanceof Br?s.push(...r.encode("/Recipients "),...this.Recipients.toArray(t)):(s.push(et),this.Recipients.forEach((e=>s.push(...e.toArray(t)))),s.push(st)));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/CFM":const r=e.parseNameAt(o,!0);if(!r||!Object.values(se).includes(r.value))throw new Error("Can't parse /CFM property value");this.CFM=r.value,o=r.end+1;break;case"/AuthEvent":const s=e.parseNameAt(o,!0);if(!s||!Object.values(ne).includes(s.value))throw new Error("Can't parse /AuthEvent property value");this.AuthEvent=s.value,o=s.end+1;break;case"/Length":o=this.parseNumberProp(a,e,o,!1);break;case"/EncryptMetadata":o=this.parseBoolProp(a,e,o);break;case"/Recipients":const i=e.getValueTypeAt(o);if(i===Se){const r=Br.parse(e,o,t.cryptInfo);if(r){this.Recipients=r.value,o=r.end+1;break}throw new Error("Can't parse /Recipients property value")}if(i===Ne){const t=Br.parseArray(e,o);if(t){this.Recipients=t.value,o=t.end+1;break}throw new Error("Can't parse /Recipients property value")}throw new Error(`Unsupported /Filter property value type: ${i}`);default:o=e.skipToNextName(o,n-1)}return!0}}class fs extends vr{constructor(){super(null),this._filtersMap=new Map}static parse(t){const e=new fs;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}getProp(t){return this._filtersMap.get(t)}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this._filtersMap.size&&this._filtersMap.forEach(((e,n)=>s.push(...r.encode(n),...e.toArray(t))));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){default:if(e.getValueTypeAt(o)===Ie){const t=e.getDictBoundsAt(o);if(t){const r=ps.parse({parser:e,bounds:t});if(r){this._filtersMap.set(a,r.value),o=r.end+1;break}}}o=e.skipToNextName(o,n-1)}return!0}}class ys extends vr{constructor(){super(be),this.Filter="/Standard",this.Length=40,this.StmF="/Identity",this.StrF="/Identity",this.EncryptMetadata=!0}static parse(t){const e=new ys;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.Filter&&s.push(...r.encode("/Filter "),...r.encode(this.Filter)),this.SubFilter&&s.push(...r.encode("/SubFilter "),...r.encode(this.SubFilter)),this.V&&s.push(...r.encode("/V "),...r.encode(" "+this.V)),this.Length&&s.push(...r.encode("/Length "),...r.encode(" "+this.Length)),this.CF&&s.push(...r.encode("/CF "),...this.CF.toArray(t)),this.StmF&&s.push(...r.encode("/StmF "),...r.encode(this.StmF)),this.StrF&&s.push(...r.encode("/StrF "),...r.encode(this.StrF)),this.EFF&&s.push(...r.encode("/EFF "),...r.encode(this.EFF)),this.R&&s.push(...r.encode("/R "),...r.encode(" "+this.R)),this.O&&s.push(...r.encode("/O "),...this.O.toArray(t)),this.U&&s.push(...r.encode("/U "),...this.U.toArray(t)),this.OE&&s.push(...r.encode("/OE "),...this.OE.toArray(t)),this.UE&&s.push(...r.encode("/UE "),...this.UE.toArray(t)),this.P&&s.push(...r.encode("/P "),...r.encode(" "+this.P)),this.Perms&&s.push(...r.encode("/Perms "),...this.Perms.toArray(t)),this.U&&s.push(...r.encode("/U "),...this.U.toArray(t)),this.EncryptMetadata&&s.push(...r.encode("/EncryptMetadata "),...r.encode(" "+this.EncryptMetadata)),this.Recipients&&(this.Recipients instanceof Br?s.push(...r.encode("/Recipients "),...this.Recipients.toArray(t)):(s.push(et),this.Recipients.forEach((e=>s.push(...e.toArray(t)))),s.push(st)));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}toCryptOptions(){var t,e,r,s,n,a,i,o,h;return this.V?{filter:this.Filter,version:this.V,revision:this.R,permissions:this.P,keyLength:this.Length,encryptMetadata:this.EncryptMetadata,stringKeyLength:null===(t=this.stringFilter)||void 0===t?void 0:t.Length,streamKeyLength:null===(e=this.streamFilter)||void 0===e?void 0:e.Length,stringMethod:null===(r=this.stringFilter)||void 0===r?void 0:r.CFM,streamMethod:null===(s=this.streamFilter)||void 0===s?void 0:s.CFM,oPasswordHash:null===(n=this.O)||void 0===n?void 0:n.bytes,uPasswordHash:null===(a=this.U)||void 0===a?void 0:a.bytes,oEncPasswordHash:null===(i=this.OE)||void 0===i?void 0:i.bytes,uEncPasswordHash:null===(o=this.UE)||void 0===o?void 0:o.bytes,perms:null===(h=this.Perms)||void 0===h?void 0:h.bytes}:null}tryParseProps(t){var e,r;if(!super.tryParseProps(t))return!1;const{parser:s,bounds:n}=t,a=n.contentStart||n.start,i=n.contentEnd||n.end;let o,h,c=s.skipToNextName(a,i-1);if(-1===c)return!1;for(;h=s.parseNameAt(c),h;)switch(c=h.end+1,o=h.value,o){case"/Filter":case"/SubFilter":case"/StmF":case"/StrF":case"/EFF":c=this.parseNameProp(o,s,c);break;case"/V":const e=s.parseNumberAt(c,!1);if(!e||!Object.values(ee).includes(e.value))throw new Error("Can't parse /V property value");this.V=e.value,c=e.end+1;break;case"/R":const r=s.parseNumberAt(c,!1);if(!r||!Object.values(re).includes(r.value))throw new Error("Can't parse /R property value");this.R=r.value,c=r.end+1;break;case"/Length":case"/P":c=this.parseNumberProp(o,s,c,!1);break;case"/O":case"/U":case"/OE":case"/UE":case"/Perms":c=this.parseLiteralProp(o,s,c,t.cryptInfo);break;case"/EncryptMetadata":c=this.parseBoolProp(o,s,c);break;case"/CF":const a=s.getDictBoundsAt(c);if(!n)throw new Error("Can't parse /CF property value");{const t=fs.parse({parser:s,bounds:a});t&&(this.CF=t.value,c=t.end+1)}break;case"/Recipients":const h=s.getValueTypeAt(c);if(h===Se){const e=Br.parse(s,c,t.cryptInfo);if(e){this.Recipients=e.value,c=e.end+1;break}throw new Error("Can't parse /Recipients property value")}if(h===Ne){const t=Br.parseArray(s,c);if(t){this.Recipients=t.value,c=t.end+1;break}throw new Error("Can't parse /Recipients property value")}throw new Error(`Unsupported /Filter property value type: ${h}`);default:c=s.skipToNextName(c,i-1)}return!!this.Filter&&(!!("/Standard"!==this.Filter||this.R&&this.O&&this.U&&!isNaN(this.P)&&(5!==this.V||!(this.R<5)&&this.OE&&this.UE&&this.Perms))&&(!!("adbe.pkcs7.s3"!==this.SubFilter&&"adbe.pkcs7.s4"!==this.SubFilter||this.Recipients)&&("/Identity"!==this.StrF&&(this.stringFilter=null===(e=this.CF)||void 0===e?void 0:e.getProp(this.StrF)),"/Identity"!==this.StmF&&(this.streamFilter=null===(r=this.CF)||void 0===r?void 0:r.getProp(this.StmF)),!0)))}}class gs extends _r{constructor(){super(oe)}static parse(t){const e=new gs;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}getObjectData(t){if(!this._streamData||!this.N||!this.First)return null;const e=new Nr(this.decodedStreamData),r=new Map;let s,n,a,i=0;for(let t=0;t<this.N;t++)s=e.parseNumberAt(i,!1,!1),n=s.value,i=s.end+2,s=e.parseNumberAt(i,!1,!1),a=s.value,i=s.end+2,r.set(n,a);if(!r.has(t))return null;const o=this.First+r.get(t),h=e.getValueTypeAt(o);if(null===h)return;let c,d;switch(h){case Ot:c=e.getDictBoundsAt(o,!1);break;case Lt:c=e.getArrayBoundsAt(o,!1);break;case Dt:const t=gr.parse(e,o);t&&(c={start:t.start,end:t.end},d=t);break;case Tt:const r=Br.parse(e,o);r&&(c={start:r.start,end:r.end},d=r);break;case Rt:const s=e.parseNumberAt(o);s&&(c={start:s.start,end:s.end},d=s)}if(!c)return null;const u=e.sliceCharCodes(c.start,c.end);if(!u.length)throw new Error("Object byte array is empty");return{parser:new Nr(u),bounds:{start:0,end:u.length-1,contentStart:c.contentStart?c.contentStart-c.start:void 0,contentEnd:c.contentEnd?u.length-1-(c.end-c.contentEnd):void 0},type:h,value:d,cryptInfo:{ref:{id:t,generation:0}},streamId:this.id}}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.N&&s.push(...r.encode("/N "),...r.encode(" "+this.N)),this.First&&s.push(...r.encode("/First "),...r.encode(" "+this.First)),this.Extends&&s.push(...r.encode("/Extends "),N,...this.Extends.toArray(t));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;if(this.Type!==oe)return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=e.getDictBoundsAt(s);let a,i,o=e.skipToNextName(n.contentStart,n.contentEnd);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/N":case"/First":o=this.parseNumberProp(a,e,o,!1);break;case"/Extends":o=this.parseRefProp(a,e,o);break;default:o=e.skipToNextName(o,n.contentEnd)}return!0}}class As extends vr{constructor(){super(de)}static parse(t){const e=new As;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.Version&&s.push(...r.encode("/Version "),...r.encode(this.Version)),this.Pages&&s.push(...r.encode("/Pages "),N,...this.Pages.toArray(t)),this.Lang&&s.push(...r.encode("/Lang "),...this.Lang.toArray(t));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Version":o=this.parseNameProp(a,e,o);break;case"/Pages":o=this.parseRefProp(a,e,o);break;case"/Lang":o=this.parseLiteralProp(a,e,o,t.cryptInfo);break;default:o=e.skipToNextName(o,n-1)}return!!this.Pages}}class ws extends vr{constructor(){super(le),this.Rotate=0}static parse(t){const e=new ws;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.Parent&&s.push(...r.encode("/Parent "),N,...this.Parent.toArray(t)),this.LastModified&&s.push(...r.encode("/LastModified "),...this.LastModified.toArray(t)),this.Resources&&s.push(...r.encode("/Resources "),...this.Resources.toArray(t)),this.MediaBox&&s.push(...r.encode("/MediaBox "),et,...r.encode(this.MediaBox[0]+""),N,...r.encode(this.MediaBox[1]+""),N,...r.encode(this.MediaBox[2]+""),N,...r.encode(this.MediaBox[3]+""),st),this.CropBox&&s.push(...r.encode("/CropBox "),et,...r.encode(this.CropBox[0]+""),N,...r.encode(this.CropBox[1]+""),N,...r.encode(this.CropBox[2]+""),N,...r.encode(this.CropBox[3]+""),st),this.BleedBox&&s.push(...r.encode("/BleedBox "),et,...r.encode(this.BleedBox[0]+""),N,...r.encode(this.BleedBox[1]+""),N,...r.encode(this.BleedBox[2]+""),N,...r.encode(this.BleedBox[3]+""),st),this.TrimBox&&s.push(...r.encode("/TrimBox "),et,...r.encode(this.TrimBox[0]+""),N,...r.encode(this.TrimBox[1]+""),N,...r.encode(this.TrimBox[2]+""),N,...r.encode(this.TrimBox[3]+""),st),this.ArtBox&&s.push(...r.encode("/ArtBox "),et,...r.encode(this.ArtBox[0]+""),N,...r.encode(this.ArtBox[1]+""),N,...r.encode(this.ArtBox[2]+""),N,...r.encode(this.ArtBox[3]+""),st),this.Contents&&(this.Contents instanceof Ar?s.push(...r.encode("/Contents "),N,...this.Contents.toArray(t)):(s.push(...r.encode("/Contents "),et),this.Contents.forEach((e=>s.push(N,...e.toArray(t)))),s.push(st))),this.Rotate&&s.push(...r.encode("/Rotate "),...r.encode(" "+this.Rotate)),this.Thumb&&s.push(...r.encode("/Thumb "),N,...this.Thumb.toArray(t)),this.B&&(this.B instanceof Ar?s.push(...r.encode("/B "),N,...this.B.toArray(t)):(s.push(...r.encode("/B "),et),this.B.forEach((e=>s.push(N,...e.toArray(t)))),s.push(st))),this.Dur&&s.push(...r.encode("/Dur "),...r.encode(" "+this.Dur)),this.Annots&&(this.Annots instanceof Ar?s.push(...r.encode("/Annots "),N,...this.Annots.toArray(t)):(s.push(...r.encode("/Annots "),et),this.Annots.forEach((e=>s.push(N,...e.toArray(t)))),s.push(st))),this.Metadata&&s.push(...r.encode("/Metadata "),N,...this.Metadata.toArray(t)),this.StructParent&&s.push(...r.encode("/StructParent "),...r.encode(" "+this.StructParent)),this.ID&&s.push(...r.encode("/ID "),N,...this.ID.toArray(t)),this.PZ&&s.push(...r.encode("/PZ "),...r.encode(" "+this.PZ)),this.Tabs&&s.push(...r.encode("/Tabs "),...r.encode(this.Tabs)),this.TemplateInstantiated&&s.push(...r.encode("/TemplateInstantiated "),...r.encode(this.TemplateInstantiated)),this.UserUnit&&s.push(...r.encode("/UserUnit "),...r.encode(" "+this.UserUnit));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Parent":case"/Thumb":case"/Metadata":o=this.parseRefProp(a,e,o);break;case"/LastModified":o=this.parseDateProp(a,e,o,t.cryptInfo);break;case"/Resources":const r=e.getValueTypeAt(o);if(r===Me){const r=Ar.parseRef(e,o);if(r&&t.parseInfoGetter){const e=t.parseInfoGetter(r.value.id);if(e){const t=Ur.parse(e);if(t){this.Resources=t.value,o=t.end+1;break}}}throw new Error("Can't parse /Resources value reference")}if(r===Ie){const r=e.getDictBoundsAt(o);if(r){if(r.contentStart){const s=Ur.parse({parser:e,bounds:r,parseInfoGetter:t.parseInfoGetter});if(!s)throw new Error("Can't parse /Resources value dictionary");this.Resources=s.value}o=r.end+1;break}throw new Error("Can't parse /Resources dictionary bounds")}throw new Error(`Unsupported /Resources property value type: ${r}`);case"/MediaBox":case"/CropBox":case"/BleedBox":case"/TrimBox":case"/ArtBox":o=this.parseNumberArrayProp(a,e,o,!0);break;case"/Contents":case"/B":case"/Annots":const s=e.getValueTypeAt(o);if(s===Me){const t=Ar.parseRef(e,o);if(t){this[a.slice(1)]=t.value,o=t.end+1;break}}else if(s===Ne){const t=Ar.parseRefArray(e,o);if(t){this[a.slice(1)]=t.value,o=t.end+1;break}}throw new Error(`Unsupported ${a} property value type: ${s}`);case"/Rotate":case"/Dur":case"/StructParent":case"/PZ":case"/UserUnit":o=this.parseNumberProp(a,e,o,!1);break;case"/ID":const i=e.getValueTypeAt(o);if(i===Me){const r=Ar.parseRef(e,o);if(r&&r&&t.parseInfoGetter){const e=t.parseInfoGetter(r.value.id);if(e){const t=Br.parse(e.parser,e.bounds.start,e.cryptInfo);if(t){this.ID=t.value,o=r.end+1;break}}}throw new Error("Can't parse /ID property value")}if(i===Se){const r=Br.parse(e,o,t.cryptInfo);if(r){this.ID=r.value,o=r.end+1;break}}throw new Error(`Unsupported /ID property value type: ${i}`);case"/Tabs":case"/TemplateInstantiated":o=this.parseNameProp(a,e,o);break;default:o=e.skipToNextName(o,n-1)}return!!this.Parent}}class ms extends vr{constructor(){super(ue),this.Rotate=0}static parse(t){const e=new ms;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.Parent&&s.push(...r.encode("/Parent "),N,...this.Parent.toArray(t)),this.Kids&&(s.push(...r.encode("/Kids "),et),this.Kids.forEach((e=>s.push(N,...e.toArray(t)))),s.push(st)),this.Count&&s.push(...r.encode("/Count "),...r.encode(" "+this.Count)),this.MediaBox&&s.push(...r.encode("/MediaBox "),et,...r.encode(this.MediaBox[0]+""),N,...r.encode(this.MediaBox[1]+""),N,...r.encode(this.MediaBox[2]+""),N,...r.encode(this.MediaBox[3]+""),st),this.Rotate&&s.push(...r.encode("/Rotate "),...r.encode(" "+this.Rotate));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Parent":o=this.parseRefProp(a,e,o);break;case"/Kids":o=this.parseRefArrayProp(a,e,o);break;case"/Count":case"/Rotate":o=this.parseNumberProp(a,e,o,!1);break;case"/MediaBox":o=this.parseNumberArrayProp(a,e,o,!0);break;default:o=e.skipToNextName(o,n-1)}return!(!this.Kids||isNaN(this.Count))}}class vs extends _r{constructor(){super(ie)}static parse(t){const e=new vs;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.Size&&s.push(...r.encode("/Size "),...r.encode(" "+this.Size)),this.Prev&&s.push(...r.encode("/Prev "),...r.encode(" "+this.Prev)),this.Root&&s.push(...r.encode("/Root "),N,...this.Root.toArray(t)),this.Encrypt&&s.push(...r.encode("/Encrypt "),N,...this.Encrypt.toArray(t)),this.Info&&s.push(...r.encode("/Info "),N,...this.Info.toArray(t)),this.ID&&s.push(...r.encode("/ID "),et,...this.ID[0].toArray(t),...this.ID[1].toArray(t),st),this.Index&&(s.push(...r.encode("/Index "),et),this.Index.forEach((t=>s.push(...r.encode(" "+t)))),s.push(st)),this.W&&s.push(...r.encode("/W "),et,...r.encode(this.W[0]+""),N,...r.encode(this.W[1]+""),N,...r.encode(this.W[2]+""),st);const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){var e;if(!super.tryParseProps(t))return!1;if(this.Type!==ce)return!1;const{parser:r,bounds:s}=t,n=s.contentStart||s.start,a=r.getDictBoundsAt(n);let i,o,h=r.skipToNextName(a.contentStart,a.contentEnd);if(-1===h)return!1;for(;o=r.parseNameAt(h),o;)switch(h=o.end+1,i=o.value,i){case"/Size":case"/Prev":h=this.parseNumberProp(i,r,h,!1);break;case"/Root":case"/Info":h=this.parseRefProp(i,r,h);break;case"/Encrypt":const t=r.getValueTypeAt(h);if(t===Me){const t=Ar.parseRef(r,h);if(t){this.Encrypt=t.value,h=t.end+1;break}throw new Error("Can't parse /Encrypt property value")}throw new Error(`Unsupported /Encrypt property value type: ${t}`);case"/ID":const e=Br.parseArray(r,h);if(!e)throw new Error("Can't parse /ID property value");this.ID=[e.value[0],e.value[1]],h=e.end+1;break;case"/Index":case"/W":h=this.parseNumberArrayProp(i,r,h,!1);break;default:h=r.skipToNextName(h,a.contentEnd)}return!(!(this.W&&this.Size&&this.Root)||this.Encrypt&&!this.ID)&&((null===(e=this.Index)||void 0===e?void 0:e.length)||(this.Index=[0,this.Size]),!0)}}class bs{constructor(t){this._type=t}get type(){return this._type}get offset(){return this._offset}}class xs{constructor(t,e,r,s,n,a,i){this.type=t,this.id=e,this.generation=r,this.byteOffset=s,this.nextFreeId=n,this.streamId=a,this.streamIndex=i}static*fromTableBytes(t){let e=0,r=0;for(;e<t.length;){const s=[];let n=t[e++];for(;Pt.has(n);)s.push(n),n=t[e++];let a=parseInt(s.map((t=>String.fromCharCode(t))).join(""),10);const i=[];let o=t[e++];for(;Pt.has(o);)i.push(o),o=t[e++];const h=parseInt(i.map((t=>String.fromCharCode(t))).join(""),10);for(;!Pt.has(t[e]);)e++;for(r=0;r<h;r++){const r=parseInt(Array.from(t.subarray(e,e+10)).map((t=>String.fromCharCode(t))).join(""),10);e+=11;const s=parseInt(Array.from(t.subarray(e,e+5)).map((t=>String.fromCharCode(t))).join(""),10);e+=6;const n=t[e];n===ht?yield new xs(Vt,a++,s,null,r):n===lt&&(yield new xs(zt,a++,s,r)),e+=3}}}static*fromStreamBytes(t,e,r){const[s,n,a]=e,i=s+n+a;if(t.length%i)throw new Error("Incorrect stream length");const o=t.length/i,h=new Array(o);if(null==r?void 0:r.length){let t,e,s=0;for(let n=0;n<r.length;n++)if(n%2)for(e=0;e<r[n];e++)h[s++]=t+e;else t=r[n]}else{let t=0;for(;t<o;)h[t++]=t}let c,d,u,l=0,p=0;for(;l<t.length;)switch(c=s?Ct(t.slice(l,l+s)):1,l+=s,d=Ct(t.slice(l,l+n)),l+=n,u=a?Ct(t.slice(l,l+a)):null,l+=a,c){case Vt:yield new xs(Vt,h[p++],null!=u?u:65535,null,d);break;case zt:yield new xs(zt,h[p++],null!=u?u:0,d);break;case Ht:yield new xs(Ht,h[p++],0,null,null,d,u)}}static toTableBytes(t){if(!(null==t?void 0:t.length))return null;const e=new TextEncoder,r=this.groupEntries(t);let s,n,a=new Uint8Array;for(const t of r){n=`${t[0]} ${t[1].length}\r\n`,s=new Uint8Array(a.length+n.length),s.set(a),s.set(e.encode(n),a.length),a=s;for(const r of t[1]){switch(r.type){case Vt:n=`${r.nextFreeId.toString().padStart(10,"0")} ${r.generation.toString().padStart(5,"0")} f\r\n`;break;case zt:n=`${r.byteOffset.toString().padStart(10,"0")} ${r.generation.toString().padStart(5,"0")} n\r\n`;break;default:continue}s=new Uint8Array(a.length+n.length),s.set(a),s.set(e.encode(n),a.length),a=s}}return a}static toStreamBytes(t,e=[1,4,2]){if(!(null==t?void 0:t.length))return null;if(Math.min(...e)<0)throw new Error("Negative length values are not permitted");let[r,s,n]=e;null!=r||(r=0),null!=s||(s=4),null!=n||(n=0);const a=r+s+n;let i,o,h;switch(r){case 0:i=()=>new Uint8Array;break;case 1:i=St;break;case 2:i=kt;break;default:o=t=>new Uint8Array([...new Array(r-2).fill(0),...kt(t)])}switch(s){case 1:o=St;break;case 2:o=kt;break;case 3:o=t=>new Uint8Array([0,...kt(t)]);break;case 4:o=Nt;break;default:o=t=>new Uint8Array([...new Array(r-4).fill(0),...Nt(t)])}switch(n){case 0:h=()=>new Uint8Array;break;case 1:h=St;break;case 2:h=kt;break;default:o=t=>new Uint8Array([...new Array(r-2).fill(0),...kt(t)])}new TextEncoder;const c=this.groupEntries(t),d=[];let u,l,p,f,y=new Uint8Array;for(const t of c){d.push(t[0],t[1].length);for(const e of t[1]){switch(e.type){case Vt:l=i(0),p=o(e.nextFreeId),f=h(e.generation);break;case zt:l=i(1),p=o(e.byteOffset),f=h(e.generation);break;case Ht:l=i(2),p=o(e.streamId),f=h(e.streamIndex);break;default:continue}u=new Uint8Array(y.length+a),u.set(y),u.set(l,y.length),u.set(p,y.length+r),u.set(f,y.length+r+s),y=u}}return{bytes:y,index:d}}static groupEntries(t){t.sort(((t,e)=>t.id-e.id));const e=[];let r,s,n;for(const a of t)a.id!==n+1?((null==s?void 0:s.length)&&e.push([r,s]),r=a.id,s=[a]):s.push(a),n=a.id;return(null==s?void 0:s.length)&&e.push([r,s]),e}}class Es extends bs{constructor(t,e){super(Ft),this._trailerStream=t,this._offset=e}get prev(){var t;return null===(t=this._trailerStream)||void 0===t?void 0:t.Prev}get size(){var t;return null===(t=this._trailerStream)||void 0===t?void 0:t.Size}get root(){var t;return null===(t=this._trailerStream)||void 0===t?void 0:t.Root}get info(){var t;return null===(t=this._trailerStream)||void 0===t?void 0:t.Root}get encrypt(){var t;return null===(t=this._trailerStream)||void 0===t?void 0:t.Encrypt}get id(){var t;return null===(t=this._trailerStream)||void 0===t?void 0:t.ID}static createFrom(t,e,r){if(!(null==e?void 0:e.length)||!t)return null;const s=Math.max(...e.map((t=>t.id)))+1,n=Math.max(s,t.size);return Es.create(e,n,r,t.root,t.offset,t.info,t.encrypt,t.id)}static create(t,e,r,s,n,a,i,o){if(!((null==t?void 0:t.length)&&e&&r&&s))return null;const h=new vs;h.Size=e,h.Root=s,h.Prev=n,h.Info=a,h.Encrypt=i,h.ID=o;const c=[1,4,2],d=xs.toStreamBytes(t,c),u=new br;u.setIntProp("/Predictor",Jt),u.setIntProp("/Columns",5),u.setIntProp("/Colors",1),u.setIntProp("/BitsPerComponent",8);const l=new Es(h,r);return l._trailerStream.Filter=Gt,l._trailerStream.DecodeParms=u,l._trailerStream.W=c,l._trailerStream.Index=d.index,l._trailerStream.streamData=d.bytes,l}static parse(t,e){if(!t)return null;const r=vs.parse(t);if(!r)return null;return{value:new Es(r.value,e),start:null,end:null}}createUpdate(t,e){return Es.createFrom(this,t,e)}getEntries(){if(!this._trailerStream)return[];return xs.fromStreamBytes(this._trailerStream.decodedStreamData,this._trailerStream.W,this._trailerStream.Index)}toArray(t){return this._trailerStream.toArray(t)}}class Ps extends vr{constructor(){super(be)}static parse(t){const e=new Ps;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.Size&&s.push(...r.encode("/Size "),...r.encode(" "+this.Size)),this.Prev&&s.push(...r.encode("/Prev "),...r.encode(" "+this.Prev)),this.Root&&s.push(...r.encode("/Root "),N,...this.Root.toArray(t)),this.Encrypt&&s.push(...r.encode("/Encrypt "),N,...this.Encrypt.toArray(t)),this.Info&&s.push(...r.encode("/Info "),N,...this.Info.toArray(t)),this.ID&&s.push(...r.encode("/ID "),et,...this.ID[0].toArray(t),...this.ID[1].toArray(t),st);const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Size":case"/Prev":o=this.parseNumberProp(a,e,o,!1);break;case"/Root":case"/Info":o=this.parseRefProp(a,e,o);break;case"/Encrypt":const t=e.getValueTypeAt(o);if(t===Me){const t=Ar.parseRef(e,o);if(t){this.Encrypt=t.value,o=t.end+1;break}throw new Error("Can't parse /Encrypt property value")}throw new Error(`Unsupported /Encrypt property value type: ${t}`);case"/ID":const r=Br.parseArray(e,o);if(!r)throw new Error("Can't parse /ID property value");this.ID=[r.value[0],r.value[1]],o=r.end+1;break;default:o=e.skipToNextName(o,n-1)}return!(!this.Size||!this.Root||this.Encrypt&&!this.ID)}}class _s extends bs{constructor(t,e,r){super(Ut),this._table=t,this._trailerDict=e,this._offset=r}get prev(){var t;return null===(t=this._trailerDict)||void 0===t?void 0:t.Prev}get size(){var t;return null===(t=this._trailerDict)||void 0===t?void 0:t.Size}get root(){var t;return null===(t=this._trailerDict)||void 0===t?void 0:t.Root}get info(){var t;return null===(t=this._trailerDict)||void 0===t?void 0:t.Root}get encrypt(){var t;return null===(t=this._trailerDict)||void 0===t?void 0:t.Encrypt}get id(){var t;return null===(t=this._trailerDict)||void 0===t?void 0:t.ID}static createFrom(t,e,r){if(!(null==e?void 0:e.length)||!t)return null;const s=Math.max(...e.map((t=>t.id)))+1,n=Math.max(s,t.size);return _s.create(e,n,r,t.root,t.offset,t.info,t.encrypt,t.id)}static create(t,e,r,s,n,a,i,o){if(!((null==t?void 0:t.length)&&e&&r&&s))return null;const h=new Ps;h.Size=e,h.Prev=n,h.Root=s,h.Info=a,h.Encrypt=i,h.ID=o;const c=xs.toTableBytes(t);return new _s(c,h,r)}static parse(t,e,r){if(!t||isNaN(e))return null;const s=t.getXrefTableBoundsAt(e);if(!s)return null;const n=t.getDictBoundsAt(s.end+1);if(!n)return null;const a=t.sliceCharCodes(s.contentStart,s.contentEnd),i=Ps.parse({parser:t,bounds:n});if(!i)return null;return{value:new _s(a,i.value,r),start:null,end:null}}createUpdate(t,e){return _s.createFrom(this,t,e)}getEntries(){if(!this._table.length)return[];return xs.fromTableBytes(this._table)}toArray(t){const e=this._trailerDict.toArray(t),r=[...bt.XREF_TABLE,...bt.END_OF_LINE,...this._table,...bt.TRAILER,...bt.END_OF_LINE,...e,...bt.END_OF_LINE];return new Uint8Array(r)}}class Cs{constructor(t){if(!(null==t?void 0:t.length))throw new Error("Data is empty");this._data=[...t],this._pointer=t.length-1,this._encoder=new TextEncoder,this.fixEof()}get offset(){return this._pointer}getCurrentData(){return new Uint8Array(this._data)}writeBytes(t){(null==t?void 0:t.length)&&(this._data.push(...t),this._pointer+=t.length)}writeIndirectObject(t,e){if(!(null==t?void 0:t.ref)||!e)return;const r=[...this._encoder.encode(`${t.ref.id} ${t.ref.generation} `),...bt.OBJ,...bt.END_OF_LINE,...e.toArray(t),...bt.OBJ_END,...bt.END_OF_LINE];this.writeBytes(r)}writeEof(t){const e=[...bt.XREF_START,...bt.END_OF_LINE,...this._encoder.encode(t+""),...bt.END_OF_LINE,...bt.END_OF_FILE,...bt.END_OF_LINE];this.writeBytes(e)}fixEof(){this._data[this._pointer]!==C&&(this._data[this._pointer-1]!==k?(this._data.push(k,C),this._pointer+=2):(this._data.push(C),this._pointer+=1))}}class Ss{constructor(t){var e;const r=[],s=[],n=[];let a=0;t.forEach((t=>{for(const e of t.getEntries()){switch(e.type){case Vt:r.push(e);break;case zt:s.push(e);break;case Ht:n.push(e);break;default:continue}e.id>a&&(a=e.id)}})),this.size=a+1;const i={id:0,generation:65535,nextFreeId:0},o=new d(i),h=new Map,c=new Map;let u=!1;for(const t of r){if(!u&&0===t.id){u=!0,i.nextFreeId=t.nextFreeId;continue}const e=c.get(t.id);(!e||e.generation<t.generation)&&c.set(t.id,{id:t.id,generation:t.generation,nextFreeId:t.nextFreeId})}let l,p=i.nextFreeId;for(;p;)l=c.get(p),c.delete(p),o.push(l),p=l.nextFreeId;[...c].forEach((t=>{const e=t[1];65535===e.generation&&0===e.nextFreeId&&h.set(e.id,e)})),this.freeLinkedList=o,this.freeOutsideListMap=h;const f=new Map;for(const t of s){if(this.isFreed(t))continue;const e=f.get(t.id);e&&e.generation>=t.generation||f.set(t.id,{id:t.id,generation:t.generation,byteOffset:t.byteOffset})}for(const t of n){if(this.isFreed(t))continue;if(f.get(t.id))continue;const r=null===(e=f.get(t.streamId))||void 0===e?void 0:e.byteOffset;r&&f.set(t.id,{id:t.id,generation:t.generation,byteOffset:r,compressed:!0,streamId:t.streamId,streamIndex:t.streamIndex})}this.usedMap=f}getOffset(t){var e;return null===(e=this.usedMap.get(t))||void 0===e?void 0:e.byteOffset}getGeneration(t){var e;return null===(e=this.usedMap.get(t))||void 0===e?void 0:e.generation}isFreed(t){return this.freeOutsideListMap.has(t.id)||this.freeLinkedList.has(t,((t,e)=>t.id===e.id&&t.generation<e.generation))}isUsed(t){return this.usedMap.has(t)}}class ks{constructor(t){this._refData=t,this._size=t.size;const e=new d;for(const r of t.freeLinkedList)e.push(r);this._freeLinkedList=e,this._usedMap=new Map}get size(){return this._size}takeFreeRef(t,e=!1){let r;if(!e&&this._freeLinkedList.length>1){const e=this._freeLinkedList.pop();this._freeLinkedList.tail.nextFreeId=0,r={id:e.id,generation:e.generation,byteOffset:t}}else r={id:this._size++,generation:0,byteOffset:t};return this._usedMap.set(r.id,r),r}setRefFree(t){if(this._usedMap.has(t)&&(this._usedMap.delete(t),this._size>this._refData.size&&this._size===t+1&&this._size--),this._refData.isUsed(t)){const e={id:t,generation:this._refData.getGeneration(t)+1,nextFreeId:0};if(-1!==this._freeLinkedList.findIndex(e,((t,e)=>t.id===e.id&&t.generation<=e.generation)))return;this._freeLinkedList.tail.nextFreeId=t,this._freeLinkedList.push(e)}}updateUsedRef(t){if(t.compressed&&t.generation)return!1;if(this.isFreed(t))return!1;const e=this._usedMap.get(t.id);if(e&&t.generation>=e.generation)return this._usedMap.set(t.id,t),!0;if(this._refData.isUsed(t.id)){const e=this._refData.getGeneration(t.generation);if(t.generation>=e)return this._usedMap.set(t.id,t),!0}return!1}exportEntries(){const t=[];for(const e of this._freeLinkedList)t.push(new xs(Vt,e.id,e.generation,null,e.nextFreeId));return this._usedMap.forEach((e=>{e.compressed?t.push(new xs(Ht,e.id,0,null,null,e.streamId,e.streamIndex)):t.push(new xs(zt,e.id,e.generation,e.byteOffset))})),t}isFreed(t){return this._freeLinkedList.has(t,((t,e)=>t.id===e.id&&t.generation<e.generation))}isUsed(t){return this._usedMap.has(t)||this._refData.isUsed(t)}}const Ns={CLOUD:"/PolygonCloud",POLYGON_DIMESION:"/PolygonDimension",POLYLINE_DIMESION:"/PolyLineDimension"};class Is extends ss{constructor(t){super(t)}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.Vertices&&(s.push(...r.encode("/Vertices "),et),this.Vertices.forEach((t=>s.push(...r.encode(" "+t)))),s.push(st)),this.IT&&s.push(...r.encode("/IT "),...r.encode(this.IT)),this.Measure&&s.push(...r.encode("/Measure "),...this.Measure.toArray(t));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Vertices":o=this.parseNumberArrayProp(a,e,o,!0);break;case"/IT":const r=e.parseNameAt(o,!0);if(r&&Object.values(Ns).includes(r.value)){this.IT=r.value,o=r.end+1;break}throw new Error("Can't parse /IT property value");case"/Measure":const s=e.getValueTypeAt(o);if(s===Me){const r=Ar.parseRef(e,o);if(r&&t.parseInfoGetter){const e=t.parseInfoGetter(r.value.id);if(e){const t=Fr.parse(e);if(t){this.Measure=t.value,o=t.end+1;break}}}throw new Error("Can't parse /Measure value reference")}if(s===Ie){const t=e.getDictBoundsAt(o);if(t){const r=Fr.parse({parser:e,bounds:t});if(r){this.Measure=r.value,o=r.end+1;break}}throw new Error("Can't parse /Measure value dictionary")}throw new Error(`Unsupported /Measure property value type: ${s}`);default:o=e.skipToNextName(o,n-1)}return!!this.Vertices}}class Bs extends Is{constructor(){super(Fe)}static parse(t){const e=new Bs;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){return super.toArray(t)}tryParseProps(t){return!!super.tryParseProps(t)}}class Ms extends Is{constructor(){super(Ve),this.LE=[Ke.NONE,Ke.NONE]}static parse(t){const e=new Ms;return e.tryParseProps(t)?{value:e,start:t.bounds.start,end:t.bounds.end}:null}toArray(t){const e=super.toArray(t),r=new TextEncoder,s=[];this.LE&&(s.push(...r.encode("/LE "),et),this.LE.forEach((t=>s.push(N,...r.encode(t)))),s.push(st));const n=[...e.subarray(0,2),...s,...e.subarray(2,e.length)];return new Uint8Array(n)}tryParseProps(t){if(!super.tryParseProps(t))return!1;const{parser:e,bounds:r}=t,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=e.skipToNextName(s,n-1);if(-1===o)return!1;for(;i=e.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/LE":const t=e.parseNameAt(o,!0);if(!(t&&Object.values(Ke).includes(t.value[0])&&Object.values(Ke).includes(t.value[1])))throw new Error("Can't parse /LE property value");this.LE=[t.value[0],t.value[1]],o=t.end+1;break;default:o=e.skipToNextName(o,n-1)}return!0}}class Rs{constructor(t){this.getObjectParseInfo=t=>{var e,r,s;if(!t)return null;const n=null===(e=this._referenceData)||void 0===e?void 0:e.getOffset(t);if(isNaN(n))return null;const a=Ar.parse(this._docParser,n);if(!a)return null;const i=this._docParser.getIndirectObjectBoundsAt(a.end+1,!0);if(!i)return null;const o=this.getObjectParseInfo,h={parser:this._docParser,bounds:i,parseInfoGetter:o,cryptInfo:{ref:{id:a.value.id,generation:a.value.generation},stringCryptor:null===(r=this._authResult)||void 0===r?void 0:r.stringCryptor,streamCryptor:null===(s=this._authResult)||void 0===s?void 0:s.streamCryptor}};if(a.value.id===t)return h;const c=gs.parse(h);if(!c)return;const d=c.value.getObjectData(t);return d?(d.parseInfoGetter=o,d):null},this._data=t,this._docParser=new Nr(t),this._version=this._docParser.getPdfVersion();const e=this._docParser.getLastXrefIndex();if(!e)throw new Error("File doesn't contain update section");const r=Rs.parseAllXrefs(this._docParser,e.value);if(!r.length)throw new Error("Failed to parse cross-reference sections");this._xrefs=r,this._referenceData=new Ss(r),this.parseEncryption()}get size(){var t;return(null===(t=this._xrefs)||void 0===t?void 0:t.length)?this._xrefs[0].size:0}get encrypted(){return!!this._encryption}get authenticated(){return!this._encryption||!!this._authResult}static parseXref(t,e,r){if(!t||!e)return null;const s=e,n=t.findSubarrayIndex(bt.XREF_TABLE,{minIndex:e,closedOnly:!0});if(n&&n.start===e){const n=t.findSubarrayIndex(bt.XREF_HYBRID,{minIndex:e,maxIndex:r,closedOnly:!0});if(!n){const r=_s.parse(t,e,s);return null==r?void 0:r.value}{const r=t.parseNumberAt(n.end+1);if(!r)return null;e=r.value}}const a=Ar.parse(t,e,!1);if(!a)return null;const i=t.getIndirectObjectBoundsAt(a.end+1);if(!i)return null;const o=Es.parse({parser:t,bounds:i},s);return null==o?void 0:o.value}static parseAllXrefs(t,e){const r=[];let s,n=t.maxIndex;for(;e&&(s=Rs.parseXref(t,e,n),s);)r.push(s),n=e,e=s.prev;return r}authenticate(t){if(this.authenticated)return!0;const e=this._encryption.toCryptOptions(),r=this._xrefs[0].id[0].hex,s=new yr(e,r);return this._authResult=s.authenticate(t),this.authenticated}getSupportedAnnotations(){var t;this.checkAuthentication(),this._catalog||(this.parsePageTree(),console.log(this._pages));const e=new Map;for(const r of this._pages){if(!r.Annots)break;const s=[];if(Array.isArray(r.Annots))s.push(...r.Annots);else{const e=this.getObjectParseInfo(r.Annots.id);if(e){const r=Ar.parseRefArray(e.parser,e.bounds.contentStart);(null===(t=null==r?void 0:r.value)||void 0===t?void 0:t.length)&&s.push(...r.value)}}const n=[];for(const t of s){const e=this.getObjectParseInfo(t.id);e.rect=r.MediaBox;let s;switch(e.parser.parseDictSubtype(e.bounds)){case ze:s=us.parse(e);break;case De:s=ls.parse(e);break;case Te:s=rs.parse(e);break;case Ue:s=ns.parse(e);break;case Oe:s=hs.parse(e);break;case Fe:s=Bs.parse(e);break;case Ve:s=Ms.parse(e);break;case Le:s=os.parse(e);break;case He:s=cs.parse(e)}s&&(n.push(s.value),console.log(s.value))}e.set(r.id,n)}return e}getUpdatedData(t){var e,r;this.checkAuthentication();const s=new ks(this._referenceData),n=new Cs(this._data);null===(e=this._authResult)||void 0===e||e.stringCryptor,null===(r=this._authResult)||void 0===r||r.streamCryptor;for(const e of t)for(const t of e.deleted)t.id&&(s.setRefFree(t.id),t instanceof ts&&t.Popup&&s.setRefFree(t.Popup.id));this.writeXref(s,n);return n.getCurrentData()}checkAuthentication(){if(!this.authenticated)throw new Error("Unauthorized access to file data")}parseEncryption(){const t=this._xrefs[0].encrypt;if(!t)return;const e=this.getObjectParseInfo(t.id),r=ys.parse(e);if(!r)throw new Error("Encryption dict can't be parsed");this._encryption=r.value}parsePageTree(){const t=this._xrefs[0].root,e=this.getObjectParseInfo(t.id),r=As.parse(e);if(!r)throw new Error("Document root catalog not found");this._catalog=r.value;const s=r.value.Pages,n=this.getObjectParseInfo(s.id),a=ms.parse(n);if(!a)throw new Error("Document root page tree not found");this._pageRoot=a.value;const i=[];this.parsePages(i,a.value),this._pages=i}parsePages(t,e){if(e.Kids.length)for(const r of e.Kids){const e=this.getObjectParseInfo(r.id);if(!e)continue;const s=e.parser.parseDictType(e.bounds);if(s===ue){const r=ms.parse(e);r&&this.parsePages(t,r.value)}else if(s===le){const r=ws.parse(e);r&&t.push(r.value)}}}writeXref(t,e){const r=this._xrefs[0],s=e.offset,n=t.takeFreeRef(s,!0),a=t.exportEntries(),i=r.createUpdate(a,s);e.writeIndirectObject({ref:n},i),e.writeEof(s)}}class Ds{constructor(t){if(this.onAnnotationDictChange={set:(t,e,r)=>(t[e]=r,!0)},!(null==t?void 0:t.length))throw new Error("Data is empty");this._sourceData=t,this._documentData=new Rs(t)}tryAuthenticate(t=""){return!!this._documentData.authenticated||this._documentData.authenticate(t)}getRefinedData(){const t=this.getAnnotationMap(),e=[];return(null==t?void 0:t.size)&&this.getAnnotationMap().forEach(((t,r)=>{const s={pageId:r,deleted:t.slice(),edited:[],added:[]};e.push(s)})),this._documentData.getUpdatedData(e)}getExportedData(){return null}getPageAnnotations(t){const e=this.getAnnotationMap().get(t);return e?e.map((t=>new Proxy(t,this.onAnnotationDictChange))):[]}addAnnotation(t,e){const r=this.getAnnotationMap().get(t);r?r.push(e):this.getAnnotationMap().set(t,[e])}removeAnnotation(t){t.isDeleted=!0}getAnnotationMap(){if(this._annotationsByPageId)return this._annotationsByPageId;if(!this._documentData.authenticated)throw new Error("Unauthorized access to file data");return this._annotationsByPageId=this._documentData.getSupportedAnnotations(),this._annotationsByPageId}}var Ts=function(t,e,r,s){return new(r||(r=Promise))((function(n,a){function i(t){try{h(s.next(t))}catch(t){a(t)}}function o(t){try{h(s.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,o)}h((s=s.apply(t,e||[])).next())}))};class Ls{constructor(t,e){this._visibleAdjPages=0,this._previewWidth=100,this._minScale=.25,this._maxScale=4,this._scale=1,this._previewerHidden=!0,this._pages=[],this._currentPage=0,this._pointerInfo={lastPos:null,downPos:null,downScroll:null},this._timers={hidePanels:0},this._pinchInfo={active:!1,lastDist:0,minDist:10,sensitivity:.025,target:null},this.onPdfLoadingProgress=t=>{},this.onPdfLoadedAsync=(t,e)=>Ts(this,void 0,void 0,(function*(){this._pdfDocument=t,this._annotationData=e,yield this.refreshPagesAsync(),this.renderVisiblePreviews(),this.renderVisiblePages(),this._shadowRoot.querySelector("#panel-bottom").classList.remove("disabled")})),this.onPdfClosedAsync=()=>Ts(this,void 0,void 0,(function*(){this._shadowRoot.querySelector("#panel-bottom").classList.add("disabled"),this._pdfDocument&&(this._pdfDocument=null),yield this.refreshPagesAsync()})),this.onMainContainerResize=(t,e)=>{const{width:r}=this._mainContainer.getBoundingClientRect();r<721?this._mainContainer.classList.add("mobile"):this._mainContainer.classList.remove("mobile")},this.onTextModeButtonClick=()=>{this.toggleMode("text")},this.onHandModeButtonClick=()=>{this.toggleMode("hand")},this.onAnnotationModeButtonClick=()=>{this.toggleMode("annotation")},this.onPreviewerToggleClick=()=>{this._previewerHidden?(this._mainContainer.classList.remove("hide-previewer"),this._shadowRoot.querySelector("div#toggle-previewer").classList.add("on"),this._previewerHidden=!1,setTimeout((()=>this.renderVisiblePreviews()),1e3)):(this._mainContainer.classList.add("hide-previewer"),this._shadowRoot.querySelector("div#toggle-previewer").classList.remove("on"),this._previewerHidden=!0)},this.onPreviewerPageClick=t=>{let e,r=t.target;for(;r&&!e;){const t=r.dataset.pageNumber;t?e=+t:r=r.parentElement}e&&this.scrollToPage(e-1)},this.onPreviewerScroll=t=>{this.renderVisiblePreviews()},this.onPaginatorInput=t=>{t.target instanceof HTMLInputElement&&(t.target.value=t.target.value.replace(/[^\d]+/g,""))},this.onPaginatorChange=t=>{if(t.target instanceof HTMLInputElement){const e=Math.max(Math.min(+t.target.value,this._pdfDocument.numPages),1);e+""!==t.target.value&&(t.target.value=e+""),this.scrollToPage(e-1)}},this.onPaginatorPrevClick=()=>{const t=u(this._currentPage-1,0,this._pages.length-1);this.scrollToPage(t)},this.onPaginatorNextClick=()=>{const t=u(this._currentPage+1,0,this._pages.length-1);this.scrollToPage(t)},this.onZoomOutClick=()=>{this.zoomOut()},this.onZoomInClick=()=>{this.zoomIn()},this.onZoomFitViewerClick=()=>{const t=u((this._viewer.getBoundingClientRect().width-20)/this._pages[this._currentPage].viewContainer.getBoundingClientRect().width*this._scale,this._minScale,this._maxScale);this.setScale(t),this.scrollToPage(this._currentPage)},this.onZoomFitPageClick=()=>{const{width:t,height:e}=this._viewer.getBoundingClientRect(),{width:r,height:s}=this._pages[this._currentPage].viewContainer.getBoundingClientRect(),n=u((t-20)/r*this._scale,this._minScale,this._maxScale),a=u((e-20)/s*this._scale,this._minScale,this._maxScale);this.setScale(Math.min(n,a)),this.scrollToPage(this._currentPage)},this.onViewerScroll=t=>{this.renderVisiblePages()},this.onViewerPointerMove=t=>{const{clientX:e,clientY:r}=t,{x:s,y:n,width:a,height:i}=this._viewer.getBoundingClientRect(),o=e-s,h=r-n,c=a-o,d=i-h;Math.min(o,c,h,d)>100?this._panelsHidden||this._timers.hidePanels||(this._timers.hidePanels=setTimeout((()=>{this._mainContainer.classList.add("hide-panels"),this._panelsHidden=!0,this._timers.hidePanels=null}),5e3)):(this._timers.hidePanels&&(clearTimeout(this._timers.hidePanels),this._timers.hidePanels=null),this._panelsHidden&&(this._mainContainer.classList.remove("hide-panels"),this._panelsHidden=!1)),this._pointerInfo.lastPos=new l(e,r)},this.onViewerPointerDown=t=>{if("hand"!==this._mode)return;const{clientX:e,clientY:r}=t;this._pointerInfo.downPos=new l(e,r),this._pointerInfo.downScroll=new l(this._viewer.scrollLeft,this._viewer.scrollTop);const s=t=>{const{x:e,y:r}=this._pointerInfo.downPos,{x:s,y:n}=this._pointerInfo.downScroll,a=t.clientX-e,i=t.clientY-r;this._viewer.scrollTo(s-a,n-i)},n=t=>{this._pointerInfo.downPos=null,this._pointerInfo.downScroll=null,window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",n),window.removeEventListener("pointerout",n)};window.addEventListener("pointermove",s),window.addEventListener("pointerup",n),window.addEventListener("pointerout",n)},this.onViewerTouchStart=t=>{if(2!==t.touches.length)return;const e=t.touches[0],r=t.touches[1];this._pinchInfo.active=!0,this._pinchInfo.lastDist=h(e.clientX,e.clientY,r.clientX,r.clientY);const s=t=>{if(2!==t.touches.length)return;const e=t.touches[0],r=t.touches[1],s=h(e.clientX,e.clientY,r.clientX,r.clientY),n=s-this._pinchInfo.lastDist,a=Math.floor(n/this._pinchInfo.minDist);if(a){const t=new l((r.clientX+e.clientX)/2,(r.clientY+e.clientY)/2);this._pinchInfo.lastDist=s,this.zoom(a*this._pinchInfo.sensitivity,t)}},n=e=>{this._pinchInfo.active=!1,this._pinchInfo.lastDist=0,t.target.removeEventListener("touchmove",s),t.target.removeEventListener("touchend",n),t.target.removeEventListener("touchcancel",n)};t.target.addEventListener("touchmove",s),t.target.addEventListener("touchend",n),t.target.addEventListener("touchcancel",n)},this.onViewerWheel=t=>{t.ctrlKey&&(t.preventDefault(),t.deltaY>0?this.zoomOut(this._pointerInfo.lastPos):this.zoomIn(this._pointerInfo.lastPos))};const s=document.querySelector(t);if(!s)throw new Error("Container not found");if(!(s instanceof HTMLDivElement))throw new Error("Container is not a DIV element");if(this._outerContainer=s,!e)throw new Error("Worker source path not defined");r.workerSrc=e,this.initViewerGUI()}destroy(){var t,e;null===(t=this._pdfLoadingTask)||void 0===t||t.destroy(),this._pages.forEach((t=>t.destroy())),this._pdfDocument&&(this._pdfDocument.cleanup(),this._pdfDocument.destroy()),null===(e=this._mainContainerResizeObserver)||void 0===e||e.disconnect(),this._shadowRoot.innerHTML=""}openPdfAsync(t){return Ts(this,void 0,void 0,(function*(){let e,r;try{if(t instanceof Uint8Array)e=t;else{let r;if("string"==typeof t){const e=yield fetch(t);r=yield e.blob()}else r=t;const s=yield r.arrayBuffer();e=new Uint8Array(s)}}catch(t){throw new Error(`Cannot load file data: ${t.message}`)}const n=new Ds(e);let a;for(;;){if(n.tryAuthenticate(a))break;if(a=yield this.showPasswordDialogAsync(),null===a)throw new Error("File loading cancelled: authentication aborted")}e=n.getRefinedData();try{if(this._pdfLoadingTask)return yield this.closePdfAsync(),this.openPdfAsync(e);this._pdfLoadingTask=s({data:e,password:a}),this._pdfLoadingTask.onProgress=this.onPdfLoadingProgress,r=yield this._pdfLoadingTask.promise,this._pdfLoadingTask=null}catch(t){throw new Error(`Cannot open PDF: ${t.message}`)}yield this.onPdfLoadedAsync(r,n)}))}closePdfAsync(){return Ts(this,void 0,void 0,(function*(){this._pdfLoadingTask&&(this._pdfLoadingTask.destroyed||(yield this._pdfLoadingTask.destroy()),this._pdfLoadingTask=null),yield this.onPdfClosedAsync()}))}initViewerGUI(){this._shadowRoot=this._outerContainer.attachShadow({mode:"open"}),this._shadowRoot.innerHTML='\n  <style>\n    :host {\n      --color-primary-final: var(--color-primary, rgba(40,40,40,1));\n      --color-primary-tr-final: var(--color-primary-tr, rgba(40,40,40,0.9));\n      --color-secondary-final: var(--color-secondary, rgba(60,60,60,1));\n      --color-secondary-tr-final: var(--color-secondary-tr, rgba(60,60,60,0.9));\n      --color-accent-final: var(--color-accent, rgba(96,96,96,1));\n      --color-shadow-final: var(--color-shadow, rgba(0,0,0,0.75));\n      --color-bg-final: var(--color-bg, rgba(128,128,128,1));\n      --color-fg-primary-final: var(--color-fg-primary, rgba(255,255,255,1));\n      --color-fg-secondary-final: var(--color-fg-secondary, rgba(187,187,187,1));\n      --color-fg-accent-final: var(--color-fg-accent, rgba(255,255,255,1));\n      --color-text-selection-final: var(--color-text-selection, rgba(104,104,128,0.3));\n    }\n\n    .disabled {\n      pointer-events: none;\n    }\n\n    .relative {\n      position: relative;\n    }\n    .absolute {\n      position: absolute;\n    }\n    .abs-stretch {\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n    }\n    .abs-topleft {\n      position: absolute;\n      left: 0;\n      top: 0;\n    }\n    .stretch {\n      width: 100%;\n      height: 100%;\n    }\n\n    #main-container {\n      box-sizing: border-box;\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      justify-content: stretch;\n      align-items: stretch;\n      width: 100%;\n      height: 100%;\n      background: var(--color-bg-final);\n    }\n  \n    #panel-top {\n      position: relative;\n      display: flex;\n      flex-direction: row;\n      justify-content: space-between;\n      align-items: center;\n      flex-shrink: 0;\n      width: 100%;\n      height: 50px;\n      background: var(--color-primary-final);\n      box-shadow: 0 0 10px var(--color-shadow-final);\n      z-index: 1;\n      transition: height 0.25s ease-out 0.1s;\n    }\n    .hide-panels #panel-top {\n      height: 0;\n      transition: height 0.25s ease-in 0.2s;\n    }\n  \n    #panel-bottom {\n      position: absolute;\n      display: flex;\n      flex-direction: row;\n      justify-content: center;\n      align-items: center;\n      flex-grow: 0;\n      flex-shrink: 0;\n      left: calc(50% - 160px);\n      bottom: 20px;\n      width: 320px;\n      height: 50px;  \n      background: var(--color-primary-tr-final);\n      box-shadow: 0 0 10px var(--color-shadow-final);\n      z-index: 1;\n      transition: height 0.25s ease-out, bottom 0.1s linear 0.25s;\n    }\n    .hide-panels #panel-bottom {\n      bottom: 0;\n      height: 0;\n      transition: bottom 0.1s linear 0.1s, height 0.25s ease-in 0.2s;\n    }\n\n    .panel-v-separator {\n      width: 1px;\n      height: 30px;\n      background-color: var(--color-fg-secondary-final);\n    }\n  \n    .panel-button {\n      cursor: pointer;\n      user-select: none;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      width: 36px;\n      height: 36px;\n      border-radius: 50%;\n    }\n    .panel-button:hover,\n    .panel-button.on {\n      background-color: var(--color-accent-final);\n    }\n    .panel-button img {\n      width: 20px;\n      height: 20px;\n      filter: invert() opacity(0.5) drop-shadow(0 0 0 var(--color-fg-primary-final)) saturate(1000%);\n    }  \n    .panel-button:hover img,\n    .panel-button.on img {\n      filter: invert() opacity(0.5) drop-shadow(0 0 0 var(--color-fg-accent-final)) saturate(1000%);\n    }  \n  \n    .subpanel {\n      display: flex;\n      flex-direction: row;\n      justify-content: center;\n      align-items: center;\n      margin: 0 4px;\n    }    \n    \n    .panel-item {\n      transform: scale(1);\n      transition: opacity 0.1s ease-out 0.35s, transform 0s linear 0.35s;\n    }\n    .hide-panels .panel-item {\n      cursor: default;      \n      opacity: 0;\n      transform: scale(0);\n      transition: opacity 0.1s ease-in, transform 0s linear 0.1s;\n    }\n  \n    #paginator {  \n      user-select: none;\n      font-family: sans-serif;\n      font-size: 16px;\n      color: var(--color-fg-primary-final);\n    }\n    #paginator-input {\n      text-align: center; \n      font-size: 16px;\n      width: 30px;\n      height: 30px;\n      margin: 2px;\n      padding: 0;\n      outline: none;\n      border: none;\n      color: var(--color-fg-primary-final);\n      background-color: var(--color-primary-final);\n    }\n    #paginator-total {\n      margin: 4px;\n    }\n\n    #toggle-previewer {\n      margin: 4px;\n    }\n      \n    #previewer {\n      box-sizing: border-box;\n      position: absolute;\n      display: flex;\n      flex-direction: column;\n      justify-content: flex-start;\n      overflow-y: auto;\n      left: 0;\n      top: 50px;\n      bottom: 0;\n      width: 160px; \n      padding-top: 0px;\n      background: var(--color-secondary-final);\n      box-shadow: 0 0 10px var(--color-shadow-final);\n      z-index: 1;\n      transition: padding-top 0.25s ease-out 0.1s, top 0.25s ease-out 0.1s, width 0.25s ease-out;\n    } \n    .hide-panels #previewer {\n      top: 0;\n      padding-top: 50px;\n      transition: padding-top 0.25s ease-in 0.2s, top 0.25s ease-in 0.2s;\n    }   \n    .mobile #previewer {\n      background: var(--color-secondary-tr-final);\n    } \n    .hide-previewer #previewer {\n      width: 0;\n      transition: width 0.25s ease-in 0.1s;\n    }\n    #previewer .page-preview {      \n      transform: scaleX(1);\n      transition: opacity 0.1s ease-out 0.35s, transform 0s linear 0.35s;\n    }\n    .hide-previewer #previewer .page-preview {\n      opacity: 0;\n      transform: scaleX(0);\n      transition: opacity 0.1s ease-in, transform 0s linear 0.1s;\n    }\n  \n    #viewer {\n      box-sizing: border-box;\n      position: absolute;\n      display: flex;\n      flex-direction: column;\n      justify-content: flex-start;\n      overflow: auto;\n      left: 160px;\n      right: 0;\n      top: 50px;\n      bottom: 0;\n      padding-top: 0px;\n      transition: padding-top 0.25s ease-out 0.1s, top 0.25s ease-out 0.1s, left 0.25s ease-out;\n    }\n    #viewer.mode-hand {\n      cursor: grab !important;\n      user-select: none !important;\n    }\n    .hide-panels #viewer {\n      top: 0;\n      padding-top: 50px;\n      transition: padding-top 0.25s ease-in 0.2s, top 0.25s ease-in 0.2s;\n    }      \n    .hide-panels.mobile #viewer,\n    .hide-panels.hide-previewer #viewer {\n      top: 0;\n      padding-top: 50px;\n      left: 0;\n      transition: padding-top 0.25s ease-in 0.2s, top 0.25s ease-in 0.2s, left 0.25s ease-in;\n    }   \n    .mobile #viewer,\n    .hide-previewer #viewer {\n      top: 50px;\n      padding-top: 0px;\n      left: 0;\n      transition: padding-top 0.25s ease-out 0.1s, top 0.25s ease-out 0.1s, left 0.25s ease-in;\n    } \n  \n    .page {    \n      position: relative;\n      display: flex;\n      flex-grow: 0;\n      flex-shrink: 0;\n      margin: 10px auto;\n      background-color: white;\n      box-shadow: 0 0 10px var(--color-shadow-final);\n    }\n    .page-preview {   \n      cursor: pointer; \n      position: relative;\n      display: flex;\n      flex-grow: 0;\n      flex-shrink: 0;\n      margin: 0 auto;\n      background-color: white;\n      background-clip: content-box;\n      border-style: solid;\n      border-width: 10px 10px 20px 10px;\n      border-color: transparent;\n    }\n    .page-preview:hover,\n    .page-preview.current {\n      border-color: var(--color-accent-final);\n    }\n    .page-preview::after {\n      display: inline-block;\n      position: absolute;\n      top: calc(100% + 3px);\n      width: 100%;\n      text-align: center;\n      font-family: sans-serif;\n      font-size: 14px;\n      line-height: 1;\n      color: var(--color-fg-primary-final);\n      content: attr(data-page-number) " ";\n    }\n\n    .page-canvas {\n      background-color: white;\n    } \n    \n    .page-text {\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      margin: 0;\n      padding: 0;\n      overflow: hidden;\n      line-height: 1;\n    }\n    .page-text span {\n      cursor: text;\n      position: absolute;\n      white-space: pre;\n      color: transparent;\n      transform-origin: 0% 0%;\n    }\n    .page-text ::selection {\n      background: var(--color-text-selection-final);\n    }\n    .mode-hand .page-text span {\n      cursor: grab;\n    }\n    \n    .page-annotations {\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      margin: 0;\n      padding: 0;\n      overflow: hidden;\n    }\n    .mode-text .page-annotations,\n    .mode-hand .page-annotations {\n      pointer-events: none;\n    }\n    \n    #password-dialog {\n      position: absolute;\n      left: 0;\n      top: 0;\n      width: 100%;\n      height: 100%;\n      background: var(--color-secondary-tr-final);\n      z-index: 2;\n    }\n    #password-dialog .form {\n      position: absolute;\n      display: flex;\n      flex-direction: row;\n      justify-content: stretch;\n      align-items: stretch;\n      flex-grow: 0;\n      flex-shrink: 0;\n      left: calc(50% - 160px);\n      top: calc(50% - 25px);\n      width: 320px;\n      height: 50px;  \n      background: var(--color-primary-tr-final);\n      box-shadow: 0 0 10px var(--color-shadow-final);\n    }\n    #password-dialog input {\n      width: 220px;\n      margin: 10px 0 10px 10px;\n      padding: 5px;\n      font-size: 16px;\n      outline: none;\n      border: none;\n      color: var(--color-fg-primary-final);\n      background-color: var(--color-primary-final);\n    }\n    #password-dialog input::placeholder {\n      font-size: 14px;\n      font-style: italic;\n      color: var(--color-fg-primary-final);\n    }\n    #password-dialog .buttons {\n      display: flex;\n      flex-direction: row;\n      justify-content: center;\n      align-items: center;\n      flex-grow: 1;\n      flex-shrink: 1;\n      width: 100px;\n    } \n\n    .svg-annotation {\n      cursor: pointer;\n    } \n    .svg-annot-rect,\n    .svg-annot-box {\n      fill: transparent;\n    }\n    .mode-annotation .svg-annotation.selected {\n      cursor: grab;\n    } \n    .mode-annotation .svg-annotation.selected .svg-annot-rect,\n    .mode-annotation .svg-annotation.selected .svg-annot-box {\n      stroke: var(--color-secondary-tr-final);\n      stroke-dasharray: 3 3;\n    } \n    .mode-annotation .svg-annotation.selected .svg-annot-handle-scale,\n    .mode-annotation .svg-annotation.selected .svg-annot-handle-rotation {\n      r: 5;\n      fill: var(--color-primary-final);\n      cursor: pointer;\n    }\n    .mode-annotation .svg-annotation.selected .svg-annot-rotation {\n      fill: none;\n      cursor: pointer;\n    }\n    .mode-annotation .svg-annotation.selected .svg-annot-rotation .circle {\n      r: 25;\n    }\n    .mode-annotation .svg-annotation.selected .svg-annot-rotation .dashed {\n      stroke: var(--color-secondary-tr-final);\n      stroke-dasharray: 3 3;\n    }\n  </style>\n\n  <div id="main-container" class="hide-previewer" \n    ondragstart="return false;" ondrop="return false;">\n    <div id="viewer"></div>\n    <div id="previewer"></div>\n    <div id="panel-top"> \n      <div class="subpanel panel-item">\n        <div id="toggle-previewer" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcmlDQ1BpY2MAACiRdZE9S8NQFIbftkpFWwrqIOKQoYpCC0VBHKWCXapDW8GqS3KbtEKShpsUKa6Ci0PBQXTxa/Af6Cq4KgiCIoi4+Af8WqTEc5tCi7Qn3JyH9573cO+5gD+tM8PuSQCG6fBMKimt5tek4Dt8GEQYQ5iSmW0tZRdz6Bo/j1RN8RAXvbrXdYyBgmozwNdHPMss7hDPE6e3HEvwHvEwK8kF4hPiGKcDEt8KXfH4TXDR4y/BPJdZAPyip1RsY6WNWYkbxJPEUUOvsOZ5xE1CqrmSpTxKaww2MkghCQkKKtiEDgdxyibNrLMv0fAto0weRn8LVXByFFEib4zUCnVVKWukq/TpqIq5/5+nrc1Me91DSaD31XU/x4HgPlCvue7vqevWz4DAC3BttvxlmtPcN+m1lhY9BiI7wOVNS1MOgKtdYOTZkrnckAK0/JoGfFwA4TwwdA/0r3uzau7j/AnIbdMT3QGHR8AE1Uc2/gDt82gCvNGYhAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAcpJREFUeNrtWwFuwyAMjBEPWNf8/4XpugesoWMKUppBYidQ5cAnVZWaRtGdDxscoC6Bvu9d7PfRue6sMETJa8MwRC8Slzi6ACkhiEu8FgGWQpiucdBW9FNj5wiWzyvxjOk5/muVm30n8Xfjl8NfkNeEMLHo10Cem/CbyAHeCZMb/sGePfqTfXfh5/Hovu/3F25Lx9ujiURad6WIld1xHDtjTLLshXv8f7Zgka2dY04ClQNCxDmR5eL0Dvi63Vavf16vh1xjzzy13YKUPPQQWFaDHOShBJjX8VzkIRdDa+RDvvBlskoBOOSlVcLURr7KIVCKPIQAJclDJsGc5FkzwdBUqJE8pANykocTIDd59mKI2zIv0Q8oSR7GAaXIQwhQkjx0GVQBGI5xjEWRrTGqkmGjQ0AFUAFUABVABVAB2sXmRMi3pEbnSDLJyNm3h3MAEvnsAqCRZw0Bb/l5Q2THjg1qaghoFVABVAAVQAVQAVQAFUCCI9thxYSJXj5WcspCHaACNNgP+LhcTr+gySqAX/nNX2nP99ujI/aaX3NAbAPDkQ0RSNFfPTUWbkA/QLUVTNoT9RpOj+rJ0aUDJE5AdkDy8LRECEQBUrnsCeUexwK5uUFRAAAAAElFTkSuQmCC"/>\n        </div> \n      </div>\n      <div id="modes" class="subpanel panel-item">\n        <div id="button-mode-text" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABb2lDQ1BpY2MAACiRdZE7SwNBFIU/N4piFBEtRCxSRLFQCApiKRFMoxYxgq8mu24SIRuX3Q0itoKNRcBCtPFV+A+0FWwVBEERRGz8A74akfVOVohIMsvs/Tgz5zJzBrTJvGG59TGwCp6TTMQjc/MLkcYXQmiE6aQ9bbj21MxEiprj8446VW8HVa/a+6qO8LLpGlDXJDxi2I4nPCY8uebZireFO41celn4UHjAkQMKXyldD/hZcTbgd8VOKjkOmuoZyf5h/Q8bOccS7heOWvmi8XsedZMWszA7I7VbZg8uSRLEiaBTZIU8HoNSC5JZdV+s7JtmVTyG/G3WccSRJSfeAVGL0tWUmhHdlC/Pusr9f55uZngo6N4Sh4Yn33/rhcYd+C75/teR738fQ+gRLgoV/6rkNPoheqmiRQ+gbRPOLiuavgvnW9D1YKeddFkKydQyGXg9hdZ56LiB5sUgq991Tu4htSFPdA17+9An+9uWfgCZXmfbLPy9EwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAtBJREFUeNrlWwtuwjAMra2cALj/CWFHWLYiQKGLEzu282GRqiFo3bznT23PhY1Yl8vl/vd6vW6VFTf5AitZp/P5JQsByPMoHEABr12oAE/d21IWG0+gTuywYrLx2OumR8sOSnmg3LwaONcFiqZT0j4jBngAhoZYVDX/HLbQCfgRWJT6MkVGycefn0tEQO5HS7YJWWwCanI5+y8REKxUu99UEEhzsQO0hFOKK5GFrdrfhT2PQU+RJiVVCdA8WkYA0O4DPTdrHUg5AKUk4AhNzURy0DIqDH4uJB/3sH+mAt+fVPg7Ri+Nx5bonpFtIscrFeZkfFGxeSs5pLLQGfww2Vy3xIXAu9wDO2xMY7bgTQJODF5EQi4Q59zg+B1ODt7FElIS4HQ+v/34dbv1Ah8NrqleW+t14OSad7cEXAi8Cwm4GHgVCRbl8Azgm0igiqagBf/rR+BZCVaKGaor/ZY2l/aEC2reNCaE9LGXtrgy1diM4KuW8Lt/YPcDMqayAniVO+CiZm/mDvhB4JtIwA8DLyYBt3++Qmsw6bUa8wq2FeOoRoTjErkw9io6ZgR/dwGLVHMl8Mf+BzIaCCtYQvOTC5m9tJlJUD22JdVg1h0etQKsCP7lAtyO6mSWYJKwoaQWn4gEs2wVGxOOkSSYpuqaVHgECeZ1ingqy3BTUXl+E/gU3z4aYFEM9bAEc/B38wdonxLrSIJreW5ZDnuQYAaecm3UChjQNDG7B/m/QcoNJiDBXDZ22CiMluM6K1wQDoqgaqb12mMdS/6hcINlFqZDz9z3hVYnIcUVtg9dZmNyveZ+e4En3xpLL+aAfp43G0Fdp8UVsSCOKKWzEyKcbtAKbpAL4hwMotfmDF6vE78252mJr1RYo+G9KfpojHIOiYuwjlalNI3LCwYopFle1ChAky2GI7iOSc4xz+/SVK0+BrlEPH6HwgyR1MebSOBOqVHf/wB4polu0KoYHQAAAABJRU5ErkJggg=="/>\n        </div> \n        <div id="button-mode-hand" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcWlDQ1BpY2MAACiRdZE9S8NQFIbfpkpFqx3qIMUhQxWHFoqCOEoFu1SHtoJVl+Q2aYQkDUmKFFfBxaHgILr4NfgPdBVcFQRBEURc/AN+LVLiuU2hRdoTbs7De897uPdcQMjqzHD6UoBhunYukxZXi2ti6B0BxDACAVGJOdZSfrGAnvHzSNUUD0neq3dd1xgqKQ4DAgPEs8yyXeJ54uyWa3HeIx5lmlQiPiFO2HRA4luuyz6/cS77/MXZLuQWAIH3FMsdLHcw02yDeIo4buhV1joPv0lYMVfylGO0xuEghwzSECGjik3ocJGkbNLMuvtSTd8yKuRh9LdQg02OMjTyJkitUleFskq6Qp+OGp/7/3k66sy03z2cBvpfPe9zAgjtA4265/2eel7jDAi+ANdm21+hOc19k15va/FjILIDXN60NfkAuNoFxp4tyZaaUpCWoKrAxwUwXASi98Dguj+r1j7On4DCNj3RHXB4BExSfWTjD603Z+Sp2ztrAAAACXBIWXMAAAsTAAALEwEAmpwYAAADGklEQVR42uVbC47jIAytESeY6f1P2NkjLCOqInmoP5g4BChSpLZJAT8/G9sQuDHtfr+Tv/9P6WZp/35+tP6lDsEyXgBg7z0eD3qAVsE9AWgU/s8cOQG+vr+bAOCAiK2Cn9CS4TnwGrTIWYAItw9voGmfo56DJlI1DnD38jx75qGxOvcZRwuuCV++V888zaCmLyUkvlc+S0BE6uZBtBMDKHjYbvnMzVG6Rz0bvbSaByWo+0frR0GQWCSZicSE0Kv93Fm5mAl10V/4PSkrSGpRkgrAUXoatWbq8yVA8ujfFQBOg56UbxXQCoIXACytvUHwBjkepffL+Q0PYGqQseaxw5WWyScDcmyPr6uEYOzdnT3YcTcxwMsBtsTlXv1aVoJwpv0bNH16tDl8FThTmwygXeYSBtn61YAmLn6YlgFW0Bg/UgueatMYWQ+AWRiFQZjSBOql6kwneWlF6MyaA8E+6EqHtUleEQUeMD2ofcJH1QRPS4cno7tp/NjoMGbSIljpL4EfPo3ybwzAOzd5aRC0DSOTllEgBEPykBSAlmzBkjkhILyWJLb2Vy7qP54heW89oGu/rgiEKskiRdGETyurBUr7L08L0sA9FdhpTYBaZopmpMKjBwjO+5KiuVD9xVYPSuzXTRdAtdQRc90TnyMIBxBetuHib+jQxjYgPNnQ68m3igOsjm0nEALl4Q2BzvIgRC3Qwaewciu5A9pzr4sM65nAQRYszYioxPzqQUXsDzJbOMZMDwAX6GQB6vM522WDStKzdYt1HlCzQNrBXZEROAxuDYS2YUGtrAwGmw1+SmsNhdMm2n87Wxha1/PdvH/xa8GQg69eEL3ufMBszg+zPBjD2jRwgmfavv7CxC7rvqbcgA89E4cKYQNfkCTlDt0XmGDZezNt1QmuGBgJwvNvjeE/t5Siy3ncq/f9LcJTrA1Wp7GAQ2SFJ0+ItGx5C0XQNJPmhYIuiG+Otm5P9QzQypwjpmSlPR4TNDoTr6iRA40+ak/l95QD1+RaemdIE96UDqMDCUuBYBW+lhM0O1VC4nQl/SkW1MJrcvwCJhH28gf87HUAAAAASUVORK5CYII="/>\n        </div> \n        <div id="button-mode-annotation" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABb2lDQ1BpY2MAACiRdZE7SwNBFIU/N4piFBEtRCxSRLFQCApiKRFMoxYxgq8mu24SIRuX3Q0itoKNRcBCtPFV+A+0FWwVBEERRGz8A74akfVOVohIMsvs/Tgz5zJzBrTJvGG59TGwCp6TTMQjc/MLkcYXQmiE6aQ9bbj21MxEiprj8446VW8HVa/a+6qO8LLpGlDXJDxi2I4nPCY8uebZireFO41celn4UHjAkQMKXyldD/hZcTbgd8VOKjkOmuoZyf5h/Q8bOccS7heOWvmi8XsedZMWszA7I7VbZg8uSRLEiaBTZIU8HoNSC5JZdV+s7JtmVTyG/G3WccSRJSfeAVGL0tWUmhHdlC/Pusr9f55uZngo6N4Sh4Yn33/rhcYd+C75/teR738fQ+gRLgoV/6rkNPoheqmiRQ+gbRPOLiuavgvnW9D1YKeddFkKydQyGXg9hdZ56LiB5sUgq991Tu4htSFPdA17+9An+9uWfgCZXmfbLPy9EwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAhxJREFUeNrtW1lywyAMtRhO0OT+J3SaHqCxanfijsuAEQaEWDTjn2CM3kMbS2ByyP1+R9vvC+IkVRSAs22eZ2sjUIHXToCLCKACb4UAkwg1dS7gm32X78TIOp45RhZw73FOsWlO4NzyJhbOiFC22W8BPDXgdxEDNktwuZmWPvtmvAiR79dr+no+/2EzLV7nVCBFgLOl3WVZJqWUM+3tfbZ3fKJrNu0UNYmOncFYCwktdDbQlJlNRkBp+Xw8Tts/brcoq4H1A2gMSAmCUuthr+4m3iu2hIINJli37tcCKoeZSXaB4CDoiPLkgWxZ5Opi6Czg7cHSfMcXRKtxAQp4LhdoBnwVBOQEX3UWSAF+FEKbBWxMBrLZVCG0d/p9THZ87wt9KBbw94ClU9MuYOquMw7UbCnc/VpgEDAIaEhitsQ4MgFItQCuNIjDBYQSwFUHgOQYAD1bwEiDzRBw3HEJPWWpUUyMuhfgLhJ0dyZvHKnrkKtlIwgOAgYB7RNAvTJbo9iwjauyLmZauyzpwqh9HWonwufScMX3z66nHc7pkxK3fhcpVSu1rslyXf54xLYrnBK8OUbS/YCdkZRZYFM81hJSEmlzaedd4VRExJCQEjz5P0MJBH3xhvk7/jQokATk0jdnirsKAjl1zZ3jQ8Egt54cRQ4VFJbQkavK84HDUvpxlrkoUTfuOh+l6VVioYOSdCq50kNBuhQloegO1A9Y7hjyBIja5wAAAABJRU5ErkJggg=="/>\n        </div> \n      </div>\n    </div>\n    <div id="panel-bottom" class="disabled">\n      <div id="paginator" class="subpanel panel-item">\n        <div id="paginator-prev" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="paginator-next" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <input id="paginator-input" type="text">\n        <span>&nbsp/&nbsp</span>\n        <span id="paginator-total">0</span>\n      </div>\n      <div class="panel-v-separator panel-item"></div>\n      <div id="zoomer" class="subpanel panel-item">\n        <div id="zoom-out" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="zoom-in" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="zoom-fit-viewer" class="panel-button">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcWlDQ1BpY2MAACiRdZG9S8NQFMVPW8Wi1Q46SHHIUMWhhaIgjlLBLtWhrWDVJXlN2kKShpcUKa6Ci0PBQXTxa/A/0FVwVRAERRBx8R/wa5ES72sKLdLe8PJ+nHfP5eUE8Kd1Zth9CcAwHZ5JJaW1/Lo08A4fRhBEHBGZ2dZydimHnvXzSN1UD3Exq3df1xoqqDYDfEHiOWZxh3iBOL3lWIL3iMdYSS4QnxDHOF2Q+Fboisdvgosefwnmucwi4BczpWIHKx3MStwgniaOGnqVte4jviSkmqtZ2iO0JmAjgxSSkKCgijJ0OJRLGSZl1t2XaPpWUCEPo7eFGjg5iiiRN0ZqlaaqtGukq/ToqInc/+dpa7Mz3vRQEuh/dd3PSWBgH2jUXff31HUbZ0DgBbg22/4K5TT/TXq9rUWPgfAOcHnT1pQD4GoXGH+2ZC43pQAtv6YBHxfAcB4YvQcGN7ysWuc4fwJy2/SL7oDDI2CK+sObf/JNaAQfxWcoAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+0lEQVR42u2bMW/EIAyFA7qla5Ol///HdUm6dguFKlQuBwnh7ADKs5TlTsrxPp6NAZ16H0czCMTXsijO90mNUw83DwC4OwAV5hZ37rYWoV6kAAAAAAAAAAAAAAAAAAAAAADcMh6CO63F7iwnkR2cUmqe57YcEIq3zyg4cWaapnYARM7rRjtLYupXY9ggaAHxzqKDtSgbAXdIkwBqqgK4QryP8J3OBe6xLjBVAFwpnjoh9rmDUJoOuhfxqXTwTiitCbon8WE6ROrCaQi6N/GxdFjX9XtzwWkIukS8/cHPmuKfnKD1W6kTdMnM2x/8qC0+VhNIPciGoEts7+nb75ro53cm4nCJ3L0ZkrqRvWSXRwokBZR9M9SzeJoOR82SziHYe5C6kA/A2cZB8E/PsXfh+zgqLt4+DgIl2cotsivEdizJlD0aZ84ymOy/G5nd5FhyJukQwHby8td60jW3hULpxP8Wu605O+vQrEaIQqDtZ20nePG+OStJz+xW+MkJpP2s4QQqvmTmizZDUSdsg7jSCVzii7bDHkK4PF5VEzjFFx+IOAip/lsSArf4YgCxZkl6iZQQ/zKAVJ/AnQ5S4lkA0Jog3Msv3OK5HBBdHZjj300TZxvOdjcoCYHrjlHMAT0HAAAAAAAAAAAAAAAAAAAAANwzFP47jBQAgFvHDyRnPtj60cBDAAAAAElFTkSuQmCC"/>\n        </div>\n        <div id="zoom-fit-page" class="panel-button">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcWlDQ1BpY2MAACiRdZG9S8NQFMVPW8Wi1Q46SHHIUMWhhaIgjlLBLtWhrWDVJXlN2kKShpcUKa6Ci0PBQXTxa/A/0FVwVRAERRBx8R/wa5ES72sKLdLe8PJ+nHfP5eUE8Kd1Zth9CcAwHZ5JJaW1/Lo08A4fRhBEHBGZ2dZydimHnvXzSN1UD3Exq3df1xoqqDYDfEHiOWZxh3iBOL3lWIL3iMdYSS4QnxDHOF2Q+Fboisdvgosefwnmucwi4BczpWIHKx3MStwgniaOGnqVte4jviSkmqtZ2iO0JmAjgxSSkKCgijJ0OJRLGSZl1t2XaPpWUCEPo7eFGjg5iiiRN0ZqlaaqtGukq/ToqInc/+dpa7Mz3vRQEuh/dd3PSWBgH2jUXff31HUbZ0DgBbg22/4K5TT/TXq9rUWPgfAOcHnT1pQD4GoXGH+2ZC43pQAtv6YBHxfAcB4YvQcGN7ysWuc4fwJy2/SL7oDDI2CK+sObf/JNaAQfxWcoAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB30lEQVR42u2bzXKDIBCAw+ql6cnqpQ/Q93+f9gF60aan9GKwmkqHsXZA5Wd3YWcyySFO+D4WCLKKU+R4qush5u/DKfHIAlIXIFIDXs45eQhkAYlHiaUhTdMMcvgZniDcTE397Xb9vFweKQgoFfwU+ue1kFJ+AcDDf6J+RQKcqWRAv+cikyhqc4Ax71WPT73Pbg746Lpd/0uO7iVIrwIuNlJkBIyrhJddJBkBbdt62UIDp7Qf5xExL5PvLAXYwM+rxDM7AbbwLIeAL3gSAnzCoxfgGx61gBDwaAWEgkcpICQ8OgGh4VEJiAGPRkAseBQCPMF3JAQo+LV7e3vh9esGKd9M3xeppT2Kk6GYY/5PBiwb47sBmOCDZwA2eCsBVVW9Tg0fX63TsadNfLHgrQQIgBebHtza8+pQIyb81iFQc0n7YHMAdnivAijAexNABd6LAErwzgVQg3cqgCK8MwFU4Z0IoAx/WAB1+EMCOMBvEqAfOXOB3yRAHTlzgne6DOrwy3IW9gKWPa+Xs7AXQDHt9ThcJ7h2p8eiglPMdYF85oCpfvf+ble+OpDMAFNx8o7f7tELGHv2WhbF2SQGisJYv7soh+9JZICp3p565EdmsoDEQ8R+dpfSwUgeAlkAw/gGgdL3j4c6UpkAAAAASUVORK5CYII="/>\n        </div>\n      </div>\n    </div>\n  </div>\n';const t=this._shadowRoot.getElementById("paginator-input");t.addEventListener("input",this.onPaginatorInput),t.addEventListener("change",this.onPaginatorChange),this._shadowRoot.querySelector("#paginator-prev").addEventListener("click",this.onPaginatorPrevClick),this._shadowRoot.querySelector("#paginator-next").addEventListener("click",this.onPaginatorNextClick),this._shadowRoot.querySelector("#zoom-out").addEventListener("click",this.onZoomOutClick),this._shadowRoot.querySelector("#zoom-in").addEventListener("click",this.onZoomInClick),this._shadowRoot.querySelector("#zoom-fit-viewer").addEventListener("click",this.onZoomFitViewerClick),this._shadowRoot.querySelector("#zoom-fit-page").addEventListener("click",this.onZoomFitPageClick),this._previewer=this._shadowRoot.querySelector("#previewer"),this._previewer.addEventListener("scroll",this.onPreviewerScroll),this._viewer=this._shadowRoot.querySelector("#viewer"),this._viewer.addEventListener("scroll",this.onViewerScroll),this._viewer.addEventListener("wheel",this.onViewerWheel),this._viewer.addEventListener("pointermove",this.onViewerPointerMove),this._viewer.addEventListener("pointerdown",this.onViewerPointerDown),this._viewer.addEventListener("touchstart",this.onViewerTouchStart),this._mainContainer=this._shadowRoot.querySelector("div#main-container");const e=new ResizeObserver(this.onMainContainerResize);e.observe(this._mainContainer),this._mainContainerResizeObserver=e,this._shadowRoot.querySelector("#toggle-previewer").addEventListener("click",this.onPreviewerToggleClick),this._shadowRoot.querySelector("#button-mode-text").addEventListener("click",this.onTextModeButtonClick),this._shadowRoot.querySelector("#button-mode-hand").addEventListener("click",this.onHandModeButtonClick),this._shadowRoot.querySelector("#button-mode-annotation").addEventListener("click",this.onAnnotationModeButtonClick),this.toggleMode("text")}refreshPagesAsync(){var t;return Ts(this,void 0,void 0,(function*(){this._pages.forEach((t=>{t.previewContainer.removeEventListener("click",this.onPreviewerPageClick),t.destroy()})),this._pages.length=0;const e=(null===(t=this._pdfDocument)||void 0===t?void 0:t.numPages)||0;if(this._shadowRoot.getElementById("paginator-total").innerHTML=e+"",e)for(let t=0;t<e;t++){const e=yield this._pdfDocument.getPage(t+1),r=new x(e,this._annotationData,this._maxScale,this._previewWidth);r.scale=this._scale,r.previewContainer.addEventListener("click",this.onPreviewerPageClick),this._previewer.append(r.previewContainer),this._viewer.append(r.viewContainer),this._pages.push(r)}}))}renderVisiblePreviews(){if(this._previewerHidden)return;const t=this._pages,e=this.getVisiblePages(this._previewer,t,!0),r=Math.max(Math.min(...e)-this._visibleAdjPages,0),s=Math.min(Math.max(...e)+this._visibleAdjPages,t.length-1);for(let e=0;e<t.length;e++){const n=t[e];e>=r&&e<=s&&n.renderPreviewAsync()}}renderVisiblePages(){var t,e;const r=this._pages,s=this.getVisiblePages(this._viewer,r),n=this._currentPage,a=this.getCurrentPage(this._viewer,r,s);if(n&&n===a||(null===(t=r[n])||void 0===t||t.previewContainer.classList.remove("current"),null===(e=r[a])||void 0===e||e.previewContainer.classList.add("current"),this._shadowRoot.getElementById("paginator-input").value=a+1+"",this.scrollToPreview(a),this._currentPage=a),-1===a)return;const i=Math.max(Math.min(...s)-this._visibleAdjPages,0),o=Math.min(Math.max(...s)+this._visibleAdjPages,r.length-1);for(let t=0;t<r.length;t++){const e=r[t];t>=i&&t<=o?e.renderViewAsync():e.clearView()}}scrollToPreview(t){const{top:e,height:r}=this._previewer.getBoundingClientRect(),{top:s,height:n}=this._pages[t].previewContainer.getBoundingClientRect(),a=s+n/2-(e+r/2)+this._previewer.scrollTop;this._previewer.scrollTo(0,a)}scrollToPage(t){const{top:e}=this._viewer.getBoundingClientRect(),{top:r}=this._pages[t].viewContainer.getBoundingClientRect(),s=r-(e-this._viewer.scrollTop);this._viewer.scrollTo(this._viewer.scrollLeft,s)}setScale(t,e=null){if(!t||t===this._scale)return;let r,s,n;if(e)for(const t of this._pages){const{x:a,y:i}=e,{x:o,y:h,width:c,height:d}=t.viewContainer.getBoundingClientRect();if(o<=a&&o+c>=a&&h<=i&&h+d>=i){r=t.viewContainer,s=(a-o)/c,n=(i-h)/d;break}}if(this._scale=t,this._pages.forEach((t=>t.scale=this._scale)),r&&(this._viewer.scrollHeight>this._viewer.clientHeight||this._viewer.scrollWidth>this._viewer.clientWidth)){const{x:t,y:a}=e,{x:i,y:o,width:h,height:c}=r.getBoundingClientRect(),d=i+h*s,u=o+c*n;let l=this._viewer.scrollLeft+(d-t),p=this._viewer.scrollTop+(u-a);if(l=l<0?0:l,p=p<0?0:p,p!==this._viewer.scrollTop||l!==this._viewer.scrollLeft)return void this._viewer.scrollTo(l,p)}setTimeout((()=>this.renderVisiblePages()),0)}zoom(t,e=null){const r=u(this._scale+t,this._minScale,this._maxScale);this.setScale(r,e||this.getViewerCenterPosition())}zoomOut(t=null){this.zoom(-.25,t)}zoomIn(t=null){this.zoom(.25,t)}getViewerCenterPosition(){const{x:t,y:e,width:r,height:s}=this._viewer.getBoundingClientRect();return new l(t+r/2,e+s/2)}toggleMode(t){if(t&&t!==this._mode){switch(this._mode){case"text":this._viewer.classList.remove("mode-text"),this._shadowRoot.querySelector("#button-mode-text").classList.remove("on");break;case"hand":this._viewer.classList.remove("mode-hand"),this._shadowRoot.querySelector("#button-mode-hand").classList.remove("on");break;case"annotation":this._viewer.classList.remove("mode-annotation"),this._shadowRoot.querySelector("#button-mode-annotation").classList.remove("on")}switch(t){case"text":this._viewer.classList.add("mode-text"),this._shadowRoot.querySelector("#button-mode-text").classList.add("on");break;case"hand":this._viewer.classList.add("mode-hand"),this._shadowRoot.querySelector("#button-mode-hand").classList.add("on");break;case"annotation":this._viewer.classList.add("mode-annotation"),this._shadowRoot.querySelector("#button-mode-annotation").classList.add("on");break;default:throw new Error(`Invalid viewer mode: ${t}`)}this._mode=t}}getVisiblePages(t,e,r=!1){const s=new Set;if(!e.length)return s;const n=t.getBoundingClientRect(),a=n.top,i=n.top+n.height;for(let t=0;t<e.length;t++){const n=e[t],o=r?n.previewContainer.getBoundingClientRect():n.viewContainer.getBoundingClientRect(),h=o.top,c=o.top+o.height;if(h<i&&c>a)s.add(t);else if(s.size)break}return s}getCurrentPage(t,e,r){const s=[...r];if(!s.length)return-1;if(1===s.length)return s[0];const n=t.getBoundingClientRect(),a=n.top,i=n.top+n.height/2;for(const t of s){const r=e[t].viewContainer.getBoundingClientRect().top;if(r>a)return r>i?t-1:t}throw new Error("Incorrect argument")}showPasswordDialogAsync(){return Ts(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{const r=document.createElement("div");r.id="password-dialog",r.innerHTML='\n    <div class="form">\n      <input id="password-input" type="password" maxlength="127"/>\n      <div class="buttons">\n        <div id="password-ok" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="password-cancel" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n      </div>\n    </div>\n',this._mainContainer.append(r);let s="";const n=this._shadowRoot.getElementById("password-input");n.placeholder="Enter password...",n.addEventListener("change",(()=>s=n.value));const a=()=>{r.remove(),t(null)};r.addEventListener("click",(t=>{t.target===r&&a()})),this._shadowRoot.getElementById("password-ok").addEventListener("click",(()=>{r.remove(),t(s)})),this._shadowRoot.getElementById("password-cancel").addEventListener("click",a)}))}))}}export{Ls as TsPdfViewer};
