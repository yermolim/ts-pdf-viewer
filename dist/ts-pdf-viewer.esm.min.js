/**
 * Copyright 2021 yermolim
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * 
 * FlateStream class is based on the corresponding one from PDF.js,
 * so the code of that class is also subject to the next license notice:
 * 
 * Copyright 2012 Mozilla Foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Copyright 1996-2003 Glyph & Cog, LLC
 * 
 * The flate stream implementation contained in this file is a JavaScript port
 * of XPDF's implementation, made available under the Apache 2.0 open source
 * license.
 */

import{renderTextLayer as e,RenderingCancelledException as t,GlobalWorkerOptions as r,getDocument as s}from"pdfjs-dist";import{v4 as n}from"uuid";import a from"crypto-es";import i from"pako";function o(){return n()}function h(e,t,r,s){return Math.hypot(r-e,s-t)}class c{constructor(e){this.data=e}}class d{constructor(e){this._length=0,e&&this.push(e)}get head(){return this._head.data}get length(){return this._length}get tail(){return this.get(this._length-1)}push(e){const t=new c(e);let r;if(this._head){for(r=this._head;r.next;)r=r.next;r.next=t}else this._head=t;this._length++}insert(e,t){if(t<0||t>this._length-1)return null;const r=new c(e);let s,n=this._head,a=0;if(t){for(;a++<t;)s=n,n=n.next;s.next=r}else this._head=r;return r.next=n,this._length++,r.data}replace(e,t){if(t<0||t>this._length-1)return null;const r=new c(e);let s,n=this._head,a=0;if(t){for(;a++<t;)s=n,n=n.next;s.next=r}else this._head=r;return r.next=n.next,n.data}remove(e){if(e<0||e>this._length-1)return null;let t,r=this._head,s=0;if(e){for(;s++<e;)t=r,r=r.next;t.next=r.next}else this._head=r.next;return this._length--,r.data}clear(){this._head=null,this._length=0}get(e){if(e<0||e>this._length-1)return null;let t=this._head,r=0;for(;r++<e;)t=t.next;return t.data}pop(){return this.remove(this._length-1)}has(e,t){if(!this._length)return!1;t||(t=(e,t)=>e===t);let r=this._head,s=0;for(;s<this._length;){if(t(e,r.data))return!0;r=r.next,s++}return!1}findIndex(e,t){if(!this._length)return-1;t||(t=(e,t)=>e===t);let r=this._head,s=0;for(;s<this._length;){if(t(e,r.data))return s;r=r.next,s++}return-1}*[Symbol.iterator](){let e=this._head;for(;e;)yield e.data,e=e.next}}function l(e,t,r){return Math.max(t,Math.min(e,r))}class u{constructor(e=0,t=0){this.length=2,this.x=e,this.y=t}static multiplyByScalar(e,t){return new u(e.x*t,e.y*t)}static addScalar(e,t){return new u(e.x+t,e.y+t)}static normalize(e){return(new u).setFromVec2(e).normalize()}static add(e,t){return new u(e.x+t.x,e.y+t.y)}static substract(e,t){return new u(e.x-t.x,e.y-t.y)}static dotProduct(e,t){return e.x*t.x+e.y*t.y}static applyMat3(e,t){return e.clone().applyMat3(t)}static lerp(e,t,r){return e.clone().lerp(t,r)}static rotate(e,t,r){return e.clone().rotate(t,r)}static equals(e,t,r=6){return e.equals(t)}static getDistance(e,t){const r=t.x-e.x,s=t.y-e.y;return Math.sqrt(r*r+s*s)}clone(){return new u(this.x,this.y)}set(e,t){return this.x=e,this.y=t,this}setFromVec2(e){return this.x=e.x,this.y=e.y,this}multiplyByScalar(e){return this.x*=e,this.y*=e,this}addScalar(e){return this.x+=e,this.y+=e,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.getMagnitude();return e&&(this.x/=e,this.y/=e),this}add(e){return this.x+=e.x,this.y+=e.y,this}substract(e){return this.x-=e.x,this.y-=e.y,this}dotProduct(e){return u.dotProduct(this,e)}applyMat3(e){if(9!==e.length)throw new Error("Matrix must contain 9 elements");const{x:t,y:r}=this,[s,n,,a,i,,o,h]=e;return this.x=t*s+r*a+o,this.y=t*n+r*i+h,this}lerp(e,t){return this.x+=t*(e.x-this.x),this.y+=t*(e.y-this.y),this}rotate(e,t){const r=Math.sin(t),s=Math.cos(t),n=this.x-e.x,a=this.y-e.y;return this.x=n*s-a*r+e.x,this.y=n*r+a*s+e.y,this}equals(e,t=6){return+this.x.toFixed(t)==+e.x.toFixed(t)&&+this.y.toFixed(t)==+e.y.toFixed(t)}toArray(){return[this.x,this.y]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y}}class p{constructor(e=0,t=0,r=0){this.length=3,this.x=e,this.y=t,this.z=r}static multiplyByScalar(e,t){return new p(e.x*t,e.y*t,e.z*t)}static addScalar(e,t){return new p(e.x+t,e.y+t,e.z+t)}static normalize(e){return(new p).setFromVec3(e).normalize()}static add(e,t){return new p(e.x+t.x,e.y+t.y,e.z+t.z)}static substract(e,t){return new p(e.x-t.x,e.y-t.y,e.z-t.z)}static dotProduct(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}static crossProduct(e,t){return new p(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)}static onVector(e,t){return e.clone().onVector(t)}static onPlane(e,t){return e.clone().onPlane(t)}static applyMat3(e,t){return e.clone().applyMat3(t)}static lerp(e,t,r){return e.clone().lerp(t,r)}static equals(e,t,r=6){return!!e&&e.equals(t,r)}static getDistance(e,t){const r=t.x-e.x,s=t.y-e.y,n=t.z-e.z;return Math.sqrt(r*r+s*s+n*n)}static getAngle(e,t){return e.getAngle(t)}clone(){return new p(this.x,this.y,this.z)}set(e,t,r){return this.x=e,this.y=t,this.z=r,this}setFromVec3(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}multiplyByScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getAngle(e){const t=this.getMagnitude()*e.getMagnitude();if(!t)return Math.PI/2;const r=this.dotProduct(e)/t;return Math.acos(l(r,-1,1))}normalize(){const e=this.getMagnitude();return e&&(this.x/=e,this.y/=e,this.z/=e),this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}substract(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}dotProduct(e){return p.dotProduct(this,e)}crossProduct(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this.z=this.x*e.y-this.y*e.x,this}onVector(e){const t=this.getMagnitude();return t?e.clone().multiplyByScalar(e.clone().dotProduct(this)/(t*t)):this.set(0,0,0)}onPlane(e){return this.substract(this.clone().onVector(e))}applyMat3(e){if(9!==e.length)throw new Error("Matrix must contain 9 elements");const{x:t,y:r,z:s}=this,[n,a,i,o,h,c,d,l,u]=e;return this.x=t*n+r*o+s*d,this.y=t*a+r*h+s*l,this.z=t*i+r*c+s*u,this}lerp(e,t){return this.x+=t*(e.x-this.x),this.y+=t*(e.y-this.y),this.z+=t*(e.z-this.z),this}equals(e,t=6){return!!e&&(+this.x.toFixed(t)==+e.x.toFixed(t)&&+this.y.toFixed(t)==+e.y.toFixed(t)&&+this.z.toFixed(t)==+e.z.toFixed(t))}toArray(){return[this.x,this.y,this.z]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}class f{constructor(){this.length=9,this._matrix=new Array(this.length),this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=1,this._matrix[5]=0,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=1}get x_x(){return this._matrix[0]}get x_y(){return this._matrix[1]}get x_z(){return this._matrix[2]}get y_x(){return this._matrix[3]}get y_y(){return this._matrix[4]}get y_z(){return this._matrix[5]}get z_x(){return this._matrix[6]}get z_y(){return this._matrix[7]}get z_z(){return this._matrix[8]}static fromMat3(e){return(new f).setFromMat3(e)}static multiply(e,t){const[r,s,n,a,i,o,h,c,d]=e._matrix,[l,u,p,g,y,w,A,m,v]=t._matrix,b=new f;return b.set(r*l+s*g+n*A,r*u+s*y+n*m,r*p+s*w+n*v,a*l+i*g+o*A,a*u+i*y+o*m,a*p+i*w+o*v,h*l+c*g+d*A,h*u+c*y+d*m,h*p+c*w+d*v),b}static multiplyScalar(e,t){const r=new f;for(let s=0;s<this.length;s++)r._matrix[s]=e._matrix[s]*t;return r}static transpose(e){const t=new f;return t.set(e.x_x,e.y_x,e.z_x,e.x_y,e.y_y,e.z_y,e.x_z,e.y_z,e.z_z),t}static invert(e){const t=new f;t.set(e.y_y*e.z_z-e.z_y*e.y_z,e.y_x*e.z_z-e.z_x*e.y_z,e.y_x*e.z_y-e.z_x*e.y_y,e.x_y*e.z_z-e.z_y*e.x_z,e.x_x*e.z_z-e.z_x*e.x_z,e.x_x*e.z_y-e.z_x*e.x_y,e.x_y*e.y_z-e.y_y*e.x_z,e.x_x*e.y_z-e.y_x*e.x_z,e.x_x*e.y_y-e.y_x*e.x_y),t.set(t.x_x,-t.x_y,t.x_z,-t.y_x,t.y_y,-t.y_z,t.z_x,-t.z_y,t.z_z);const r=e.x_x*t.x_x+e.x_y*t.x_y+e.x_z*t.x_z,s=new f;if(r){const e=.1;s.set(e*t.x_x,e*t.y_x,e*t.z_x,e*t.x_y,e*t.y_y,e*t.z_y,e*t.x_z,e*t.y_z,e*t.z_z)}else s.set(0,0,0,0,0,0,0,0,0);return s}static buildScale(e,t){return null!=t||(t=e),(new f).set(e,0,0,0,t,0,0,0,1)}static buildRotation(e){const t=Math.cos(e),r=Math.sin(e);return(new f).set(t,-r,0,r,t,0,0,0,1)}static buildTranslate(e,t){return(new f).set(1,0,0,0,1,0,e,t,1)}static equals(e,t,r=6){return e.equals(t,r)}clone(){return(new f).set(this.x_x,this.x_y,this.x_z,this.y_x,this.y_y,this.y_z,this.z_x,this.z_y,this.z_z)}set(e,t,r,s,n,a,i,o,h){return this._matrix[0]=e,this._matrix[1]=t,this._matrix[2]=r,this._matrix[3]=s,this._matrix[4]=n,this._matrix[5]=a,this._matrix[6]=i,this._matrix[7]=o,this._matrix[8]=h,this}reset(){return this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=1,this._matrix[5]=0,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=1,this}setFromMat3(e){for(let t=0;t<this.length;t++)this._matrix[t]=e._matrix[t];return this}multiply(e){const[t,r,s,n,a,i,o,h,c]=this._matrix,[d,l,u,p,f,g,y,w,A]=e._matrix;return this._matrix[0]=t*d+r*p+s*y,this._matrix[1]=t*l+r*f+s*w,this._matrix[2]=t*u+r*g+s*A,this._matrix[3]=n*d+a*p+i*y,this._matrix[4]=n*l+a*f+i*w,this._matrix[5]=n*u+a*g+i*A,this._matrix[6]=o*d+h*p+c*y,this._matrix[7]=o*l+h*f+c*w,this._matrix[8]=o*u+h*g+c*A,this}multiplyScalar(e){for(let t=0;t<this.length;t++)this._matrix[t]*=e;return this}transpose(){const e=(new f).setFromMat3(this);return this.set(e.x_x,e.y_x,e.z_x,e.x_y,e.y_y,e.z_y,e.x_z,e.y_z,e.z_z),this}invert(){const e=new f;e.set(this.y_y*this.z_z-this.z_y*this.y_z,this.y_x*this.z_z-this.z_x*this.y_z,this.y_x*this.z_y-this.z_x*this.y_y,this.x_y*this.z_z-this.z_y*this.x_z,this.x_x*this.z_z-this.z_x*this.x_z,this.x_x*this.z_y-this.z_x*this.x_y,this.x_y*this.y_z-this.y_y*this.x_z,this.x_x*this.y_z-this.y_x*this.x_z,this.x_x*this.y_y-this.y_x*this.x_y),e.set(e.x_x,-e.x_y,e.x_z,-e.y_x,e.y_y,-e.y_z,e.z_x,-e.z_y,e.z_z);if(this.x_x*e.x_x+this.x_y*e.x_y+this.x_z*e.x_z){const t=.1;this.set(t*e.x_x,t*e.y_x,t*e.z_x,t*e.x_y,t*e.y_y,t*e.z_y,t*e.x_z,t*e.y_z,t*e.z_z)}else this.set(0,0,0,0,0,0,0,0,0);return this}getDeterminant(){const[e,t,r,s,n,a,i,o,h]=this._matrix;return e*n*h-e*a*o+t*a*i-t*s*h+r*s*o-r*n*i}getTRS(){const e=new u(this.z_x,this.z_y),t=Math.sqrt(this.x_x*this.x_x+this.x_y*this.x_y),r=Math.sqrt(this.y_x*this.y_x+this.y_y*this.y_y),s=new u(t,r),n=Math.atan(-this.x_y/this.x_x),a=Math.acos(this.x_x/t);let i;return i=a>Math.PI/2&&n>0||a<Math.PI/2&&n<0?2*Math.PI-a:a,{t:e,r:i,s:s}}equals(e,t=6){for(let r=0;r<this.length;r++)if(+this._matrix[r].toFixed(t)!=+e._matrix[r].toFixed(t))return!1;return!0}applyScaling(e,t){const r=f.buildScale(e,t);return this.multiply(r)}applyTranslation(e,t){const r=f.buildTranslate(e,t);return this.multiply(r)}applyRotation(e){const t=f.buildRotation(e);return this.multiply(t)}toArray(){return this._matrix.slice()}toIntArray(){return new Int32Array(this)}toIntShortArray(){return new Int32Array([this._matrix[0],this._matrix[1],this._matrix[3],this._matrix[4],this._matrix[6],this._matrix[7]])}toFloatArray(){return new Float32Array(this)}toFloatShortArray(){return new Float32Array([this._matrix[0],this._matrix[1],this._matrix[3],this._matrix[4],this._matrix[6],this._matrix[7]])}*[Symbol.iterator](){for(let e=0;e<9;e++)yield this._matrix[e]}}function g(e,t,r,s,n=!1){const a=new f;a.applyTranslation(-e.x,-e.y);const i=u.substract(t,e).getMagnitude(),o=u.substract(s,r).getMagnitude()/i;if(a.applyScaling(o),!n){const n=Math.atan2(t.y-e.y,t.x-e.x),i=Math.atan2(s.y-r.y,s.x-r.x)-n;a.applyRotation(i)}return a.applyTranslation(r.x,r.y),a}function y(...e){return{min:new u(Math.min(...e.map((e=>e.x))),Math.min(...e.map((e=>e.y)))),max:new u(Math.max(...e.map((e=>e.x))),Math.max(...e.map((e=>e.y))))}}var w=function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{h(s.next(e))}catch(e){a(e)}}function o(e){try{h(s.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}h((s=s.apply(e,t||[])).next())}))};class A{constructor(e,t,r){if(this._svgByAnnotation=new Map,!e||isNaN(t)||!r)throw new Error("Required argument not found");this._pageId=t,this._pageDimensions=r,this._container=document.createElement("div"),this._container.classList.add("page-annotations"),this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.classList.add("stretch"),this._svg.setAttribute("data-page-id",t+""),this._svg.setAttribute("viewBox",`0 0 ${r.x} ${r.y}`),this._svg.setAttribute("transform","scale(1, -1)"),this._svg.addEventListener("pointerdown",(e=>{e.target===this._svg&&this.switchSelectedAnnotation(null)})),this._defs=document.createElementNS("http://www.w3.org/2000/svg","defs"),this._container.append(this._svg),this._annotations=e.getPageAnnotations(t)}destroy(){this.remove(),this._container=null}remove(){var e;null===(e=this._container)||void 0===e||e.remove()}appendAsync(e){return w(this,void 0,void 0,(function*(){this._rendered||(yield this.renderAnnotationsAsync(),this._rendered=!0),e.append(this._container)}))}switchSelectedAnnotation(e){if(e===this._selectedAnnotation)return;if(this._selectedAnnotation){const e=this._svgByAnnotation.get(this._selectedAnnotation);null==e||e.classList.remove("selected")}const t=this._svgByAnnotation.get(e);t&&(t.classList.add("selected"),this._svg.append(t),this._selectedAnnotation=e)}renderAnnotation(e){const t=e.render();if(!t)return;const{svg:r,clipPaths:s}=t;this._svgByAnnotation.set(e,r),r.addEventListener("pointerdown",(()=>this.switchSelectedAnnotation(e))),this._svg.append(r),null==s||s.forEach((e=>this._defs.append(e)))}renderAnnotationsAsync(){var e;return w(this,void 0,void 0,(function*(){this.clear();const t=[];for(let r=0;r<(null===(e=this._annotations)||void 0===e?void 0:e.length);r++)t.push(new Promise((e=>{setTimeout((()=>{this.renderAnnotation(this._annotations[r]),e()}),0)})));return yield Promise.all(t),this._svg.append(this._defs),!0}))}clear(){this._svg.innerHTML="",this._svgByAnnotation.clear()}}var m=function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{h(s.next(e))}catch(e){a(e)}}function o(e){try{h(s.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}h((s=s.apply(e,t||[])).next())}))};class v{constructor(e){if(this.onMouseDown=e=>{var t;this._divModeTimer&&(clearTimeout(this._divModeTimer),this._divModeTimer=null),null===(t=this._renderTask)||void 0===t||t.expandTextDivs(!0)},this.onMouseUp=e=>{this._divModeTimer=setTimeout((()=>{var e;null===(e=this._renderTask)||void 0===e||e.expandTextDivs(!1),this._divModeTimer=null}),300)},!e)throw new Error("Page proxy is not defined");this._pageProxy=e,this._container=document.createElement("div"),this._container.classList.add("page-text"),this._container.addEventListener("mousedown",this.onMouseDown),this._container.addEventListener("mouseup",this.onMouseUp)}static appendPageTextAsync(e,t,r){return m(this,void 0,void 0,(function*(){const s=new v(e);return yield s.renderTextLayerAsync(r),t.append(s._container),s}))}destroy(){this.destroyRenderTask(),this._container&&(this._container.remove(),this._container=null)}renderTextLayerAsync(t){return m(this,void 0,void 0,(function*(){this.clear(),this.destroyRenderTask();const r=this._pageProxy.getViewport({scale:t}),s=this._pageProxy.streamTextContent();this._renderTask=e({container:this._container,textContentStream:s,viewport:r,enhanceTextSelection:!0});try{yield this._renderTask.promise}catch(e){if("TextLayer task cancelled."===e.message)return!1;throw e}return!0}))}clear(){this._container.innerHTML=""}destroyRenderTask(){this._renderTask&&(this._renderTask.cancel(),this._renderTask=null)}}var b=function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{h(s.next(e))}catch(e){a(e)}}function o(e){try{h(s.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}h((s=s.apply(e,t||[])).next())}))};class x{constructor(e,t,r,s){if(!e)throw new Error("Page proxy is not defined");if(!t)throw new Error("Annotation data is not defined");this._pageProxy=e,this._viewport=e.getViewport({scale:1}),this._maxScale=Math.max(r,1),this._annotationData=t,this.number=e.pageNumber,this.id=e.ref.num,this.generation=e.ref.gen;const{width:n,height:a}=this._viewport,i=(s=Math.max(null!=s?s:0,50))*(a/n);this._dimensions={width:n,height:a,previewWidth:s,previewHeight:i},this._previewContainer=document.createElement("div"),this._previewContainer.classList.add("page-preview"),this._previewContainer.setAttribute("data-page-number",this.number+""),this._previewContainer.setAttribute("data-page-id",this.id+""),this._previewContainer.setAttribute("data-page-gen",this.generation+""),this._previewContainer.style.width=this._dimensions.previewWidth+"px",this._previewContainer.style.height=this._dimensions.previewHeight+"px",this._viewContainer=document.createElement("div"),this._viewContainer.classList.add("page"),this._viewContainer.setAttribute("data-page-number",this.number+""),this._viewContainer.setAttribute("data-page-id",this.id+""),this._viewContainer.setAttribute("data-page-gen",this.generation+""),this.scale=1}get previewContainer(){return this._previewContainer}get viewContainer(){return this._viewContainer}set _viewRendered(e){this.$viewRendered=e,this._viewContainer.setAttribute("data-loaded",e+"")}get _viewRendered(){return this.$viewRendered}set scale(e){if(e<=0||this._scale===e)return;this._scale=e;const t=window.devicePixelRatio;this._dimensions.scaledWidth=this._dimensions.width*this._scale,this._dimensions.scaledHeight=this._dimensions.height*this._scale,this._dimensions.scaledDprWidth=this._dimensions.scaledWidth*t,this._dimensions.scaledDprHeight=this._dimensions.scaledHeight*t,this._viewContainer.style.width=this._dimensions.scaledWidth+"px",this._viewContainer.style.height=this._dimensions.scaledHeight+"px",this._viewCanvas&&(this._viewCanvas.style.width=this._dimensions.scaledWidth+"px",this._viewCanvas.style.height=this._dimensions.scaledHeight+"px"),this._scaleIsValid=!1}get viewValid(){return this._scaleIsValid&&this._viewRendered}destroy(){this._previewContainer.remove(),this._viewContainer.remove(),this._pageProxy.cleanup()}renderPreviewAsync(e=!1){return b(this,void 0,void 0,(function*(){if(this._renderPromise&&(e&&this.cancelRenderTask(),yield this._renderPromise),e||!this._previewRendered)return this._renderPromise=this.runPreviewRenderAsync(),this._renderPromise}))}renderViewAsync(e=!1){return b(this,void 0,void 0,(function*(){if(this._renderPromise&&(e&&this.cancelRenderTask(),yield this._renderPromise),e||!this.viewValid)return this._renderPromise=this.runViewRenderAsync(),this._renderPromise}))}clearPreview(){this._previewContainer.innerHTML=""}clearView(){var e,t,r;null===(e=this._annotations)||void 0===e||e.destroy(),this._annotations=null,null===(t=this._text)||void 0===t||t.destroy(),this._text=null,null===(r=this._viewCanvas)||void 0===r||r.remove(),this._viewRendered=!1}cancelRenderTask(){this._renderTask&&(this._renderTask.cancel(),this._renderTask=null)}runRenderTaskAsync(e){return b(this,void 0,void 0,(function*(){this.cancelRenderTask(),this._renderTask=this._pageProxy.render(e);try{yield this._renderTask.promise}catch(e){if(e instanceof t)return!1;throw e}finally{this._renderTask=null}return!0}))}createPreviewCanvas(){const e=document.createElement("canvas");e.classList.add("page-canvas");const t=window.devicePixelRatio,{previewWidth:r,previewHeight:s}=this._dimensions;return e.style.width=r+"px",e.style.height=s+"px",e.width=r*t,e.height=s*t,e}createViewCanvas(){const e=document.createElement("canvas");return e.classList.add("page-canvas"),e.style.width=this._dimensions.scaledWidth+"px",e.style.height=this._dimensions.scaledHeight+"px",e.width=this._dimensions.scaledDprWidth,e.height=this._dimensions.scaledDprHeight,e}scaleCanvasImage(e,t){let r,s=this._scale/this._maxScale,n=e;for(;s<.5;)r=document.createElement("canvas"),r.width=.5*n.width,r.height=.5*n.height,r.getContext("2d").drawImage(n,0,0,r.width,r.height),n=r,s*=2;t.getContext("2d").drawImage(n,0,0,t.width,t.height)}runPreviewRenderAsync(){return b(this,void 0,void 0,(function*(){const e=this.createPreviewCanvas(),t={canvasContext:e.getContext("2d"),viewport:this._viewport.clone({scale:e.width/this._dimensions.width})};(yield this.runRenderTaskAsync(t))?(this._previewContainer.innerHTML="",this._previewContainer.append(e),this._previewRendered=!0):this._previewRendered=!1}))}runViewRenderAsync(){var e,t;return b(this,void 0,void 0,(function*(){const r=this._scale;null===(e=this._text)||void 0===e||e.destroy(),this._text=null;const s=this.createViewCanvas(),n={canvasContext:s.getContext("2d"),viewport:this._viewport.clone({scale:r*window.devicePixelRatio}),enableWebGL:!0};if((yield this.runRenderTaskAsync(n))&&r===this._scale){if(null===(t=this._viewCanvas)||void 0===t||t.remove(),this._viewContainer.append(s),this._viewCanvas=s,this._viewRendered=!0,this._text=yield v.appendPageTextAsync(this._pageProxy,this._viewContainer,r),!this._annotations){const{width:e,height:t}=this._dimensions;this._annotations=new A(this._annotationData,this.id,new u(e,t))}yield this._annotations.appendAsync(this.viewContainer),r===this._scale&&(this._scaleIsValid=!0)}}))}}const E=0,_=8,C=9,P=10,S=12,k=13,N=32,I=37,B=40,M=41,R=45,D=46,T=47,L=48,O=49,U=50,F=51,V=52,z=53,H=54,W=55,G=56,Q=57,q=60,j=62,K=69,X=70,Y=80,J=82,Z=83,$=84,ee=88,te=91,re=92,se=93,ne=97,ae=98,ie=100,oe=101,he=102,ce=106,de=108,le=109,ue=110,pe=111,fe=112,ge=114,ye=115,we=116,Ae=117,me=120,ve=121,be={NULL:[ue,Ae,de,de],OBJ:[pe,ae,ce],OBJ_END:[oe,ue,ie,pe,ae,ce],STREAM_START:[ye,we,ge,oe,ne,le],STREAM_END:[oe,ue,ie,ye,we,ge,oe,ne,le],DICT_START:[q,q],DICT_END:[j,j],ARRAY_START:[te],ARRAY_END:[se],STR_LITERAL_START:[B],STR_LITERAL_END:[M],STR_HEX_START:[q],STR_HEX_END:[j],VERSION:[I,Y,68,X,R],PREV:[T,Y,ge,oe,118],TYPE:[T,$,ve,fe,oe],SUBTYPE:[T,Z,Ae,ae,we,ve,fe,oe],FORM:[T,X,pe,ge,le],XREF_TABLE:[me,ge,oe,he],XREF_STREAM:[T,ee,J,oe,he],XREF_HYBRID:[ee,J,oe,he,Z,we,le],XREF_START:[ye,we,ne,ge,we,me,ge,oe,he],TRAILER:[we,ge,ne,105,de,oe,ge],END_OF_FILE:[I,I,K,79,X],END_OF_LINE:[k,P],TRUE:[we,ge,Ae,oe],FALSE:[he,ne,de,ye,oe]},xe=new Set([I,B,M,T,q,j,te,se,123,125]),Ee=new Set([E,C,P,S,k,N]),_e=new Set([L,O,U,F,V,z,H,W,G,Q]);function Ce(e){return!xe.has(e)&&!Ee.has(e)}function Pe(e){if(!(null==e?void 0:e.length))return 0;if(1===e.length)return e[0];const t=Array.from(e,(e=>("0"+(255&e).toString(16)).slice(-2))).join("");return parseInt(t,16)}function Se(e){const t=new ArrayBuffer(1);return new DataView(t).setInt8(0,e),new Uint8Array(t)}function ke(e,t=!1){const r=new ArrayBuffer(2);return new DataView(r).setInt16(0,e,t),new Uint8Array(r)}function Ne(e,t=!1){const r=new ArrayBuffer(4);return new DataView(r).setInt32(0,e,t),new Uint8Array(r)}function Ie(e,t){const r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e[s]^t;return r}function Be(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Me(e){const t=new Uint8Array(e.length/2);for(let r=0,s=0;r<e.length;r+=2,s++)t[s]=parseInt(e.substr(r,2),16);return t}const Re=3,De=4,Te=5,Le=7,Oe=8,Ue=0,Fe=1,Ve=0,ze=1,He=2,We="/DCTDecode",Ge="/FlateDecode",Qe="/JBIG2Decode",qe="/JPXDecode",je=1,Ke=2,Xe=10,Ye=11,Je=12,Ze=13,$e=14,et=15,tt={RC4_40:1,RC4_128:2,AES_128:4,AES_256:5},rt={RC4_40:2,RC4_128:3,AES_128:4,AES_256:5,AES_256_V2:6},st={NONE:"/None",RC4:"/V2",AES_128:"/AESV2",AES_256:"/AESV3"},nt={DOC_OPEN:"/DocOpen",EMBEDDED_OPEN:"/EFOpen"},at={LEFT:0,CENTER:1,RIGHT:2},it="/XRef",ot="/ObjStm",ht="/XObject",ct="/Catalog",dt="/Pages",lt="/Page",ut="/Annot",pt="/Border",ft="/Measure",gt="/ExtGState",yt="/CryptFilter",wt="/Mask",At="/Group",mt="/Font",vt="",bt={TRANSPARENCY:"/Transparency"},xt=0,Et=2,_t=3,Ct=4,Pt=5,St=6,kt=7,Nt=8,It=9,Bt=10,Mt=11,Rt="/Text",Dt="/FreeText",Tt="/Line",Lt="/Square",Ot="/Circle",Ut="/Polygon",Ft="/PolyLine",Vt="/Stamp",zt="/Ink",Ht={MARKED:"/Marked",REVIEW:"/Review"},Wt={MARKED:"/Marked",UNMARKED:"/Unmarked"},Gt={ACCEPTED:"/Accepted",REJECTED:"/Rejected",CANCELLED:"/Cancelled",COMPLETED:"/Completed",NONE:"/None"},Qt={COMMENT:"/Comment",KEY:"/Key",NOTE:"/Note",HELP:"/Help",NEW_PARAGRAPH:"/NewParagraph",PARAGRAPH:"/Paragraph",INSERT:"/Insert"},qt={SQUARE:"/Square",CIRCLE:"/Circle",DIAMOND:"/Diamond",ARROW_OPEN:"/OpenArrow",ARROW_CLOSED:"/ClosedArrow",NONE:"/None",BUTT:"/Butt",ARROW_OPEN_R:"/ROpenArrow",ARROW_CLOSED_R:"/RClosedArrow",SLASH:"/Slash"},jt={BUTT:0,ROUND:1,SQUARE:2},Kt={MITER:0,ROUND:1,BEVEL:2},Xt={ABSOLUTE:"/AbsoluteColorimetric",RELATIVE:"/RelativeColorimetric",SATURATION:"/Saturation",PERCEPTUAL:"/Perceptual"},Yt={NORMAL:"/Normal",COMPATIBLE:"/Compatible",MULTIPLY:"/Multiply",SCREEN:"/Screen",OVERLAY:"/Overlay",DARKEN:"/Darken",LIGHTEN:"/Lighten",COLOR_DODGE:"/ColorDodge",COLOR_BURN:"/ColorBurn",HARD_LIGHT:"/HardLight",SOFT_LIGHT:"/SoftLight",DIFFERENCE:"/Difference",EXCLUSION:"/Exclusion"},Jt="/DeviceGray",Zt="/DeviceRGB",$t="/DeviceCMYK",er="/Indexed",tr={ALPHA:"/Alpha",LUMINOSITY:"/Luminosity"},rr=new Set([Ge,We,Qe,qe]);function sr(e){return a.lib.WordArray.create(e)}function nr(e){return function(e,t=!1){const r=new ArrayBuffer(4*e.length),s=new DataView(r);for(let r=0;r<e.length;r++)s.setInt32(4*r,e[r],t);return new Uint8Array(r)}(e.words).slice(0,e.sigBytes)}function ar(e){e instanceof Uint8Array&&(e=sr(e));return a.MD5(e)}function ir(e,t){e instanceof Uint8Array&&(e=sr(e)),t instanceof Uint8Array&&(t=sr(t));return a.RC4.encrypt(e,t).ciphertext}function or(e,t,r=!1){if(e instanceof Uint8Array&&(e=sr(e)),t instanceof Uint8Array&&(t=sr(t)),r){const r=a.lib.WordArray.create(e.words.slice(0,4));return a.algo.AES.createDecryptor(t,{mode:a.mode.CBC,iv:r,padding:a.pad.Pkcs7}).finalize(e)}{const r=a.lib.WordArray.random(16);return a.algo.AES.createEncryptor(t,{mode:a.mode.CBC,iv:r,padding:a.pad.Pkcs7}).finalize(e)}}const hr=[115,65,108,84];class cr{constructor(e){if(!e)throw new Error("Empty key");if(16!==e.length)throw new Error(`Invalid key length: ${e.length} (shall be 16)`);this._n=e.length,this._key=e,this._tempKey=new Uint8Array(e.length+9)}encrypt(e,t){return this.run(e,t.id,t.generation)}decrypt(e,t){return this.run(e,t.id,t.generation,!0)}run(e,t,r,s=!1){const n=Ne(t,!0),a=Ne(r,!0);this._tempKey.set(this._key,0),this._tempKey.set(n.subarray(0,3),this._n),this._tempKey.set(a.subarray(0,2),this._n+3),this._tempKey.set(hr,this._n+5);const i=nr(ar(this._tempKey)),o=Math.min(this._n+5,16),h=nr(or(e,i.slice(0,o),s));return s?h.slice(16):h}}class dr{constructor(e){if(!e)throw new Error("Empty key");if(32!==e.length)throw new Error(`Invalid key length: ${e.length} (shall be 16)`);this._n=e.length,this._key=e}encrypt(e,t){return this.run(e,t.id,t.generation)}decrypt(e,t){return this.run(e,t.id,t.generation,!0)}run(e,t,r,s=!1){const n=nr(or(e,this._key,s));return s?n.slice(16):n}}class lr{constructor(){}encrypt(e,t){return e}decrypt(e,t){return e}}class ur{constructor(e){if(!e)throw new Error("Empty key");if(e.length<5||e.length>16)throw new Error(`Invalid key length: ${e.length} (shall be a multiple in range from 40 to 128)`);this._n=e.length,this._key=e,this._tempKey=new Uint8Array(e.length+5)}encrypt(e,t){const r=Ne(t.id,!0),s=Ne(t.generation,!0);this._tempKey.set(this._key,0),this._tempKey.set(r.slice(0,3),this._n),this._tempKey.set(s.slice(0,2),this._n+3);const n=nr(ar(this._tempKey)),a=Math.min(this._n+5,16);return nr(ir(e,n.slice(0,a)))}decrypt(e,t){return this.encrypt(e,t)}}const pr=[40,191,78,94,78,117,138,65,100,0,78,86,255,250,1,8,46,46,0,182,208,104,62,128,47,12,169,254,100,83,105,122];class fr{constructor(e,t){const{filter:r,version:s,revision:n,permissions:a,encryptMetadata:i,keyLength:o,stringKeyLength:h,streamKeyLength:c,stringMethod:d,streamMethod:l,oPasswordHash:u,uPasswordHash:p,oEncPasswordHash:f,uEncPasswordHash:g,perms:y}=e;if("/Standard"!==r)throw new Error(`Unsupported filter name: ${r}`);if(![1,2,4,5].includes(s))throw new Error(`Unsupported algorithm version: ${s}`);if(![2,3,4,5,6].includes(n))throw new Error(`Unsupported algorithm revision: ${n}`);if(isNaN(a))throw new Error("Permissions not provided");if(!u||!p)throw new Error("Password hash not provided");this._filter=r,this._version=s,this._revision=n,this._permissions=a,this._keyLength=o,this._encryptMetadata=i,this._stringKeyLength=h,this._streamKeyLength=c,this._stringMethod=d,this._streamMethod=l,this._oPasswordHash=u,this._uPasswordHash=p,this._oEncPasswordHash=f,this._uEncPasswordHash=g,this._perms=y,this._fileId=t}authenticate(e){const t=this._version,r=this._stringMethod,s=this._streamMethod;let n=!1;if(this.authOwnerPassword(e))n=!0;else{if(!this.authUserPassword(e))return null}const a=this._lastEncryptionKey;switch(t){case 1:const e=new ur(a);return{owner:n,stringCryptor:e,streamCryptor:e};case 2:const t=new ur(a);return{owner:n,stringCryptor:t,streamCryptor:t};case 4:let i,o;if(r&&r!==st.NONE)if(r===st.RC4)i=new ur(a);else{if(r!==st.AES_128)throw new Error(`Invalid crypt method: ${r}`);i=new cr(a)}else i=new lr;if(s&&s!==st.NONE)if(s===st.RC4)o=new ur(a);else{if(s!==st.AES_128)throw new Error(`Invalid crypt method: ${s}`);o=new cr(a)}else o=new lr;return{owner:n,stringCryptor:i,streamCryptor:o};case 5:let h,c;if(r&&r!==st.NONE){if(r!==st.AES_256)throw new Error(`Invalid crypt method: ${r}`);i=new dr(a)}else i=new lr;if(s&&s!==st.NONE){if(s!==st.AES_256)throw new Error(`Invalid crypt method: ${s}`);o=new dr(a)}else o=new lr;return{owner:n,stringCryptor:h,streamCryptor:c}}}padPassword32(e){if(!e)return new Uint8Array(pr);const t=(new TextEncoder).encode(e),r=new Uint8Array(32);return r.set(t.slice(0,32)),t.length<32&&r.set(pr.slice(0,32-t.length),t.length),r}computeEncryptionKey(e){if([2,3,4].includes(this._revision)){const t=this.padPassword32(e),r=Ne(this._permissions,!0),s=this._revision>=4&&!this._encryptMetadata?new Uint8Array([255,255,255,255]):new Uint8Array(0);let n=nr(ar(new Uint8Array([...t,...this._oPasswordHash,...r,...this._fileId,...s])));const a=this._keyLength>>3;if(this._revision>=3)for(let e=0;e<50;e++)n=nr(ar(n.slice(0,a)));const i=n.slice(0,a);return this._lastEncryptionKey=i,i}if(5===this._revision)throw new Error("Not implemented yet");if(6===this._revision)throw new Error("Not implemented yet")}computeOHashEncryptionKey_R2R3R4(e){let t=ar(this.padPassword32(e));if(this._revision>=3)for(let e=0;e<50;e++)t=ar(t);const r=nr(t),s=this._keyLength>>3;return r.slice(0,s)}computeOHash_R2R3R4(e,t){const r=this.computeOHashEncryptionKey_R2R3R4(e||t);let s=ir(this.padPassword32(t),r);if(this._revision>=3)for(let e=1;e<20;e++)s=ir(s,Ie(r,e));return nr(s)}computeUHash_R2(e){const t=this.computeEncryptionKey(e);return nr(ir(new Uint8Array(pr),t))}computeUHash_R3R4(e){const t=this.computeEncryptionKey(e);let r=ar(new Uint8Array([...pr,...this._fileId]));r=ir(r,t);for(let e=1;e<20;e++)r=ir(r,Ie(t,e));return nr(r)}authOwnerPassword(e){if([2,3,4].includes(this._revision)){const t=this.computeOHashEncryptionKey_R2R3R4(e);let r;if(2===this._revision)r=nr(ir(this._oPasswordHash,t));else{let e=sr(this._oPasswordHash);for(let r=19;r>=0;r--)e=ir(e,Ie(t,r));r=nr(e)}const s=function(e,t){if((null==e?void 0:e.length)&&(null==t?void 0:t.length)){let r;e:for(let s=0;s<=e.length;s++){let n=!1;for(r=0;r<t.length;r++){if(!(s+r<e.length)){if(n)return s;break e}if(e[s+r]!==t[r])continue e;n=!0}}}return-1}(r,new Uint8Array(pr)),n=(new TextDecoder).decode(-1===s?r:r.subarray(0,s));return this.authUserPassword(n)}if(5===this._revision)throw new Error("Not implemented yet");if(6===this._revision)throw new Error("Not implemented yet")}authUserPassword(e){let t;if(2===this._revision)return t=this.computeUHash_R2(e),Be(this._uPasswordHash,t);if(3===this._revision||4===this._revision)return t=this.computeUHash_R3R4(e),Be(this._uPasswordHash.subarray(0,16),t);if(5===this._revision)throw new Error("Not implemented yet");if(6===this._revision)throw new Error("Not implemented yet")}}class gr{constructor(e,t){this._literal=e,this._bytes=t}get literal(){return this._literal}get bytes(){return this._bytes.slice()}static parse(e,t,r=null,s=!0){const n=e.getLiteralBounds(t,s);if(!n)return;let a=gr.unescape(e.subCharCodes(n.start+1,n.end-1));(null==r?void 0:r.ref)&&r.stringCryptor&&(a=r.stringCryptor.decrypt(a,r.ref));return{value:gr.fromBytes(a),start:n.start,end:n.end}}static fromBytes(e){const t=(254===e[0]&&255===e[1]?new TextDecoder("utf-16be"):new TextDecoder).decode(e);return new gr(t,e)}static fromString(e){const t=[];t.push(254,255);for(let r=0;r<e.length;r++){const s=e.charCodeAt(r);t.push((65280&s)>>>8),t.push(255&s)}return new gr(e,new Uint8Array(t))}static escape(e){const t=[];for(let r=0;r<e.length;r++)switch(e[r]){case P:t.push(re),t.push(ue);break;case k:t.push(re),t.push(ge);break;case C:t.push(re),t.push(we);break;case _:t.push(re),t.push(ae);break;case S:t.push(re),t.push(he);break;case B:t.push(re),t.push(B);break;case M:t.push(re),t.push(M);break;case re:t.push(re),t.push(re);break;default:t.push(e[r])}return new Uint8Array(t)}static unescape(e){const t=[];let r=!1;for(let s=0;s<e.length;s++)if(r){switch(e[s]){case ue:t.push(P);break;case ge:t.push(k);break;case we:t.push(C);break;case ae:t.push(_);break;case he:t.push(S);break;case B:t.push(B);break;case M:t.push(M);break;case re:t.push(re);break;default:t.push(e[s])}r=!1}else e[s]!==re?t.push(e[s]):r=!0;return new Uint8Array(t)}toArray(e){const t=(null==e?void 0:e.ref)&&e.stringCryptor?e.stringCryptor.encrypt(this._bytes,e.ref):this._bytes;return new Uint8Array([...be.STR_LITERAL_START,...gr.escape(t),...be.STR_LITERAL_END])}}class yr{constructor(e,t){this.id=null!=e?e:0,this.generation=null!=t?t:0}static parse(e,t,r=!0){if(r&&(t=e.findRegularIndex("straight",t)),t<0||t>e.maxIndex)return null;const s=e.parseNumberAt(t,!1,!1);if(!s||isNaN(s.value))return null;const n=e.parseNumberAt(s.end+2,!1,!1);return!n||isNaN(n.value)?null:{value:new yr(s.value,n.value),start:t,end:n.end}}static parseRef(e,t,r=!0){const s=yr.parse(e,t,r);if(!s)return null;const n=s.end+2,a=e.findSubarrayIndex([J],{minIndex:n,closedOnly:!0});return a&&a.start===n?{value:s.value,start:s.start,end:a.end}:null}static parseRefArray(e,t,r=!0){const s=e.getArrayBoundsAt(t,r);if(!s)return null;const n=[];let a,i=s.start+1;for(;i<s.end&&(a=yr.parseRef(e,i,!0),a);)n.push(a.value),i=a.end+1;return{value:n,start:s.start,end:s.end}}equals(e){return this.id===e.id&&this.generation===e.generation}toArray(e){return(new TextEncoder).encode(`${this.id} ${this.generation} R`)}toString(){return this.id+"|"+this.generation}}class wr{constructor(e,t){this._source=e,this._date=new Date(t)}get source(){return this._source}get date(){return new Date(this._date)}static parse(e,t,r=null,s=!0){if(s&&(t=e.skipEmpty(t)),e.isOutside(t)||e.getCharCode(t)!==B)return null;const n=e.findCharIndex(M,"straight",t);if(-1===n)return null;let a=e.subCharCodes(t+1,n-1);(null==r?void 0:r.ref)&&r.stringCryptor&&(a=r.stringCryptor.decrypt(a,r.ref));try{return{value:wr.fromArray(a),start:t,end:n}}catch(e){return null}}static fromDate(e){const t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0");return new wr(`D:${t}${r}${s}${n}${a}${i}`,e)}static fromString(e){const t=/D:(?<Y>\d{4})(?<M>\d{2})(?<D>\d{2})(?<h>\d{2})(?<m>\d{2})(?<s>\d{2})/.exec(e),r=new Date(+t.groups.Y,+t.groups.M-1,+t.groups.D,+t.groups.h,+t.groups.m,+t.groups.s);return new wr(e,r)}static fromArray(e){const t=(new TextDecoder).decode(e);return wr.fromString(t)}toArray(e){let t=(new TextEncoder).encode(this._source);return(null==e?void 0:e.ref)&&e.stringCryptor&&(t=e.stringCryptor.encrypt(t,e.ref)),new Uint8Array([...be.STR_LITERAL_START,...t,...be.STR_LITERAL_END])}}class Ar{constructor(){this._deleted=!1,this._edited=!1,this._added=!1,this.onChange={set:(e,t,r)=>(this._edited||"_"===t[0]||(this._edited=!0,console.log("EDITED"),console.log(this)),e[t]=r,!0)}}get ref(){return this._ref}set ref(e){this._ref=e}get id(){var e;return null===(e=this._ref)||void 0===e?void 0:e.id}get generation(){var e;return null===(e=this._ref)||void 0===e?void 0:e.generation}get deleted(){return this._deleted}get edited(){return this._edited}get added(){return this._added}parseRefProp(e,t,r){const s=yr.parseRef(t,r);return this.setParsedProp(e,s)}parseRefArrayProp(e,t,r){const s=yr.parseRefArray(t,r);return this.setParsedProp(e,s)}parseBoolProp(e,t,r){const s=t.parseBoolAt(r);return this.setParsedProp(e,s)}parseNameProp(e,t,r,s=!0){const n=t.parseNameAt(r,s);return this.setParsedProp(e,n)}parseNameArrayProp(e,t,r,s=!0){const n=t.parseNameArrayAt(r,s);return this.setParsedProp(e,n)}parseNumberProp(e,t,r,s=!0){const n=t.parseNumberAt(r,s);return this.setParsedProp(e,n)}parseNumberArrayProp(e,t,r,s=!0){const n=t.parseNumberArrayAt(r,s);return this.setParsedProp(e,n)}parseDateProp(e,t,r,s){const n=wr.parse(t,r,s);return this.setParsedProp(e,n)}parseLiteralProp(e,t,r,s){const n=gr.parse(t,r,s);return this.setParsedProp(e,n)}setParsedProp(e,t){if(!t)throw new Error(`Can't parse ${e} property value`);return this[e.slice(1)]=t.value,t.end+1}}class mr extends Ar{constructor(e){super(),this.Type=e}get streamId(){return this._streamId}toArray(e){const t=new TextEncoder,r=[...be.DICT_START];return this.Type&&r.push(...be.TYPE,...t.encode(this.Type)),r.push(...be.DICT_END),new Uint8Array(r)}parseProps(e){var t;if(!e)throw new Error("Parse info is empty");this._ref=null===(t=e.cryptInfo)||void 0===t?void 0:t.ref,this._streamId=e.streamId;const{parser:r,bounds:s}=e,n=s.contentStart||s.start,a=s.contentEnd||s.end;let i,o,h=r.skipToNextName(n,a-1);if(-1===h)throw new Error("Dict is empty (has no properties)");for(;o=r.parseNameAt(h),o;)switch(h=o.end+1,i=o.value,i){case"/Type":const e=r.parseNameAt(h);if(e){if(this.Type&&this.Type!==e.value)throw new Error(`Ivalid dict type: '${e.value}' instead of '${this.Type}'`);return}throw new Error("Can't parse /Type property value");default:h=r.skipToNextName(h,a-1)}}}class vr extends mr{constructor(){super(vt),this._intPropMap=new Map,this._boolPropMap=new Map,this._namePropMap=new Map,this._refPropMap=new Map}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new vr;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}static parseArray(e,t,r=null,s=!0){const n=e.getArrayBoundsAt(t,s);if(!n)return null;const a=[];let i,o=n.start+1;for(;o<n.end;){const t=e.getDictBoundsAt(o);if(i=vr.parse({parser:e,bounds:t,cryptInfo:r}),!i)break;a.push(i.value),o=i.end+1}return{value:a,start:n.start,end:n.end}}getIntProp(e){return this._intPropMap.get(e)}getBoolProp(e){return this._boolPropMap.get(e)}getNameProp(e){return this._namePropMap.get(e)}getRefProp(e){return this._refPropMap.get(e)}setIntProp(e,t){return this._intPropMap.set(e,t)}setBoolProp(e,t){return this._boolPropMap.set(e,t)}setNameProp(e,t){return this._namePropMap.set(e,t)}setRefProp(e,t){return this._refPropMap.set(e,t)}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this._intPropMap.forEach(((e,t)=>s.push(...r.encode(t),...r.encode(" "+e)))),this._boolPropMap.forEach(((e,t)=>s.push(...r.encode(t),...r.encode(" "+e)))),this._namePropMap.forEach(((e,t)=>s.push(...r.encode(t),...r.encode(e)))),this._refPropMap.forEach(((t,n)=>s.push(...r.encode(n),...t.toArray(e))));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;){o=i.end+1,a=i.value;switch(t.getValueTypeAt(o)){case _t:const e=t.parseNumberAt(o,!1);if(e){this._intPropMap.set(a,e.value),o=e.end+1;continue}break;case Et:const r=t.parseBoolAt(o);if(r){this._boolPropMap.set(a,r.value),o=r.end+1;continue}break;case St:const s=t.parseNameAt(o);if(s){this._namePropMap.set(a,s.value),o=s.end+1;continue}break;case Bt:const n=yr.parseRef(t,o);if(n){this._refPropMap.set(a,n.value),o=n.end+1;continue}}o=t.skipToNextName(o,n-1)}}}class br extends class{constructor(e){this._minBufferLength=512,this._bufferLength=0,this._current=0,this._ended=!1,this._sourceStream=e}get length(){return this._buffer.length}ensureBuffer(e){const t=this._buffer;if(t&&e<=t.byteLength)return t;let r=this._minBufferLength;for(;r<e;)r*=2;const s=new Uint8Array(r);return t&&s.set(t),this._buffer=s}takeByte(){const e=this._current;for(;this._bufferLength<=e;){if(this._ended)return-1;this._readBlock()}return this._buffer[this._current++]}takeBytes(e){let t;const r=this._current;if(e){for(this.ensureBuffer(r+e),t=r+e;!this._ended&&this._bufferLength<t;)this._readBlock();t>this._bufferLength&&(t=this._bufferLength)}else{for(;!this._ended;)this._readBlock();t=this._bufferLength}this._current=t;return this._buffer.subarray(r,t)}takeUint16(){const e=this.takeByte(),t=this.takeByte();return-1===e||-1===t?-1:(e<<8)+t}takeInt32(){return(this.takeByte()<<24)+(this.takeByte()<<16)+(this.takeByte()<<8)+this.takeByte()}peekByte(){const e=this.takeByte();return-1!==e&&this._current--,e}peekBytes(e){const t=this.takeBytes(e);return this._current-=t.length,t}skip(e){this._current+=e||1}reset(){this._current=0}}{constructor(e){super(e),this._codeSize=0,this._codeBuf=0;const t=e.takeByte(),r=e.takeByte();if(-1===t||-1===r)throw new Error(`Invalid header in flate stream: ${t}, ${r}`);if(8!=(15&t))throw new Error(`Unknown compression method in flate stream: ${t}, ${r}`);if(((t<<8)+r)%31!=0)throw new Error(`Bad FCHECK in flate stream: ${t}, ${r}`);if(32&r)throw new Error(`FDICT bit set in flate stream: ${t}, ${r}`);this._codeSize=0,this._codeBuf=0}_readBlock(){let e,t;const r=this._sourceStream;let s,n,a=this.getBits(3);if(1&a&&(this._ended=!0),a>>=1,0===a){let t;if(-1===(t=r.takeByte()))throw new Error("Bad block header in flate stream");let s=t;if(-1===(t=r.takeByte()))throw new Error("Bad block header in flate stream");if(s|=t<<8,-1===(t=r.takeByte()))throw new Error("Bad block header in flate stream");let n=t;if(-1===(t=r.takeByte()))throw new Error("Bad block header in flate stream");if(n|=t<<8,n!==(65535&~s)&&(0!==s||0!==n))throw new Error("Bad uncompressed block length in flate stream");this._codeBuf=0,this._codeSize=0;const a=this._bufferLength,i=a+s;if(e=this.ensureBuffer(i),this._bufferLength=i,0===s)-1===r.peekByte()&&(this._ended=!0);else{const t=r.takeBytes(s);e.set(t,a),t.length<s&&(this._ended=!0)}return}if(1===a)s=br.fixedLitCodeTab,n=br.fixedDistCodeTab;else{if(2!==a)throw new Error("Unknown block type in flate stream");{const e=this.getBits(5)+257,r=this.getBits(5)+1,a=this.getBits(4)+4,i=new Uint8Array(br.codeLenCodeMap.length);let o;for(o=0;o<a;o++)i[br.codeLenCodeMap[o]]=this.getBits(3);const h=this.generateHuffmanTable(i);t=0,o=0;const c=e+r,d=new Uint8Array(c);let l,u,p;for(;o<c;){const e=this.getCode(h);if(16===e)l=2,u=3,p=t;else if(17===e)l=3,u=3,p=t=0;else{if(18!==e){d[o++]=t=e;continue}l=7,u=11,p=t=0}let r=this.getBits(l)+u;for(;r-- >0;)d[o++]=p}s=this.generateHuffmanTable(d.subarray(0,e)),n=this.generateHuffmanTable(d.subarray(e,c))}}e=this._buffer;let i=e?e.length:0,o=this._bufferLength;for(;;){let r=this.getCode(s);if(r<256){o+1>=i&&(e=this.ensureBuffer(o+1),i=e.length),e[o++]=r;continue}if(256===r)return void(this._bufferLength=o);r-=257,r=br.lengthDecode[r];let a=r>>16;a>0&&(a=this.getBits(a)),t=(65535&r)+a,r=this.getCode(n),r=br.distDecode[r],a=r>>16,a>0&&(a=this.getBits(a));const h=(65535&r)+a;o+t>=i&&(e=this.ensureBuffer(o+t),i=e.length);for(let r=0;r<t;++r,++o)e[o]=e[o-h]}}getBits(e){const t=this._sourceStream;let r,s=this._codeSize,n=this._codeBuf;for(;s<e;){if(-1===(r=t.takeByte()))throw new Error("Bad encoding in flate stream");n|=r<<s,s+=8}return r=n&(1<<e)-1,this._codeBuf=n>>e,this._codeSize=s-=e,r}getCode(e){const t=this._sourceStream,[r,s]=e;let n,a=this._codeSize,i=this._codeBuf;for(;a<s&&-1!==(n=t.takeByte());)i|=n<<a,a+=8;const o=r[i&(1<<s)-1],h=o>>16,c=65535&o;if(h<1||a<h)throw new Error("Bad encoding in flate stream");return this._codeBuf=i>>h,this._codeSize=a-h,c}generateHuffmanTable(e){const t=e.length;let r,s=0;for(r=0;r<t;r++)e[r]>s&&(s=e[r]);const n=1<<s,a=new Int32Array(n);for(let i=1,o=0,h=2;i<=s;i++,o<<=1,h<<=1)for(let s=0;s<t;s++)if(e[s]===i){let e=0,t=o;for(r=0;r<i;r++)e=e<<1|1&t,t>>=1;for(r=e;r<n;r+=h)a[r]=i<<16|s;o++}return[a,s]}}br.codeLenCodeMap=new Int32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),br.lengthDecode=new Int32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),br.distDecode=new Int32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),br.fixedLitCodeTab=[new Int32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],br.fixedDistCodeTab=[new Int32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];class xr{constructor(e,t=0,r){if(r&&r<0)throw new Error("Stream length can't be negative");this._bytes=e instanceof Uint8Array?e:new Uint8Array(e),this._start=t,this._current=t,this._end=t+r||e.length}get length(){return this._end-this._start}takeByte(){return this._current>=this._end?-1:this._bytes[this._current++]}takeBytes(e){const t=this._bytes,r=this._current,s=this._end;if(e){let n=r+e;n>s&&(n=s),this._current=n;return t.subarray(r,n)}return t.subarray(r,s)}takeUint16(){const e=this.takeByte(),t=this.takeByte();return-1===e||-1===t?-1:(e<<8)+t}takeInt32(){return(this.takeByte()<<24)+(this.takeByte()<<16)+(this.takeByte()<<8)+this.takeByte()}peekByte(){const e=this.takeByte();return-1!==e&&this._current--,e}peekBytes(e){const t=this.takeBytes(e);return this._current-=t.length,t}getByte(e){return this._bytes[e]}getByteRange(e,t){return this._bytes.subarray(Math.max(e,0),Math.min(t,this._end))}skip(e){this._current+=e||1}reset(){this._current=this._start}}class Er{static Decode(e,t=je,r=1,s=1,n=8){const a=new xr(e,0,e.length),i=new br(a).takeBytes(null);switch(t){case je:return i;case Xe:case Ye:case Je:case Ze:case $e:case et:return Er.removePngFilter(i,r,s,n);case Ke:throw new Error("Unsupported filter predictor")}}static Encode(e,t=Je,r=5,s=1,n=8){let a;switch(t){case je:a=e;break;case Xe:case Ye:case Je:case Ze:case $e:case et:a=Er.applyPngFilter(e,t,r,s,n);break;case Ke:throw new Error("Unsupported filter predictor")}return i.deflate(a)}static removePngFilter(e,t,r,s){const n=Math.ceil(r*s/8),a=t*n,i=a+1;if(e.length%i)throw new Error("Data length doesn't match filter columns");const o=new Uint8Array(e.length/i*a),h=new Array(a).fill(0),c=new Array(a).fill(0),d=e=>e-n<0?0:c[e-n],l=e=>h[e];let u=0,p=0,f=0,g=0,y=0,w=0;for(let t=0;t<e.length;t++)if(t%i==0){if(y=e[t],u=0,t)for(f=0;f<a;f++)h[f]=o[g+f];g=p}else{switch(c[u]=e[t],y){case 0:w=c[u];break;case 1:w=(c[u]+d(u))%256;break;case 2:w=(c[u]+l(u))%256;break;case 3:w=(c[u]+Math.floor((l(u)+d(u))/2))%256;break;case 4:w=(c[u]+this.paethPredictor(d(u),l(u),(A=u)-n<0?0:h[A-n]))%256}o[p++]=w,u++}var A;return o}static applyPngFilter(e,t=12,r=5,s=1,n=8){let a;switch(t){case Xe:a=0;break;case Ye:a=1;break;case Je:a=2;break;case Ze:a=3;break;case $e:a=4;break;default:throw new Error("Invalid PNG filter type")}const i=Math.ceil(s*n/8),o=r*i,h=o+1,c=Math.ceil(e.length/o)*h,d=new Uint8Array(c),l=new Array(o).fill(0),u=new Array(o).fill(0),p=e=>e-i<0?0:u[e-i],f=e=>l[e];let g=0,y=0,w=0,A=0,m=0;for(let t=0;t<c;t++)if(t%h==0){if(g=0,t)for(w=0;w<o;w++)l[w]=e[A+w];A=y,d[t]=a}else{switch(u[g]=e[y++]||0,a){case 0:m=u[g];break;case 1:m=(u[g]-p(g))%256;break;case 2:m=(u[g]-f(g))%256;break;case 3:m=(u[g]-Math.floor((f(g)+p(g))/2))%256;break;case 4:m=(u[g]-this.paethPredictor(p(g),f(g),(v=g)-i<0?0:l[v-i]))%256}d[t]=m,g++}var v;return d}static paethPredictor(e,t,r){const s=e+t-r,n=Math.abs(s-e),a=Math.abs(s-t),i=Math.abs(s-r);return n<=a&&n<=i?e:a<=i?t:r}}class _r extends Ar{constructor(e){super(),this.Type=e}get streamData(){return this._streamData}set streamData(e){this.setStreamData(e),this._edited=!0}get decodedStreamData(){return this._decodedStreamData||this.decodeStreamData(),this._decodedStreamData}toArray(e){const t=(null==e?void 0:e.ref)&&e.streamCryptor?e.streamCryptor.encrypt(this.streamData,e.ref):this.streamData,r=new TextEncoder,s=[...be.DICT_START];return s.push(...r.encode("/Length "),...r.encode(" "+t.length)),this.Type&&s.push(...be.TYPE,...r.encode(this.Type)),this.Filter&&s.push(...r.encode("/Filter "),...r.encode(this.Filter)),this.DecodeParms&&s.push(...r.encode("/DecodeParms "),...this.DecodeParms.toArray(e)),s.push(...be.DICT_END,...be.END_OF_LINE,...be.STREAM_START,...be.END_OF_LINE,...t,...be.END_OF_LINE,...be.STREAM_END,...be.END_OF_LINE),new Uint8Array(s)}parseProps(e){var t,r;if(!e)throw new Error("Parse info is empty");this._ref=null===(t=e.cryptInfo)||void 0===t?void 0:t.ref;const{parser:s,bounds:n}=e,a=n.contentStart||n.start,i=n.contentEnd||n.end,o=s.findSubarrayIndex(be.STREAM_END,{direction:"reverse",minIndex:a,maxIndex:i,closedOnly:!0});if(!o)throw new Error("Object is not a stream");const h=s.findSubarrayIndex(be.STREAM_START,{direction:"reverse",minIndex:a,maxIndex:o.start-1,closedOnly:!0});if(!h)throw new Error("Stream start is out of the data bounds");const c=s.getDictBoundsAt(a);let d,l,u=s.skipToNextName(c.contentStart,c.contentEnd);if(-1===u)throw new Error("Dict is empty (has no properties)");for(;l=s.parseNameAt(u),l;)switch(u=l.end+1,d=l.value,d){case"/Type":const t=s.parseNameAt(u);if(!t)throw new Error("Can't parse /Type property value");if(this.Type&&this.Type!==t.value)throw new Error(`Ivalid dict type: '${t.value}' instead of '${this.Type}'`);u=t.end+1;break;case"/Length":case"/DL":u=this.parseNumberProp(d,s,u,!1);break;case"/Filter":const r=s.getValueTypeAt(u);if(r===St){const e=s.parseNameAt(u);if(e&&rr.has(e.value)){this.Filter=e.value,u=e.end+1;break}throw new Error(`Unsupported /Filter property value: ${e.value}`)}if(r===kt){const e=s.parseNameArrayAt(u);if(e){const t=e.value;if(1===t.length&&rr.has(t[0])){this.Filter=t[0],u=e.end+1;break}throw new Error(`Unsupported /Filter property value: ${t.toString()}`)}}throw new Error(`Unsupported /Filter property value type: ${r}`);case"/DecodeParms":const n=s.getValueTypeAt(u);if(n===Nt){const t=s.getDictBoundsAt(u);if(t){const r=vr.parse({parser:s,bounds:t,cryptInfo:e.cryptInfo});if(r){this.DecodeParms=r.value,u=t.end+1;break}}throw new Error("Can't parse /DecodeParms property value")}if(n===kt){const t=vr.parseArray(s,u,e.cryptInfo);if(t){const e=t.value;if(1===e.length){this.DecodeParms=e[0],u=t.end+1;break}}throw new Error("Can't parse /DecodeParms property value")}throw new Error(`Unsupported /DecodeParms property value type: ${n}`);default:u=s.skipToNextName(u,c.contentEnd)}const p=s.findNewLineIndex("straight",h.end+1),f=s.findNewLineIndex("reverse",o.start-1),g=s.sliceCharCodes(p,f),y=(null===(r=e.cryptInfo)||void 0===r?void 0:r.ref)&&e.cryptInfo.streamCryptor?e.cryptInfo.streamCryptor.decrypt(g,e.cryptInfo.ref):g;this._streamData=y}setStreamData(e){let t;if(this.DecodeParms){const r=this.DecodeParms;t=Er.Encode(e,r.getIntProp("/Predictor")||je,r.getIntProp("/Columns")||1,r.getIntProp("/Colors")||1,r.getIntProp("/BitsPerComponent")||8)}else t=Er.Encode(e);this._streamData=t,this.Length=t.length,this.DL=e.length,this._decodedStreamData=e}decodeStreamData(){let e;switch(this.Filter){case Ge:if(this.DecodeParms){const t=this.DecodeParms;e=Er.Decode(this._streamData,t.getIntProp("/Predictor")||je,t.getIntProp("/Columns")||1,t.getIntProp("/Colors")||1,t.getIntProp("/BitsPerComponent")||8)}else e=Er.Decode(this._streamData);break;default:e=new Uint8Array(this._streamData)}this._decodedStreamData=e}}class Cr extends _r{constructor(e=null){super(e)}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Cr;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}getText(){return null}toArray(e){return super.toArray(e)}parseProps(e){super.parseProps(e)}}const Pr={SOLID:"/S",DASHED:"/D",BEVELED:"/B",INSET:"/I",UNDERLINE:"/U"};class Sr extends mr{constructor(){super(pt),this.W=1,this.S=Pr.SOLID,this.D=[3,0]}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Sr;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.W&&s.push(...r.encode("/W "),...r.encode(" "+this.W)),this.S&&s.push(...r.encode("/S "),...r.encode(this.S)),this.D&&s.push(...r.encode("/D "),te,...r.encode(this.D[0]+""),N,...r.encode(this.D[1]+""),se);const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){var t,r;super.parseProps(e);const{parser:s,bounds:n}=e,a=n.contentStart||n.start,i=n.contentEnd||n.end;let o,h,c=s.skipToNextName(a,i-1);for(;h=s.parseNameAt(c),h;)switch(c=h.end+1,o=h.value,o){case"/W":c=this.parseNumberProp(o,s,c,!0);break;case"/S":const e=s.parseNameAt(c,!0);if(!e||!Object.values(Pr).includes(e.value))throw new Error("Can't parse /S property value");this.S=e.value,c=e.end+1;break;case"/D":const n=s.parseNumberArrayAt(c,!0);if(!n)throw new Error("Can't parse /D property value");this.D=[null!==(t=n.value[0])&&void 0!==t?t:3,null!==(r=n.value[1])&&void 0!==r?r:0],c=n.end+1;break;default:c=s.skipToNextName(c,i-1)}}}class kr{constructor(e){if(!(null==e?void 0:e.length))throw new Error("Data is empty");this._data=e,this._maxIndex=e.length-1}get maxIndex(){return this._maxIndex}getPdfVersion(){var e;const t=this.findSubarrayIndex(be.VERSION);if(!t)throw new Error("PDF not valid. Version not found");const r=null===(e=this.parseNumberAt(t.end+1,!0))||void 0===e?void 0:e.value;if(!r)throw new Error("Error parsing version number");return r.toFixed(1)}getLastXrefIndex(){const e=this.findSubarrayIndex(be.XREF_START,{maxIndex:this.maxIndex,direction:"reverse"});if(!e)return null;const t=this.parseNumberAt(e.end+1);return t||null}findSubarrayIndex(e,t){var r,s;const n=this._data;if(!(null==e?void 0:e.length))return null;const a=(null==t?void 0:t.direction)||"straight",i=Math.max(Math.min(null!==(r=null==t?void 0:t.minIndex)&&void 0!==r?r:0,this._maxIndex),0),o=Math.max(Math.min(null!==(s=null==t?void 0:t.maxIndex)&&void 0!==s?s:this._maxIndex,this._maxIndex),0),h=!(null==t?void 0:t.closedOnly);let c,d="straight"===a?i:o;if("straight"===a)e:for(;d<=o;d++){for(c=0;c<e.length;c++)if(n[d+c]!==e[c])continue e;if(h||!Ce(n[d+c]))return{start:d,end:d+c-1}}else{const t=e.length-1;e:for(;d>=i;d--){for(c=0;c<e.length;c++)if(n[d-c]!==e[t-c])continue e;if(h||!Ce(n[d-c]))return{start:d-c+1,end:d}}}return null}findCharIndex(e,t="straight",r){return this.findSingleCharIndex((t=>e===t),t,r)}findNewLineIndex(e="straight",t){let r=this.findSingleCharIndex((e=>e===k||e===P),e,t);return-1===r?-1:"straight"===e?(this._data[r]===k&&this._data[r+1]===P&&r++,Math.min(r+1,this._maxIndex)):(this._data[r]===P&&this._data[r-1]===k&&r--,Math.max(r-1,0))}findSpaceIndex(e="straight",t){return this.findSingleCharIndex((e=>Ee.has(e)),e,t)}findNonSpaceIndex(e="straight",t){return this.findSingleCharIndex((e=>!Ee.has(e)),e,t)}findDelimiterIndex(e="straight",t){return this.findSingleCharIndex((e=>xe.has(e)),e,t)}findNonDelimiterIndex(e="straight",t){return this.findSingleCharIndex((e=>!xe.has(e)),e,t)}findIrregularIndex(e="straight",t){return this.findSingleCharIndex((e=>!Ce(e)),e,t)}findRegularIndex(e="straight",t){return this.findSingleCharIndex((e=>Ce(e)),e,t)}getValueTypeAt(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e))return null;const r=this._data,s=e;switch(r[s]){case T:return Ce(r[s+1])?St:xt;case te:return kt;case B:return Ct;case q:return q===r[s+1]?Nt:Pt;case I:return Mt;case L:case O:case U:case F:case V:case z:case H:case W:case G:case Q:const e=this.findDelimiterIndex("straight",s+1);if(-1!==e){const t=this.findCharIndex(J,"reverse",e-1);if(-1!==t&&t>s&&!Ce(r[t+1]))return Bt}return _t;case D:case R:return n=r[s+1],_e.has(n)?_t:xt;case ye:return r[s+1]===we&&r[s+2]===ge&&r[s+3]===oe&&r[s+4]===ne&&r[s+5]===le?It:xt;case we:return r[s+1]===ge&&r[s+2]===Ae&&r[s+3]===oe?Et:xt;case he:return r[s+1]===ne&&r[s+2]===de&&r[s+3]===ye&&r[s+4]===oe?Et:xt;default:return xt}var n}getIndirectObjectBoundsAt(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e))return null;const r=this.findSubarrayIndex(be.OBJ,{minIndex:e,closedOnly:!0});if(!r)return null;let s=this.findNonSpaceIndex("straight",r.end+1);if(-1===s)return null;const n=this.findSubarrayIndex(be.OBJ_END,{minIndex:s,closedOnly:!0});if(!n)return null;let a=this.findNonSpaceIndex("reverse",n.start-1);return this.getCharCode(s)===q&&this.getCharCode(s+1)===q&&this.getCharCode(a-1)===j&&this.getCharCode(a)===j&&(s+=2,a-=2),{start:r.start,end:n.end,contentStart:s,contentEnd:a}}getXrefTableBoundsAt(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e)||this._data[e]!==me)return null;const r=this.findSubarrayIndex(be.XREF_TABLE,{minIndex:e});if(!r)return null;const s=this.findNonSpaceIndex("straight",r.end+1);if(-1===s)return null;const n=this.findSubarrayIndex(be.TRAILER,{minIndex:r.end+1});if(!n)return null;const a=this.findNonSpaceIndex("reverse",n.start-1);return a<s?null:{start:r.start,end:n.end,contentStart:s,contentEnd:a}}getDictBoundsAt(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e)||this._data[e]!==q||this._data[e+1]!==q)return null;const r=this.findNonSpaceIndex("straight",e+2);if(-1===r)return null;let s,n,a=1,i=!0,o=0,h=r;for(;a;)n=s,s=this._data[h++],s!==B||o&&n===re||o++,s===M&&o&&n!==re&&o--,o||(i?i=!1:s===q&&s===n?(a++,i=!0):s===j&&s===n&&(a--,i=!0));const c=h-1,d=this.findNonSpaceIndex("reverse",c-2);return d<r?{start:e,end:c}:{start:e,end:c,contentStart:r,contentEnd:d}}getArrayBoundsAt(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e)||this._data[e]!==te)return null;let r,s=0,n=e+1;for(;s||r!==se;)r=this._data[n++],r===te?s++:s&&r===se&&s--;const a=n-1;return a-e<1?null:{start:e,end:a}}getHexBounds(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e)||this.getCharCode(e)!==q)return null;const r=this.findCharIndex(j,"straight",e+1);return-1===r?null:{start:e,end:r}}getLiteralBounds(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e)||this.getCharCode(e)!==B)return null;let r,s,n=e+1,a=0;for(;a||s!==M||r===re;){if(n>this._maxIndex)return null;isNaN(s)||(r=s),s=this.getCharCode(n++),r!==re&&(s===B?a+=1:a&&s===M&&(a-=1))}return{start:e,end:n-1}}parseNumberAt(e,t=!1,r=!0){if(r&&(e=this.skipEmpty(e)),this.isOutside(e)||!Ce(this._data[e]))return null;let s=e,n="",a=this._data[s];for(a===R?(n+="-",a=this._data[++s]):a===D&&(n+="0.",a=this._data[++s]);_e.has(a)||t&&a===D;)n+=String.fromCharCode(a),a=this._data[++s];return n?{value:+n,start:e,end:s-1}:null}parseNameAt(e,t=!0,r=!0){if(r&&(e=this.skipEmpty(e)),this.isOutside(e)||this._data[e]!==T)return null;let s=e+1,n=t?"/":"",a=this._data[s];for(;Ce(a);)n+=String.fromCharCode(a),a=this._data[++s];return n.length>1?{value:n,start:e,end:s-1}:null}parseStringAt(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e))return null;let r=e,s="",n=this._data[r];for(;Ce(n);)s+=String.fromCharCode(n),n=this._data[++r];return 0!==s.length?{value:s,start:e,end:r-1}:null}parseBoolAt(e,t=!0){if(t&&(e=this.skipEmpty(e)),this.isOutside(e))return null;const r=this.findSubarrayIndex(be.TRUE,{minIndex:e});if(r)return{value:!0,start:e,end:r.end};const s=this.findSubarrayIndex(be.FALSE,{minIndex:e});return s?{value:!0,start:e,end:s.end}:null}parseNumberArrayAt(e,t=!0,r=!0){const s=this.getArrayBoundsAt(e,r);if(!s)return null;const n=[];let a,i=s.start+1;for(;i<s.end&&(a=this.parseNumberAt(i,t,!0),a);)n.push(a.value),i=a.end+1;return{value:n,start:s.start,end:s.end}}parseNameArrayAt(e,t=!0,r=!0){const s=this.getArrayBoundsAt(e,r);if(!s)return null;const n=[];let a,i=s.start+1;for(;i<s.end&&(a=this.parseNameAt(i,t,!0),a);)n.push(a.value),i=a.end+1;return{value:n,start:s.start,end:s.end}}parseDictType(e){return this.parseDictNameProperty(be.TYPE,e)}parseDictSubtype(e){return this.parseDictNameProperty(be.SUBTYPE,e)}parseDictNameProperty(e,t){const r=this.findSubarrayIndex(e,{minIndex:t.start,maxIndex:t.end});if(!r)return null;const s=this.parseNameAt(r.end+1);return s?s.value:null}skipEmpty(e){let t=this.findNonSpaceIndex("straight",e);if(-1===t)return-1;if(this._data[t]===I){const e=this.findNewLineIndex("straight",t+1);if(-1===e)return-1;t=this.findNonSpaceIndex("straight",e)}return t}skipToNextName(e,t){if(e||(e=0),(t=t?Math.min(t,this._maxIndex):0)<e)return-1;let r=e;for(;r<=t;){const e=this.getValueTypeAt(r,!0);if(e){let t;switch(e){case Nt:t=this.getDictBoundsAt(r,!1);break;case kt:t=this.getArrayBoundsAt(r,!1);break;case Ct:t=this.getLiteralBounds(r,!1);break;case Pt:t=this.getHexBounds(r,!1);break;case _t:const e=this.parseNumberAt(r,!0,!1);e&&(t=e);break;case Et:const s=this.parseBoolAt(r,!1);s&&(t=s);break;case Mt:break;case St:return r;default:r++;continue}if(t){r=t.end+1,t=null;continue}}r++}return-1}getCharCode(e){return this._data[e]}getChar(e){const t=this._data[e];return isNaN(t)?null:String.fromCharCode(t)}sliceCharCodes(e,t){return this._data.slice(e,(t||e)+1)}sliceChars(e,t){return String.fromCharCode(...this._data.slice(e,(t||e)+1))}subCharCodes(e,t){return this._data.subarray(e,(t||e)+1)}isOutside(e){return e<0||e>this._maxIndex}getValidStartIndex(e,t){return isNaN(t)?"straight"===e?0:this._maxIndex:Math.max(Math.min(t,this._maxIndex),0)}findSingleCharIndex(e,t="straight",r){const s=this._data;let n=this.getValidStartIndex(t,r);if("straight"===t){for(;n<=this._maxIndex;n++)if(e(s[n]))return n}else for(;n>=0;n--)if(e(s[n]))return n;return-1}}class Nr extends mr{constructor(){super(null),this._objectIdMap=new Map,this._dictParserMap=new Map}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Nr;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}getObjectId(e){return this._objectIdMap.get(e)}*getObjectIds(){for(const e of this._objectIdMap)yield e}getDictParser(e){return this._dictParserMap.get(e)}*getDictParsers(){for(const e of this._dictParserMap)yield e}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this._objectIdMap.forEach(((t,n)=>{s.push(...r.encode(n),N,...t.toArray(e))}));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){default:const r=t.getValueTypeAt(o);if(r===Bt){const e=yr.parseRef(t,o);if(e){this._objectIdMap.set(a,e.value),o=e.end+1;break}}else if(r===Nt){const r=t.getDictBoundsAt(o);if(r){const s={parser:new kr(t.sliceCharCodes(r.start,r.end)),bounds:{start:0,end:r.end-r.start,contentStart:r.contentStart-r.start,contentEnd:r.contentEnd-r.start},cryptInfo:e.cryptInfo};this._dictParserMap.set(a,s),o=r.end+1;break}}o=t.skipToNextName(o,n-1)}}}class Ir{constructor(e,t,r){this._literal=e,this._hex=t,this._bytes=r}get literal(){return this._literal}get hex(){return this._hex.slice()}get bytes(){return this._bytes.slice()}static parse(e,t,r=null,s=!0){const n=e.getHexBounds(t,s);if(!n)return null;let a=e.sliceCharCodes(n.start+1,n.end-1);(null==r?void 0:r.ref)&&r.stringCryptor&&(a=r.stringCryptor.decrypt(a,r.ref));return{value:Ir.fromBytes(a),start:n.start,end:n.end}}static parseArray(e,t,r=null,s=!0){const n=e.getArrayBoundsAt(t,s);if(!n)return null;const a=[];let i,o=n.start+1;for(;o<n.end&&(i=Ir.parse(e,o,r,s),i);)a.push(i.value),o=i.end+1;return{value:a,start:n.start,end:n.end}}static fromBytes(e){const t=(new TextDecoder).decode(e),r=Me(t);return new Ir(t,r,e)}static fromHexBytes(e){let t="";e.forEach((e=>t+=e.toString(16).padStart(2,"0")));const r=(new TextEncoder).encode(t);return new Ir(t,e,r)}static fromLiteralString(e){const t=Me(e),r=(new TextEncoder).encode(e);return new Ir(e,t,r)}toArray(e){return new Uint8Array([...be.STR_HEX_START,...this._bytes,...be.STR_HEX_END])}}class Br{constructor(e,t,r){switch(e){case Jt:this.componentsNumber=1;break;case Zt:this.componentsNumber=3;break;case $t:this.componentsNumber=4;break;default:throw new Error(`Unsupported base color space for indexed color space: ${e}`)}if(this.baseColorSpace=e,r.length!==this.componentsNumber*(t+1))throw new Error(`Invalid lookup array length: ${r.length}`);this.highestValue=t,this.lookupArray=r,console.log(this)}static parse(e,t=!0){const{parser:r,bounds:s,cryptInfo:n}=e;let a;t&&(a=r.findNonSpaceIndex("straight",s.start));const i=a;if(a<0||a>r.maxIndex||r.getCharCode(a)!==te)return console.log("Color space array start not found"),null;a++;const o=r.parseNameAt(a);if(!o||"/Indexed"!==o.value)return console.log("Array is not representing an indexed color space"),null;a=o.end+1;const h=r.parseNameAt(a);if(!h)return console.log("Can't parse base color space name of the indexed color space"),null;a=h.end+2;const c=r.parseNumberAt(a);if(!c||isNaN(c.value))return console.log("Can't parse the highest value of the indexed color space"),null;let d;a=c.end+1;const l=r.getValueTypeAt(a);if(l===Bt)try{const t=yr.parseRef(r,a),s=e.parseInfoGetter(t.value.id);d=Cr.parse(s).value.decodedStreamData,a=t.end+1}catch(e){throw new Error(`Can't parse indexed color array lookup ref: ${e.message}`)}else if(l===Pt){const e=Ir.parse(r,a,n);if(!e)throw new Error("Can't parse indexed color array lookup hex string");d=e.value.hex,a=e.end+1}try{return{value:new Br(h.value,c.value,d),start:i,end:a-1}}catch(e){return console.log(e.message),null}}toArray(e){const t=new TextEncoder,r=[];return r.push(te,...t.encode("/Indexed "),...t.encode(this.baseColorSpace+" "),...t.encode(this.highestValue+" "),...Ir.fromHexBytes(this.lookupArray).toArray(e),se),new Uint8Array(r)}getColor(e){switch(this.baseColorSpace){case Jt:const t=this.lookupArray[e];return[t,t,t];case Zt:return[this.lookupArray[3*e],this.lookupArray[3*e+1],this.lookupArray[3*e+2]];case $t:const r=this.lookupArray[4*e]/255,s=this.lookupArray[4*e+1]/255,n=this.lookupArray[4*e+2]/255,a=this.lookupArray[4*e+3]/255;return[255*(1-r)*(1-a),255*(1-s)*(1-a),255*(1-n)*(1-a)]}}}var Mr=function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{h(s.next(e))}catch(e){a(e)}}function o(e){try{h(s.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}h((s=s.apply(e,t||[])).next())}))};class Rr extends _r{constructor(){super(ht),this.Subtype="/Image",this.ImageMask=!1,this.Interpolate=!1,this.SMaskInData=0}get sMask(){return this._sMask}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Rr;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.Subtype&&s.push(...r.encode("/Subtype "),...r.encode(this.Subtype)),this.Width&&s.push(...r.encode("/Width "),...r.encode(" "+this.Width)),this.Height&&s.push(...r.encode("/Width "),...r.encode(" "+this.Height)),this.ColorSpace&&(this._indexedColorSpace?s.push(...r.encode("/ColorSpace "),...this._indexedColorSpace.toArray(e)):s.push(...r.encode("/ColorSpace "),...r.encode(this.ColorSpace))),this.BitsPerComponent&&s.push(...r.encode("/BitsPerComponent "),...r.encode(" "+this.BitsPerComponent)),s.push(...r.encode("/ImageMask "),...r.encode(" "+!!this.ImageMask)),this.Mask&&(s.push(...r.encode("/Mask "),te),this.Mask.forEach((e=>s.push(N,...r.encode(" "+e)))),s.push(se)),this.Decode&&(s.push(...r.encode("/Decode "),te),this.Decode.forEach((e=>s.push(N,...r.encode(" "+e)))),s.push(se)),s.push(...r.encode("/Interpolate "),...r.encode(" "+!!this.Interpolate)),this.SMask&&s.push(...r.encode("/SMask "),...this.SMask.toArray(e)),this.SMaskInData&&s.push(...r.encode("/SMaskInData "),...r.encode(" "+this.SMaskInData)),this.Matte&&(s.push(...r.encode("/Matte "),te),this.Matte.forEach((e=>s.push(N,...r.encode(" "+e)))),s.push(se)),this.StructParent&&s.push(...r.encode("/StructParent "),...r.encode(" "+this.StructParent)),this.Metadata&&s.push(...r.encode("/Metadata "),N,...this.Metadata.toArray(e));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}getImageUrlAsync(){return Mr(this,void 0,void 0,(function*(){if(this._imageUrl&&URL.revokeObjectURL(this._imageUrl),this.Filter===We||this.Filter===Qe||this.Filter===qe){const e=new Blob([this.decodedStreamData],{type:"application/octet-binary"}),t=URL.createObjectURL(e);return this._imageUrl=t,t}if(this.Filter===Ge){const e=this.Width*this.Height;let t;if(this.sMask){if(t=this.sMask.decodedStreamData,t.length!==e)throw new Error(`Invalid alpha mask data length: ${t.length} (must be ${e})`)}else t=new Uint8Array(e).fill(255);const r=new Uint8ClampedArray(4*e);for(let s=0;s<e;s++){const[e,n,a]=this.getColor(s);r[4*s]=e,r[4*s+1]=n,r[4*s+2]=a,r[4*s+3]=t[s]}const s=new ImageData(r,this.Width,this.Height),n=new Promise(((e,t)=>{const r=document.createElement("canvas");r.width=this.Width,r.height=this.Height,r.getContext("2d").putImageData(s,0,0),r.toBlob((t=>{const r=URL.createObjectURL(t);e(r)}))})),a=yield n;return this._imageUrl=a,a}throw new Error(`Unsupported image filter type: ${this.Filter}`)}))}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=t.getDictBoundsAt(s);let a,i,o=t.skipToNextName(n.contentStart,n.contentEnd);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Subtype":const r=t.parseNameAt(o);if(!r)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==r.value)throw new Error(`Ivalid dict subtype: '${r.value}' instead of '${this.Subtype}'`);o=r.end+1;break;case"/Width":case"/Height":case"/BitsPerComponent":case"/SMaskInData":case"/StructParent":o=this.parseNumberProp(a,t,o,!1);break;case"/Decode":o=this.parseNumberArrayProp(a,t,o,!1);break;case"/Matte":o=this.parseNumberArrayProp(a,t,o,!0);break;case"/Interpolate":o=this.parseBoolProp(a,t,o);break;case"/SMask":case"/Metadata":o=this.parseRefProp(a,t,o);break;case"/ColorSpace":const s=t.getValueTypeAt(o);if(s===St){const e=t.parseNameAt(o);if(e){this.ColorSpace=e.value,o=e.end+1;break}throw new Error("Can't parse /ColorSpace name")}if(s===kt){const r=t.getArrayBoundsAt(o);if(r){const s=Br.parse({parser:t,bounds:r,cryptInfo:e.cryptInfo,parseInfoGetter:e.parseInfoGetter});if(s){this.ColorSpace=er,this._indexedColorSpace=s.value,o=r.end+1;break}throw new Error("Can't parse /ColorSpace object:"+t.sliceChars(r.start,r.end))}throw new Error("Can't parse /ColorSpace value array")}if(s===Bt){const r=yr.parseRef(t,o);if(r){const t=e.parseInfoGetter(r.value.id);if(t){const e=Br.parse(t);if(e){this.ColorSpace=er,this._indexedColorSpace=e.value,o=r.end+1;break}throw new Error("Can't parse /ColorSpace object:"+t.parser.sliceChars(t.bounds.start,t.bounds.end))}}throw new Error("Can't parse /ColorSpace ref")}throw new Error(`Unsupported /ColorSpace property value type: ${s}`);case"/ImageMask":const i=t.parseBoolAt(o,!1);if(!i)throw new Error("Can't parse /ImageMask property value");this.ImageMask=i.value,o=i.end+1,this.ImageMask&&(this.BitsPerComponent=1);break;case"/Mask":const h=t.getValueTypeAt(o);if(h===Bt){const r=yr.parseRef(t,o);if(!r)throw new Error("Can't parse /Mask value reference: failed to parse ref");const s=e.parseInfoGetter(r.value.id);if(!s)throw new Error("Can't parse /Mask value reference: failed to get image parse info");const n=Rr.parse(s);if(!n)throw new Error("Can't parse /Mask value reference: failed to parse image stream");const a=new kr(new Uint8Array([te,...n.value.decodedStreamData,se]));if(!a)throw new Error("Can't parse /Mask value reference: failed to get decoded image data");const i=a.parseNumberArrayAt(0,!1);if(!i)throw new Error("Can't parse /Mask value reference: failed to parse decoded image data");this.Mask=i.value,o=r.end+1;break}if(h===kt){const e=t.parseNumberArrayAt(o,!1);if(e){this.Mask=e.value,o=e.end+1;break}throw new Error("Can't parse /Mask property value")}throw new Error(`Unsupported /Mask property value type: ${h}`);case"/OC":case"/Intent":case"/Alternates":case"/ID":case"/OPI":default:o=t.skipToNextName(o,n.contentEnd)}if(!this.Width&&!this.Height)throw new Error("Not all required properties parsed");if(this.ImageMask&&(1!==this.BitsPerComponent||this.ColorSpace))throw new Error("Mutually exclusive properties found");if(!this.Decode&&(this.Filter!==qe||this.ImageMask))switch(this.ColorSpace){case Jt:this.Decode=[0,1];break;case Zt:this.Decode=[0,1,0,1,0,1];break;case $t:this.Decode=[0,1,0,1,0,1,0,1];break;case er:this.Decode=[0,Math.pow(2,this.BitsPerComponent||1)-1];break;default:this.Decode=[0,1]}if(this.DecodeParms||(this.DecodeParms=new vr),this.DecodeParms.getIntProp("/BitsPerComponent")||this.DecodeParms.setIntProp("/BitsPerComponent",this.BitsPerComponent),this.DecodeParms.getIntProp("/Columns")||this.DecodeParms.setIntProp("/Columns",this.Width),!this.DecodeParms.getIntProp("/Colors"))switch(this.ColorSpace){case Jt:case er:this.DecodeParms.setIntProp("/Colors",1);break;case Zt:this.DecodeParms.setIntProp("/Colors",3);break;case $t:this.DecodeParms.setIntProp("/Colors",4);break;default:this.DecodeParms.setIntProp("/Colors",1)}if(this.SMask){const t=e.parseInfoGetter(this.SMask.id);if(!t)throw new Error(`Can't get parse info for ref: ${this.SMask.id} ${this.sMask.generation} R`);const r=Rr.parse(t);if(!r)throw new Error(`Can't parse SMask: ${this.SMask.id} ${this.sMask.generation} R`);this._sMask=r.value}}getColor(e){var t;const r=this.decodedStreamData;switch(this.ColorSpace){case Jt:const s=r[e];return[s,s,s];case Zt:return[r[3*e],r[3*e+1],r[3*e+2]];case $t:const n=r[4*e]/255,a=r[4*e+1]/255,i=r[4*e+2]/255,o=r[4*e+3]/255;return[255*(1-n)*(1-o),255*(1-a)*(1-o),255*(1-i)*(1-o)];case er:return(null===(t=this._indexedColorSpace)||void 0===t?void 0:t.getColor(e))||[0,0,0]}}}class Dr extends mr{constructor(){super(mt)}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Dr;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.Subtype&&s.push(...r.encode("/Subtype "),...r.encode(" "+this.Subtype)),this.BaseFont&&s.push(...r.encode("/BaseFont "),...r.encode(" "+this.BaseFont)),this.Encoding&&s.push(...r.encode("/Encoding "),...r.encode(" "+this.Encoding)),this.ToUnicode&&s.push(...r.encode("/G "),N,...this.ToUnicode.toArray(e));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Subtype":const e=t.parseNameAt(o,!0);if(e){if("/Type1"===e.value||"/TrueType"===e.value){this.Subtype=e.value,o=e.end+1;break}throw new Error(`Font type is not supported: ${e.value}`)}throw new Error("Can't parse /Subtype property value");case"/BaseFont":case"/Encoding":o=this.parseNameProp(a,t,o);break;case"/ToUnicode":o=this.parseRefProp(a,t,o);break;default:o=t.skipToNextName(o,n-1)}}}class Tr extends mr{constructor(){super(wt),this.TR="/Identity"}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Tr;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.S&&s.push(...r.encode("/S "),...r.encode(this.S)),this.G&&s.push(...r.encode("/G "),N,...this.G.toArray(e)),this.BC&&(s.push(...r.encode("/BC "),te),this.BC.forEach((e=>s.push(N,...r.encode(" "+e)))),s.push(se)),this.TR&&s.push(...r.encode("/TR "),...r.encode(" "+this.TR));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/S":const e=t.parseNameAt(o,!0);if(!e||!Object.values(tr).includes(e.value))throw new Error("Can't parse /S property value");this.S=e.value,o=e.end+1;break;case"/G":o=this.parseRefProp(a,t,o);break;case"/BC":o=this.parseNumberArrayProp(a,t,o);break;case"/TR":default:o=t.skipToNextName(o,n-1)}}}class Lr extends mr{constructor(){super(gt)}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Lr;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.LW&&s.push(...r.encode("/LW "),...r.encode(" "+this.LW)),this.LC&&s.push(...r.encode("/LC "),...r.encode(" "+this.LC)),this.LJ&&s.push(...r.encode("/LJ "),...r.encode(" "+this.LJ)),this.ML&&s.push(...r.encode("/ML "),...r.encode(" "+this.ML)),this.D&&s.push(...r.encode("/D "),te,te,...r.encode(""+this.D[0][0]),...r.encode(" "+this.D[0][1]),se,...r.encode(" "+this.D[1]),se),this.RI&&s.push(...r.encode("/RI "),...r.encode(this.RI)),this.OP&&s.push(...r.encode("/OP "),...r.encode(" "+this.OP)),this.op&&s.push(...r.encode("/op "),...r.encode(" "+this.op)),this.OPM&&s.push(...r.encode("/OPM "),...r.encode(" "+this.OPM)),this.Font&&s.push(...r.encode("/Font "),te,...this.Font[0].toArray(e),...r.encode(" "+this.Font[1]),se),this.FL&&s.push(...r.encode("/FL "),...r.encode(" "+this.FL)),this.SM&&s.push(...r.encode("/SM "),...r.encode(" "+this.SM)),this.SA&&s.push(...r.encode("/SA "),...r.encode(" "+this.SA)),this.BM&&s.push(...r.encode("/BM "),...r.encode(this.BM)),this.SMask&&(this.SMask instanceof Tr?s.push(...r.encode("/SMask "),...this.SMask.toArray(e)):s.push(...r.encode("/SMask "),...r.encode(this.SMask))),this.CA&&s.push(...r.encode("/CA "),...r.encode(" "+this.CA)),this.ca&&s.push(...r.encode("/ca "),...r.encode(" "+this.ca)),this.AIS&&s.push(...r.encode("/AIS "),...r.encode(" "+this.AIS)),this.TK&&s.push(...r.encode("/AIS "),...r.encode(" "+this.TK));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}toParams(){const e={};if(isNaN(this.LW)||(e.strokeWidth=this.LW),!isNaN(this.LC))switch(this.LC){case jt.BUTT:e.strokeLineCap="butt";break;case jt.ROUND:e.strokeLineCap="round";break;case jt.SQUARE:e.strokeLineCap="square"}if(!isNaN(this.LJ))switch(this.LJ){case Kt.BEVEL:e.strokeLineJoin="bevel";break;case Kt.ROUND:e.strokeLineJoin="round";break;case Kt.MITER:e.strokeLineJoin="miter"}return this.ML&&(e.strokeMiterLimit=this.ML),this.D&&(e.strokeDashArray=`${this.D[0][0]} ${this.D[0][1]}`,e.strokeDashOffset=this.D[1]),this.Font,this.BM&&(e.strokeMiterLimit=this.ML),this.SMask,this.CA&&(e.strokeAlpha=this.CA),this.ca&&(e.fillAlpha=this.ca),this.AIS,e}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/LC":const e=t.parseNumberAt(o,!0);if(!e||!Object.values(jt).includes(e.value))throw new Error("Can't parse /LC property value");this.LC=e.value,o=e.end+1;break;case"/OPM":const r=t.parseNumberAt(o,!0);if(!r||![0,1].includes(r.value))throw new Error("Can't parse /OPM property value");this.OPM=r.value,o=r.end+1;break;case"/LJ":const s=t.parseNumberAt(o,!0);if(!s||!Object.values(Kt).includes(s.value))throw new Error("Can't parse /LJ property value");this.LJ=s.value,o=s.end+1;break;case"/RI":const i=t.parseNameAt(o,!0);if(!i||!Object.values(Xt).includes(i.value))throw new Error("Can't parse /RI property value");this.RI=i.value,o=i.end+1;break;case"/BM":const h=t.parseNameAt(o,!0);if(!h||!Object.values(Yt).includes(h.value))throw new Error("Can't parse /BM property value");this.BM=h.value,o=h.end+1;break;case"/SMask":const c=t.getValueTypeAt(o);if(c===St){const e=t.parseNameAt(o);if(e){this.SMask=e.value,o=e.end+1;break}throw new Error("Can't parse /SMask property name")}if(c===Nt){const e=t.getDictBoundsAt(o);if(e){const r=Tr.parse({parser:t,bounds:e});if(r){this.SMask=r.value,o=r.end+1;break}}throw new Error("Can't parse /SMask value dictionary")}throw new Error(`Unsupported /SMask property value type: ${c}`);case"/Font":const d=t.getValueTypeAt(o);if(d!==kt)throw new Error(`Unsupported /Font property value type: ${d}`);{const e=t.getArrayBoundsAt(o);if(e){const r=yr.parse(t,e.start+1);if(r){const s=t.parseNumberAt(r.end+1);if(s){this.Font=[r.value,s.value],o=e.end+1;break}}}}throw new Error("Can't parse /Font property value");case"/D":const l=t.getValueTypeAt(o);if(l!==kt)throw new Error(`Unsupported /D property value type: ${l}`);{const e=t.getArrayBoundsAt(o);if(e){const r=t.parseNumberArrayAt(e.start+1);if(r){const s=t.parseNumberAt(r.end+1);if(s){this.D=[[r.value[0],r.value[1]],s.value],o=e.end+1;break}}}}throw new Error("Can't parse /D property value");case"/OP":case"/op":case"/SA":case"/AIS":case"/TK":o=this.parseBoolProp(a,t,o);break;case"/LW":case"/ML":case"/FL":case"/SM":case"/CA":case"/ca":o=this.parseNumberProp(a,t,o);break;default:o=t.skipToNextName(o,n-1)}}}class Or extends mr{constructor(){super(null),this._gsMap=new Map,this._fontsMap=new Map,this._xObjectsMap=new Map}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Or;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];if(this._gsMap.size){s.push(...r.encode("/ExtGState ")),s.push(...be.DICT_START);for(const[t,n]of this._gsMap)s.push(...r.encode(t.slice(10)),N),n.ref?s.push(...new yr(n.ref.id,n.ref.generation).toArray(e)):s.push(...n.toArray(e));s.push(...be.DICT_END)}if(this._xObjectsMap.size){s.push(...r.encode("/XObject "),...be.DICT_START);for(const[t,n]of this._xObjectsMap){const a=n.ref;if(!a)throw new Error("XObject has no reference");s.push(...r.encode(t.slice(8)),N),s.push(...new yr(a.id,a.generation).toArray(e))}s.push(...be.DICT_END)}this.ColorSpace&&s.push(...r.encode("/ColorSpace "),...this.ColorSpace.toArray(e)),this.Pattern&&s.push(...r.encode("/Pattern "),...this.Pattern.toArray(e)),this.Shading&&s.push(...r.encode("/Shading "),...this.Shading.toArray(e)),this.Font&&s.push(...r.encode("/Font "),...this.Font.toArray(e)),this.Properties&&s.push(...r.encode("/Properties "),...this.Properties.toArray(e)),this.ProcSet&&(s.push(...r.encode("/ProcSet "),te),this.ProcSet.forEach((e=>s.push(N,...r.encode(e)))),s.push(se));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}getGraphicsState(e){return this._gsMap.get(e)}*getGraphicsStates(){for(const e of this._gsMap)yield e}setGraphicsState(e,t){this._gsMap.set(`/ExtGState${e}`,t)}getFont(e){return this._fontsMap.get(e)}*getFonts(){for(const e of this._fontsMap)yield e}getXObject(e){return this._xObjectsMap.get(e)}*getXObjects(){for(const e of this._xObjectsMap)yield e}setXObject(e,t){this._xObjectsMap.set(`/XObject${e}`,t)}fillMaps(e,t){if(this._gsMap.clear(),this._fontsMap.clear(),this._xObjectsMap.clear(),this.ExtGState){for(const[t,r]of this.ExtGState.getObjectIds()){const s=e(r.id);if(!s)continue;const n=Lr.parse(s);n&&this._gsMap.set(`/ExtGState${t}`,n.value)}for(const[e,t]of this.ExtGState.getDictParsers()){const r=Lr.parse(t);r&&this._gsMap.set(`/ExtGState${e}`,r.value)}}if(this.XObject)for(const[t,r]of this.XObject.getObjectIds()){const s=e(r.id);if(!s)continue;const n=s.parser.findSubarrayIndex(be.FORM,{direction:"straight",minIndex:s.bounds.start,maxIndex:s.bounds.end})?zr.parse(s):Rr.parse(s);n&&this._xObjectsMap.set(`/XObject${t}`,n.value)}if(this.Font)for(const[t,r]of this.Font.getObjectIds()){const s=e(r.id);if(!s)continue;const n=Dr.parse(s);n&&this._fontsMap.set(`/Font${t}`,n.value)}}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/ExtGState":case"/ColorSpace":case"/Pattern":case"/Shading":case"/XObject":case"/Font":case"/Properties":const e=t.getDictBoundsAt(o);if(e){const r=Nr.parse({parser:t,bounds:e});if(r){this[a.slice(1)]=r.value,o=e.end+1;break}}throw new Error(`Can't parse ${a} property value`);case"/ProcSet":o=this.parseNameArrayProp(a,t,o);break;default:o=t.skipToNextName(o,n-1)}e.parseInfoGetter&&this.fillMaps(e.parseInfoGetter,e.cryptInfo)}}class Ur extends mr{constructor(){super(ft),this.Subtype="/RL"}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Ur;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.Subtype&&s.push(...r.encode("/Subtype "),...r.encode(this.Subtype));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Subtype":const e=t.parseNameAt(o);if(!e)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==e.value)throw new Error(`Ivalid dict subtype: '${e.value}' instead of '${this.Subtype}'`);o=e.end+1;break;default:o=t.skipToNextName(o,n-1)}}}class Fr extends mr{constructor(){super(At),this.S="/Transparency"}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.S&&s.push(...r.encode("/S "),...r.encode(this.S));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/S":const e=t.parseNameAt(o,!0);if(!e)throw new Error("Can't parse /S property value");if(!Object.values(bt).includes(e.value))throw new Error(`Ivalid dict subtype: '${e.value}'`);this.S=e.value,o=e.end+1;break;default:o=t.skipToNextName(o,n-1)}}}class Vr extends Fr{constructor(){super(),this.I=!1,this.K=!1}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Vr;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.CS&&s.push(...r.encode("/CS "),...r.encode(this.CS)),this.I&&s.push(...r.encode("/I "),...r.encode(" "+this.I)),this.K&&s.push(...r.encode("/K "),...r.encode(" "+this.K));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){if(super.parseProps(e),"/Transparency"!==this.S)throw new Error("Not a transparency dict");const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/CS":const e=t.getValueTypeAt(o);if(e===St){const e=t.parseNameAt(o);if(e){this.CS=e.value,o=e.end+1;break}throw new Error("Can't parse /CS property name")}if(e===kt){const e=t.getArrayBoundsAt(o);if(e){o=e.end+1;break}throw new Error("Can't parse /CS value dictionary")}throw new Error(`Unsupported /CS property value type: ${e}`);case"/I":case"/K":o=this.parseBoolProp(a,t,o);break;default:o=t.skipToNextName(o,n-1)}}}class zr extends _r{constructor(){super(ht),this.Subtype="/Form",this.FormType=1,this.Matrix=[1,0,0,1,0,0]}get matrix(){const e=new f;if(this.Matrix){const[t,r,s,n,a,i]=this.Matrix;e.set(t,r,0,s,n,0,a,i,1)}return e}set matrix(e){e&&(this.Matrix=[...e.toFloatShortArray()])}get bBox(){return{ll:new u(this.BBox[0],this.BBox[1]),lr:new u(this.BBox[2],this.BBox[1]),ur:new u(this.BBox[2],this.BBox[3]),ul:new u(this.BBox[0],this.BBox[3])}}get transformedBBox(){const e=new f;if(this.Matrix){const[t,r,s,n,a,i]=this.Matrix;e.set(t,r,0,s,n,0,a,i,1)}const t=new u(this.BBox[0],this.BBox[1]),r=new u(this.BBox[2],this.BBox[1]),s=new u(this.BBox[2],this.BBox[3]),n=new u(this.BBox[0],this.BBox[3]);return{ll:u.applyMat3(t,e),lr:u.applyMat3(r,e),ur:u.applyMat3(s,e),ul:u.applyMat3(n,e)}}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new zr;t.parseProps(e);const r=new Proxy(t,t.onChange);return t._proxy=r,{value:r,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.Subtype&&s.push(...r.encode("/Subtype "),...r.encode(this.Subtype)),this.FormType&&s.push(...r.encode("/FormType "),...r.encode(" "+this.FormType)),this.BBox&&s.push(...r.encode("/BBox "),te,...r.encode(this.BBox[0]+""),N,...r.encode(this.BBox[1]+""),N,...r.encode(this.BBox[2]+""),N,...r.encode(this.BBox[3]+""),se),this.Matrix&&s.push(...r.encode("/BBox "),te,...r.encode(this.Matrix[0]+""),N,...r.encode(this.Matrix[1]+""),N,...r.encode(this.Matrix[2]+""),N,...r.encode(this.Matrix[3]+""),N,...r.encode(this.Matrix[4]+""),N,...r.encode(this.Matrix[5]+""),se),this.Resources&&s.push(...r.encode("/Resources "),...this.Resources.toArray(e)),this.Metadata&&s.push(...r.encode("/Metadata "),N,...this.Metadata.toArray(e)),this.LastModified&&s.push(...r.encode("/LastModified "),...this.LastModified.toArray(e)),this.StructParent&&s.push(...r.encode("/StructParent "),...r.encode(" "+this.StructParent)),this.StructParents&&s.push(...r.encode("/StructParents "),...r.encode(" "+this.StructParents)),this.Measure&&s.push(...r.encode("/Measure "),...this.Measure.toArray(e)),this.Group&&s.push(...r.encode("/Group "),...this.Group.toArray(e));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=t.getDictBoundsAt(s);let a,i,o=t.skipToNextName(n.contentStart,n.contentEnd);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Subtype":const r=t.parseNameAt(o);if(!r)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==r.value)throw new Error(`Ivalid dict subtype: '${r.value}' instead of '${this.Subtype}'`);o=r.end+1;break;case"/FormType":const s=t.parseNumberAt(o,!1);if(!s)throw new Error("Can't parse /FormType property value");if(1!==s.value)throw new Error(`Ivalid form type: '${s.value}' instead of '1'`);o=s.end+1;break;case"/BBox":case"/Matrix":o=this.parseNumberArrayProp(a,t,o,!0);break;case"/LastModified":o=this.parseDateProp(a,t,o,e.cryptInfo);break;case"/Metadata":o=this.parseRefProp(a,t,o);break;case"/StructParent":case"/StructParents":o=this.parseNumberProp(a,t,o,!1);break;case"/Resources":const i=t.getValueTypeAt(o);if(i===Bt){const r=yr.parseRef(t,o);if(r&&e.parseInfoGetter){const t=e.parseInfoGetter(r.value.id);if(t){const e=Or.parse(t);if(e){this.Resources=e.value,o=e.end+1;break}}}throw new Error("Can't parse /Resources value reference")}if(i===Nt){const r=t.getDictBoundsAt(o);if(r){if(r.contentStart){const s=Or.parse({parser:t,bounds:r,parseInfoGetter:e.parseInfoGetter});if(!s)throw new Error("Can't parse /Resources value dictionary");this.Resources=s.value}o=r.end+1;break}throw new Error("Can't parse /Resources dictionary bounds")}throw new Error(`Unsupported /Resources property value type: ${i}`);case"/Measure":const h=t.getValueTypeAt(o);if(h===Bt){const r=yr.parseRef(t,o);if(r&&e.parseInfoGetter){const t=e.parseInfoGetter(r.value.id);if(t){const e=Ur.parse(t);if(e){this.Measure=e.value,o=e.end+1;break}}}throw new Error("Can't parse /Measure value reference")}if(h===Nt){const r=t.getDictBoundsAt(o);if(r){const s=Ur.parse({parser:t,bounds:r,cryptInfo:e.cryptInfo});if(s){this.Measure=s.value,o=s.end+1;break}}throw new Error("Can't parse /Measure value dictionary")}throw new Error(`Unsupported /Measure property value type: ${h}`);case"/Group":const c=t.getValueTypeAt(o);if(c===Bt){const r=yr.parseRef(t,o);if(r&&e.parseInfoGetter){const t=e.parseInfoGetter(r.value.id);if(t){const e=Vr.parse(t);if(e){this.Group=e.value,o=e.end+1;break}}}throw new Error("Can't parse /Group value reference")}if(c===Nt){const r=t.getDictBoundsAt(o);if(r){const s=Vr.parse({parser:t,bounds:r,cryptInfo:e.cryptInfo});if(s){this.Group=s.value,o=s.end+1;break}}throw new Error("Can't parse /Group value dictionary")}throw new Error(`Unsupported /Group property value type: ${c}`);case"/OC":case"/OPI":default:o=t.skipToNextName(o,n.contentEnd)}if(!this.BBox)throw new Error("Not all required properties parsed")}}class Hr extends mr{constructor(){super(null),this._streamsMap=new Map}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Hr;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}getStream(e){return this._streamsMap.get(e)}*getStreams(){for(const e of this._streamsMap)yield e[1]}setStream(e,t){return this._streamsMap.set(e,t)}clearStreams(){this._streamsMap.clear()}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.N&&(s.push(...r.encode("/N ")),this.N,s.push(...this.N.toArray(e))),this.R&&(s.push(...r.encode("/R ")),this.R,s.push(...this.R.toArray(e))),this.D&&(s.push(...r.encode("/D ")),this.D,s.push(...this.D.toArray(e)));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}fillStreamsMap(e){this._streamsMap.clear();for(const t of["N","R","D"])if(this[t])if(this[t]instanceof yr){const r=e(this[t].id);if(!r)continue;const s=zr.parse(r);if(!s)continue;s&&this._streamsMap.set(`/${t}`,s.value)}else for(const[r,s]of this[t].getProps()){const n=e(s.id);if(!n)continue;const a=zr.parse(n);a&&this._streamsMap.set(`/${t}${r}`,a.value)}}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/N":const e=t.getValueTypeAt(o);if(e===Bt){const e=yr.parseRef(t,o);if(e){this.N=e.value,o=e.end+1;break}}else{if(e!==Nt)throw new Error(`Unsupported /N property value type: ${e}`);{const e=t.getDictBoundsAt(o);if(e){const r=Nr.parse({parser:t,bounds:e});if(r){this.N=r.value,o=r.end+1;break}}}}throw new Error("Can't parse /N property value");case"/R":const r=t.getValueTypeAt(o);if(r===Bt){const e=yr.parseRef(t,o);if(e){this.R=e.value,o=e.end+1;break}}else{if(r!==Nt)throw new Error(`Unsupported /R property value type: ${r}`);{const e=t.getDictBoundsAt(o);if(e){const r=Nr.parse({parser:t,bounds:e});if(r){this.R=r.value,o=r.end+1;break}}}}throw new Error("Can't parse /R property value");case"/D":const s=t.getValueTypeAt(o);if(s===Bt){const e=yr.parseRef(t,o);if(e){this.D=e.value,o=e.end+1;break}}else{if(s!==Nt)throw new Error(`Unsupported /D property value type: ${s}`);{const e=t.getDictBoundsAt(o);if(e){const r=Nr.parse({parser:t,bounds:e});if(r){this.D=r.value,o=r.end+1;break}}}}throw new Error("Can't parse /D property value");default:o=t.skipToNextName(o,n-1)}if(!this.N)throw new Error("Not all required properties parsed");e.parseInfoGetter&&this.fillStreamsMap(e.parseInfoGetter)}}const Wr={NONE:"/S",CLOUDY:"/C"};class Gr extends mr{constructor(){super(null),this.S=Wr.NONE,this.L=0}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Gr;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.S&&s.push(...r.encode("/S "),...r.encode(this.S)),this.L&&s.push(...r.encode("/L "),...r.encode(" "+this.L));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/S":const e=t.parseNameAt(o,!0);if(!e||!Object.values(Wr).includes(e.value))throw new Error("Can't parse /S property value");this.S=e.value,o=e.end+1;break;case"/L":o=this.parseNumberProp(a,t,o,!0);break;default:o=t.skipToNextName(o,n-1)}}}class Qr{constructor(e,t,r,s,n){this.hCornerR=null!=e?e:0,this.vCornerR=null!=t?t:0,this.width=null!=r?r:1,this.dash=null!=s?s:3,this.gap=null!=n?n:0}static parse(e,t,r=!0){if(r&&(t=e.findRegularIndex("straight",t)),t<0||t>e.maxIndex||e.getCharCode(t)!==te)return null;const s=e.parseNumberAt(t+1);if(!s||isNaN(s.value))return null;const n=e.parseNumberAt(s.end+2);if(!n||isNaN(n.value))return null;const a=e.parseNumberAt(n.end+2);if(!a||isNaN(a.value))return null;const i=e.findNonSpaceIndex("straight",a.end+1);if(!i)return null;if(e.getCharCode(i)===se)return{value:new Qr(s.value,n.value,a.value),start:t,end:i};if(e.getCharCode(i)===te){const r=e.parseNumberAt(i+1);if(!r||isNaN(r.value))return null;const o=e.parseNumberAt(r.end+2);if(!o||isNaN(o.value))return null;const h=e.findNonSpaceIndex("straight",o.end+1);if(!h||e.getCharCode(h)!==se)return null;const c=e.findNonSpaceIndex("straight",h+1);return c&&e.getCharCode(c)===se?{value:new Qr(s.value,n.value,a.value,r.value,o.value),start:t,end:c}:null}return null}toArray(e){const t=this.dash&&this.gap?`[${this.hCornerR} ${this.vCornerR} ${this.width}]`:`[${this.hCornerR} ${this.vCornerR} ${this.width} [${this.dash} ${this.gap}]]`;return(new TextEncoder).encode(t)}}class qr{constructor(e){Object.assign(this,qr.defaultParams,e)}clone(e){const t=new qr(this);return e?Object.assign(t,e):t}}qr.defaultParams={fontFamily:"helvetica, sans-serif",fontSize:"12px",lineHeight:"1",letterSpacing:"normal",wordSpacing:"normal",textHorScale:1,textRenderMode:0,textVertAlign:"0",textKnockOut:!0};class jr{constructor(e){var t,r,s,n;Object.assign(this,jr.defaultParams,e),this.matrix=null===(t=this.matrix)||void 0===t?void 0:t.clone(),this.textState=null===(r=this.textState)||void 0===r?void 0:r.clone(),this.strokeColor=null===(s=this.strokeColor)||void 0===s?void 0:s.clone(),this.fillColor=null===(n=this.fillColor)||void 0===n?void 0:n.clone()}get stroke(){const{x:e,y:t,z:r}=this.strokeColor;return`rgba(${e},${t},${r},${this.strokeAlpha})`}get fill(){const{x:e,y:t,z:r}=this.fillColor;return`rgba(${e},${t},${r},${this.fillAlpha})`}clone(e){const t=new jr(this);return e?Object.assign(t,e):t}setColor(e,...t){let r,s,n;switch(t.length){case 1:r=s=n=255*t[0];break;case 3:r=255*t[0],s=255*t[1],n=255*t[2];break;case 4:const[e,a,i,o]=t;r=255*(1-e)*(1-o),s=255*(1-a)*(1-o),n=255*(1-i)*(1-o)}"stroke"===e?this.strokeColor.set(r,s,n):this.fillColor.set(r,s,n)}}jr.defaultParams={matrix:new f,textState:new qr,strokeColorSpace:"rgb",strokeAlpha:1,strokeColor:new p,fillColorSpace:"rgb",fillAlpha:1,fillColor:new p,strokeWidth:1,strokeMiterLimit:10,strokeLineCap:"square",strokeLineJoin:"miter"};var Kr=function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{h(s.next(e))}catch(e){a(e)}}function o(e){try{h(s.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}h((s=s.apply(e,t||[])).next())}))};class Xr{constructor(e,t,r){if(this._clipPaths=[],this._graphicsStates=[],!e)throw new Error("Stream is not defined");this._stream=e,this._parser=new kr(e.decodedStreamData),this._rect=t,this._objectName=r;const s=Xr.calcBBoxToRectMatrix(e,t),n=document.createElementNS("http://www.w3.org/2000/svg","clipPath");n.id=`clip0_${r}`,n.innerHTML=`<rect x="${t[0]}" y="${t[1]}" width="${t[2]-t[0]}" height="${t[3]-t[1]}" />`,this._clipPaths.push(n),this._graphicsStates.push(new jr({matrix:s}))}get state(){return this._graphicsStates[this._graphicsStates.length-1]}static calcBBoxToRectMatrix(e,t){const r=e.matrix,{ll:s,lr:n,ur:a,ul:i}=e.bBox,{min:o,max:h}=y(u.applyMat3(s,r),u.applyMat3(n,r),u.applyMat3(a,r),u.applyMat3(i,r)),c=g(o,h,new u(t[0],t[1]),new u(t[2],t[3]));return f.fromMat3(r).multiply(c)}static parseNextCommand(e,t){const r=[];let s;e:for(;!s;){const n=e.getValueTypeAt(t,!0);switch(n){case _t:const a=e.parseNumberAt(t,!0);r.push(a.value),t=a.end+1;break;case St:const i=e.parseNameAt(t,!0);r.push(i.value),t=i.end+1;break;case kt:const o=e.getArrayBoundsAt(t),h=e.parseNumberArrayAt(t,!0);if(!h)throw new Error(`Invalid appearance stream array: \n            ${e.sliceChars(o.start,o.end)}`);{const e=h.value;2===e.length?r.push(...e):1===e.length?r.push(e[0],0):r.push(3,0)}t=o.end+1;break;case Ct:const c=gr.parse(e,t);r.push(c.value.literal),t=c.end+1;break;case Pt:const d=Ir.parse(e,t);r.push(d.value.hex),t=d.end+1;break;case xt:const l=e.parseStringAt(t);s=l.value,t=l.end+1;break e;default:throw new Error(`Invalid appearance stream value type: ${n}`)}}return{endIndex:t,parameters:r,operator:s}}renderAsync(){return Kr(this,void 0,void 0,(function*(){return{svg:yield this.drawGroupAsync(this._parser),clipPaths:this._clipPaths}}))}pushState(e){const t=this._graphicsStates[this._graphicsStates.length-1].clone(e);this._graphicsStates.push(t)}popState(){return 1===this._graphicsStates.length?null:this._graphicsStates.pop()}drawPath(e,t,r,s=!1,n=!1){s&&"Z"!==e[e.length-1]&&(e+=" Z");const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("transform",`matrix(${this.state.matrix.toFloatShortArray().join(" ")})`),a.setAttribute("clipPath",`url(#${this._clipPaths[this._clipPaths.length-1].id})`),a.setAttribute("d",e),this.state.mixBlendMode&&a.setAttribute("mix-blend-mode",this.state.mixBlendMode),r?(a.setAttribute("fill",this.state.fill),a.setAttribute("fill-rule",n?"evenodd":"nonzero")):a.setAttribute("fill","none"),t?(a.setAttribute("stroke",this.state.stroke),a.setAttribute("stroke-width",this.state.strokeWidth+""),a.setAttribute("stroke-miterlimit",this.state.strokeMiterLimit+""),a.setAttribute("stroke-linecap",this.state.strokeLineCap),a.setAttribute("stroke-linejoin",this.state.strokeLineJoin),this.state.strokeDashArray&&a.setAttribute("stroke-dasharray",this.state.strokeDashArray),this.state.strokeDashOffset&&a.setAttribute("stroke-dashoffset",this.state.strokeDashOffset+"")):a.setAttribute("stroke","none"),a}drawText(e){throw new Error("Method is not implemented")}drawTextGroup(e){const t=document.createElementNS("http://www.w3.org/2000/svg","g");let r=0;for(;-1!==r;){const{endIndex:t,parameters:s,operator:n}=Xr.parseNextCommand(e,r);r=e.skipEmpty(t+1)}return t}drawGroupAsync(e){return Kr(this,void 0,void 0,(function*(){const t=document.createElementNS("http://www.w3.org/2000/svg","g"),r=new u;let s,n="";const a=e=>{t.append(e),n=""};let i=0;for(;-1!==i;){const{endIndex:o,parameters:h,operator:c}=Xr.parseNextCommand(e,i);switch(i=e.skipEmpty(o+1),c){case"q":this.pushState();break;case"Q":this.popState();break;case"gs":const o=this._stream.Resources.getGraphicsState(`/ExtGState${h[0]}`);if(!o)throw new Error("External state specified in appearance stream not found");const d=o.toParams();Object.assign(this.state,d);break;case"cm":const[l,p,g,y,w,A]=h,m=(new f).set(l,p,0,g,y,0,w,A,1);this.state.matrix=m.multiply(this.state.matrix);break;case"w":this.state.strokeWidth=+h[0]||1;break;case"J":switch(h[0]){case jt.ROUND:this.state.strokeLineCap="round";break;case jt.SQUARE:this.state.strokeLineCap="square";break;case jt.BUTT:default:this.state.strokeLineCap="butt"}break;case"j":switch(h[0]){case Kt.BEVEL:this.state.strokeLineJoin="bevel";break;case Kt.ROUND:this.state.strokeLineJoin="round";break;case Kt.MITER:default:this.state.strokeLineJoin="miter"}break;case"M":this.state.strokeMiterLimit=+h[0]||10;break;case"d":this.state.strokeDashArray=`${h[0]} ${h[1]}`,this.state.strokeDashOffset=+h[2];break;case"CS":switch(h[0]){case Jt:this.state.strokeColorSpace="grayscale";break;case Zt:this.state.strokeColorSpace="rgb";break;case $t:this.state.strokeColorSpace="cmyk";break;default:throw new Error("Unsupported color space in appearance stream")}break;case"cs":switch(h[0]){case Jt:this.state.fillColorSpace="grayscale";break;case Zt:this.state.fillColorSpace="rgb";break;case $t:this.state.fillColorSpace="cmyk";break;default:throw new Error("Unsupported color space in appearance stream")}break;case"G":this.state.strokeColorSpace="grayscale",this.state.setColor("stroke",...h);break;case"g":this.state.fillColorSpace="grayscale",this.state.setColor("fill",...h);break;case"RG":this.state.strokeColorSpace="rgb",this.state.setColor("stroke",...h);break;case"rg":this.state.fillColorSpace="rgb",this.state.setColor("fill",...h);break;case"K":this.state.strokeColorSpace="cmyk",this.state.setColor("stroke",...h);break;case"k":this.state.fillColorSpace="cmyk",this.state.setColor("fill",...h);break;case"SC":this.state.setColor("stroke",...h);break;case"cs":this.state.setColor("fill",...h);break;case"ri":case"i":break;case"m":const v=new u(+h[0],+h[1]);n+=` M ${v.x} ${v.y}`,r.setFromVec2(v);break;case"l":const b=new u(+h[0],+h[1]);n+=` L ${b.x} ${b.y}`,r.setFromVec2(b);break;case"re":const x=new u(+h[0],+h[1]),E=new u(+h[2],+h[3]).add(x);n+=` M ${x.x} ${x.y} L ${E.x} ${x.y} L ${E.x} ${E.y} L ${x.x} ${E.y} L ${x.x} ${x.y}`,r.setFromVec2(x);break;case"c":const _=new u(+h[0],+h[1]),C=new u(+h[2],+h[3]),P=new u(+h[4],+h[5]);n+=` C ${_.x} ${_.y}, ${C.x} ${C.y}, ${P.x} ${P.y}`,r.setFromVec2(P);break;case"v":const S=new u(+h[0],+h[1]),k=new u(+h[2],+h[3]);n+=` C ${r.x} ${r.y}, ${S.x} ${S.y}, ${k.x} ${k.y}`,r.setFromVec2(k);break;case"y":const N=new u(+h[0],+h[1]),I=new u(+h[2],+h[3]);n+=` C ${N.x} ${N.y}, ${I.x} ${I.y}, ${I.x} ${I.y}`,r.setFromVec2(I);break;case"h":n+=" Z";break;case"S":a(this.drawPath(n,!0,!1));break;case"s":a(this.drawPath(n,!0,!1,!0));break;case"F":case"f":a(this.drawPath(n,!1,!0,!0));break;case"F*":case"f*":a(this.drawPath(n,!1,!0,!0,!0));break;case"B":a(this.drawPath(n,!0,!0,!1,!1));break;case"B*":a(this.drawPath(n,!0,!0,!1,!0));break;case"b":a(this.drawPath(n,!0,!0,!0,!1));break;case"b*":a(this.drawPath(n,!0,!0,!0,!0));break;case"n":if("W"===s||"W*"===s){"Z"!==n[n.length-1]&&(n+=" Z");const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d",n);const t=this._clipPaths.length-1,r=document.createElementNS("http://www.w3.org/2000/svg","clipPath");r.setAttribute("clip-rule","W"===s?"nonzero":"evenodd"),r.setAttribute("clip-path",`url(#${this._clipPaths[t]})`),r.id=`clip${t+1}_${this._objectName}`,r.append(e),this._clipPaths.push(r),this.state.clipPath=r}n="";break;case"W":case"W*":break;case"BT":const B=e.findSubarrayIndex([K,$],{closedOnly:!0,minIndex:i});if(B){const r=this.drawTextGroup(new kr(e.sliceCharCodes(i,B.start-1)));t.append(r),i=e.skipEmpty(B.end+1);break}throw new Error("Can't find the appearance stream text object end");case"Do":const M=this._stream.Resources.getXObject(`/XObject${h[0]}`);if(!M)throw new Error(`External object not found in the appearance stream resources: ${h[0]}`);if(M instanceof zr){const e=yield this.drawGroupAsync(new kr(M.decodedStreamData));t.append(e)}else{if(!(M instanceof Rr))throw new Error(`Unsupported appearance stream external object: ${h[0]}`);{const e=yield M.getImageUrlAsync();if(!e)throw new Error("Can't get image url from external image stream");const r=document.createElementNS("http://www.w3.org/2000/svg","image");r.onerror=e=>{console.log(`Loading external image stream failed: ${e}`)},r.setAttribute("href",e),r.setAttribute("width",M.Width+""),r.setAttribute("height",M.Height+"");const s=(new f).applyTranslation(-M.Width/2,-M.Height/2).applyScaling(1,-1).applyTranslation(M.Width/2,M.Height/2).applyScaling(1/M.Width,1/M.Height).multiply(this.state.matrix);r.setAttribute("transform",`matrix(${s.toFloatShortArray().join(" ")})`),r.setAttribute("clipPath",`url(#${this._clipPaths[this._clipPaths.length-1].id})`),t.append(r)}}break;default:throw new Error(`Unsupported appearance stream operator: ${c}`)}s=c}return t}))}}var Yr=function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{h(s.next(e))}catch(e){a(e)}}function o(e){try{h(s.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}h((s=s.apply(e,t||[])).next())}))};class Jr extends mr{constructor(e){super(ut),this.F=0,this.Border=new Qr(0,0,1),this._transformationMatrix=new f,this._transformationPoint=new u,this._currentAngle=0,this._boxX=new u,this._boxY=new u,this._svgId=o(),this.onRectPointerDown=e=>{document.addEventListener("pointerup",this.onRectPointerUp),document.addEventListener("pointerout",this.onRectPointerUp),this._transformationTimer=setTimeout((()=>{this._transformationTimer=null,this._svg.after(this._svgContentCopy),this._transformationPoint.setFromVec2(this.convertClientCoordsToPage(e.clientX,e.clientY)),document.addEventListener("pointermove",this.onRectPointerMove)}),200)},this.onRectPointerMove=e=>{const t=this.convertClientCoordsToPage(e.clientX,e.clientY);this._transformationMatrix.reset().applyTranslation(t.x-this._transformationPoint.x,t.y-this._transformationPoint.y),this._svgContentCopyUse.setAttribute("transform",`matrix(${this._transformationMatrix.toFloatShortArray().join(" ")})`)},this.onRectPointerUp=()=>{if(document.removeEventListener("pointermove",this.onRectPointerMove),document.removeEventListener("pointerup",this.onRectPointerUp),document.removeEventListener("pointerout",this.onRectPointerUp),this._transformationTimer)return clearTimeout(this._transformationTimer),void(this._transformationTimer=null);this._svgContentCopy.remove(),this._svgContentCopyUse.setAttribute("transform","matrix(1 0 0 1 0 0)"),this.applyRectTransform(this._transformationMatrix),this._transformationMatrix.reset(),this.updateRenderAsync()},this.onRotationHandlePointerDown=e=>{document.addEventListener("pointerup",this.onRotationHandlePointerUp),document.addEventListener("pointerout",this.onRotationHandlePointerUp),this._transformationTimer=setTimeout((()=>{this._transformationTimer=null,this._svg.after(this._svgContentCopy),document.addEventListener("pointermove",this.onRotationHandlePointerMove)}),200),e.stopPropagation()},this.onRotationHandlePointerMove=e=>{const t=(this.Rect[0]+this.Rect[2])/2,r=(this.Rect[1]+this.Rect[3])/2,s=this.convertPageCoordsToClient(t,r),n=this.getCurrentRotation(),a=Math.atan2(e.clientY-s.y,e.clientX-s.x)+Math.PI/2-n;this._currentAngle=a,this._transformationMatrix.reset().applyTranslation(-t,-r).applyRotation(a).applyTranslation(t,r),this._svgContentCopyUse.setAttribute("transform",`matrix(${this._transformationMatrix.toFloatShortArray().join(" ")})`)},this.onRotationHandlePointerUp=e=>{if(document.removeEventListener("pointermove",this.onRotationHandlePointerMove),document.removeEventListener("pointerup",this.onRotationHandlePointerUp),document.removeEventListener("pointerout",this.onRotationHandlePointerUp),this._transformationTimer)return clearTimeout(this._transformationTimer),void(this._transformationTimer=null);this._svgContentCopy.remove(),this._svgContentCopyUse.setAttribute("transform","matrix(1 0 0 1 0 0)"),this.applyRectTransform(this._transformationMatrix),this._transformationMatrix.reset(),this.updateRenderAsync()},this.onScaleHandlePointerDown=e=>{document.addEventListener("pointerup",this.onScaleHandlePointerUp),document.addEventListener("pointerout",this.onScaleHandlePointerUp);const t=e.target,{ll:r,lr:s,ur:n,ul:a}=this.getLocalBB(),i=t.dataset.handleName;switch(i){case"ll":this._transformationPoint.setFromVec2(n),this._boxX.setFromVec2(a).substract(n),this._boxY.setFromVec2(s).substract(n);break;case"lr":this._transformationPoint.setFromVec2(a),this._boxX.setFromVec2(n).substract(a),this._boxY.setFromVec2(r).substract(a);break;case"ur":this._transformationPoint.setFromVec2(r),this._boxX.setFromVec2(s).substract(r),this._boxY.setFromVec2(a).substract(r);break;case"ul":this._transformationPoint.setFromVec2(s),this._boxX.setFromVec2(r).substract(s),this._boxY.setFromVec2(n).substract(s);break;default:throw new Error(`Invalid handle name: ${i}`)}this._boxXLength=this._boxX.getMagnitude(),this._boxYLength=this._boxY.getMagnitude(),this._transformationTimer=setTimeout((()=>{this._transformationTimer=null,this._svg.after(this._svgContentCopy),document.addEventListener("pointermove",this.onScaleHandlePointerMove)}),200),e.stopPropagation()},this.onScaleHandlePointerMove=e=>{const t=this.convertClientCoordsToPage(e.clientX,e.clientY).substract(this._transformationPoint),r=t.getMagnitude(),s=Math.abs(t.dotProduct(this._boxX))/r/this._boxXLength*r,n=Math.sqrt(r*r-s*s),a=s/this._boxXLength,i=n/this._boxYLength,o=(this.Rect[0]+this.Rect[2])/2,h=(this.Rect[1]+this.Rect[3])/2,c=this.getCurrentRotation();this._transformationMatrix.reset().applyTranslation(-o,-h).applyRotation(-c).applyScaling(a,i).applyRotation(c).applyTranslation(o,h);const d=this._transformationPoint.clone().substract(this._transformationPoint.clone().applyMat3(this._transformationMatrix));this._transformationMatrix.applyTranslation(d.x,d.y),this._svgContentCopyUse.setAttribute("transform",`matrix(${this._transformationMatrix.toFloatShortArray().join(" ")})`)},this.onScaleHandlePointerUp=e=>{if(document.removeEventListener("pointermove",this.onScaleHandlePointerMove),document.removeEventListener("pointerup",this.onScaleHandlePointerUp),document.removeEventListener("pointerout",this.onScaleHandlePointerUp),this._transformationTimer)return clearTimeout(this._transformationTimer),void(this._transformationTimer=null);this._svgContentCopy.remove(),this._svgContentCopyUse.setAttribute("transform","matrix(1 0 0 1 0 0)"),this.applyRectTransform(this._transformationMatrix),this._transformationMatrix.reset(),this.updateRenderAsync()},this.Subtype=e}get apStream(){var e;return this._apStream||(this._apStream=[...null===(e=this.AP)||void 0===e?void 0:e.getStreams()][0]),this._apStream}set apStream(e){this._apStream=e,this._edited=!0}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];if(this.Subtype&&s.push(...r.encode("/Subtype "),...r.encode(this.Subtype)),this.Rect&&s.push(...r.encode("/Rect "),te,...r.encode(this.Rect[0]+""),N,...r.encode(this.Rect[1]+""),N,...r.encode(this.Rect[2]+""),N,...r.encode(this.Rect[3]+""),se),this.Contents&&s.push(...r.encode("/Contents "),...this.Contents.toArray(e)),this.P&&s.push(...r.encode("/P "),N,...this.P.toArray(e)),this.NM&&s.push(...r.encode("/NM "),...this.NM.toArray(e)),this.M&&s.push(...r.encode("/M "),...this.M.toArray(e)),this.F&&s.push(...r.encode("/F "),...r.encode(" "+this.F)),this.AS&&s.push(...r.encode("/AS "),...r.encode(this.AS)),this.Border&&s.push(...r.encode("/Border "),...this.Border.toArray(e)),this.BS&&s.push(...r.encode("/BS "),...this.BS.toArray(e)),this.BE&&s.push(...r.encode("/BE "),...this.BE.toArray(e)),this.C&&(s.push(...r.encode("/C "),te),this.C.forEach((e=>s.push(...r.encode(" "+e)))),s.push(se)),this.StructParent&&s.push(...r.encode("/StructParent "),...r.encode(" "+this.StructParent)),this.apStream){this.AP||(this.AP=new Hr);const t=this.apStream.ref;if(!t)throw new Error("Appearance stream has no reference");this.AP.N=new yr(t.id,t.generation),this.AP.R=null,this.AP.D=null,this.AP.clearStreams(),this.AP.setStream("/N",this.apStream),s.push(...r.encode("/AP "),...this.AP.toArray(e))}const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}render(){return this._svg||(this._svg=this.renderMainElement()),this.updateRenderAsync(),{svg:this._svg,clipPaths:this._svgClipPaths}}parseProps(e){var t;super.parseProps(e);const{parser:r,bounds:s}=e,n=s.contentStart||s.start,a=s.contentEnd||s.end;let i,h,c=r.skipToNextName(n,a-1);for(;h=r.parseNameAt(c),h;)switch(c=h.end+1,i=h.value,i){case"/Subtype":const t=r.parseNameAt(c);if(!t)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==t.value)throw new Error(`Ivalid dict subtype: '${t.value}' instead of '${this.Subtype}'`);c=t.end+1;break;case"/Rect":c=this.parseNumberArrayProp(i,r,c,!0);break;case"/P":c=this.parseRefProp(i,r,c);break;case"/Contents":case"/NM":c=this.parseLiteralProp(i,r,c,e.cryptInfo);break;case"/M":const s=wr.parse(r,c,e.cryptInfo);if(s){this.M=s.value,c=s.end+1;break}{const t=gr.parse(r,c,e.cryptInfo);if(t){this.M=t.value,c=t.end+1;break}}throw new Error("Can't parse /M property value");case"/C":c=this.parseNumberArrayProp(i,r,c,!0);break;case"/F":case"/StructParent":c=this.parseNumberProp(i,r,c,!1);break;case"/Border":const n=Qr.parse(r,c);if(!n)throw new Error("Can't parse /Border property value");this.Border=n.value,c=n.end+1;break;case"/BS":const o=r.getValueTypeAt(c);if(o===Bt){const t=yr.parseRef(r,c);if(t&&e.parseInfoGetter){const r=e.parseInfoGetter(t.value.id);if(r){const e=Sr.parse(r);if(e){this.BS=e.value,c=e.end+1;break}}}throw new Error("Can't parse /BS value reference")}if(o===Nt){const e=r.getDictBoundsAt(c);if(e){const t=Sr.parse({parser:r,bounds:e});if(t){this.BS=t.value,c=t.end+1;break}}throw new Error("Can't parse /BS value dictionary")}throw new Error(`Unsupported /BS property value type: ${o}`);case"/BE":const h=r.getValueTypeAt(c);if(h===Bt){const t=yr.parseRef(r,c);if(t&&e.parseInfoGetter){const r=e.parseInfoGetter(t.value.id);if(r){const e=Gr.parse(r);if(e){this.BE=e.value,c=e.end+1;break}}}throw new Error("Can't parse /BE value reference")}if(h===Nt){const e=r.getDictBoundsAt(c);if(e){const t=Gr.parse({parser:r,bounds:e});if(t){this.BE=t.value,c=t.end+1;break}}throw new Error("Can't parse /BE value dictionary")}throw new Error(`Unsupported /BE property value type: ${h}`);case"/AP":const d=r.getValueTypeAt(c);if(d===Bt){const t=yr.parseRef(r,c);if(t&&e.parseInfoGetter){const r=e.parseInfoGetter(t.value.id);if(r){const e=Hr.parse(r);if(e){this.AP=e.value,c=e.end+1;break}}}throw new Error("Can't parse /AP value reference")}if(d===Nt){const t=r.getDictBoundsAt(c);if(t){const s=Hr.parse({parser:r,bounds:t,parseInfoGetter:e.parseInfoGetter});if(s){this.AP=s.value,c=s.end+1;break}}throw new Error("Can't parse /AP value dictionary")}throw new Error(`Unsupported /AP property value type: ${d}`);case"/AS":c=this.parseNameProp(i,r,c);break;case"/OC":default:c=r.skipToNextName(c,a-1)}if(!this.Subtype||!this.Rect)throw new Error("Not all required properties parsed");this.name=(null===(t=this.NM)||void 0===t?void 0:t.literal)||o(),this.pageRect=e.rect}applyRectTransform(e){const t=this._proxy||this,r=t.getLocalBB();r.ll.applyMat3(e),r.lr.applyMat3(e),r.ur.applyMat3(e),r.ul.applyMat3(e);const{min:s,max:n}=y(r.ll,r.lr,r.ur,r.ul);t.Rect=[s.x,s.y,n.x,n.y];const a=t.apStream;if(a){const r=a.matrix.multiply(e);t.apStream.matrix=r}}getCurrentRotation(){var e;const t=null===(e=this.apStream)||void 0===e?void 0:e.matrix;if(!t)return 0;const{r:r}=t.getTRS();return r}getLocalBB(){let e,t,r,s;if(this._bBox)e=this._bBox.ll,t=this._bBox.lr,r=this._bBox.ur,s=this._bBox.ul;else if(this.apStream){const{ll:n,lr:a,ur:i,ul:o}=this.apStream.transformedBBox,{min:h,max:c}=y(n,a,i,o),d=g(h,c,new u(this.Rect[0],this.Rect[1]),new u(this.Rect[2],this.Rect[3]),!0);e=n.applyMat3(d),t=a.applyMat3(d),r=i.applyMat3(d),s=o.applyMat3(d)}else e=new u(this.Rect[0],this.Rect[1]),t=new u(this.Rect[2],this.Rect[1]),r=new u(this.Rect[2],this.Rect[3]),s=new u(this.Rect[0],this.Rect[3]);return this._bBox={ll:e,lr:t,ur:r,ul:s},this._bBox}convertClientCoordsToPage(e,t){const{x:r,y:s,width:n,height:a}=this._svgBox.getBoundingClientRect(),i=new u(r,s),o=(new u(r+n,s+a).x-i.x)/(this.Rect[2]-this.Rect[0]),h=new u(r-this.Rect[0]*o,s+a+this.Rect[1]*o);return new u((e-h.x)/o,(h.y-t)/o)}convertPageCoordsToClient(e,t){const{x:r,y:s,width:n,height:a}=this._svgBox.getBoundingClientRect(),i=new u(r,s),o=(new u(r+n,s+a).x-i.x)/(this.Rect[2]-this.Rect[0]),h=new u(r-this.Rect[0]*o,s+a+this.Rect[1]*o);return new u(h.x+e*o,h.y-t*o)}renderRect(){const e=document.createElementNS("http://www.w3.org/2000/svg","rect");return e.classList.add("svg-annot-rect"),e.setAttribute("data-annotation-name",this.name),e.setAttribute("x",this.Rect[0]+""),e.setAttribute("y",this.Rect[1]+""),e.setAttribute("width",this.Rect[2]-this.Rect[0]+""),e.setAttribute("height",this.Rect[3]-this.Rect[1]+""),e}renderBox(){const{ll:e,lr:t,ur:r,ul:s}=this.getLocalBB(),n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.classList.add("svg-annot-box"),n.setAttribute("data-annotation-name",this.name),n.setAttribute("d",`M ${e.x} ${e.y} L ${t.x} ${t.y} L ${r.x} ${r.y} L ${s.x} ${s.y} Z`),n}renderMainElement(){const e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.classList.add("svg-annotation"),e.setAttribute("data-annotation-name",this.name),e.addEventListener("pointerdown",this.onRectPointerDown),e}renderApAsync(){return Yr(this,void 0,void 0,(function*(){const e=this.apStream;if(e)try{const t=new Xr(e,this.Rect,this.name);return yield t.renderAsync()}catch(e){console.log(`Annotation stream render error: ${e.message}`)}return null}))}renderContent(){return null}renderContentCopy(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","defs"),r=document.createElementNS("http://www.w3.org/2000/svg","symbol");r.id=this._svgId+"_symbol";const s=document.createElementNS("http://www.w3.org/2000/svg","use");s.setAttribute("href",`#${this._svgId}`),s.setAttribute("viewBox",`${this.pageRect[0]} ${this.pageRect[1]} ${this.pageRect[2]} ${this.pageRect[3]}`),r.append(s),t.append(r);const n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttribute("href",`#${this._svgId}_symbol`),n.setAttribute("opacity","0.2"),e.append(t,n),{copy:e,use:n}}renderScaleHandles(){const e=this.getLocalBB(),t=[];return["ll","lr","ur","ul"].forEach((r=>{const s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.classList.add("svg-annot-handle-scale"),s.setAttribute("data-handle-name",r),s.setAttribute("cx",e[r].x+""),s.setAttribute("cy",e[r].y+""),s.addEventListener("pointerdown",this.onScaleHandlePointerDown),t.push(s)})),t}renderRotationHandle(){const e=(this.Rect[0]+this.Rect[2])/2,t=(this.Rect[1]+this.Rect[3])/2,r=this.getCurrentRotation(),s=document.createElementNS("http://www.w3.org/2000/svg","g");s.classList.add("svg-annot-rotation"),s.setAttribute("data-handle-name","center");const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.classList.add("circle","dashed"),n.setAttribute("cx",e+""),n.setAttribute("cy",t+"");const a=(new f).applyTranslation(-e,35-t).applyRotation(r).applyTranslation(e,t),i=new u(e,t).applyMat3(a),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.classList.add("dashed"),o.setAttribute("x1",e+""),o.setAttribute("y1",t+""),o.setAttribute("x2",i.x+""),o.setAttribute("y2",i.y+"");const h=document.createElementNS("http://www.w3.org/2000/svg","circle");return h.classList.add("svg-annot-handle-rotation"),h.setAttribute("data-handle-name","center"),h.setAttribute("cx",i.x+""),h.setAttribute("cy",i.y+""),h.addEventListener("pointerdown",this.onRotationHandlePointerDown),s.append(n,o,h),s}renderHandles(){return[...this.renderScaleHandles(),this.renderRotationHandle()]}updateRenderAsync(){return Yr(this,void 0,void 0,(function*(){this._svg.innerHTML="";const e=this.renderContent()||(yield this.renderApAsync());if(!e)return this._svgBox=null,this._svgContent=null,this._svgContentCopy=null,this._svgContentCopyUse=null,void(this._svgClipPaths=null);const t=e.svg;t.id=this._svgId,t.classList.add("svg-annotation-content"),t.setAttribute("data-annotation-name",this.name);const{copy:r,use:s}=this.renderContentCopy(),n=this.renderRect(),a=this.renderBox(),i=this.renderHandles();this._svg.append(n,a,e.svg,...i),this._svgBox=a,this._svgContent=t,this._svgContentCopy=r,this._svgContentCopyUse=s,this._svgClipPaths=e.clipPaths}))}}const Zr={REPLY:"/R",GROUP:"/Group"};class $r extends Jr{constructor(e){super(e),this.RT=Zr.REPLY}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.T&&s.push(...r.encode("/T "),...this.T.toArray(e)),this.Popup&&s.push(...r.encode("/Popup "),N,...this.Popup.toArray(e)),this.RC&&s.push(...r.encode("/RC "),...this.RC.toArray(e)),this.CA&&s.push(...r.encode("/CA "),...r.encode(" "+this.CA)),this.CreationDate&&s.push(...r.encode("/CreationDate "),...this.CreationDate.toArray(e)),this.Subj&&s.push(...r.encode("/Subj "),...this.Subj.toArray(e)),this.IRT&&s.push(...r.encode("/IRT "),N,...this.IRT.toArray(e)),this.RT&&s.push(...r.encode("/RT "),...r.encode(this.RT));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/T":case"/Subj":o=this.parseLiteralProp(a,t,o,e.cryptInfo);break;case"/Popup":case"/IRT":o=this.parseRefProp(a,t,o);break;case"/RC":const r=t.getValueTypeAt(o);if(r===Bt){const r=yr.parseRef(t,o);if(r&&e.parseInfoGetter){const t=e.parseInfoGetter(r.value.id);if(t){const e=t.type||t.parser.getValueTypeAt(t.bounds.contentStart);if(e===Ct){const e=gr.parse(t.parser,t.bounds.contentStart);if(e){this.RC=e.value,o=r.end+1;break}}else{if(e!==Nt)throw new Error(`Unsupported /RC property value type: ${e}`);{const e=Cr.parse(t);if(e){const t=e.value.getText();this.RC=gr.fromString(t),o=r.end+1;break}}}}}throw new Error("Can't parse /RC value reference")}if(r===Ct){const r=gr.parse(t,o,e.cryptInfo);if(r){this.RC=r.value,o=r.end+1;break}throw new Error("Can't parse /RC property value")}throw new Error(`Unsupported /RC property value type: ${r}`);case"/CA":o=this.parseNumberProp(a,t,o,!0);break;case"/CreationDate":o=this.parseDateProp(a,t,o,e.cryptInfo);break;case"/RT":const s=t.parseNameAt(o,!0);if(!s||!Object.values(Zr).includes(s.value))throw new Error("Can't parse /RT property value");this.RT=s.value,o=s.end+1;break;case"/ExData":break;default:o=t.skipToNextName(o,n-1)}if(!this.Subtype||!this.Rect)throw new Error("Not all required properties parsed")}}const es={PLAIN_TEXT:"/FreeText",WITH_CALLOUT:"/FreeTextCallout",CLICK_TO_TYPE:"/FreeTextTypeWriter"};class ts extends $r{constructor(){super(Dt),this.IT=es.PLAIN_TEXT,this.LE=qt.NONE}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new ts;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.DA&&s.push(...r.encode("/DA "),...this.DA.toArray(e)),this.Q&&s.push(...r.encode("/Q "),...r.encode(" "+this.Q)),this.DS&&s.push(...r.encode("/DS "),...this.DS.toArray(e)),this.CL&&(s.push(...r.encode("/CL "),te),this.CL.forEach((e=>s.push(...r.encode(" "+e)))),s.push(se)),this.IT&&s.push(...r.encode("/IT "),...r.encode(this.IT)),this.RD&&s.push(...r.encode("/RD "),te,...r.encode(this.RD[0]+""),N,...r.encode(this.RD[1]+""),N,...r.encode(this.RD[2]+""),N,...r.encode(this.RD[3]+""),se),this.LE&&s.push(...r.encode("/LE "),...r.encode(this.LE));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/DA":case"/DS":o=this.parseLiteralProp(a,t,o,e.cryptInfo);break;case"/Q":const r=t.parseNumberAt(o,!0);if(!r||!Object.values(at).includes(r.value))throw new Error("Can't parse /Q property value");this.Q=r.value,o=r.end+1;break;case"/LE":const s=t.parseNameAt(o,!0);if(!s||!Object.values(qt).includes(s.value))throw new Error("Can't parse /LE property value");this.LE=s.value,o=s.end+1;break;case"/CL":case"/RD":o=this.parseNumberArrayProp(a,t,o,!0);break;case"/IT":const i=t.parseNameAt(o,!0);if(i){if("/FreeTextTypewriter"===i.value){this.IT=es.CLICK_TO_TYPE,o=i.end+1;break}if(Object.values(es).includes(i.value)){this.IT=i.value,o=i.end+1;break}}throw new Error("Can't parse /IT property value");default:o=t.skipToNextName(o,n-1)}if(!this.DA)throw new Error("Not all required properties parsed")}}class rs extends $r{constructor(e){super(e)}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.IC&&(s.push(...r.encode("/IC "),te),this.IC.forEach((e=>s.push(...r.encode(" "+e)))),s.push(se));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/IC":o=this.parseNumberArrayProp(a,t,o,!0);break;default:o=t.skipToNextName(o,n-1)}}}class ss extends rs{constructor(){super(Ot)}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new ss;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.RD&&s.push(...r.encode("/RD "),te,...r.encode(this.RD[0]+""),N,...r.encode(this.RD[1]+""),N,...r.encode(this.RD[2]+""),N,...r.encode(this.RD[3]+""),se);const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/RD":o=this.parseNumberArrayProp(a,t,o,!0);break;default:o=t.skipToNextName(o,n-1)}}}const ns={ARROW:"/LineArrow",DIMESION:"/LineDimension"},as={INLINE:"/Inline",TOP:"/Top"};class is extends rs{constructor(){super(Tt),this.LE=[qt.NONE,qt.NONE],this.LL=0,this.LLE=0,this.Cap=!1,this.LLO=0,this.CP=as.INLINE,this.CO=[0,0]}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new is;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.L&&s.push(...r.encode("/L "),te,...r.encode(this.L[0]+""),N,...r.encode(this.L[1]+""),N,...r.encode(this.L[2]+""),N,...r.encode(this.L[3]+""),se),this.LE&&(s.push(...r.encode("/LE "),te),this.LE.forEach((e=>s.push(N,...r.encode(e)))),s.push(se)),this.LL&&s.push(...r.encode("/LL "),...r.encode(" "+this.LL)),this.LLE&&s.push(...r.encode("/LLE "),...r.encode(" "+this.LLE)),this.Cap&&s.push(...r.encode("/Cap "),...r.encode(" "+this.Cap)),this.IT&&s.push(...r.encode("/IT "),...r.encode(this.IT)),this.LLO&&s.push(...r.encode("/LLO "),...r.encode(" "+this.LLO)),this.CP&&s.push(...r.encode("/CP "),...r.encode(this.CP)),this.Measure&&s.push(...r.encode("/Measure "),...this.Measure.toArray(e)),this.CO&&s.push(...r.encode("/CO "),te,...r.encode(this.CO[0]+""),N,...r.encode(this.CO[1]+""),se);const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/L":case"/CO":o=this.parseNumberArrayProp(a,t,o,!0);break;case"/LE":const r=t.parseNameArrayAt(o,!0);if(!(r&&Object.values(qt).includes(r.value[0])&&Object.values(qt).includes(r.value[1])))throw new Error("Can't parse /LE property value");this.LE=[r.value[0],r.value[1]],o=r.end+1;break;case"/IT":const s=t.parseNameAt(o,!0);if(s&&Object.values(ns).includes(s.value)){this.IT=s.value,o=s.end+1;break}throw new Error("Can't parse /IT property value");case"/CP":const i=t.parseNameAt(o,!0);if(!i||!Object.values(as).includes(i.value[0]))throw new Error("Can't parse /CP property value");this.CP=i.value,o=i.end+1;break;case"/LL":case"/LLE":case"/LLO":o=this.parseNumberProp(a,t,o,!1);break;case"/Cap":o=this.parseBoolProp(a,t,o);break;case"/Measure":const h=t.getValueTypeAt(o);if(h===Bt){const r=yr.parseRef(t,o);if(r&&e.parseInfoGetter){const t=e.parseInfoGetter(r.value.id);if(t){const e=Ur.parse(t);if(e){this.Measure=e.value,o=e.end+1;break}}}throw new Error("Can't parse /BS value reference")}if(h===Nt){const e=t.getDictBoundsAt(o);if(e){const r=Ur.parse({parser:t,bounds:e});if(r){this.Measure=r.value,o=r.end+1;break}}throw new Error("Can't parse /Measure value dictionary")}throw new Error(`Unsupported /Measure property value type: ${h}`);default:o=t.skipToNextName(o,n-1)}}}class os extends rs{constructor(){super(Lt)}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new os;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.RD&&s.push(...r.encode("/RD "),te,...r.encode(this.RD[0]+""),N,...r.encode(this.RD[1]+""),N,...r.encode(this.RD[2]+""),N,...r.encode(this.RD[3]+""),se);const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/RD":o=this.parseNumberArrayProp(a,t,o,!0);break;default:o=t.skipToNextName(o,n-1)}}}class hs extends $r{constructor(){super(zt)}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new hs;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.InkList&&(s.push(...r.encode("/InkList "),te),this.InkList.forEach((e=>{s.push(te),e.forEach((e=>s.push(...r.encode(" "+e)))),s.push(se)})),s.push(se));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){var t;super.parseProps(e);const{parser:r,bounds:s}=e,n=s.contentStart||s.start,a=s.contentEnd||s.end;let i,o,h=r.skipToNextName(n,a-1);for(;o=r.parseNameAt(h),o;)switch(h=o.end+1,i=o.value,i){case"/InkList":if(r.getValueTypeAt(h)===kt){const e=[];let t,s=++h;for(;t=r.parseNumberArrayAt(s),t;)e.push(t.value),s=t.end+1;this.InkList=e;break}throw new Error("Can't parse /InkList property value");default:h=r.skipToNextName(h,a-1)}if(!(null===(t=this.InkList)||void 0===t?void 0:t.length))throw new Error("Not all required properties parsed")}}const cs="/Draft";class ds extends $r{constructor(){super(Vt),this.Name=cs}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new ds;t.parseProps(e);const r=new Proxy(t,t.onChange);return t._proxy=r,{value:r,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.Name&&s.push(...r.encode("/Name "),...r.encode(this.Name));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;t.sliceChars(s,n);let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Name":o=this.parseNameProp(a,t,o);break;default:o=t.skipToNextName(o,n-1)}if(!this.Name)throw new Error("Not all required properties parsed")}}class ls extends $r{constructor(){super(Rt),this.Open=!1}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new ls;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.Open&&s.push(...r.encode("/Open "),...r.encode(" "+this.Open)),this.Name&&s.push(...r.encode("/Name "),...r.encode(this.Name)),this.State&&s.push(...r.encode("/State "),...r.encode(this.State)),this.StateModel&&s.push(...r.encode("/StateModel "),...r.encode(this.StateModel));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Open":o=this.parseBoolProp(a,t,o);break;case"/Name":const e=t.parseNameAt(o,!0);if(!e||!Object.values(Qt).includes(e.value))throw new Error("Can't parse /Name property value");this.Name=e.value,o=e.end+1;break;case"/State":const r=t.parseNameAt(o,!0);if(!r||!Object.values(Wt).concat(Object.values(Gt)).includes(r.value))throw new Error("Can't parse /State property value");this.State=r.value,o=r.end+1;break;case"/StateModel":const s=t.parseNameAt(o,!0);if(!s||!Object.values(Ht).includes(s.value))throw new Error("Can't parse /StateModel property value");this.StateModel=s.value,o=s.end+1;break;default:o=t.skipToNextName(o,n-1)}}}class us extends mr{constructor(){super(yt),this.CFM=st.NONE,this.AuthEvent=nt.DOC_OPEN,this.Length=40,this.EncryptMetadata=!0}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new us;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.CFM&&s.push(...r.encode("/CFM "),...r.encode(this.CFM)),this.AuthEvent&&s.push(...r.encode("/AuthEvent "),...r.encode(this.AuthEvent)),this.Length&&s.push(...r.encode("/Length "),...r.encode(" "+this.Length)),this.EncryptMetadata&&s.push(...r.encode("/EncryptMetadata "),...r.encode(" "+this.EncryptMetadata)),this.Recipients&&(this.Recipients instanceof Ir?s.push(...r.encode("/Recipients "),...this.Recipients.toArray(e)):(s.push(te),this.Recipients.forEach((t=>s.push(...t.toArray(e)))),s.push(se)));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/CFM":const r=t.parseNameAt(o,!0);if(!r||!Object.values(st).includes(r.value))throw new Error("Can't parse /CFM property value");this.CFM=r.value,o=r.end+1;break;case"/AuthEvent":const s=t.parseNameAt(o,!0);if(!s||!Object.values(nt).includes(s.value))throw new Error("Can't parse /AuthEvent property value");this.AuthEvent=s.value,o=s.end+1;break;case"/Length":o=this.parseNumberProp(a,t,o,!1);break;case"/EncryptMetadata":o=this.parseBoolProp(a,t,o);break;case"/Recipients":const i=t.getValueTypeAt(o);if(i===Pt){const r=Ir.parse(t,o,e.cryptInfo);if(r){this.Recipients=r.value,o=r.end+1;break}throw new Error("Can't parse /Recipients property value")}if(i===kt){const e=Ir.parseArray(t,o);if(e){this.Recipients=e.value,o=e.end+1;break}throw new Error("Can't parse /Recipients property value")}throw new Error(`Unsupported /Filter property value type: ${i}`);default:o=t.skipToNextName(o,n-1)}}}class ps extends mr{constructor(){super(null),this._filtersMap=new Map}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new ps;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}getProp(e){return this._filtersMap.get(e)}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this._filtersMap.size&&this._filtersMap.forEach(((t,n)=>s.push(...r.encode(n),...t.toArray(e))));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){default:if(t.getValueTypeAt(o)===Nt){const e=t.getDictBoundsAt(o);if(e){const r=us.parse({parser:t,bounds:e});if(r){this._filtersMap.set(a,r.value),o=r.end+1;break}}}o=t.skipToNextName(o,n-1)}}}class fs extends mr{constructor(){super(vt),this.Filter="/Standard",this.Length=40,this.StmF="/Identity",this.StrF="/Identity",this.EncryptMetadata=!0}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new fs;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.Filter&&s.push(...r.encode("/Filter "),...r.encode(this.Filter)),this.SubFilter&&s.push(...r.encode("/SubFilter "),...r.encode(this.SubFilter)),this.V&&s.push(...r.encode("/V "),...r.encode(" "+this.V)),this.Length&&s.push(...r.encode("/Length "),...r.encode(" "+this.Length)),this.CF&&s.push(...r.encode("/CF "),...this.CF.toArray(e)),this.StmF&&s.push(...r.encode("/StmF "),...r.encode(this.StmF)),this.StrF&&s.push(...r.encode("/StrF "),...r.encode(this.StrF)),this.EFF&&s.push(...r.encode("/EFF "),...r.encode(this.EFF)),this.R&&s.push(...r.encode("/R "),...r.encode(" "+this.R)),this.O&&s.push(...r.encode("/O "),...this.O.toArray(e)),this.U&&s.push(...r.encode("/U "),...this.U.toArray(e)),this.OE&&s.push(...r.encode("/OE "),...this.OE.toArray(e)),this.UE&&s.push(...r.encode("/UE "),...this.UE.toArray(e)),this.P&&s.push(...r.encode("/P "),...r.encode(" "+this.P)),this.Perms&&s.push(...r.encode("/Perms "),...this.Perms.toArray(e)),this.U&&s.push(...r.encode("/U "),...this.U.toArray(e)),this.EncryptMetadata&&s.push(...r.encode("/EncryptMetadata "),...r.encode(" "+this.EncryptMetadata)),this.Recipients&&(this.Recipients instanceof Ir?s.push(...r.encode("/Recipients "),...this.Recipients.toArray(e)):(s.push(te),this.Recipients.forEach((t=>s.push(...t.toArray(e)))),s.push(se)));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}toCryptOptions(){var e,t,r,s,n,a,i,o,h;return this.V?{filter:this.Filter,version:this.V,revision:this.R,permissions:this.P,keyLength:this.Length,encryptMetadata:this.EncryptMetadata,stringKeyLength:null===(e=this.stringFilter)||void 0===e?void 0:e.Length,streamKeyLength:null===(t=this.streamFilter)||void 0===t?void 0:t.Length,stringMethod:null===(r=this.stringFilter)||void 0===r?void 0:r.CFM,streamMethod:null===(s=this.streamFilter)||void 0===s?void 0:s.CFM,oPasswordHash:null===(n=this.O)||void 0===n?void 0:n.bytes,uPasswordHash:null===(a=this.U)||void 0===a?void 0:a.bytes,oEncPasswordHash:null===(i=this.OE)||void 0===i?void 0:i.bytes,uEncPasswordHash:null===(o=this.UE)||void 0===o?void 0:o.bytes,perms:null===(h=this.Perms)||void 0===h?void 0:h.bytes}:null}parseProps(e){var t,r;super.parseProps(e);const{parser:s,bounds:n}=e,a=n.contentStart||n.start,i=n.contentEnd||n.end;let o,h,c=s.skipToNextName(a,i-1);for(;h=s.parseNameAt(c),h;)switch(c=h.end+1,o=h.value,o){case"/Filter":case"/SubFilter":case"/StmF":case"/StrF":case"/EFF":c=this.parseNameProp(o,s,c);break;case"/V":const t=s.parseNumberAt(c,!1);if(!t||!Object.values(tt).includes(t.value))throw new Error("Can't parse /V property value");this.V=t.value,c=t.end+1;break;case"/R":const r=s.parseNumberAt(c,!1);if(!r||!Object.values(rt).includes(r.value))throw new Error("Can't parse /R property value");this.R=r.value,c=r.end+1;break;case"/Length":case"/P":c=this.parseNumberProp(o,s,c,!1);break;case"/O":case"/U":case"/OE":case"/UE":case"/Perms":c=this.parseLiteralProp(o,s,c,e.cryptInfo);break;case"/EncryptMetadata":c=this.parseBoolProp(o,s,c);break;case"/CF":const a=s.getDictBoundsAt(c);if(!n)throw new Error("Can't parse /CF property value");{const e=ps.parse({parser:s,bounds:a});e&&(this.CF=e.value,c=e.end+1)}break;case"/Recipients":const h=s.getValueTypeAt(c);if(h===Pt){const t=Ir.parse(s,c,e.cryptInfo);if(t){this.Recipients=t.value,c=t.end+1;break}throw new Error("Can't parse /Recipients property value")}if(h===kt){const e=Ir.parseArray(s,c);if(e){this.Recipients=e.value,c=e.end+1;break}throw new Error("Can't parse /Recipients property value")}throw new Error(`Unsupported /Filter property value type: ${h}`);default:c=s.skipToNextName(c,i-1)}if(!this.Filter)throw new Error("Not all required properties parsed");if("/Standard"===this.Filter&&(!this.R||!this.O||!this.U||isNaN(this.P)||5===this.V&&(this.R<5||!this.OE||!this.UE||!this.Perms)))throw new Error("Not all required properties parsed");if(("adbe.pkcs7.s3"===this.SubFilter||"adbe.pkcs7.s4"===this.SubFilter)&&!this.Recipients)throw new Error("Not all required properties parsed");"/Identity"!==this.StrF&&(this.stringFilter=null===(t=this.CF)||void 0===t?void 0:t.getProp(this.StrF)),"/Identity"!==this.StmF&&(this.streamFilter=null===(r=this.CF)||void 0===r?void 0:r.getProp(this.StmF))}}class gs extends _r{constructor(){super(ot)}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new gs;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}getObjectData(e){if(!this._streamData||!this.N||!this.First)return null;const t=new kr(this.decodedStreamData),r=new Map;let s,n,a,i=0;for(let e=0;e<this.N;e++)s=t.parseNumberAt(i,!1,!1),n=s.value,i=s.end+2,s=t.parseNumberAt(i,!1,!1),a=s.value,i=s.end+2,r.set(n,a);if(!r.has(e))return null;const o=this.First+r.get(e),h=t.getValueTypeAt(o);if(null===h)return;let c,d;switch(h){case Oe:c=t.getDictBoundsAt(o,!1);break;case Le:c=t.getArrayBoundsAt(o,!1);break;case De:const e=gr.parse(t,o);e&&(c={start:e.start,end:e.end},d=e);break;case Te:const r=Ir.parse(t,o);r&&(c={start:r.start,end:r.end},d=r);break;case Re:const s=t.parseNumberAt(o);s&&(c={start:s.start,end:s.end},d=s)}if(!c)return null;const l=t.sliceCharCodes(c.start,c.end);if(!l.length)throw new Error("Object byte array is empty");return{parser:new kr(l),bounds:{start:0,end:l.length-1,contentStart:c.contentStart?c.contentStart-c.start:void 0,contentEnd:c.contentEnd?l.length-1-(c.end-c.contentEnd):void 0},type:h,value:d,cryptInfo:{ref:{id:e,generation:0}},streamId:this.id}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.N&&s.push(...r.encode("/N "),...r.encode(" "+this.N)),this.First&&s.push(...r.encode("/First "),...r.encode(" "+this.First)),this.Extends&&s.push(...r.encode("/Extends "),N,...this.Extends.toArray(e));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=t.getDictBoundsAt(s);let a,i,o=t.skipToNextName(n.contentStart,n.contentEnd);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/N":case"/First":o=this.parseNumberProp(a,t,o,!1);break;case"/Extends":o=this.parseRefProp(a,t,o);break;default:o=t.skipToNextName(o,n.contentEnd)}}}class ys extends mr{constructor(){super(ct)}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new ys;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.Version&&s.push(...r.encode("/Version "),...r.encode(this.Version)),this.Pages&&s.push(...r.encode("/Pages "),N,...this.Pages.toArray(e)),this.Lang&&s.push(...r.encode("/Lang "),...this.Lang.toArray(e));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Version":o=this.parseNameProp(a,t,o);break;case"/Pages":o=this.parseRefProp(a,t,o);break;case"/Lang":o=this.parseLiteralProp(a,t,o,e.cryptInfo);break;default:o=t.skipToNextName(o,n-1)}if(!this.Pages)throw new Error("Not all required properties parsed")}}class ws extends mr{constructor(){super(lt),this.Rotate=0}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new ws;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.Parent&&s.push(...r.encode("/Parent "),N,...this.Parent.toArray(e)),this.LastModified&&s.push(...r.encode("/LastModified "),...this.LastModified.toArray(e)),this.Resources&&s.push(...r.encode("/Resources "),...this.Resources.toArray(e)),this.MediaBox&&s.push(...r.encode("/MediaBox "),te,...r.encode(this.MediaBox[0]+""),N,...r.encode(this.MediaBox[1]+""),N,...r.encode(this.MediaBox[2]+""),N,...r.encode(this.MediaBox[3]+""),se),this.CropBox&&s.push(...r.encode("/CropBox "),te,...r.encode(this.CropBox[0]+""),N,...r.encode(this.CropBox[1]+""),N,...r.encode(this.CropBox[2]+""),N,...r.encode(this.CropBox[3]+""),se),this.BleedBox&&s.push(...r.encode("/BleedBox "),te,...r.encode(this.BleedBox[0]+""),N,...r.encode(this.BleedBox[1]+""),N,...r.encode(this.BleedBox[2]+""),N,...r.encode(this.BleedBox[3]+""),se),this.TrimBox&&s.push(...r.encode("/TrimBox "),te,...r.encode(this.TrimBox[0]+""),N,...r.encode(this.TrimBox[1]+""),N,...r.encode(this.TrimBox[2]+""),N,...r.encode(this.TrimBox[3]+""),se),this.ArtBox&&s.push(...r.encode("/ArtBox "),te,...r.encode(this.ArtBox[0]+""),N,...r.encode(this.ArtBox[1]+""),N,...r.encode(this.ArtBox[2]+""),N,...r.encode(this.ArtBox[3]+""),se),this.Contents&&(this.Contents instanceof yr?s.push(...r.encode("/Contents "),N,...this.Contents.toArray(e)):(s.push(...r.encode("/Contents "),te),this.Contents.forEach((t=>s.push(N,...t.toArray(e)))),s.push(se))),this.Rotate&&s.push(...r.encode("/Rotate "),...r.encode(" "+this.Rotate)),this.Thumb&&s.push(...r.encode("/Thumb "),N,...this.Thumb.toArray(e)),this.B&&(this.B instanceof yr?s.push(...r.encode("/B "),N,...this.B.toArray(e)):(s.push(...r.encode("/B "),te),this.B.forEach((t=>s.push(N,...t.toArray(e)))),s.push(se))),this.Dur&&s.push(...r.encode("/Dur "),...r.encode(" "+this.Dur)),this.Annots&&(this.Annots instanceof yr?s.push(...r.encode("/Annots "),N,...this.Annots.toArray(e)):(s.push(...r.encode("/Annots "),te),this.Annots.forEach((t=>s.push(N,...t.toArray(e)))),s.push(se))),this.Metadata&&s.push(...r.encode("/Metadata "),N,...this.Metadata.toArray(e)),this.StructParent&&s.push(...r.encode("/StructParent "),...r.encode(" "+this.StructParent)),this.ID&&s.push(...r.encode("/ID "),N,...this.ID.toArray(e)),this.PZ&&s.push(...r.encode("/PZ "),...r.encode(" "+this.PZ)),this.Tabs&&s.push(...r.encode("/Tabs "),...r.encode(this.Tabs)),this.TemplateInstantiated&&s.push(...r.encode("/TemplateInstantiated "),...r.encode(this.TemplateInstantiated)),this.UserUnit&&s.push(...r.encode("/UserUnit "),...r.encode(" "+this.UserUnit));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Parent":case"/Thumb":case"/Metadata":o=this.parseRefProp(a,t,o);break;case"/LastModified":o=this.parseDateProp(a,t,o,e.cryptInfo);break;case"/Resources":const r=t.getValueTypeAt(o);if(r===Bt){const r=yr.parseRef(t,o);if(r&&e.parseInfoGetter){const t=e.parseInfoGetter(r.value.id);if(t){const e=Or.parse(t);if(e){this.Resources=e.value,o=e.end+1;break}}}throw new Error("Can't parse /Resources value reference")}if(r===Nt){const r=t.getDictBoundsAt(o);if(r){if(r.contentStart){const s=Or.parse({parser:t,bounds:r,parseInfoGetter:e.parseInfoGetter});if(!s)throw new Error("Can't parse /Resources value dictionary");this.Resources=s.value}o=r.end+1;break}throw new Error("Can't parse /Resources dictionary bounds")}throw new Error(`Unsupported /Resources property value type: ${r}`);case"/MediaBox":case"/CropBox":case"/BleedBox":case"/TrimBox":case"/ArtBox":o=this.parseNumberArrayProp(a,t,o,!0);break;case"/Contents":case"/B":case"/Annots":const s=t.getValueTypeAt(o);if(s===Bt){const e=yr.parseRef(t,o);if(e){this[a.slice(1)]=e.value,o=e.end+1;break}}else if(s===kt){const e=yr.parseRefArray(t,o);if(e){this[a.slice(1)]=e.value,o=e.end+1;break}}throw new Error(`Unsupported ${a} property value type: ${s}`);case"/Rotate":case"/Dur":case"/StructParent":case"/PZ":case"/UserUnit":o=this.parseNumberProp(a,t,o,!1);break;case"/ID":const i=t.getValueTypeAt(o);if(i===Bt){const r=yr.parseRef(t,o);if(r&&r&&e.parseInfoGetter){const t=e.parseInfoGetter(r.value.id);if(t){const e=Ir.parse(t.parser,t.bounds.start,t.cryptInfo);if(e){this.ID=e.value,o=r.end+1;break}}}throw new Error("Can't parse /ID property value")}if(i===Pt){const r=Ir.parse(t,o,e.cryptInfo);if(r){this.ID=r.value,o=r.end+1;break}}throw new Error(`Unsupported /ID property value type: ${i}`);case"/Tabs":case"/TemplateInstantiated":o=this.parseNameProp(a,t,o);break;default:o=t.skipToNextName(o,n-1)}if(!this.Parent)throw new Error("Not all required properties parsed")}}class As extends mr{constructor(){super(dt),this.Rotate=0}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new As;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.Parent&&s.push(...r.encode("/Parent "),N,...this.Parent.toArray(e)),this.Kids&&(s.push(...r.encode("/Kids "),te),this.Kids.forEach((t=>s.push(N,...t.toArray(e)))),s.push(se)),this.Count&&s.push(...r.encode("/Count "),...r.encode(" "+this.Count)),this.MediaBox&&s.push(...r.encode("/MediaBox "),te,...r.encode(this.MediaBox[0]+""),N,...r.encode(this.MediaBox[1]+""),N,...r.encode(this.MediaBox[2]+""),N,...r.encode(this.MediaBox[3]+""),se),this.Rotate&&s.push(...r.encode("/Rotate "),...r.encode(" "+this.Rotate));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Parent":o=this.parseRefProp(a,t,o);break;case"/Kids":o=this.parseRefArrayProp(a,t,o);break;case"/Count":case"/Rotate":o=this.parseNumberProp(a,t,o,!1);break;case"/MediaBox":o=this.parseNumberArrayProp(a,t,o,!0);break;default:o=t.skipToNextName(o,n-1)}if(!this.Kids||isNaN(this.Count))throw new Error("Not all required properties parsed")}}class ms extends _r{constructor(){super(it)}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new ms;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.Size&&s.push(...r.encode("/Size "),...r.encode(" "+this.Size)),this.Prev&&s.push(...r.encode("/Prev "),...r.encode(" "+this.Prev)),this.Root&&s.push(...r.encode("/Root "),N,...this.Root.toArray(e)),this.Encrypt&&s.push(...r.encode("/Encrypt "),N,...this.Encrypt.toArray(e)),this.Info&&s.push(...r.encode("/Info "),N,...this.Info.toArray(e)),this.ID&&s.push(...r.encode("/ID "),te,...this.ID[0].toArray(e),...this.ID[1].toArray(e),se),this.Index&&(s.push(...r.encode("/Index "),te),this.Index.forEach((e=>s.push(...r.encode(" "+e)))),s.push(se)),this.W&&s.push(...r.encode("/W "),te,...r.encode(this.W[0]+""),N,...r.encode(this.W[1]+""),N,...r.encode(this.W[2]+""),se);const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){var t;super.parseProps(e);const{parser:r,bounds:s}=e,n=s.contentStart||s.start,a=r.getDictBoundsAt(n);let i,o,h=r.skipToNextName(a.contentStart,a.contentEnd);for(;o=r.parseNameAt(h),o;)switch(h=o.end+1,i=o.value,i){case"/Size":case"/Prev":h=this.parseNumberProp(i,r,h,!1);break;case"/Root":case"/Info":h=this.parseRefProp(i,r,h);break;case"/Encrypt":const e=r.getValueTypeAt(h);if(e===Bt){const e=yr.parseRef(r,h);if(e){this.Encrypt=e.value,h=e.end+1;break}throw new Error("Can't parse /Encrypt property value")}throw new Error(`Unsupported /Encrypt property value type: ${e}`);case"/ID":const t=Ir.parseArray(r,h);if(!t)throw new Error("Can't parse /ID property value");this.ID=[t.value[0],t.value[1]],h=t.end+1;break;case"/Index":case"/W":h=this.parseNumberArrayProp(i,r,h,!1);break;default:h=r.skipToNextName(h,a.contentEnd)}if(!this.W||!this.Size||!this.Root||this.Encrypt&&!this.ID)throw new Error("Not all required properties parsed");(null===(t=this.Index)||void 0===t?void 0:t.length)||(this.Index=[0,this.Size])}}class vs{constructor(e){this._type=e}get type(){return this._type}get offset(){return this._offset}}class bs{constructor(e,t,r,s,n,a,i){this.type=e,this.id=t,this.generation=r,this.byteOffset=s,this.nextFreeId=n,this.streamId=a,this.streamIndex=i}static*fromTableBytes(e){let t=0,r=0;for(;t<e.length;){const s=[];let n=e[t++];for(;_e.has(n);)s.push(n),n=e[t++];let a=parseInt(s.map((e=>String.fromCharCode(e))).join(""),10);const i=[];let o=e[t++];for(;_e.has(o);)i.push(o),o=e[t++];const h=parseInt(i.map((e=>String.fromCharCode(e))).join(""),10);for(;!_e.has(e[t]);)t++;for(r=0;r<h;r++){const r=parseInt(Array.from(e.subarray(t,t+10)).map((e=>String.fromCharCode(e))).join(""),10);t+=11;const s=parseInt(Array.from(e.subarray(t,t+5)).map((e=>String.fromCharCode(e))).join(""),10);t+=6;const n=e[t];n===he?yield new bs(Ve,a++,s,null,r):n===ue&&(yield new bs(ze,a++,s,r)),t+=3}}}static*fromStreamBytes(e,t,r){const[s,n,a]=t,i=s+n+a;if(e.length%i)throw new Error("Incorrect stream length");const o=e.length/i,h=new Array(o);if(null==r?void 0:r.length){let e,t,s=0;for(let n=0;n<r.length;n++)if(n%2)for(t=0;t<r[n];t++)h[s++]=e+t;else e=r[n]}else{let e=0;for(;e<o;)h[e++]=e}let c,d,l,u=0,p=0;for(;u<e.length;)switch(c=s?Pe(e.slice(u,u+s)):1,u+=s,d=Pe(e.slice(u,u+n)),u+=n,l=a?Pe(e.slice(u,u+a)):null,u+=a,c){case Ve:yield new bs(Ve,h[p++],null!=l?l:65535,null,d);break;case ze:yield new bs(ze,h[p++],null!=l?l:0,d);break;case He:yield new bs(He,h[p++],0,null,null,d,l)}}static toTableBytes(e){if(!(null==e?void 0:e.length))return null;const t=new TextEncoder,r=this.groupEntries(e);let s,n,a=new Uint8Array;for(const e of r){n=`${e[0]} ${e[1].length}\r\n`,s=new Uint8Array(a.length+n.length),s.set(a),s.set(t.encode(n),a.length),a=s;for(const r of e[1]){switch(r.type){case Ve:n=`${r.nextFreeId.toString().padStart(10,"0")} ${r.generation.toString().padStart(5,"0")} f\r\n`;break;case ze:n=`${r.byteOffset.toString().padStart(10,"0")} ${r.generation.toString().padStart(5,"0")} n\r\n`;break;default:continue}s=new Uint8Array(a.length+n.length),s.set(a),s.set(t.encode(n),a.length),a=s}}return a}static toStreamBytes(e,t=[1,4,2]){if(!(null==e?void 0:e.length))return null;if(Math.min(...t)<0)throw new Error("Negative length values are not permitted");let[r,s,n]=t;null!=r||(r=0),null!=s||(s=4),null!=n||(n=0);const a=r+s+n;let i,o,h;switch(r){case 0:i=()=>new Uint8Array;break;case 1:i=Se;break;case 2:i=ke;break;default:o=e=>new Uint8Array([...new Array(r-2).fill(0),...ke(e)])}switch(s){case 1:o=Se;break;case 2:o=ke;break;case 3:o=e=>new Uint8Array([0,...ke(e)]);break;case 4:o=Ne;break;default:o=e=>new Uint8Array([...new Array(r-4).fill(0),...Ne(e)])}switch(n){case 0:h=()=>new Uint8Array;break;case 1:h=Se;break;case 2:h=ke;break;default:o=e=>new Uint8Array([...new Array(r-2).fill(0),...ke(e)])}new TextEncoder;const c=this.groupEntries(e),d=[];let l,u,p,f,g=new Uint8Array;for(const e of c){d.push(e[0],e[1].length);for(const t of e[1]){switch(t.type){case Ve:u=i(0),p=o(t.nextFreeId),f=h(t.generation);break;case ze:u=i(1),p=o(t.byteOffset),f=h(t.generation);break;case He:u=i(2),p=o(t.streamId),f=h(t.streamIndex);break;default:continue}l=new Uint8Array(g.length+a),l.set(g),l.set(u,g.length),l.set(p,g.length+r),l.set(f,g.length+r+s),g=l}}return{bytes:g,index:d}}static groupEntries(e){e.sort(((e,t)=>e.id-t.id));const t=[];let r,s,n;for(const a of e)a.id!==n+1?((null==s?void 0:s.length)&&t.push([r,s]),r=a.id,s=[a]):s.push(a),n=a.id;return(null==s?void 0:s.length)&&t.push([r,s]),t}}class xs extends vs{constructor(e,t){super(Fe),this._trailerStream=e,this._offset=t}get prev(){var e;return null===(e=this._trailerStream)||void 0===e?void 0:e.Prev}get size(){var e;return null===(e=this._trailerStream)||void 0===e?void 0:e.Size}get root(){var e;return null===(e=this._trailerStream)||void 0===e?void 0:e.Root}get info(){var e;return null===(e=this._trailerStream)||void 0===e?void 0:e.Root}get encrypt(){var e;return null===(e=this._trailerStream)||void 0===e?void 0:e.Encrypt}get id(){var e;return null===(e=this._trailerStream)||void 0===e?void 0:e.ID}static createFrom(e,t,r){if(!(null==t?void 0:t.length)||!e)return null;const s=Math.max(...t.map((e=>e.id)))+1,n=Math.max(s,e.size);return xs.create(t,n,r,e.root,e.offset,e.info,e.encrypt,e.id)}static create(e,t,r,s,n,a,i,o){if(!((null==e?void 0:e.length)&&t&&r&&s))return null;const h=new ms;h.Size=t,h.Root=s,h.Prev=n,h.Info=a,h.Encrypt=i,h.ID=o;const c=[1,4,2],d=bs.toStreamBytes(e,c),l=new vr;l.setIntProp("/Predictor",Je),l.setIntProp("/Columns",5),l.setIntProp("/Colors",1),l.setIntProp("/BitsPerComponent",8);const u=new xs(h,r);return u._trailerStream.Filter=Ge,u._trailerStream.DecodeParms=l,u._trailerStream.W=c,u._trailerStream.Index=d.index,u._trailerStream.streamData=d.bytes,u}static parse(e,t){if(!e)return null;const r=ms.parse(e);if(!r)return null;return{value:new xs(r.value,t),start:null,end:null}}createUpdate(e,t){return xs.createFrom(this,e,t)}getEntries(){if(!this._trailerStream)return[];return bs.fromStreamBytes(this._trailerStream.decodedStreamData,this._trailerStream.W,this._trailerStream.Index)}toArray(e){return this._trailerStream.toArray(e)}}class Es extends mr{constructor(){super(vt)}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Es;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.Size&&s.push(...r.encode("/Size "),...r.encode(" "+this.Size)),this.Prev&&s.push(...r.encode("/Prev "),...r.encode(" "+this.Prev)),this.Root&&s.push(...r.encode("/Root "),N,...this.Root.toArray(e)),this.Encrypt&&s.push(...r.encode("/Encrypt "),N,...this.Encrypt.toArray(e)),this.Info&&s.push(...r.encode("/Info "),N,...this.Info.toArray(e)),this.ID&&s.push(...r.encode("/ID "),te,...this.ID[0].toArray(e),...this.ID[1].toArray(e),se);const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Size":case"/Prev":o=this.parseNumberProp(a,t,o,!1);break;case"/Root":case"/Info":o=this.parseRefProp(a,t,o);break;case"/Encrypt":const e=t.getValueTypeAt(o);if(e===Bt){const e=yr.parseRef(t,o);if(e){this.Encrypt=e.value,o=e.end+1;break}throw new Error("Can't parse /Encrypt property value")}throw new Error(`Unsupported /Encrypt property value type: ${e}`);case"/ID":const r=Ir.parseArray(t,o);if(!r)throw new Error("Can't parse /ID property value");this.ID=[r.value[0],r.value[1]],o=r.end+1;break;default:o=t.skipToNextName(o,n-1)}if(!this.Size||!this.Root||this.Encrypt&&!this.ID)throw new Error("Not all required properties parsed")}}class _s extends vs{constructor(e,t,r){super(Ue),this._table=e,this._trailerDict=t,this._offset=r}get prev(){var e;return null===(e=this._trailerDict)||void 0===e?void 0:e.Prev}get size(){var e;return null===(e=this._trailerDict)||void 0===e?void 0:e.Size}get root(){var e;return null===(e=this._trailerDict)||void 0===e?void 0:e.Root}get info(){var e;return null===(e=this._trailerDict)||void 0===e?void 0:e.Root}get encrypt(){var e;return null===(e=this._trailerDict)||void 0===e?void 0:e.Encrypt}get id(){var e;return null===(e=this._trailerDict)||void 0===e?void 0:e.ID}static createFrom(e,t,r){if(!(null==t?void 0:t.length)||!e)return null;const s=Math.max(...t.map((e=>e.id)))+1,n=Math.max(s,e.size);return _s.create(t,n,r,e.root,e.offset,e.info,e.encrypt,e.id)}static create(e,t,r,s,n,a,i,o){if(!((null==e?void 0:e.length)&&t&&r&&s))return null;const h=new Es;h.Size=t,h.Prev=n,h.Root=s,h.Info=a,h.Encrypt=i,h.ID=o;const c=bs.toTableBytes(e);return new _s(c,h,r)}static parse(e,t,r){if(!e||isNaN(t))return null;const s=e.getXrefTableBoundsAt(t);if(!s)return null;const n=e.getDictBoundsAt(s.end+1);if(!n)return null;const a=e.sliceCharCodes(s.contentStart,s.contentEnd),i=Es.parse({parser:e,bounds:n});if(!i)return null;return{value:new _s(a,i.value,r),start:null,end:null}}createUpdate(e,t){return _s.createFrom(this,e,t)}getEntries(){if(!this._table.length)return[];return bs.fromTableBytes(this._table)}toArray(e){const t=this._trailerDict.toArray(e),r=[...be.XREF_TABLE,...be.END_OF_LINE,...this._table,...be.TRAILER,...be.END_OF_LINE,...t,...be.END_OF_LINE];return new Uint8Array(r)}}class Cs{constructor(e){if(!(null==e?void 0:e.length))throw new Error("Data is empty");this._data=[...e],this._pointer=e.length-1,this._encoder=new TextEncoder,this.fixEof()}get offset(){return this._pointer}getCurrentData(){return new Uint8Array(this._data)}writeBytes(e){(null==e?void 0:e.length)&&(this._data.push(...e),this._pointer+=e.length)}writeIndirectObject(e,t){if(!(null==e?void 0:e.ref)||!t)return;const r=[...this._encoder.encode(`${e.ref.id} ${e.ref.generation} `),...be.OBJ,...be.END_OF_LINE,...t.toArray(e),...be.OBJ_END,...be.END_OF_LINE];this.writeBytes(r)}writeEof(e){const t=[...be.XREF_START,...be.END_OF_LINE,...this._encoder.encode(e+""),...be.END_OF_LINE,...be.END_OF_FILE,...be.END_OF_LINE];this.writeBytes(t)}fixEof(){this._data[this._pointer]!==P&&(this._data[this._pointer-1]!==k?(this._data.push(k,P),this._pointer+=2):(this._data.push(P),this._pointer+=1))}}class Ps{constructor(e){var t;const r=[],s=[],n=[];let a=0;e.forEach((e=>{for(const t of e.getEntries()){switch(t.type){case Ve:r.push(t);break;case ze:s.push(t);break;case He:n.push(t);break;default:continue}t.id>a&&(a=t.id)}})),this.size=a+1;const i={id:0,generation:65535,nextFreeId:0},o=new d(i),h=new Map,c=new Map;let l=!1;for(const e of r){if(!l&&0===e.id){l=!0,i.nextFreeId=e.nextFreeId;continue}const t=c.get(e.id);(!t||t.generation<e.generation)&&c.set(e.id,{id:e.id,generation:e.generation,nextFreeId:e.nextFreeId})}let u,p=i.nextFreeId;for(;p;)u=c.get(p),c.delete(p),o.push(u),p=u.nextFreeId;[...c].forEach((e=>{const t=e[1];65535===t.generation&&0===t.nextFreeId&&h.set(t.id,t)})),this.freeLinkedList=o,this.freeOutsideListMap=h;const f=new Map;for(const e of s){if(this.isFreed(e))continue;const t=f.get(e.id);t&&t.generation>=e.generation||f.set(e.id,{id:e.id,generation:e.generation,byteOffset:e.byteOffset})}for(const e of n){if(this.isFreed(e))continue;if(f.get(e.id))continue;const r=null===(t=f.get(e.streamId))||void 0===t?void 0:t.byteOffset;r&&f.set(e.id,{id:e.id,generation:e.generation,byteOffset:r,compressed:!0,streamId:e.streamId,streamIndex:e.streamIndex})}this.usedMap=f}getOffset(e){var t;return null===(t=this.usedMap.get(e))||void 0===t?void 0:t.byteOffset}getGeneration(e){var t;return null===(t=this.usedMap.get(e))||void 0===t?void 0:t.generation}isFreed(e){return this.freeOutsideListMap.has(e.id)||this.freeLinkedList.has(e,((e,t)=>e.id===t.id&&e.generation<t.generation))}isUsed(e){return this.usedMap.has(e)}}class Ss{constructor(e){this._refData=e,this._size=e.size;const t=new d;for(const r of e.freeLinkedList)t.push(r);this._freeLinkedList=t,this._usedMap=new Map}get size(){return this._size}takeFreeRef(e,t=!1){let r;if(!t&&this._freeLinkedList.length>1){const t=this._freeLinkedList.pop();this._freeLinkedList.tail.nextFreeId=0,r={id:t.id,generation:t.generation,byteOffset:e}}else r={id:this._size++,generation:0,byteOffset:e};return this._usedMap.set(r.id,r),r}setRefFree(e){if(this._usedMap.has(e)&&(this._usedMap.delete(e),this._size>this._refData.size&&this._size===e+1&&this._size--),this._refData.isUsed(e)){const t={id:e,generation:this._refData.getGeneration(e)+1,nextFreeId:0};if(-1!==this._freeLinkedList.findIndex(t,((e,t)=>e.id===t.id&&e.generation<=t.generation)))return;this._freeLinkedList.tail.nextFreeId=e,this._freeLinkedList.push(t)}}updateUsedRef(e){if(e.compressed&&e.generation)return!1;if(this.isFreed(e))return!1;const t=this._usedMap.get(e.id);if(t&&e.generation>=t.generation)return this._usedMap.set(e.id,e),!0;if(this._refData.isUsed(e.id)){const t=this._refData.getGeneration(e.generation);if(e.generation>=t)return this._usedMap.set(e.id,e),!0}return!1}exportEntries(){const e=[];for(const t of this._freeLinkedList)e.push(new bs(Ve,t.id,t.generation,null,t.nextFreeId));return this._usedMap.forEach((t=>{t.compressed?e.push(new bs(He,t.id,0,null,null,t.streamId,t.streamIndex)):e.push(new bs(ze,t.id,t.generation,t.byteOffset))})),e}isFreed(e){return this._freeLinkedList.has(e,((e,t)=>e.id===t.id&&e.generation<t.generation))}isUsed(e){return this._usedMap.has(e)||this._refData.isUsed(e)}}const ks={CLOUD:"/PolygonCloud",POLYGON_DIMESION:"/PolygonDimension",POLYLINE_DIMESION:"/PolyLineDimension"};class Ns extends rs{constructor(e){super(e)}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.Vertices&&(s.push(...r.encode("/Vertices "),te),this.Vertices.forEach((e=>s.push(...r.encode(" "+e)))),s.push(se)),this.IT&&s.push(...r.encode("/IT "),...r.encode(this.IT)),this.Measure&&s.push(...r.encode("/Measure "),...this.Measure.toArray(e));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/Vertices":o=this.parseNumberArrayProp(a,t,o,!0);break;case"/IT":const r=t.parseNameAt(o,!0);if(r&&Object.values(ks).includes(r.value)){this.IT=r.value,o=r.end+1;break}throw new Error("Can't parse /IT property value");case"/Measure":const s=t.getValueTypeAt(o);if(s===Bt){const r=yr.parseRef(t,o);if(r&&e.parseInfoGetter){const t=e.parseInfoGetter(r.value.id);if(t){const e=Ur.parse(t);if(e){this.Measure=e.value,o=e.end+1;break}}}throw new Error("Can't parse /Measure value reference")}if(s===Nt){const e=t.getDictBoundsAt(o);if(e){const r=Ur.parse({parser:t,bounds:e});if(r){this.Measure=r.value,o=r.end+1;break}}throw new Error("Can't parse /Measure value dictionary")}throw new Error(`Unsupported /Measure property value type: ${s}`);default:o=t.skipToNextName(o,n-1)}if(!this.Vertices)throw new Error("Not all required properties parsed")}}class Is extends Ns{constructor(){super(Ut)}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Is;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){return super.toArray(e)}parseProps(e){super.parseProps(e)}}class Bs extends Ns{constructor(){super(Ft),this.LE=[qt.NONE,qt.NONE]}static parse(e){if(!e)throw new Error("Parsing information not passed");try{const t=new Bs;return t.parseProps(e),{value:t,start:e.bounds.start,end:e.bounds.end}}catch(e){return console.log(e.message),null}}toArray(e){const t=super.toArray(e),r=new TextEncoder,s=[];this.LE&&(s.push(...r.encode("/LE "),te),this.LE.forEach((e=>s.push(N,...r.encode(e)))),s.push(se));const n=[...t.subarray(0,2),...s,...t.subarray(2,t.length)];return new Uint8Array(n)}parseProps(e){super.parseProps(e);const{parser:t,bounds:r}=e,s=r.contentStart||r.start,n=r.contentEnd||r.end;let a,i,o=t.skipToNextName(s,n-1);for(;i=t.parseNameAt(o),i;)switch(o=i.end+1,a=i.value,a){case"/LE":const e=t.parseNameAt(o,!0);if(!(e&&Object.values(qt).includes(e.value[0])&&Object.values(qt).includes(e.value[1])))throw new Error("Can't parse /LE property value");this.LE=[e.value[0],e.value[1]],o=e.end+1;break;default:o=t.skipToNextName(o,n-1)}}}class Ms{constructor(e){this.getObjectParseInfo=e=>{var t,r,s;if(!e)return null;const n=null===(t=this._referenceData)||void 0===t?void 0:t.getOffset(e);if(isNaN(n))return null;const a=yr.parse(this._docParser,n);if(!a)return null;const i=this._docParser.getIndirectObjectBoundsAt(a.end+1,!0);if(!i)return null;const o=this.getObjectParseInfo,h={parser:this._docParser,bounds:i,parseInfoGetter:o,cryptInfo:{ref:{id:a.value.id,generation:a.value.generation},stringCryptor:null===(r=this._authResult)||void 0===r?void 0:r.stringCryptor,streamCryptor:null===(s=this._authResult)||void 0===s?void 0:s.streamCryptor}};if(a.value.id===e)return h;const c=gs.parse(h);if(!c)return;const d=c.value.getObjectData(e);return d?(d.parseInfoGetter=o,d):null},this._data=e,this._docParser=new kr(e),this._version=this._docParser.getPdfVersion();const t=this._docParser.getLastXrefIndex();if(!t)throw new Error("File doesn't contain update section");const r=Ms.parseAllXrefs(this._docParser,t.value);if(!r.length)throw new Error("Failed to parse cross-reference sections");this._xrefs=r,this._referenceData=new Ps(r),this.parseEncryption()}get size(){var e;return(null===(e=this._xrefs)||void 0===e?void 0:e.length)?this._xrefs[0].size:0}get encrypted(){return!!this._encryption}get authenticated(){return!this._encryption||!!this._authResult}static parseXref(e,t,r){if(!e||!t)return null;const s=t,n=e.findSubarrayIndex(be.XREF_TABLE,{minIndex:t,closedOnly:!0});if(n&&n.start===t){const n=e.findSubarrayIndex(be.XREF_HYBRID,{minIndex:t,maxIndex:r,closedOnly:!0});if(!n){const r=_s.parse(e,t,s);return null==r?void 0:r.value}{const r=e.parseNumberAt(n.end+1);if(!r)return null;t=r.value}}const a=yr.parse(e,t,!1);if(!a)return null;const i=e.getIndirectObjectBoundsAt(a.end+1);if(!i)return null;const o=xs.parse({parser:e,bounds:i},s);return null==o?void 0:o.value}static parseAllXrefs(e,t){const r=[];let s,n=e.maxIndex;for(;t&&(s=Ms.parseXref(e,t,n),s);)r.push(s),n=t,t=s.prev;return r}authenticate(e){if(this.authenticated)return!0;const t=this._encryption.toCryptOptions(),r=this._xrefs[0].id[0].hex,s=new fr(t,r);return this._authResult=s.authenticate(e),this.authenticated}getSupportedAnnotations(){var e;this.checkAuthentication(),this._catalog||(this.parsePageTree(),console.log(this._pages));const t=new Map;for(const r of this._pages){if(!r.Annots)break;const s=[];if(Array.isArray(r.Annots))s.push(...r.Annots);else{const t=this.getObjectParseInfo(r.Annots.id);if(t){const r=yr.parseRefArray(t.parser,t.bounds.contentStart);(null===(e=null==r?void 0:r.value)||void 0===e?void 0:e.length)&&s.push(...r.value)}}const n=[];for(const e of s){const t=this.getObjectParseInfo(e.id);t.rect=r.MediaBox;let s;switch(t.parser.parseDictSubtype(t.bounds)){case Vt:s=ds.parse(t);break;case Rt:s=ls.parse(t);break;case Dt:s=ts.parse(t);break;case Ot:s=ss.parse(t);break;case Lt:s=os.parse(t);break;case Ut:s=Is.parse(t);break;case Ft:s=Bs.parse(t);break;case Tt:s=is.parse(t);break;case zt:s=hs.parse(t)}s&&(n.push(s.value),console.log(s.value))}t.set(r.id,n)}return t}getUpdatedData(e){var t,r;this.checkAuthentication();const s=new Ss(this._referenceData),n=new Cs(this._data);null===(t=this._authResult)||void 0===t||t.stringCryptor,null===(r=this._authResult)||void 0===r||r.streamCryptor;for(const t of e)for(const e of t.deleted)e.id&&(s.setRefFree(e.id),e instanceof $r&&e.Popup&&s.setRefFree(e.Popup.id));this.writeXref(s,n);return n.getCurrentData()}checkAuthentication(){if(!this.authenticated)throw new Error("Unauthorized access to file data")}parseEncryption(){const e=this._xrefs[0].encrypt;if(!e)return;const t=this.getObjectParseInfo(e.id),r=fs.parse(t);if(!r)throw new Error("Encryption dict can't be parsed");this._encryption=r.value}parsePageTree(){const e=this._xrefs[0].root,t=this.getObjectParseInfo(e.id),r=ys.parse(t);if(!r)throw new Error("Document root catalog not found");this._catalog=r.value;const s=r.value.Pages,n=this.getObjectParseInfo(s.id),a=As.parse(n);if(!a)throw new Error("Document root page tree not found");this._pageRoot=a.value;const i=[];this.parsePages(i,a.value),this._pages=i}parsePages(e,t){if(t.Kids.length)for(const r of t.Kids){const t=this.getObjectParseInfo(r.id);if(!t)continue;const s=t.parser.parseDictType(t.bounds);if(s===dt){const r=As.parse(t);r&&this.parsePages(e,r.value)}else if(s===lt){const r=ws.parse(t);r&&e.push(r.value)}}}writeXref(e,t){const r=this._xrefs[0],s=t.offset,n=e.takeFreeRef(s,!0),a=e.exportEntries(),i=r.createUpdate(a,s);t.writeIndirectObject({ref:n},i),t.writeEof(s)}}class Rs{constructor(e){if(this.onAnnotationDictChange={set:(e,t,r)=>(e[t]=r,!0)},!(null==e?void 0:e.length))throw new Error("Data is empty");this._sourceData=e,this._documentData=new Ms(e)}tryAuthenticate(e=""){return!!this._documentData.authenticated||this._documentData.authenticate(e)}getRefinedData(){const e=this.getAnnotationMap(),t=[];return(null==e?void 0:e.size)&&this.getAnnotationMap().forEach(((e,r)=>{const s={pageId:r,deleted:e.slice(),edited:[],added:[]};t.push(s)})),this._documentData.getUpdatedData(t)}getExportedData(){return null}getPageAnnotations(e){return this.getAnnotationMap().get(e)||[]}addAnnotation(e,t){const r=this.getAnnotationMap().get(e);r?r.push(t):this.getAnnotationMap().set(e,[t])}removeAnnotation(e){e.isDeleted=!0}getAnnotationMap(){if(this._annotationsByPageId)return this._annotationsByPageId;if(!this._documentData.authenticated)throw new Error("Unauthorized access to file data");return this._annotationsByPageId=this._documentData.getSupportedAnnotations(),this._annotationsByPageId}}var Ds=function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{h(s.next(e))}catch(e){a(e)}}function o(e){try{h(s.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}h((s=s.apply(e,t||[])).next())}))};class Ts{constructor(e,t){this._visibleAdjPages=0,this._previewWidth=100,this._minScale=.25,this._maxScale=4,this._scale=1,this._previewerHidden=!0,this._pages=[],this._currentPage=0,this._pointerInfo={lastPos:null,downPos:null,downScroll:null},this._timers={hidePanels:0},this._pinchInfo={active:!1,lastDist:0,minDist:10,sensitivity:.025,target:null},this.onPdfLoadingProgress=e=>{},this.onPdfLoadedAsync=(e,t)=>Ds(this,void 0,void 0,(function*(){this._pdfDocument=e,this._annotationData=t,yield this.refreshPagesAsync(),this.renderVisiblePreviews(),this.renderVisiblePages(),this._shadowRoot.querySelector("#panel-bottom").classList.remove("disabled")})),this.onPdfClosedAsync=()=>Ds(this,void 0,void 0,(function*(){this._shadowRoot.querySelector("#panel-bottom").classList.add("disabled"),this._pdfDocument&&(this._pdfDocument=null),yield this.refreshPagesAsync()})),this.onMainContainerResize=(e,t)=>{const{width:r}=this._mainContainer.getBoundingClientRect();r<721?this._mainContainer.classList.add("mobile"):this._mainContainer.classList.remove("mobile")},this.onTextModeButtonClick=()=>{this.toggleMode("text")},this.onHandModeButtonClick=()=>{this.toggleMode("hand")},this.onAnnotationModeButtonClick=()=>{this.toggleMode("annotation")},this.onPreviewerToggleClick=()=>{this._previewerHidden?(this._mainContainer.classList.remove("hide-previewer"),this._shadowRoot.querySelector("div#toggle-previewer").classList.add("on"),this._previewerHidden=!1,setTimeout((()=>this.renderVisiblePreviews()),1e3)):(this._mainContainer.classList.add("hide-previewer"),this._shadowRoot.querySelector("div#toggle-previewer").classList.remove("on"),this._previewerHidden=!0)},this.onPreviewerPageClick=e=>{let t,r=e.target;for(;r&&!t;){const e=r.dataset.pageNumber;e?t=+e:r=r.parentElement}t&&this.scrollToPage(t-1)},this.onPreviewerScroll=e=>{this.renderVisiblePreviews()},this.onPaginatorInput=e=>{e.target instanceof HTMLInputElement&&(e.target.value=e.target.value.replace(/[^\d]+/g,""))},this.onPaginatorChange=e=>{if(e.target instanceof HTMLInputElement){const t=Math.max(Math.min(+e.target.value,this._pdfDocument.numPages),1);t+""!==e.target.value&&(e.target.value=t+""),this.scrollToPage(t-1)}},this.onPaginatorPrevClick=()=>{const e=l(this._currentPage-1,0,this._pages.length-1);this.scrollToPage(e)},this.onPaginatorNextClick=()=>{const e=l(this._currentPage+1,0,this._pages.length-1);this.scrollToPage(e)},this.onZoomOutClick=()=>{this.zoomOut()},this.onZoomInClick=()=>{this.zoomIn()},this.onZoomFitViewerClick=()=>{const e=l((this._viewer.getBoundingClientRect().width-20)/this._pages[this._currentPage].viewContainer.getBoundingClientRect().width*this._scale,this._minScale,this._maxScale);this.setScale(e),this.scrollToPage(this._currentPage)},this.onZoomFitPageClick=()=>{const{width:e,height:t}=this._viewer.getBoundingClientRect(),{width:r,height:s}=this._pages[this._currentPage].viewContainer.getBoundingClientRect(),n=l((e-20)/r*this._scale,this._minScale,this._maxScale),a=l((t-20)/s*this._scale,this._minScale,this._maxScale);this.setScale(Math.min(n,a)),this.scrollToPage(this._currentPage)},this.onViewerScroll=e=>{this.renderVisiblePages()},this.onViewerPointerMove=e=>{const{clientX:t,clientY:r}=e,{x:s,y:n,width:a,height:i}=this._viewer.getBoundingClientRect(),o=t-s,h=r-n,c=a-o,d=i-h;Math.min(o,c,h,d)>100?this._panelsHidden||this._timers.hidePanels||(this._timers.hidePanels=setTimeout((()=>{this._mainContainer.classList.add("hide-panels"),this._panelsHidden=!0,this._timers.hidePanels=null}),5e3)):(this._timers.hidePanels&&(clearTimeout(this._timers.hidePanels),this._timers.hidePanels=null),this._panelsHidden&&(this._mainContainer.classList.remove("hide-panels"),this._panelsHidden=!1)),this._pointerInfo.lastPos=new u(t,r)},this.onViewerPointerDown=e=>{if("hand"!==this._mode)return;const{clientX:t,clientY:r}=e;this._pointerInfo.downPos=new u(t,r),this._pointerInfo.downScroll=new u(this._viewer.scrollLeft,this._viewer.scrollTop);const s=e=>{const{x:t,y:r}=this._pointerInfo.downPos,{x:s,y:n}=this._pointerInfo.downScroll,a=e.clientX-t,i=e.clientY-r;this._viewer.scrollTo(s-a,n-i)},n=e=>{this._pointerInfo.downPos=null,this._pointerInfo.downScroll=null,window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",n),window.removeEventListener("pointerout",n)};window.addEventListener("pointermove",s),window.addEventListener("pointerup",n),window.addEventListener("pointerout",n)},this.onViewerTouchStart=e=>{if(2!==e.touches.length)return;const t=e.touches[0],r=e.touches[1];this._pinchInfo.active=!0,this._pinchInfo.lastDist=h(t.clientX,t.clientY,r.clientX,r.clientY);const s=e=>{if(2!==e.touches.length)return;const t=e.touches[0],r=e.touches[1],s=h(t.clientX,t.clientY,r.clientX,r.clientY),n=s-this._pinchInfo.lastDist,a=Math.floor(n/this._pinchInfo.minDist);if(a){const e=new u((r.clientX+t.clientX)/2,(r.clientY+t.clientY)/2);this._pinchInfo.lastDist=s,this.zoom(a*this._pinchInfo.sensitivity,e)}},n=t=>{this._pinchInfo.active=!1,this._pinchInfo.lastDist=0,e.target.removeEventListener("touchmove",s),e.target.removeEventListener("touchend",n),e.target.removeEventListener("touchcancel",n)};e.target.addEventListener("touchmove",s),e.target.addEventListener("touchend",n),e.target.addEventListener("touchcancel",n)},this.onViewerWheel=e=>{e.ctrlKey&&(e.preventDefault(),e.deltaY>0?this.zoomOut(this._pointerInfo.lastPos):this.zoomIn(this._pointerInfo.lastPos))};const s=document.querySelector(e);if(!s)throw new Error("Container not found");if(!(s instanceof HTMLDivElement))throw new Error("Container is not a DIV element");if(this._outerContainer=s,!t)throw new Error("Worker source path not defined");r.workerSrc=t,this.initViewerGUI()}destroy(){var e,t;null===(e=this._pdfLoadingTask)||void 0===e||e.destroy(),this._pages.forEach((e=>e.destroy())),this._pdfDocument&&(this._pdfDocument.cleanup(),this._pdfDocument.destroy()),null===(t=this._mainContainerResizeObserver)||void 0===t||t.disconnect(),this._shadowRoot.innerHTML=""}openPdfAsync(e){return Ds(this,void 0,void 0,(function*(){let t,r;try{if(e instanceof Uint8Array)t=e;else{let r;if("string"==typeof e){const t=yield fetch(e);r=yield t.blob()}else r=e;const s=yield r.arrayBuffer();t=new Uint8Array(s)}}catch(e){throw new Error(`Cannot load file data: ${e.message}`)}const n=new Rs(t);let a;for(;;){if(n.tryAuthenticate(a))break;if(a=yield this.showPasswordDialogAsync(),null===a)throw new Error("File loading cancelled: authentication aborted")}t=n.getRefinedData();try{if(this._pdfLoadingTask)return yield this.closePdfAsync(),this.openPdfAsync(t);this._pdfLoadingTask=s({data:t,password:a}),this._pdfLoadingTask.onProgress=this.onPdfLoadingProgress,r=yield this._pdfLoadingTask.promise,this._pdfLoadingTask=null}catch(e){throw new Error(`Cannot open PDF: ${e.message}`)}yield this.onPdfLoadedAsync(r,n)}))}closePdfAsync(){return Ds(this,void 0,void 0,(function*(){this._pdfLoadingTask&&(this._pdfLoadingTask.destroyed||(yield this._pdfLoadingTask.destroy()),this._pdfLoadingTask=null),yield this.onPdfClosedAsync()}))}initViewerGUI(){this._shadowRoot=this._outerContainer.attachShadow({mode:"open"}),this._shadowRoot.innerHTML='\n  <style>\n    :host {\n      --color-primary-final: var(--color-primary, rgba(40,40,40,1));\n      --color-primary-tr-final: var(--color-primary-tr, rgba(40,40,40,0.9));\n      --color-secondary-final: var(--color-secondary, rgba(60,60,60,1));\n      --color-secondary-tr-final: var(--color-secondary-tr, rgba(60,60,60,0.9));\n      --color-accent-final: var(--color-accent, rgba(96,96,96,1));\n      --color-shadow-final: var(--color-shadow, rgba(0,0,0,0.75));\n      --color-bg-final: var(--color-bg, rgba(128,128,128,1));\n      --color-fg-primary-final: var(--color-fg-primary, rgba(255,255,255,1));\n      --color-fg-secondary-final: var(--color-fg-secondary, rgba(187,187,187,1));\n      --color-fg-accent-final: var(--color-fg-accent, rgba(255,255,255,1));\n      --color-text-selection-final: var(--color-text-selection, rgba(104,104,128,0.3));\n    }\n\n    .disabled {\n      pointer-events: none;\n    }\n\n    .relative {\n      position: relative;\n    }\n    .absolute {\n      position: absolute;\n    }\n    .abs-stretch {\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n    }\n    .abs-topleft {\n      position: absolute;\n      left: 0;\n      top: 0;\n    }\n    .stretch {\n      width: 100%;\n      height: 100%;\n    }\n\n    #main-container {\n      box-sizing: border-box;\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      justify-content: stretch;\n      align-items: stretch;\n      width: 100%;\n      height: 100%;\n      background: var(--color-bg-final);\n    }\n  \n    #panel-top {\n      position: relative;\n      display: flex;\n      flex-direction: row;\n      justify-content: space-between;\n      align-items: center;\n      flex-shrink: 0;\n      width: 100%;\n      height: 50px;\n      background: var(--color-primary-final);\n      box-shadow: 0 0 10px var(--color-shadow-final);\n      z-index: 1;\n      transition: height 0.25s ease-out 0.1s;\n    }\n    .hide-panels #panel-top {\n      height: 0;\n      transition: height 0.25s ease-in 0.2s;\n    }\n  \n    #panel-bottom {\n      position: absolute;\n      display: flex;\n      flex-direction: row;\n      justify-content: center;\n      align-items: center;\n      flex-grow: 0;\n      flex-shrink: 0;\n      left: calc(50% - 160px);\n      bottom: 20px;\n      width: 320px;\n      height: 50px;  \n      background: var(--color-primary-tr-final);\n      box-shadow: 0 0 10px var(--color-shadow-final);\n      z-index: 1;\n      transition: height 0.25s ease-out, bottom 0.1s linear 0.25s;\n    }\n    .hide-panels #panel-bottom {\n      bottom: 0;\n      height: 0;\n      transition: bottom 0.1s linear 0.1s, height 0.25s ease-in 0.2s;\n    }\n\n    .panel-v-separator {\n      width: 1px;\n      height: 30px;\n      background-color: var(--color-fg-secondary-final);\n    }\n  \n    .panel-button {\n      cursor: pointer;\n      user-select: none;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      width: 36px;\n      height: 36px;\n      border-radius: 50%;\n    }\n    .panel-button:hover,\n    .panel-button.on {\n      background-color: var(--color-accent-final);\n    }\n    .panel-button img {\n      width: 20px;\n      height: 20px;\n      filter: invert() opacity(0.5) drop-shadow(0 0 0 var(--color-fg-primary-final)) saturate(1000%);\n    }  \n    .panel-button:hover img,\n    .panel-button.on img {\n      filter: invert() opacity(0.5) drop-shadow(0 0 0 var(--color-fg-accent-final)) saturate(1000%);\n    }  \n  \n    .subpanel {\n      display: flex;\n      flex-direction: row;\n      justify-content: center;\n      align-items: center;\n      margin: 0 4px;\n    }    \n    \n    .panel-item {\n      transform: scale(1);\n      transition: opacity 0.1s ease-out 0.35s, transform 0s linear 0.35s;\n    }\n    .hide-panels .panel-item {\n      cursor: default;      \n      opacity: 0;\n      transform: scale(0);\n      transition: opacity 0.1s ease-in, transform 0s linear 0.1s;\n    }\n  \n    #paginator {  \n      user-select: none;\n      font-family: sans-serif;\n      font-size: 16px;\n      color: var(--color-fg-primary-final);\n    }\n    #paginator-input {\n      text-align: center; \n      font-size: 16px;\n      width: 30px;\n      height: 30px;\n      margin: 2px;\n      padding: 0;\n      outline: none;\n      border: none;\n      color: var(--color-fg-primary-final);\n      background-color: var(--color-primary-final);\n    }\n    #paginator-total {\n      margin: 4px;\n    }\n\n    #toggle-previewer {\n      margin: 4px;\n    }\n      \n    #previewer {\n      box-sizing: border-box;\n      position: absolute;\n      display: flex;\n      flex-direction: column;\n      justify-content: flex-start;\n      overflow-y: auto;\n      left: 0;\n      top: 50px;\n      bottom: 0;\n      width: 160px; \n      padding-top: 0px;\n      background: var(--color-secondary-final);\n      box-shadow: 0 0 10px var(--color-shadow-final);\n      z-index: 1;\n      transition: padding-top 0.25s ease-out 0.1s, top 0.25s ease-out 0.1s, width 0.25s ease-out;\n    } \n    .hide-panels #previewer {\n      top: 0;\n      padding-top: 50px;\n      transition: padding-top 0.25s ease-in 0.2s, top 0.25s ease-in 0.2s;\n    }   \n    .mobile #previewer {\n      background: var(--color-secondary-tr-final);\n    } \n    .hide-previewer #previewer {\n      width: 0;\n      transition: width 0.25s ease-in 0.1s;\n    }\n    #previewer .page-preview {      \n      transform: scaleX(1);\n      transition: opacity 0.1s ease-out 0.35s, transform 0s linear 0.35s;\n    }\n    .hide-previewer #previewer .page-preview {\n      opacity: 0;\n      transform: scaleX(0);\n      transition: opacity 0.1s ease-in, transform 0s linear 0.1s;\n    }\n  \n    #viewer {\n      box-sizing: border-box;\n      position: absolute;\n      display: flex;\n      flex-direction: column;\n      justify-content: flex-start;\n      overflow: auto;\n      left: 160px;\n      right: 0;\n      top: 50px;\n      bottom: 0;\n      padding-top: 0px;\n      transition: padding-top 0.25s ease-out 0.1s, top 0.25s ease-out 0.1s, left 0.25s ease-out;\n    }\n    #viewer.mode-hand {\n      cursor: grab !important;\n      user-select: none !important;\n    }\n    .hide-panels #viewer {\n      top: 0;\n      padding-top: 50px;\n      transition: padding-top 0.25s ease-in 0.2s, top 0.25s ease-in 0.2s;\n    }      \n    .hide-panels.mobile #viewer,\n    .hide-panels.hide-previewer #viewer {\n      top: 0;\n      padding-top: 50px;\n      left: 0;\n      transition: padding-top 0.25s ease-in 0.2s, top 0.25s ease-in 0.2s, left 0.25s ease-in;\n    }   \n    .mobile #viewer,\n    .hide-previewer #viewer {\n      top: 50px;\n      padding-top: 0px;\n      left: 0;\n      transition: padding-top 0.25s ease-out 0.1s, top 0.25s ease-out 0.1s, left 0.25s ease-in;\n    } \n  \n    .page {    \n      position: relative;\n      display: flex;\n      flex-grow: 0;\n      flex-shrink: 0;\n      margin: 10px auto;\n      background-color: white;\n      box-shadow: 0 0 10px var(--color-shadow-final);\n    }\n    .page-preview {   \n      cursor: pointer; \n      position: relative;\n      display: flex;\n      flex-grow: 0;\n      flex-shrink: 0;\n      margin: 0 auto;\n      background-color: white;\n      background-clip: content-box;\n      border-style: solid;\n      border-width: 10px 10px 20px 10px;\n      border-color: transparent;\n    }\n    .page-preview:hover,\n    .page-preview.current {\n      border-color: var(--color-accent-final);\n    }\n    .page-preview::after {\n      display: inline-block;\n      position: absolute;\n      top: calc(100% + 3px);\n      width: 100%;\n      text-align: center;\n      font-family: sans-serif;\n      font-size: 14px;\n      line-height: 1;\n      color: var(--color-fg-primary-final);\n      content: attr(data-page-number) " ";\n    }\n\n    .page-canvas {\n      background-color: white;\n    } \n    \n    .page-text {\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      margin: 0;\n      padding: 0;\n      overflow: hidden;\n      line-height: 1;\n    }\n    .page-text span {\n      cursor: text;\n      position: absolute;\n      white-space: pre;\n      color: transparent;\n      transform-origin: 0% 0%;\n    }\n    .page-text ::selection {\n      background: var(--color-text-selection-final);\n    }\n    .mode-hand .page-text span {\n      cursor: grab;\n    }\n    \n    .page-annotations {\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      margin: 0;\n      padding: 0;\n      overflow: hidden;\n    }\n    .mode-text .page-annotations,\n    .mode-hand .page-annotations {\n      pointer-events: none;\n    }\n    \n    #password-dialog {\n      position: absolute;\n      left: 0;\n      top: 0;\n      width: 100%;\n      height: 100%;\n      background: var(--color-secondary-tr-final);\n      z-index: 2;\n    }\n    #password-dialog .form {\n      position: absolute;\n      display: flex;\n      flex-direction: row;\n      justify-content: stretch;\n      align-items: stretch;\n      flex-grow: 0;\n      flex-shrink: 0;\n      left: calc(50% - 160px);\n      top: calc(50% - 25px);\n      width: 320px;\n      height: 50px;  \n      background: var(--color-primary-tr-final);\n      box-shadow: 0 0 10px var(--color-shadow-final);\n    }\n    #password-dialog input {\n      width: 220px;\n      margin: 10px 0 10px 10px;\n      padding: 5px;\n      font-size: 16px;\n      outline: none;\n      border: none;\n      color: var(--color-fg-primary-final);\n      background-color: var(--color-primary-final);\n    }\n    #password-dialog input::placeholder {\n      font-size: 14px;\n      font-style: italic;\n      color: var(--color-fg-primary-final);\n    }\n    #password-dialog .buttons {\n      display: flex;\n      flex-direction: row;\n      justify-content: center;\n      align-items: center;\n      flex-grow: 1;\n      flex-shrink: 1;\n      width: 100px;\n    } \n\n    .svg-annotation {\n      cursor: pointer;\n    } \n    .svg-annot-rect,\n    .svg-annot-box {\n      fill: transparent;\n    }\n    .mode-annotation .svg-annotation.selected {\n      cursor: grab;\n    } \n    .mode-annotation .svg-annotation.selected .svg-annot-rect,\n    .mode-annotation .svg-annotation.selected .svg-annot-box {\n      stroke: var(--color-secondary-tr-final);\n      stroke-dasharray: 3 3;\n    } \n    .mode-annotation .svg-annotation.selected .svg-annot-handle-scale,\n    .mode-annotation .svg-annotation.selected .svg-annot-handle-rotation {\n      r: 5;\n      fill: var(--color-primary-final);\n      cursor: pointer;\n    }\n    .mode-annotation .svg-annotation.selected .svg-annot-rotation {\n      fill: none;\n      cursor: pointer;\n    }\n    .mode-annotation .svg-annotation.selected .svg-annot-rotation .circle {\n      r: 25;\n    }\n    .mode-annotation .svg-annotation.selected .svg-annot-rotation .dashed {\n      stroke: var(--color-secondary-tr-final);\n      stroke-dasharray: 3 3;\n    }\n  </style>\n\n  <div id="main-container" class="hide-previewer" \n    ondragstart="return false;" ondrop="return false;">\n    <div id="viewer"></div>\n    <div id="previewer"></div>\n    <div id="panel-top"> \n      <div class="subpanel panel-item">\n        <div id="toggle-previewer" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcmlDQ1BpY2MAACiRdZE9S8NQFIbftkpFWwrqIOKQoYpCC0VBHKWCXapDW8GqS3KbtEKShpsUKa6Ci0PBQXTxa/Af6Cq4KgiCIoi4+Af8WqTEc5tCi7Qn3JyH9573cO+5gD+tM8PuSQCG6fBMKimt5tek4Dt8GEQYQ5iSmW0tZRdz6Bo/j1RN8RAXvbrXdYyBgmozwNdHPMss7hDPE6e3HEvwHvEwK8kF4hPiGKcDEt8KXfH4TXDR4y/BPJdZAPyip1RsY6WNWYkbxJPEUUOvsOZ5xE1CqrmSpTxKaww2MkghCQkKKtiEDgdxyibNrLMv0fAto0weRn8LVXByFFEib4zUCnVVKWukq/TpqIq5/5+nrc1Me91DSaD31XU/x4HgPlCvue7vqevWz4DAC3BttvxlmtPcN+m1lhY9BiI7wOVNS1MOgKtdYOTZkrnckAK0/JoGfFwA4TwwdA/0r3uzau7j/AnIbdMT3QGHR8AE1Uc2/gDt82gCvNGYhAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAcpJREFUeNrtWwFuwyAMjBEPWNf8/4XpugesoWMKUppBYidQ5cAnVZWaRtGdDxscoC6Bvu9d7PfRue6sMETJa8MwRC8Slzi6ACkhiEu8FgGWQpiucdBW9FNj5wiWzyvxjOk5/muVm30n8Xfjl8NfkNeEMLHo10Cem/CbyAHeCZMb/sGePfqTfXfh5/Hovu/3F25Lx9ujiURad6WIld1xHDtjTLLshXv8f7Zgka2dY04ClQNCxDmR5eL0Dvi63Vavf16vh1xjzzy13YKUPPQQWFaDHOShBJjX8VzkIRdDa+RDvvBlskoBOOSlVcLURr7KIVCKPIQAJclDJsGc5FkzwdBUqJE8pANykocTIDd59mKI2zIv0Q8oSR7GAaXIQwhQkjx0GVQBGI5xjEWRrTGqkmGjQ0AFUAFUABVABVAB2sXmRMi3pEbnSDLJyNm3h3MAEvnsAqCRZw0Bb/l5Q2THjg1qaghoFVABVAAVQAVQAVQAFUCCI9thxYSJXj5WcspCHaACNNgP+LhcTr+gySqAX/nNX2nP99ujI/aaX3NAbAPDkQ0RSNFfPTUWbkA/QLUVTNoT9RpOj+rJ0aUDJE5AdkDy8LRECEQBUrnsCeUexwK5uUFRAAAAAElFTkSuQmCC"/>\n        </div> \n      </div>\n      <div id="modes" class="subpanel panel-item">\n        <div id="button-mode-text" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABb2lDQ1BpY2MAACiRdZE7SwNBFIU/N4piFBEtRCxSRLFQCApiKRFMoxYxgq8mu24SIRuX3Q0itoKNRcBCtPFV+A+0FWwVBEERRGz8A74akfVOVohIMsvs/Tgz5zJzBrTJvGG59TGwCp6TTMQjc/MLkcYXQmiE6aQ9bbj21MxEiprj8446VW8HVa/a+6qO8LLpGlDXJDxi2I4nPCY8uebZireFO41celn4UHjAkQMKXyldD/hZcTbgd8VOKjkOmuoZyf5h/Q8bOccS7heOWvmi8XsedZMWszA7I7VbZg8uSRLEiaBTZIU8HoNSC5JZdV+s7JtmVTyG/G3WccSRJSfeAVGL0tWUmhHdlC/Pusr9f55uZngo6N4Sh4Yn33/rhcYd+C75/teR738fQ+gRLgoV/6rkNPoheqmiRQ+gbRPOLiuavgvnW9D1YKeddFkKydQyGXg9hdZ56LiB5sUgq991Tu4htSFPdA17+9An+9uWfgCZXmfbLPy9EwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAtBJREFUeNrlWwtuwjAMra2cALj/CWFHWLYiQKGLEzu282GRqiFo3bznT23PhY1Yl8vl/vd6vW6VFTf5AitZp/P5JQsByPMoHEABr12oAE/d21IWG0+gTuywYrLx2OumR8sOSnmg3LwaONcFiqZT0j4jBngAhoZYVDX/HLbQCfgRWJT6MkVGycefn0tEQO5HS7YJWWwCanI5+y8REKxUu99UEEhzsQO0hFOKK5GFrdrfhT2PQU+RJiVVCdA8WkYA0O4DPTdrHUg5AKUk4AhNzURy0DIqDH4uJB/3sH+mAt+fVPg7Ri+Nx5bonpFtIscrFeZkfFGxeSs5pLLQGfww2Vy3xIXAu9wDO2xMY7bgTQJODF5EQi4Q59zg+B1ODt7FElIS4HQ+v/34dbv1Ah8NrqleW+t14OSad7cEXAi8Cwm4GHgVCRbl8Azgm0igiqagBf/rR+BZCVaKGaor/ZY2l/aEC2reNCaE9LGXtrgy1diM4KuW8Lt/YPcDMqayAniVO+CiZm/mDvhB4JtIwA8DLyYBt3++Qmsw6bUa8wq2FeOoRoTjErkw9io6ZgR/dwGLVHMl8Mf+BzIaCCtYQvOTC5m9tJlJUD22JdVg1h0etQKsCP7lAtyO6mSWYJKwoaQWn4gEs2wVGxOOkSSYpuqaVHgECeZ1ingqy3BTUXl+E/gU3z4aYFEM9bAEc/B38wdonxLrSIJreW5ZDnuQYAaecm3UChjQNDG7B/m/QcoNJiDBXDZ22CiMluM6K1wQDoqgaqb12mMdS/6hcINlFqZDz9z3hVYnIcUVtg9dZmNyveZ+e4En3xpLL+aAfp43G0Fdp8UVsSCOKKWzEyKcbtAKbpAL4hwMotfmDF6vE78252mJr1RYo+G9KfpojHIOiYuwjlalNI3LCwYopFle1ChAky2GI7iOSc4xz+/SVK0+BrlEPH6HwgyR1MebSOBOqVHf/wB4polu0KoYHQAAAABJRU5ErkJggg=="/>\n        </div> \n        <div id="button-mode-hand" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcWlDQ1BpY2MAACiRdZE9S8NQFIbfpkpFqx3qIMUhQxWHFoqCOEoFu1SHtoJVl+Q2aYQkDUmKFFfBxaHgILr4NfgPdBVcFQRBEURc/AN+LVLiuU2hRdoTbs7De897uPdcQMjqzHD6UoBhunYukxZXi2ti6B0BxDACAVGJOdZSfrGAnvHzSNUUD0neq3dd1xgqKQ4DAgPEs8yyXeJ54uyWa3HeIx5lmlQiPiFO2HRA4luuyz6/cS77/MXZLuQWAIH3FMsdLHcw02yDeIo4buhV1joPv0lYMVfylGO0xuEghwzSECGjik3ocJGkbNLMuvtSTd8yKuRh9LdQg02OMjTyJkitUleFskq6Qp+OGp/7/3k66sy03z2cBvpfPe9zAgjtA4265/2eel7jDAi+ANdm21+hOc19k15va/FjILIDXN60NfkAuNoFxp4tyZaaUpCWoKrAxwUwXASi98Dguj+r1j7On4DCNj3RHXB4BExSfWTjD603Z+Sp2ztrAAAACXBIWXMAAAsTAAALEwEAmpwYAAADGklEQVR42uVbC47jIAytESeY6f1P2NkjLCOqInmoP5g4BChSpLZJAT8/G9sQuDHtfr+Tv/9P6WZp/35+tP6lDsEyXgBg7z0eD3qAVsE9AWgU/s8cOQG+vr+bAOCAiK2Cn9CS4TnwGrTIWYAItw9voGmfo56DJlI1DnD38jx75qGxOvcZRwuuCV++V888zaCmLyUkvlc+S0BE6uZBtBMDKHjYbvnMzVG6Rz0bvbSaByWo+0frR0GQWCSZicSE0Kv93Fm5mAl10V/4PSkrSGpRkgrAUXoatWbq8yVA8ujfFQBOg56UbxXQCoIXACytvUHwBjkepffL+Q0PYGqQseaxw5WWyScDcmyPr6uEYOzdnT3YcTcxwMsBtsTlXv1aVoJwpv0bNH16tDl8FThTmwygXeYSBtn61YAmLn6YlgFW0Bg/UgueatMYWQ+AWRiFQZjSBOql6kwneWlF6MyaA8E+6EqHtUleEQUeMD2ofcJH1QRPS4cno7tp/NjoMGbSIljpL4EfPo3ybwzAOzd5aRC0DSOTllEgBEPykBSAlmzBkjkhILyWJLb2Vy7qP54heW89oGu/rgiEKskiRdGETyurBUr7L08L0sA9FdhpTYBaZopmpMKjBwjO+5KiuVD9xVYPSuzXTRdAtdQRc90TnyMIBxBetuHib+jQxjYgPNnQ68m3igOsjm0nEALl4Q2BzvIgRC3Qwaewciu5A9pzr4sM65nAQRYszYioxPzqQUXsDzJbOMZMDwAX6GQB6vM522WDStKzdYt1HlCzQNrBXZEROAxuDYS2YUGtrAwGmw1+SmsNhdMm2n87Wxha1/PdvH/xa8GQg69eEL3ufMBszg+zPBjD2jRwgmfavv7CxC7rvqbcgA89E4cKYQNfkCTlDt0XmGDZezNt1QmuGBgJwvNvjeE/t5Siy3ncq/f9LcJTrA1Wp7GAQ2SFJ0+ItGx5C0XQNJPmhYIuiG+Otm5P9QzQypwjpmSlPR4TNDoTr6iRA40+ak/l95QD1+RaemdIE96UDqMDCUuBYBW+lhM0O1VC4nQl/SkW1MJrcvwCJhH28gf87HUAAAAASUVORK5CYII="/>\n        </div> \n        <div id="button-mode-annotation" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABb2lDQ1BpY2MAACiRdZE7SwNBFIU/N4piFBEtRCxSRLFQCApiKRFMoxYxgq8mu24SIRuX3Q0itoKNRcBCtPFV+A+0FWwVBEERRGz8A74akfVOVohIMsvs/Tgz5zJzBrTJvGG59TGwCp6TTMQjc/MLkcYXQmiE6aQ9bbj21MxEiprj8446VW8HVa/a+6qO8LLpGlDXJDxi2I4nPCY8uebZireFO41celn4UHjAkQMKXyldD/hZcTbgd8VOKjkOmuoZyf5h/Q8bOccS7heOWvmi8XsedZMWszA7I7VbZg8uSRLEiaBTZIU8HoNSC5JZdV+s7JtmVTyG/G3WccSRJSfeAVGL0tWUmhHdlC/Pusr9f55uZngo6N4Sh4Yn33/rhcYd+C75/teR738fQ+gRLgoV/6rkNPoheqmiRQ+gbRPOLiuavgvnW9D1YKeddFkKydQyGXg9hdZ56LiB5sUgq991Tu4htSFPdA17+9An+9uWfgCZXmfbLPy9EwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAhxJREFUeNrtW1lywyAMtRhO0OT+J3SaHqCxanfijsuAEQaEWDTjn2CM3kMbS2ByyP1+R9vvC+IkVRSAs22eZ2sjUIHXToCLCKACb4UAkwg1dS7gm32X78TIOp45RhZw73FOsWlO4NzyJhbOiFC22W8BPDXgdxEDNktwuZmWPvtmvAiR79dr+no+/2EzLV7nVCBFgLOl3WVZJqWUM+3tfbZ3fKJrNu0UNYmOncFYCwktdDbQlJlNRkBp+Xw8Tts/brcoq4H1A2gMSAmCUuthr+4m3iu2hIINJli37tcCKoeZSXaB4CDoiPLkgWxZ5Opi6Czg7cHSfMcXRKtxAQp4LhdoBnwVBOQEX3UWSAF+FEKbBWxMBrLZVCG0d/p9THZ87wt9KBbw94ClU9MuYOquMw7UbCnc/VpgEDAIaEhitsQ4MgFItQCuNIjDBYQSwFUHgOQYAD1bwEiDzRBw3HEJPWWpUUyMuhfgLhJ0dyZvHKnrkKtlIwgOAgYB7RNAvTJbo9iwjauyLmZauyzpwqh9HWonwufScMX3z66nHc7pkxK3fhcpVSu1rslyXf54xLYrnBK8OUbS/YCdkZRZYFM81hJSEmlzaedd4VRExJCQEjz5P0MJBH3xhvk7/jQokATk0jdnirsKAjl1zZ3jQ8Egt54cRQ4VFJbQkavK84HDUvpxlrkoUTfuOh+l6VVioYOSdCq50kNBuhQloegO1A9Y7hjyBIja5wAAAABJRU5ErkJggg=="/>\n        </div> \n      </div>\n    </div>\n    <div id="panel-bottom" class="disabled">\n      <div id="paginator" class="subpanel panel-item">\n        <div id="paginator-prev" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="paginator-next" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <input id="paginator-input" type="text">\n        <span>&nbsp/&nbsp</span>\n        <span id="paginator-total">0</span>\n      </div>\n      <div class="panel-v-separator panel-item"></div>\n      <div id="zoomer" class="subpanel panel-item">\n        <div id="zoom-out" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="zoom-in" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="zoom-fit-viewer" class="panel-button">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcWlDQ1BpY2MAACiRdZG9S8NQFMVPW8Wi1Q46SHHIUMWhhaIgjlLBLtWhrWDVJXlN2kKShpcUKa6Ci0PBQXTxa/A/0FVwVRAERRBx8R/wa5ES72sKLdLe8PJ+nHfP5eUE8Kd1Zth9CcAwHZ5JJaW1/Lo08A4fRhBEHBGZ2dZydimHnvXzSN1UD3Exq3df1xoqqDYDfEHiOWZxh3iBOL3lWIL3iMdYSS4QnxDHOF2Q+Fboisdvgosefwnmucwi4BczpWIHKx3MStwgniaOGnqVte4jviSkmqtZ2iO0JmAjgxSSkKCgijJ0OJRLGSZl1t2XaPpWUCEPo7eFGjg5iiiRN0ZqlaaqtGukq/ToqInc/+dpa7Mz3vRQEuh/dd3PSWBgH2jUXff31HUbZ0DgBbg22/4K5TT/TXq9rUWPgfAOcHnT1pQD4GoXGH+2ZC43pQAtv6YBHxfAcB4YvQcGN7ysWuc4fwJy2/SL7oDDI2CK+sObf/JNaAQfxWcoAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+0lEQVR42u2bMW/EIAyFA7qla5Ol///HdUm6dguFKlQuBwnh7ADKs5TlTsrxPp6NAZ16H0czCMTXsijO90mNUw83DwC4OwAV5hZ37rYWoV6kAAAAAAAAAAAAAAAAAAAAAADcMh6CO63F7iwnkR2cUmqe57YcEIq3zyg4cWaapnYARM7rRjtLYupXY9ggaAHxzqKDtSgbAXdIkwBqqgK4QryP8J3OBe6xLjBVAFwpnjoh9rmDUJoOuhfxqXTwTiitCbon8WE6ROrCaQi6N/GxdFjX9XtzwWkIukS8/cHPmuKfnKD1W6kTdMnM2x/8qC0+VhNIPciGoEts7+nb75ro53cm4nCJ3L0ZkrqRvWSXRwokBZR9M9SzeJoOR82SziHYe5C6kA/A2cZB8E/PsXfh+zgqLt4+DgIl2cotsivEdizJlD0aZ84ymOy/G5nd5FhyJukQwHby8td60jW3hULpxP8Wu605O+vQrEaIQqDtZ20nePG+OStJz+xW+MkJpP2s4QQqvmTmizZDUSdsg7jSCVzii7bDHkK4PF5VEzjFFx+IOAip/lsSArf4YgCxZkl6iZQQ/zKAVJ/AnQ5S4lkA0Jog3Msv3OK5HBBdHZjj300TZxvOdjcoCYHrjlHMAT0HAAAAAAAAAAAAAAAAAAAAANwzFP47jBQAgFvHDyRnPtj60cBDAAAAAElFTkSuQmCC"/>\n        </div>\n        <div id="zoom-fit-page" class="panel-button">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcWlDQ1BpY2MAACiRdZG9S8NQFMVPW8Wi1Q46SHHIUMWhhaIgjlLBLtWhrWDVJXlN2kKShpcUKa6Ci0PBQXTxa/A/0FVwVRAERRBx8R/wa5ES72sKLdLe8PJ+nHfP5eUE8Kd1Zth9CcAwHZ5JJaW1/Lo08A4fRhBEHBGZ2dZydimHnvXzSN1UD3Exq3df1xoqqDYDfEHiOWZxh3iBOL3lWIL3iMdYSS4QnxDHOF2Q+Fboisdvgosefwnmucwi4BczpWIHKx3MStwgniaOGnqVte4jviSkmqtZ2iO0JmAjgxSSkKCgijJ0OJRLGSZl1t2XaPpWUCEPo7eFGjg5iiiRN0ZqlaaqtGukq/ToqInc/+dpa7Mz3vRQEuh/dd3PSWBgH2jUXff31HUbZ0DgBbg22/4K5TT/TXq9rUWPgfAOcHnT1pQD4GoXGH+2ZC43pQAtv6YBHxfAcB4YvQcGN7ysWuc4fwJy2/SL7oDDI2CK+sObf/JNaAQfxWcoAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB30lEQVR42u2bzXKDIBCAw+ql6cnqpQ/Q93+f9gF60aan9GKwmkqHsXZA5Wd3YWcyySFO+D4WCLKKU+R4qush5u/DKfHIAlIXIFIDXs45eQhkAYlHiaUhTdMMcvgZniDcTE397Xb9vFweKQgoFfwU+ue1kFJ+AcDDf6J+RQKcqWRAv+cikyhqc4Ax71WPT73Pbg746Lpd/0uO7iVIrwIuNlJkBIyrhJddJBkBbdt62UIDp7Qf5xExL5PvLAXYwM+rxDM7AbbwLIeAL3gSAnzCoxfgGx61gBDwaAWEgkcpICQ8OgGh4VEJiAGPRkAseBQCPMF3JAQo+LV7e3vh9esGKd9M3xeppT2Kk6GYY/5PBiwb47sBmOCDZwA2eCsBVVW9Tg0fX63TsadNfLHgrQQIgBebHtza8+pQIyb81iFQc0n7YHMAdnivAijAexNABd6LAErwzgVQg3cqgCK8MwFU4Z0IoAx/WAB1+EMCOMBvEqAfOXOB3yRAHTlzgne6DOrwy3IW9gKWPa+Xs7AXQDHt9ThcJ7h2p8eiglPMdYF85oCpfvf+ble+OpDMAFNx8o7f7tELGHv2WhbF2SQGisJYv7soh+9JZICp3p565EdmsoDEQ8R+dpfSwUgeAlkAw/gGgdL3j4c6UpkAAAAASUVORK5CYII="/>\n        </div>\n      </div>\n    </div>\n  </div>\n';const e=this._shadowRoot.getElementById("paginator-input");e.addEventListener("input",this.onPaginatorInput),e.addEventListener("change",this.onPaginatorChange),this._shadowRoot.querySelector("#paginator-prev").addEventListener("click",this.onPaginatorPrevClick),this._shadowRoot.querySelector("#paginator-next").addEventListener("click",this.onPaginatorNextClick),this._shadowRoot.querySelector("#zoom-out").addEventListener("click",this.onZoomOutClick),this._shadowRoot.querySelector("#zoom-in").addEventListener("click",this.onZoomInClick),this._shadowRoot.querySelector("#zoom-fit-viewer").addEventListener("click",this.onZoomFitViewerClick),this._shadowRoot.querySelector("#zoom-fit-page").addEventListener("click",this.onZoomFitPageClick),this._previewer=this._shadowRoot.querySelector("#previewer"),this._previewer.addEventListener("scroll",this.onPreviewerScroll),this._viewer=this._shadowRoot.querySelector("#viewer"),this._viewer.addEventListener("scroll",this.onViewerScroll),this._viewer.addEventListener("wheel",this.onViewerWheel),this._viewer.addEventListener("pointermove",this.onViewerPointerMove),this._viewer.addEventListener("pointerdown",this.onViewerPointerDown),this._viewer.addEventListener("touchstart",this.onViewerTouchStart),this._mainContainer=this._shadowRoot.querySelector("div#main-container");const t=new ResizeObserver(this.onMainContainerResize);t.observe(this._mainContainer),this._mainContainerResizeObserver=t,this._shadowRoot.querySelector("#toggle-previewer").addEventListener("click",this.onPreviewerToggleClick),this._shadowRoot.querySelector("#button-mode-text").addEventListener("click",this.onTextModeButtonClick),this._shadowRoot.querySelector("#button-mode-hand").addEventListener("click",this.onHandModeButtonClick),this._shadowRoot.querySelector("#button-mode-annotation").addEventListener("click",this.onAnnotationModeButtonClick),this.toggleMode("text")}refreshPagesAsync(){var e;return Ds(this,void 0,void 0,(function*(){this._pages.forEach((e=>{e.previewContainer.removeEventListener("click",this.onPreviewerPageClick),e.destroy()})),this._pages.length=0;const t=(null===(e=this._pdfDocument)||void 0===e?void 0:e.numPages)||0;if(this._shadowRoot.getElementById("paginator-total").innerHTML=t+"",t)for(let e=0;e<t;e++){const t=yield this._pdfDocument.getPage(e+1),r=new x(t,this._annotationData,this._maxScale,this._previewWidth);r.scale=this._scale,r.previewContainer.addEventListener("click",this.onPreviewerPageClick),this._previewer.append(r.previewContainer),this._viewer.append(r.viewContainer),this._pages.push(r)}}))}renderVisiblePreviews(){if(this._previewerHidden)return;const e=this._pages,t=this.getVisiblePages(this._previewer,e,!0),r=Math.max(Math.min(...t)-this._visibleAdjPages,0),s=Math.min(Math.max(...t)+this._visibleAdjPages,e.length-1);for(let t=0;t<e.length;t++){const n=e[t];t>=r&&t<=s&&n.renderPreviewAsync()}}renderVisiblePages(){var e,t;const r=this._pages,s=this.getVisiblePages(this._viewer,r),n=this._currentPage,a=this.getCurrentPage(this._viewer,r,s);if(n&&n===a||(null===(e=r[n])||void 0===e||e.previewContainer.classList.remove("current"),null===(t=r[a])||void 0===t||t.previewContainer.classList.add("current"),this._shadowRoot.getElementById("paginator-input").value=a+1+"",this.scrollToPreview(a),this._currentPage=a),-1===a)return;const i=Math.max(Math.min(...s)-this._visibleAdjPages,0),o=Math.min(Math.max(...s)+this._visibleAdjPages,r.length-1);for(let e=0;e<r.length;e++){const t=r[e];e>=i&&e<=o?t.renderViewAsync():t.clearView()}}scrollToPreview(e){const{top:t,height:r}=this._previewer.getBoundingClientRect(),{top:s,height:n}=this._pages[e].previewContainer.getBoundingClientRect(),a=s+n/2-(t+r/2)+this._previewer.scrollTop;this._previewer.scrollTo(0,a)}scrollToPage(e){const{top:t}=this._viewer.getBoundingClientRect(),{top:r}=this._pages[e].viewContainer.getBoundingClientRect(),s=r-(t-this._viewer.scrollTop);this._viewer.scrollTo(this._viewer.scrollLeft,s)}setScale(e,t=null){if(!e||e===this._scale)return;let r,s,n;if(t)for(const e of this._pages){const{x:a,y:i}=t,{x:o,y:h,width:c,height:d}=e.viewContainer.getBoundingClientRect();if(o<=a&&o+c>=a&&h<=i&&h+d>=i){r=e.viewContainer,s=(a-o)/c,n=(i-h)/d;break}}if(this._scale=e,this._pages.forEach((e=>e.scale=this._scale)),r&&(this._viewer.scrollHeight>this._viewer.clientHeight||this._viewer.scrollWidth>this._viewer.clientWidth)){const{x:e,y:a}=t,{x:i,y:o,width:h,height:c}=r.getBoundingClientRect(),d=i+h*s,l=o+c*n;let u=this._viewer.scrollLeft+(d-e),p=this._viewer.scrollTop+(l-a);if(u=u<0?0:u,p=p<0?0:p,p!==this._viewer.scrollTop||u!==this._viewer.scrollLeft)return void this._viewer.scrollTo(u,p)}setTimeout((()=>this.renderVisiblePages()),0)}zoom(e,t=null){const r=l(this._scale+e,this._minScale,this._maxScale);this.setScale(r,t||this.getViewerCenterPosition())}zoomOut(e=null){this.zoom(-.25,e)}zoomIn(e=null){this.zoom(.25,e)}getViewerCenterPosition(){const{x:e,y:t,width:r,height:s}=this._viewer.getBoundingClientRect();return new u(e+r/2,t+s/2)}toggleMode(e){if(e&&e!==this._mode){switch(this._mode){case"text":this._viewer.classList.remove("mode-text"),this._shadowRoot.querySelector("#button-mode-text").classList.remove("on");break;case"hand":this._viewer.classList.remove("mode-hand"),this._shadowRoot.querySelector("#button-mode-hand").classList.remove("on");break;case"annotation":this._viewer.classList.remove("mode-annotation"),this._shadowRoot.querySelector("#button-mode-annotation").classList.remove("on")}switch(e){case"text":this._viewer.classList.add("mode-text"),this._shadowRoot.querySelector("#button-mode-text").classList.add("on");break;case"hand":this._viewer.classList.add("mode-hand"),this._shadowRoot.querySelector("#button-mode-hand").classList.add("on");break;case"annotation":this._viewer.classList.add("mode-annotation"),this._shadowRoot.querySelector("#button-mode-annotation").classList.add("on");break;default:throw new Error(`Invalid viewer mode: ${e}`)}this._mode=e}}getVisiblePages(e,t,r=!1){const s=new Set;if(!t.length)return s;const n=e.getBoundingClientRect(),a=n.top,i=n.top+n.height;for(let e=0;e<t.length;e++){const n=t[e],o=r?n.previewContainer.getBoundingClientRect():n.viewContainer.getBoundingClientRect(),h=o.top,c=o.top+o.height;if(h<i&&c>a)s.add(e);else if(s.size)break}return s}getCurrentPage(e,t,r){const s=[...r];if(!s.length)return-1;if(1===s.length)return s[0];const n=e.getBoundingClientRect(),a=n.top,i=n.top+n.height/2;for(const e of s){const r=t[e].viewContainer.getBoundingClientRect().top;if(r>a)return r>i?e-1:e}throw new Error("Incorrect argument")}showPasswordDialogAsync(){return Ds(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const r=document.createElement("div");r.id="password-dialog",r.innerHTML='\n    <div class="form">\n      <input id="password-input" type="password" maxlength="127"/>\n      <div class="buttons">\n        <div id="password-ok" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="password-cancel" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n      </div>\n    </div>\n',this._mainContainer.append(r);let s="";const n=this._shadowRoot.getElementById("password-input");n.placeholder="Enter password...",n.addEventListener("change",(()=>s=n.value));const a=()=>{r.remove(),e(null)};r.addEventListener("click",(e=>{e.target===r&&a()})),this._shadowRoot.getElementById("password-ok").addEventListener("click",(()=>{r.remove(),e(s)})),this._shadowRoot.getElementById("password-cancel").addEventListener("click",a)}))}))}}export{Ts as TsPdfViewer};
